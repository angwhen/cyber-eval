JustSystems has issued an update to its Ichitaro product line ( Japanese office suite software ) , plugging a zero-day vulnerability 
This vulnerability is being actively exploited in the wild to specifically target Japanese organizations 
The content of the emails vary depending on the business interest of the targeted recipient 's organization ; however , all are about recent political events associated with Japan 
Often such exploitation attempts crash and then relaunch the document viewer to open a clean document in order to trick users into believing it is legitimate 
In this particular attack , opening the document and dropping the payload are done without crashing Ichitaro and , as such , users have no visual indications as to what is really happening in the background 
As Security Response previously discussed , unpatched vulnerabilities being exploited is nothing new for Ichitaro 
However , during our investigation of this Ichitaro zero-day attack , we discovered that the attack was in fact part of an ongoing cyberespionage campaign specifically targeting various Japanese organizations 
Symantec has named this attack campaign CloudyOmega 
However , some of the files exploit software vulnerabilities , and the aforementioned vulnerability in Ichitaro software is only one of them 
This blog provides insights into the history of the attack campaign , infection methods , malware payload , and the group carrying out the attacks 
The first attack of the campaign can be traced back to at least 2011 
Figure 1 shows the targeted sectors and the number of attacks carried out each year 
The perpetrators were very cautious launching attacks in the early years with attacks beginning in earnest in 2014 
By far , the public sector in Japan is the most targeted sector hit by Operation CloudyOmega 
This provides some clue as to who the attack group is 
Email is the predominant infection vector used in this campaign 
Figure 2 is an example of an email used in recent attacks prior to those exploiting the Ichitaro zero-day vulnerability 
Ironically , the attackers follow security best practices by indicating in the first email that the password will be sent to the recipient in a separate email 
The body of the email is very short and claims the attachment includes a medical receipt 
The file in the attachment has a Microsoft Word icon but , as indicated within Windows Explorer , it is an executable file 
The malware is exclusively used in the CloudyOmega attack campaign and first appeared in 2011 when it was used in an attack against a Japanese chemical company 
Each Emdivi variant has a unique version number and belongs to one of two types : Type S and Type T 
The unique version number is not only a clear sign that Emdivi is systematically managed , but it also acts as an encryption key 
Both Emdivi Type S and Type T share the following functionality : Type T is primarily used in Operation CloudyOmega , has been in constant development since the campaign was first launched in 2011 , and is written in the C++ programing language 
However , protection mechanisms and encryption , essential features for threat survival , are not present in Type S. One interesting trait of Type S is that it uses Japanese sentences that seem to be randomly taken from the internet to change the file hash 
For instance , in the example shown in Figure 4 , it uses a sentence talking about the special theory of relativity 
So far , a total of 50 unique domains have been identified from 58 Emdivi variants 
Almost all websites used as C & C servers are compromised Japanese websites ranging from sites belonging to small businesses to personal blogs 
We discovered that 40 out of the 50 compromised websites , spread across 13 IP addresses , are hosted on a single cloud-hosting service based in Japan 
The compromised sites are hosted on various pieces of web server software , such as Apache and Microsoft Internet Information Services ( IIS ) , and are on different website platforms 
This indicates that the sites were not compromised through a vulnerability in a single software product or website platform 
The compromised cloud hosting company has been notified but , at the time of writing , has not replied 
Symantec offers two IPS signatures that detect and block network communication between infected computers and the Emdivi C & C server : During our research , multiple samples related to this attack campaign were identified and allowed us to connect the dots , as it were , when it came to CloudyOmega 's connections to other attack groups 
In August 2012 , the CloudyOmega attackers exploited the zero-day Adobe Flash Player and AIR 'copyRawDataTo ( ) ' Integer Overflow Vulnerability ( CVE-2012-5054 ) in an attack against a high-profile organization in Japan 
As CVE- 2012-5054 was publicly disclosed in the same month , the attack utilized what was , at the time , a zero-day exploit 
Interestingly , the Flash file that was used in an Emdivi attack in 2012 and the one used in the LadyBoyle attack in 2013 look very similar 
Figure 6 shows the malformed SWF file executing LadyBoyle ( ) code that attempts to exploit the Adobe Flash Player CVE-2013-0634 Remote Memory Corruption Vulnerability ( CVE-2013-0634 ) 
The Flash file seems to have been created using the same framework used by the CloudyOmega group , but with a different exploit 
No other evidence connects these two different campaigns ; however , as described previously in Symantec Security Response 's Elderwood blog , it is strongly believed that a single parent organization has broken into a number of subgroups that each target a particular industry 
In terms of the latest attack on Ichitaro , we collected a dozen samples of JTD files , all of which are exactly the same except for their payload 
The parent organization , it would seem , supplied the zero-day exploit to the different subgroups as part of an attack toolkit and each group launched a separate attack using their chosen malware 
This is why three different payloads ( Backdoor.Emdivi , Backdoor.Korplug , and Backdoor.ZXshell ) were observed in the latest zero-day attack 
Operation CloudyOmega was launched by an attack group that has communication channels with other notorious attack groups including Hidden Lynx and the group responsible for LadyBoyle 
CloudyOmega has been in operation since 2011 and is persistent in targeting Japanese organizations 
With the latest attack employing a zero-day vulnerability , there is no indication that the group will stop their activities anytime soon 
Symantec Security Response will be keeping a close eye on the CloudyOmega group 
It is highly recommended that customers using Ichitaro products apply any patches as soon as possible 
Repressive nation-states have long monitored telecommunica- tions to keep tabs on political dissent 
The Internet and online social networks , however , pose novel technical challenges to this practice , even as they open up new domains for surveil- lance 
We analyze an extensive collection of suspicious files and links targeting activists , opposition members , and non- governmental organizations in the Middle East over the past several years 
We find that these artifacts reflect efforts to at- tack targets ' devices for the purposes of eavesdropping , stealing information , and/or unmasking anonymous users 
We describe attack campaigns we have observed in Bahrain , Syria , and the United Arab Emirates , investigating attackers , tools , and tech- niques 
In addition to off-the-shelf remote access trojans and the use of third-party IP-tracking services , we identify commer- cial spyware marketed exclusively to governments , including Gamma 's FinSpy and Hacking Team 's Remote Control Sys- tem ( RCS ) 
We describe their use in Bahrain and the UAE , and map out the potential broader scope of this activity by conduct- ing global scans of the corresponding command-and-control ( C & C ) servers 
Finally , we frame the real-world consequences of these campaigns via strong circumstantial evidence linking hacking to arrests , interrogations , and imprisonment 
Computer security research devotes extensive efforts to pro- tecting individuals against indiscriminate , large-scale attacks such as those used by cybercriminals 
Recently , the prob- lem of protecting institutions against targeted attacks conducted by nation-states ( so-called '' Advanced Persistent Threats '' ) has likewise elicited significant research interest 
Where these two problem domains intersect , however-targeted cyber attacks by nation-states against individuals-has received virtually no sig- nificant , methodical research attention to date 
This new prob- lem space poses challenges that are both technically complex and of significant real-world importance 
In this work we undertake to characterize the emergent prob- lem space of nation-state Internet attacks against individuals engaged in pro-democracy or opposition movements 
While we lack the data to do so in a fully comprehensive fashion , we provide extensive detail from both technical and operational perspectives as seen in three countries 
We view such character- izations as the fundamental first step necessary for the rigorous , scientific pursuit of a new problem space 
For our study we draw upon several years of research we have conducted into cases from Bahrain , Syria and the United Arab Emirates 
We frame the nature of these attacks , and the technology and infrastructure used to conduct them , in the con- text of their impacts on real people 
We hope in the process to inspire additional research efforts addressing the difficult prob- lem of how to adequately protect individuals with very limited resources facing powerful adversaries 
As an illustration of this phenomenon , consider the follow- ing anecdote , pieced together from public reports and court documents 
At dawn on 3/12/13 , police raided the house of 17-year- old Ali Al-Shofa , confiscated his laptop and phone , and took him into custody 
He was charged with referring to Bahrain's King as a '' dictator '' ( ) and '' fallen one '' ( ) on a pseudonymous Twitter account , @ alkawarahnews 
Accord- ing to court documents , Bahrain 's Cyber Crime Unit had linked an IP address registered in his father 's name to the account on 12/9/12 
Operators of @ alkawarahnews later forwarded a suspicious private message to one of the authors 
The message was received on 12/8/12 on a Facebook account linked to the Twitter handle , and contained a link to a protest video , purport- edly sent by an anti-government individual 
The link redirected through iplogger.org , a service that records the IP address of anyone who clicks 
Analytics for the link indicate that it had been clicked once from inside Bahrain 
On 6/25/13 , Ali was sentenced to one year in prison 
Ali 's case is an example of the larger phenomenon we in- vestigate : attacks against activists , dissidents , trade unionists , human rights campaigners , journalists , and members of NGOs ( henceforth '' targets '' ) in the Middle East 
The lat- ter advertises that governments need its technology to '' look through their target 's eyes '' rather than rely solely on '' passive monitoring '' 
Overall , the attacks we document are rarely technically novel 
In fact , we suspect that the majority of at- tacks could be substantially limited via well-known security practices , settings , and software updates 
We obtained the majority of our artifacts by encouraging in- dividuals who might be targeted by governments to provide us with suspicious files and unsolicited links , especially from un- familiar senders 
While this process has provided a rich set of artifacts to analyze , it does not permit us to claim our dataset is representative 
Our analysis links these attacks with a common class of ac- tor : an attacker whose behavior , choice of target , or use of in- formation obtained in the attack , aligns with the interests of a government 
In some cases , such as Ali 's , the attackers appear to be governments themselves ; in other cases , they appear in- stead to be pro-government actors , ranging from patriotic , not necessarily skilled volunteers to cyber mercenaries 
The phe- nomenon has been identified before , such as in Libya , when the fall of Gaddafi 's regime revealed direct government ties to hacking during the 2011 Civil War 
We make the following contributions : • We analyze the technology associated with targeted at- tacks ( e.g. , malicious links , spyware ) , and trace it back to its programmers and manufacturers 
While the attacks are not novel-and indeed often involve technology used by the cybercrime underground-they are significant be- cause they have a real-world impact and visibility , and are connected to governments 
In addition , we often find amateurish mistakes in either the attacker 's technology or operations , indicating that energy spent countering these threats can realize significant benefits 
We do not , how- ever , conclude that all nation-state attacks or attackers are incompetent , and we suspect that some attacks have evaded our detection 
• When possible , we empirically characterize the attacks and technology we have observed 
We map out global use of two commercial hacking tools by governments by searching through Internet scan data using fingerprints for command-and-control ( C & C ) servers derived from our spyware analysis 
• We develop strong evidence tying attacks to govern- ment sponsors and corporate suppliers , countering de- nials , sometimes energetic and sometimes indirect , of such involvement [ , , , ] , in contrast to denials or claims of a corporate '' oversight '' board 
Our scan- ning suggests use of '' lawful intercept '' trojans by 11 ad- ditional countries considered governed by '' authoritarian regimes 
'' We believe that activists and journalists in such countries may experience harassment or consequences to life or liberty from government surveillance 
Finally , we do not explore potential defenses appropriate for protecting the target population in this work 
We believe that to do so in a sufficiently well-grounded , meaningful manner first requires developing an understanding of the targets ' knowledge of security issues , their posture regarding how they currently protect themselves , and the resources ( including potentially ed- ucation ) that they can draw upon 
To this end , we are now con- ducting ( with IRB approval ) in-depth interviews with potential targets along with systematic examination of their Internet de- vices in order to develop such an understanding 
In the past decades , a rich body of academic work has grown to document and understand government Internet censorship , in- cluding nationwide censorship campaigns like the Great Fire- wall of China [ , , ] 
Research on governmental Internet surveillance and activities like law-enforcement interception is a comparatively smaller area 
Some academic work looks at government use of devices to enable censorship , such as key- word blacklists for Chinese chat clients , or the Green Dam censorware that was to be deployed on all new computers sold in China 
We are aware of only limited previous work looking at advanced threat actors targeting activists with hack- ing , though this work has not always been able to establish ev- idence of government connections 
Platforms used by potential targets , such as GMail , Twitter , and Facebook increasingly make transport- layer encryption the default , obscuring communications from most network surveillance 
This use of encryption , along with the global nature of many social movements , and the role of diaspora groups , likely makes hacking increasingly attractive , especially to states who are unable to request or compel content from these platforms 
Indeed , the increasing use of encryption and the global nature of targets have both been cited by pur- veyors of '' lawful intercept '' trojans in their marketing materi- als [ , ] 
In one notable case in 2009 , UAE telecom firm Eti- salat distributed a system update to its then 145,000 BlackBerry subscribers that contained spyware to read encrypted Black- Berry e-mail from the device 
The spyware was discovered when the update drastically slowed users ' phones 
In con- trast to country-scale distribution , our work looks at this kind of pro-government and government-linked surveillance through highly targeted attacks 
The term APT ( Advanced Persistent Threat ) refers to a sophisticated cyber-attacker who persistently attempts to tar- get an individual or group 
Work outside the academic community tracking government cyberattacks typically falls under this umbrella 
There has been significant work on APT outside the academic community , especially among se- curity professionals , threat intelligence companies , and human rights groups 
Much of this work has focused on suspected government-on-government or government-on-corporation cy- ber attacks [ , ] 
Meanwhile , a small but growing body of this research deals with attacks carried out by governments against opposition and activist groups operating within , as well as outside their borders 
One of the most notable cases is GhostNet , a large-scale cyber espionage campaign against the Tibetan independence movement [ , ] 
Other work avoids drawing conclusions about the attackers 
Our study is based on extensive analysis of malicious files and suspect communications relevant to the activities of targeted groups in Bahrain , Syria , and the UAE , as documented in Ta- ble 1 
A number of the attacks had significant real-world impli- cations , per Table 2 
In many cases , we keep our descriptions somewhat imprecise to avoid potential leakage of target identi- ties 
We began our work when contacted by individuals con- cerned that a government might have targeted them for cyber- attacks 
As we became more acquainted with the targeted com- munities , in some cases we contacted targeted groups directly ; in others , we reached out to individuals with connections to tar- geted groups , who allowed us to examine their communications with the groups 
For Bahrain and Syria , the work encompassed 10,000s of e-mails and instant messages 
For the UAE , the vol- ume is several thousand communications 
This following sections outline recent targeted hacking cam- paigns in Bahrain , Syria and the UAE 
These cases have a com- mon theme : attacks against targets ' computers and devices with malicious files and links 
We also , however , frequently find technical and op- erational errors by the attackers that enable us to link attacks to governments 
We have analyzed two attack campaigns in the context of Bahrain , where the government has been pursuing a crackdown against an Arab-Spring inspired uprising since 2/14/2011 
Some individuals who apparently clicked on these links were later arrested , including Ali ( cf 
§1 ) , whose click appears to have been used against him in court 
While both campaigns point back to the government , we have not as yet identified overlap between the campaigns ; targets of FinSpy appeared to reside mainly outside Bahrain , whereas the IP spy links targeted those mainly inside the country 
We examine each campaign in turn 
Beginning in April 2012 , the authors received 5 suspicious e-mails from US and UK-based activists and journalists working on Bahrain 
Under default security settings , Office disables all unsigned macros , so that a user who opens the document will only see an informational message that the macro has been disabled 
Thus , this attack was apparently designed with the belief or hope that targets would have reduced security settings 
Identification as FinSpy : By running the sample using Windows Virtual PC , we found the following string in mem- ory : y : \lsvnbranches\finspyv4.01\finspyv2\ 
This string suggests FinSpy , a product of Gamma Inter- national 
We de- vised a fingerprint for the obfuscater and located a structurally similar executable by searching a large malware database 
Since it did not in- clude anti-VM code , we ran it in TEMU , an x86 emulator de- signed for malware analysis 
TEMU captures instruction- level execution traces and provides support for taint-tracking 
The private key presumably resides on the C & C server 
The weak AES keys make decryption of the data straightfor- ward 
We wrote a program that generally can find these keys in under an hour , exploiting the fact that many of the system clock readings occur within the same clock-update quantum 
In addition , FinSpy 's AES code fails to encrypt the last block of data if less than the AES block size of 128 bits , leaving trail- ing plaintext 
While we suspect FinSpy 's cryptographic deficiencies reflect bugs , it is also con- ceivable that the cryptography was deliberately weakened to facilitate one government monitoring the surveillance of oth- ers 
Analyzing network traffic between our infected VM and the C & C server revealed that the server used a global IPID , which allowed us to infer server activity by its progression 
In response to our preliminary work an executive at Gamma told the press that Bahrain 's FinSpy server was merely a proxy and the real server could have been anywhere , as part of a claim that the Bahrain FinSpy deployment could have been associ- ated with another government 
However , a proxy would show gaps in a global IPID as it forwarded traffic ; our frequent observation of strictly consecutive IPIDs thus contradicts this statement 
Exploitation of captured data : Since we suspected the spy- ware operator would likely seek to exploit captured credentials , particularly those associated with Bahraini activist organiza- tions , we worked with Bahrain Watch , an activist organization inside Bahrain 
Bahrain Watch established a fake login page on their website and provided us with a username and pass- word 
From a clean VM , we logged in using these credentials , saving the password in Mozilla Firefox 
Bahrain Watch 's website logs revealed a subsequent hit from 89.148.0.41-made however to the site 's home- page , rather than its login page-coming shortly after we had infected the VM 
Decrypting packet captures of the spyware's activity , we found that our VM sent the password to the server exactly one minute earlier : The URL provided to the server did not include the path to the login page , which was inaccessible from the home- page 
This omission reflects the fact that the Firefox password database stores only domain names , not full login page URLs , for each password 
Repeating the experiment again yielded a hit from the same IP address within a minute 
We inspected Bahrain Watch 's logs , which showed no subsequent ( or previ- ous ) activity from that address , nor any instances of the same User Agent string 
The attacker then discovers the victim 's identity from their ISP 
In one case we identified legal documents that pro- vided a circumstantial link between such a spy link and a sub- sequent arrest 
Figure 2 illustrates the larger ecosystem of these attacks 
The attackers appear to represent a single entity , as the activity all connects back to accounts that sent links shortened using a par- ticular user account al9mood on the bit.ly URL shortening service 
Recall Ali Faisal Al-Shufa ( discussed in Section 1 ) , who was accused of sending insulting tweets from an account @ alkawarahnews ( Al Kawarah News in Figure 2 ) 
An op- erator of the account forwarded us a suspicious private message sent to the Al Kawarah News Facebook account from Red Sky 
Red Sky was purportedly arrested on 10/17/12 , was convicted of insulting the King on his Twitter account @ RedSky446 , and was sentenced to four months prison 
When released , he found that the passwords for his Twitter , Facebook , and e-mail accounts had been changed , and did not know how to recover his accounts 
The message that Red Sky 's account sent to Al Kawarah News included a link shortened using Google 's goo.gl ser- vice 
We used the goo.gl API to access analytics for the link , finding that it unshortened to iplogger.org/25SX and was created on 12/8/12 
The link had received only one click , which came from Bahrain with the referrer www.facebook.com 
Ali 's case files contained a request from the Public Prose- cution for information on an IP address that it had linked to Al Kawarah News about 22 hours after the link was created 
Court documents indicate that ISP data linked the IP address to Ali , and on this basis he was sentenced to one year in prison 
Red Sky also targeted M in Figure 2 
M recalled click- ing on a link from Red Sky while using an Internet connec- tion from one of the houses in M 's village 
The house was raided by police on 3/12/13 , who were looking for the sub- scriber of the house 's internet connection 
Police questioning revolved around Tweets that referred to Bahrain 's King as a '' cursed one 
The attack on Jehad Abdulla is noteworthy , as the ac- count 's activity aligned with communities typically critical of Bahrain 's opposition 
However , the account also directly crit- icized the King on occasion , in one case referring to him as '' weak '' and '' stingy 
On 10/16/12 , Salman Darwish was arrested for insulting the King using the Jehad Abdulla account 
He was sentenced to one month in prison , partly on the basis of his confession 
Salman's father claims that police denied Salman food , drink , and medi- cal care 
Another account linked to al9mood targeted @ YLUBH , the Twitter account of Yokogawa Union , a trade union at the Bahraini branch of a Japanese company 
Yokogawa fired the leader of the trade union , Sami Ab- dulaziz Hassan , on 3/23/13 
It later emerged that Sami was indeed the operator of the @ YLUBH account , and that the police had called him in for questioning in relation to its tweets 
Figure 2 shows two such cases , Maryam and Sayed Yousif 
While ReadNotify.com forbids spoofing in their TOS , the service has a vulnerability known to the attackers ( and which we confirmed ) that allows spoofing the From address by directly setting the parameters on a submission form on their website 
We have not found evidence suggesting this vulnerabil- ity is publicly known , but it appears clear that the attacker ex- ploited it , as the web form adds a X-Mai1er : RNwebmail header not added when sending through ReadNotify.com's other supported methods 
The header appeared in each e-mail the targets forwarded to us 
When spoofing using this method , the original sender ad- dress still appears in X-Sender and other headers 
Accord- ing to these , the e-mails received by the targets all came from fatoomah85 @ gmail.com 
A link sent in one of these e- mails was connected to the al9mood bit.ly account 
In monitoring accounts connected to al9mood , we counted more than 200 IP spy links in Twitter messages and public Facebook posts 
In one particularly clever tactic , attackers exploited Twitter 's default font , for example substituting a lowercase '' l '' with an uppercase '' I '' or switching vowels ( e.g 
from '' a '' to an '' e '' ) to create at-a-glance identical usernames 
In addition , malicious accounts tended to quickly delete IP spy tweets sent via ( public ) mentions , and frequently change profile names 
The use of RATs against the opposition has been a well- documented feature of the Syrian Civil War since the first re- ports were published in early 2012 [ , , , , ] 
The phenomenon is widespread , and in our experience , most mem- bers of the opposition know that some hacking is taking place 
The seeding techniques and bait files suggest a good understanding of the opposition 's needs , fears and behavior , coupled with ba- sic familiarity with off-the-shelf RATs 
In some cases attacks occur in a context that points to a more direct connection to one of the belligerents : the Syrian opposition has regularly ob- served that detainees ' accounts begin seeding malware shortly after their arrest by government forces 
Researchers and security professionals have already profiled many of these RATs , including DarkComet [ , ] , Black- shades Remote Controller , Xtreme RAT , njRAT , and ShadowTech 
Some are available for purchase by any- one , in contrast to '' government only '' FinSpy and RCS 
For ex- ample , Xtreme RAT retails for e350 , while a version of Black- shades lists for e40 
Others , like DarkComet , are free 
We have also observed cracked versions of these RATs on Arabic- language hacker forums , making them available with little ef- fort and no payment trail 
Our illustration shows in abstract terms the use of Victim A 's account to seed mal- ware ( '' Aleppo Plan '' ) via ( say ) Skype messages to Victim ( s ) Bn 
In the cases of Opp 
One domain remains active , hosting a website of the Salafist Al-Nusra front , while the other appears dormant 
Interestingly , in the case of the fake Skype encryption the deception extended to a YouTube video from '' IT Se- curity Lab '' demonstrating the program 's purported ca- pabilities , as well as a website promoting the tool , skype- encryption.sytes.net 
The attackers also constructed a ba- sic , faux GUI for their '' Encryption '' program ( see Figure 4 ) 
The fake GUI has a number of non-functional buttons like '' En- crypt '' and '' DeCrypt , '' which generate fake prompts 
Anecdotally , campaign volume appears to track significant events in the ongoing conflict 
For example , campaigns dwin- dled and then rebounded within hours after Syria 's 2012 Inter- net shutdown 
Similarly , activity observed by the authors also dwindled prior to expectation of US-led military action against Syrian government targets in September 2013 
Once this option appeared to be off the table , the volume of new samples and campaigns we observed again increased , includ- ing the recent targeting of NGO workers per Figure 3 
We are aware of only a negligible number of cases of the opposition using similar RATs against Syrian Government supporters , al- though evidence exists of other kinds of electronic attacks by third parties 
The logistics and activities of Syria 's numerous opposition groups are intentionally concealed from public view to protect both their efficacy , and the lives of people participating in them 
Nevertheless , Syrian opposition members are generally familiar with stories off digital compro- mises of high-profile figures , including those entrusted with the most sensitive roles , as well as rank-and-file members 
Com- promise of operational security poses a documented threat to life both for victims of electronic compromise , and to family members and associates 
The Syrian conflict is ongoing , making it difficult to assem- ble comprehensive evidence of linkages between government actors and malware campaigns 
Moreover , many individuals whose identities have been compromised are in prison or oth- erwise disappeared , and thus unable to relate the evidence pre- sented to them during interrogation 
Still , strong circumstantial evidence links the use of RATs , phishing , and government ac- tivity , which we briefly summarize here : ( 1 ) many Syrians have recounted to journalists and the authors how interrogators con- fronted them with material from their computers 
For example : The policeman told me , '' Do you remember when you were talking to your friend and you told him you had something wrong [ sic ] and paid a lot of money ? At that time we were taking information from your laptop 
'' ( 2 ) Syrian activists have supplied cases to international journal- ists , where arrests are quickly followed by the social me- dia accounts of detained individuals seeding malware to contact lists ( Figure 3 ) 
( 3 ) Finally , despite the notoriety of the attack campaigns , including mention of C & C IPs in international me- dia , the Syrian government has made no public statements about these campaigns nor acted to shut down the servers 
Beyond the ongoing challenges of attribution , these malware campaigns have a tangible impact on the Syrian opposition , and generally align with the interests of the Syrian government's propaganda operations 
The case of Abdul Razzaq Tlass , a leader in the Free Syrian Army , is illustrative of the potential uses of such campaigns 
In 2012 a string of videos emerged showing Tlass sexting and engaged in lewd activity in front of a webcam 
While he denied the videos , the harm to his rep- utation was substantial and he was eventually replaced 
While the UAE has experienced no recent uprising or politi- cal unrest , it has nevertheless cracked down on its opposition , concurrent with the Arab Spring 
The associated C & C server indicated direct UAE government involvement 
Over time , we stopped receiving RCS samples from UAE targets , and instead observed a shift to the use of off-the-shelf RATs , and possible involvement of cyber-mercenary groups 
However , poor attacker operational security .allowed us to link most observed attacks together 
UAE activist Ahmed Mansoor ( per Figure 5 ) , impris- oned from April to November 2011 after signing an online pro- democracy petition , received an e-mail purportedly from '' Arabic Wikileaks '' in July 2012 
He opened the associated at- tachment , '' veryimportant.doc , '' and saw what he described as '' scrambled letters '' 
He forwarded us the e-mail for investiga- tion 
The attachment exploited CVE-2010-3333 , an RTF pars- ing vulnerability in Microsoft Office 
The document did not contain any bait content , and part of the malformed RTF that triggered the exploit was displayed in the document 
We denote this combination as the 3-Stage Ex- ploit Kit in Figure 5 
When we ob- tained the sample in July 2012 , ar-24.com resolved to an IP address on Linode , a hosting provider 
Three months later , it resolved to a UAE address belonging to the Royal Group , an organization linked to the UAE government ; it is chaired by Sheikh Tahnoon bin Zayed Al-Nayhan , a member of the UAE ruling family and a son of the founder of the UAE 
Identification as RCS : We identified strings in memory that matched those in a Symantec analysis of RCS ( also known as DaVinci or Crisis ) , a product of the Italian com- pany Hacking Team 
We also located a structurally sim- ilar Word document via VirusTotal 
Analysis of capabilities : RCS has a suite of functionality largely similar to FinSpy 
If embedded as an applet , and no exploit is present , Java displays a security warning and asks the user whether they authorize the installation 
Another difference is in persistence 
We did not observe similar capabilities in the FinSpy samples we examined 
Exploitation of captured data : When Ahmed Mansoor re- ceived the RCS document , he opened it , infecting his computer ( Figure 5 ) 
The suspicious accesses stopped after removal of the application-specific password 
The e-mail was sent from the UAE's timezone ( as well as of other countries ) and contained the terms '' veryimportant '' and '' wikileaks '' , just like in the e-mail re- ceived by Ahmed 
Possible consequences : Shortly after he was targeted , Ahmed says he was physically assaulted twice by an attacker who appeared able to track Ahmed 's location 
He also re- ports that his car was stolen , a large sum of money disappeared from his bank account , and his passport was confiscated 
He believes these consequences are part of a government in- timidation campaign against him , but we did not uncover any direct links to his infection 
We were unable to obtain the second stage or the ultimate pay- load , as the website was unavailable at the time of testing 
However , the exploit kit appears indicative of Hacking Team involvement 
A page on faddeha.com found in Google's cache contained an embedded .jar with the same applet class ( WebEnhancer ) as those observed in other .jar files that we found to contain RCS 
We found a file that VirusTotal had downloaded from faddeha.com , which appeared to be a re- mote access toolkit known as SpyNet , available for general pur- chase for 50 Euros 
SpyNet Packing : We found another instance of the first stage of the 3-Stage Exploit Kit on VirusTotal 
The sample was packed using ASProtect 
Finally , this executable unpacks SpyNet 
SpyNet 's GUI only offers an option to pack with UPX , suggesting that the attack- ers specially added the other layers of packing 
In some cases , the Visual Basic project bears the name NoWayTech , which appears to be an underground RunPE tool , while others are named SpyVisual , which we have been unable to trace to any public underground tools , and thus also may reflect customiza- tion by the attacker 
The SpyVisual projects contain the string c : \Users\Zain\AppData\Local\Temp\OLE1EmbedStrm.wav , which we used as the fingerprint VB Packer in Figure 6 
Cedar Key attack : The same VB Packer was used in an attack on Relative of political detainee D and H.R 
activist E in Figure 6 
Loading the page greeted the target with '' Video loading please wait 


Oracle released a patch 12 hours after activists began receiving these links 
The cedarkeyrv.com domain is associated with an RV park in Cedar Key , Florida 
The website 's hosting company told us that the site had apparently suffered a compromise , but did not have further details 
The exploit used in the attack appears to have been origi- nally posted by a Kuwaiti user , njq8 , on an Arabic-language exploit sharing site 
We contacted njq8 , who told us that he had obtained the exploit elsewhere and modified it prior to posting 
This same C & C occurred in an- other attack ( Figure 6 ) targeting Relative of political detainee D ; in that case , the payload was a freely-available RAT known as njRAT , written by the same njq8 as the exploit-poster dis- cussed above 
However , we did not find any other evidence suggesting njq8 's involvement in either attack 
More SpyNet attacks : The domain hamas.sytes.net , which we previously saw used by two SpyNet sam- ples , resolved to 67.205.79.177 
Historically , dreems.no-ip.ca also resolved to this address 
The SMTP source of the e-mail was webmail.upload.bz 
Appin : In early 2013 UAE H.R 
activist E forwarded nu- merous documents that included a particular CVE-2012-0158 exploit for Microsoft Word 
All three domains match those used by an Indian cybermercenary group said to be linked to Appin Security Group 
The former two domains hosted content other than spyware ( i.e. , they may have been compromised ) 
We alerted the owner of www.getmedia.us , who removed the payloads 
The samples we received afforded us an opportunity to em- pirically characterize the use of FinFisher and Hacking Team around the world , enabling us to assess their prevalence , and identify other country cases that may warrant future investiga- tion 
We analyzed the samples and the behavior of their C & C servers to develop indicators ( fingerprints ) for how the servers respond to certain types of requests 
We then scanned the full Internet IPv4 address space ( '' /0 '' ) for these , along with prob- ing results found by past scans 
In many cases we do not release the full details of our fingerprints to avoid compromising what may be legitimate investigations 
Identifying and linking servers : We developed a number of fingerprints for identifying FinSpy servers using HTTP- based probing as well as FinSpy 's custom TLV-based proto- col. We leveraged quirks such as specific non-compliance with RFC 2616 , responses to certain types of invalid data , and the presence of signatures such as the bizarre '' Hallo Steffi '' that Guarnieri identified from Bahraini FinSpy C & C servers [ , ] 
See Appendix A for details 
We then exhaus- tively scanned the Internet looking for matches to these finger- prints 
In Spring 2013 we noticed FinSpy servers now issuing 302 Redirects to google.com 
However , we noticed anomalies : for ex- ample , servers in India were redirecting to the Latvian ver- sion of Google google.lv 
We suspect that the server in India was a relay forwarding to a master in Latvia 
Be- cause the master served as a proxy for Google , we could uncover its IP address using a Google feature that prints a user 's IP address for the query '' IP address 
'' We created an additional fingerprint based on the proxying behavior and is- sued GET /search ? q=ip+address & nord=1 requests to servers We note some interesting master locations in Table 4 
Server locations : In all , our fingerprints matched 92 dis- tinct IP addresses in 35 different countries 
Probing these on 8/8/13 revealed 22 distinct addresses still responding , sited in : Bahrain , Bangladesh , Bosnia and Herzegovina , Estonia , Ethiopia , Germany , Hong Kong , Indonesia , Macedonia , Mex- ico , Romania , Serbia , Turkmenistan , and the United States 
We found servers responding to a number of our fingerprints , sug- gesting either that some servers lag in their updates , or a con- certed effort to vary the behavior of FinSpy servers to make detection harder 
We found : ( 1 ) 3 IP addresses in ranges registered to Gamma 
( 2 ) Servers in 3 IP ranges explicitly registered to govern- ment agencies : Turkmenistan 's Ministry of Communications , Qatar 's State Security Bureau , and the Bulgarian Council of Ministers 
( 3 ) 3 additional IP addresses in Bahrain , all in Batelco 
( 4 ) Servers in 7 countries with governments classified as '' authoritarian regimes '' by The Economist : Bahrain , Ethiopia , Nigeria , Qatar , Turkmenistan , UAE , Vietnam 
Additional FinSpy samples : In parallel to our scanning , we obtained 9 samples of FinSpy by writing YARA rules for the '' malware hunting '' feature of VirusTotal Intelligence 
This feature sends us all newly-submitted samples that match our signatures 
This did not appear to be an older or newer ver- sion of the protocol , suggesting that our scan results may not reveal the full scope of FinSpy C & C servers 
Perhaps , the HTTP POST protocol was only delivered to a specific Gamma customer to meet a requirement 
We began by analyzing the UAE RCS sample from Ahmed and 6 samples obtained from VirusTotal by searching for AV re- sults containing the strings '' DaVinci '' and '' RCS 
'' At the time , several AV vendors had added detection for RCS based on a sample analyzed by Dr 
Web and the UAE RCS sample sent to Ahmed 
Based on these samples , we devised YARA signa- tures that yielded 23 additional samples of structurally similar malware 
Fingerprints : We probed the C & C servers of the RCS and FSBSpy samples , and found that they responded in a distinc- tive way to HTTP requests , and returned distinctive SSL cer- tificates 
We searched sources including Shodan , 5 Internet Census service probes , and Critical.IO scanning data for the observed distinctive HTTP behavior 
We searched for the dis- tinctive SSL certificates in two Internet Census service probes , and SSL certificate scans from ZMap 
We also contacted a team at TU Munich , who applied our fingerprints to their SSL scanning data 
Across all of these sources , we obtained 31,345 indicator hits reflecting 555 IP addresses in 48 coun- tries 
One SSL certificate returned by 175 of the servers was issued by '' /CN=RCS Certification Authority /O=HT srl , '' apparently referring to the name of the spyware and the company 
Servers for 5 of our FSBSpy samples and 2 of our RCS samples re- sponded with this type of certificate 
Some servers returned these certificates in chains that in- cluded another distinctive certificate 
We found 175 distinct IP addresses ( including the C & C 's for 5 of our FSBSpy samples and 2 of our RCS samples ) responded with this second type of certificate 
We devised two more indicators : one that matched 125 IP addresses , including 7 of our FSBSpy samples ' C & C 's , and one that matched 2 IP addresses , in Italy and Kazakhstan 
Server locations : On 11/4/13 we probed all of the IP ad- dresses that we collected , finding 166 active addresses match- ing one of our fingerprints in 29 different countries 
We sum- marize the top providers and countries in Table 5 
The prevalence of active servers either located in the USA or hosted by Linode is striking , and seems to indicate a pervasive use of out-of-country web hosting and VPS services 
In addition , we found : ( 1 ) 3 IP addresses on a /28 named '' HT public subnet '' that is registered to the CFO of Hacking Team 
The domain hackingteam.it resolves to an address in this range 
( 2 ) An address belonging to Omantel , a majority-state-owned telecom in Oman 
( 3 ) 7 IP addresses belonging to Maroc Telecom 
Moroccan journal- ists at Mamfakinch.com were previously targeted by RCS in 2012 
( 4 ) Overall , servers in 8 countries with governments deemed '' authoritarian regimes '' : Azerbaijan , Kazakhstan , Nigeria , Oman , Saudi Arabia , Sudan , UAE , Uzbekistan 
Link to Hacking Team : All active servers match- ing one of our signatures also responded peculiarly when queried with particular ill-formed HTTP requests , respond- ing with '' HTTP1/1 400 Bad request '' ( should be '' HTTP/1.1 '' ) and a body of '' Detected error : HTTP code 400 '' 
Googling for this response yielded a GitHub project em-http-server , a Ruby-based webserver 
The project 's author is listed as Alberto Ornaghi , a software architect at Hacking Team 
We suspect that the Hacking Team C & C server code may incorporate code from this project 
Links between servers : We identified many cases where several servers hosted by different providers , and in different countries , returned identical SSL certificates matching our fin- gerprints 
We also observed 30 active servers used a global IPID 
Only one active server had neither a global IPID nor an SSL certificate matching our fingerprints 
We assessed whether servers returning SSL certificates were forwarding to the servers with global IPIDs by inducing bursts of traffic at the former and monitoring the IPID at the latter 
For 11 servers , we found that the server 's activity correlated to bursts sent to other servers 
There was a 1:1 mapping between the remaining 8 addresses and groups 
We refer to a group along with the server ( s ) it forwards to as a server group 
We identified several server groups that may be associated with victims or operators in a certain country 
Some of these suggest possible further investigation : Turkey : We identified a group containing 20 servers in 9 countries 
We ex- clusively received RCS traffic from Turkish IP addresses 
( RCS traffic is identifiable based on a distinctive user agent and URL in POST requests 
In the above cases , save Turkey , the country we have identi- fied is classified as an '' authoritarian regime , '' and may be using Hacking Team products against the types of targets we profile in this paper 
In the case of Turkey , there are hints that the tool may be employed against dissidents 
Targeted surveillance of individuals conducted by nation-states poses an exceptionally challenging security problem , given the great imbalance of resources and expertise between the victims and the attackers 
We have sketched the nature of this problem space as reported to us by targeted individuals in three Middle Eastern countries 
In- stead , they employ prepackaged tools developed by vendors or acquired from the cybercrime underground 
This technol- ogy sometimes suffers from what strike us as amateurish mis- takes ( multiple serious errors implementing cryptography , bro- ken protocol messages ) , as does the attackers ' employment of it ( identifying-information embedded in binaries , C & C servers discoverable via scanning or '' Google hacking '' , clusters of at- tack accounts tied by common activity ) 
Some of these errors assisted our efforts to assemble strong circumstantial evidence of governmental origins 
In addition , we mapped out the global use of two '' governmental '' hacking suites , including identify- ing 11 cases in which they appeared to be used in countries governed by '' authoritarian regimes 
'' We aim with this work to inspire additional research efforts addressing the difficult problem of how to adequately protect individuals with very limited resources facing very powerful adversaries 
Open questions include robust , practical detection of targeted attacks designed to exfiltrate data from a victim's computer , as well as detection of and defense against novel at- tack vectors , like tampering with Internet connections to insert malware 
The task is highly challenging , but the potential stakes are likewise very high 
An opposition member , reflecting on gov- ernment hacking in Libya , speculated as to why some users would execute files even while recognizing them as potentially malicious : '' If we were vulnerable we could n't care less 


we were desperate to get our voices out 


it was a matter of life or death 


it was just vital to get this information out 
'' This work was supported by the National Science Foundation under grants 1223717 and 1237265 , and by a Citizen Lab Fel- lowship 
Any opinions , findings , and conclusions or recom- mendations expressed in this material are those of the authors and do not necessarily reflect the views of the sponsors 
The authors would like to thank the following individuals for their help in various aspects of our analysis : Bernhard Am- man , Collin D. Anderson , Brandon Dixon , Zakir Durumeric , Eva Galperin , Claudio Guarnieri , Drew Hintz , Ralph Holz , Shane Huntley , Andrew Lyons , Mark Schloesser , and Nicholas Weaver 
Previous work by Guarnieri on scanning for FinSpy servers found that in response to a request such as GET / , the Bahraini FinSpy C & C server returns a response with the string '' Hallo Steffi '' 
Guarnieri searched a database of such responses compiled by the Critical.IO Internet scanning project , locating 11 additional servers in 10 countries 
We refer to this fingerprint as α1 
Concurrent with this ef- fort , we devised our own fingerprint β1 that tested three as- pects of the handshake between a FinSpy infectee and a Fin- Spy C & C server , which follows a custom TLV-based protocol running on ports such as 22 , 53 , 80 , and 443 
We conducted targeted scanning of several countries using β1 , and also con- firmed Guarnieri 's findings for those servers still reachable af- ter he published his findings 
We observed a trend : changes in HTTP response behavior by FinFisher after publication of findings about the software 
In July 2012 , for example , after a post about Bahraini FinSpy samples , servers closed the TCP connection in response to a GET / or HEAD / request ( although servers continued to behave consistently with β1 
Other changes followed later in 2012 , including a new response to GET / requests that in- cluded an imperfect copy of an Apache server 's HTTP response ( the Date header used UTC rather than GMT ) 
We fingerprinted this error as α2 , and later in 2012 fingerprinted other distinctive behavior in response to GET / requests as α3 
Subsequent scans of /0 for α2 and α3 , and five service probes of the Internet Census for α1 through α3 , located several additional servers 
In Feburary 2013 we identified and finger- printed new HTTP response behavior with α4 and modified β1 to produce β2 , which tests only two of the three aspects of the FinSpy handshake ( the third test of β1 was broken when Fin- Spy servers were updated to accept types of invalid data they had previously rejected ) 
As of 3/13/13 , all servers that matched any α fingerprint matched β2 
Two years ago , we published our research into RedOctober , a complex cyber-espionage operation targeting diplomatic embassies worldwide 
We named it RedOctober because we started this investigation in October 2012 , an unusually hot month 
After our announcement in January 2013 , the RedOctober operation was promptly shut down and the network of C & Cs was dismantled 
As usually happens with these big operations , considering the huge investment and number of resources behind it , they do n't just '' go away '' forever 
Normally , the group goes underground for a few months , redesigns the tools and the malware and resume operations 
See : Since January 2013 , we 've been on the lookout for a possible RedOctober comeback 
One possible hit was triggered when we observed Mevade , an unusual piece of malware that appeared late in 2013 
The Mevade C & C name styles as well as some other technical similarities indicated a connection to RedOctober , but the link was weak 
It was n't until August 2014 that we observed something which made us wonder if RedOctober is back for good 
In August 2014 , some of our users observed targeted attacks with a variation of CVE-2012-0158 and an unusual set of malware 
We did a quick analysis of the malware and it immediately stood out because of certain unusual things that are not very common in the APT world 
As we started digging into the operation , more details emerged which supported this theory 
Perhaps the most unusual fact was that the Microsoft Office exploit did n't directly write a Windows PE backdoor on disk 
The loader appears to be different every time and internal strings indicate it is '' polymorphically '' generated 
According to their website , CloudMe is owned and operated by CloudMe AB , a company based in Linköping , Sweden 
( Important note : we do not believe that CloudMe is in any way related to the Cloud Atlas group - the attackers simply create free accounts on this provider and abuse them for command-and-control ) 
Of course , it should be possible to reconfigure the malware to use any Cloud-based storage service that supports WebDAV 
Just like with RedOctober , the top target of Cloud Atlas is Russia , followed closely by Kazakhstan , according to data from the Kaspersky Security Network ( KSN ) 
Actually , we see an obvious overlap of targets between the two , with subtle differences which closely account for the geopolitical changes in the region that happened during the last two years 
Both Cloud Atlas and RedOctober malware implants rely on a similar construct , with a loader and the final payload that is stored encrypted and compressed in an external file 
There are some important differences though , especially in the encryption algorithms used – RC4 in RedOctober vs AES in Cloud Atlas 
The usage of the compression algorithms in Cloud Altas and RedOctober is another interesting similarity 
Both malicious programs share the code for LZMA compression algorithm 
In CloudAtlas it is used to compress the logs and to decompress the decrypted payload from the C & C servers , while in Red October the '' scheduler '' plugin uses it to decompress executable payloads from the C & C 
It turns out that the implementation of the algorithm is identical in both malicious modules , however the way it is invoked is a bit different , with additional input sanity checks added to the CloudAtlas version 
Another interesting similarity between the malware families is the configuration of the build system used to compile the binaries 
Every binary created using the Microsoft Visual Studio toolchain has a special header that contains information about the number of input object files and version information of the compilers used to create them , the '' Rich '' header called so by the magic string that is used to identify it in the file 
We have been able to identify several RedOctober binaries that have '' Rich '' headers describing exactly the same layout of VC 2010 + VC 2008 object files 
Although this does n't necessarily mean that the binaries were created on the same development computer , they were definitely compiled using the same version of the Microsoft Visual Studio up to the build number version and using similar project configuration 
To summarize the similarities between the two : Finally , perhaps the strongest connection comes from targeting 
In at least one case , the victim 's computer was attacked only twice in the last two years , with only two malicious programs – RedOctober and Cloud Atlas 
These and other details make us believe that CloudAtlas represents a rebirth of the RedOctober attacks 
Following big announcements and public exposures of targeted attack operations , APT groups behave in a predictable manner 
Other groups that are more nervous about exposure go in a hibernation mode for months or years 
Some may never return using the same tools and techniques 
However , when a major cyber-espionage operation is exposed , the attackers are unlikely to completely shut down everything 
They simply go offline for some time , completely reshuffle their tools and return with rejuvenated forces 
We believe this is also the case of RedOctober , which makes a classy return with Cloud Atlas 
A few days ago we detected a watering hole campaign in a website owned by one big industrial company 
The website is related to software used for simulation and system engineering in a wide range of industries , including automotive , aerospace , and manufacturing 
As we have seen , this is a very powerful framework that gives attackers a lot of insight into the potential targets that will help them launching future attacks against them 
We have also seen several Metasploit-produced exploits that target different versions of Java in the same IP address that hosts the Scanbox framework ( 122.10.9 [ 
] 109 ) 
This actor initiated their most recent campaign on November 19 , 2014 targeting multiple organizations 
The attacker leveraged multiple exploits , targeting both CVE-2014-6332 and CVE-2014-4113 
The use of CVE-2014-6332 is notable , as it demonstrates that multiple classes of actors , both criminal and APT alike , have now incorporated this exploit into their toolkits 
Further , the use of both of these two known vulnerabilities in tandem is notable for APT3 
This actor is historically known for leveraging zero- day vulnerabilities in widespread but infrequent phishing campaigns 
The use of known exploits and more frequent attacks may indicate both a shift in strategy and operational tempo for this group 
The body of the message is below : One Month 's Free Membership for The PLAYBOY ClUB 1080P HD VIDEOS 100,000 PHOTOS 4,000 MODELS Nude Celebrities , Playmates , Cybergirls & More ! Click hxxp : //join.playboysplus.com/signup/ To Get a Free Plus Member Now & Never Miss Another Update 
Your Member referrals must remain active 
If anyone getting '' Promotion not available '' for 1 month free membership , you might get the issue up to 48 hrs once your membership is expired and make sure to Clear out cookies or use another browser or use another PC 
These files have the following metadata : These payload files also have interesting PDB debug strings 
The most interesting PDB string is the '' 4113.pdb , '' which appears to reference CVE-2014-4113 
These first three bytes are the command identifier 
] com – another known domain referenced in our Operation Clandestine Fox blog 
In addition , the join.playboysplus [ 
] com exploit and payload delivery site resolves to 104.151.248.173 
Since Operation Clandestine Fox , we have observed this actor execute multiple attacks that did not rely on zero-day exploits 
The combination of this sustained operational tempo and lack of zero-day exploits may indicate that this group has changed strategy and has decided to attack more frequently and does not have steady access to zero-day exploit code 
No matter the strategy , this actor has shown an ability to operate successfully 
IOCs for this threat can be found here 
In late December 2011 , CrowdStrike , Inc. received three binary executable files that were suspected of having been involved in a sophisticted attack against a large Fortune 500 company 
The files were analyzed to understand first if they were in fact malicious , and the level of sophistication of the samples 
The samples were clearly malicious and varied in sophistication 
Some AV engines occasionally identify this sample as Derusbi Trojan 
CrowdStrike Intelligence Team has seen Trojans from 8 different builder variants of this RAT , including 64-bit versions , used in targeted attacks in 2011 against Defense , Energy/Power , and Chemical Industries in US and Japan 
All of these samples reflect common toolmarks and tradecraft consistent with Chinese based actors who target various strategic interests of the United States including High Tech/Heavy Industry , Non-Governmental Organizations ( NGOs ) , State/Federal Government , Defense Industrial Base ( DIB ) , and organizations with vast economic interests 
This report contains an in-depth technical analysis of the samples , detection/remediation/mitigation information , attribution intelligence , and a conclusion aimed at providing the reader with a synopsis of the report 
This code appears to have been compiled on Wednesday May 4th , 2011 at 11:04:24 A.M. UTC ( equivalent to early evening time in China ) 
Note that the timestamp is in UTC , however the relative time of day in China is provided for the benefit of the reader 
The CSIDL in this case pints to : '' The file system directory that contains documents that are common to all users 
A typical path is C : \Documents and Settings\All Users\Documents 
This date is specified in the dropper code and does not change across multiple infections 
This is a relatively common technique used by malware dropper files to optimize the number of files required to infect a machine 
The resource language of the malicious DLL is set to '' Chinese ( Simplified ) '' , this is a compiler artifact which indicates the language setting on the compiler used by the person who built the binary was set to '' Chinese ( Simplified ) '' at the time the dropper was compiled 
The 'MZ ' header which denotes a binary executable file of the dropped DLL is initially obfuscated 
A subroutine to decompress the dropped file is present as 'dead code ' ( code that is not used ) in the binary 
This subroutine will be invoked on the already closed file handle of the dropped file in the present code version 
Since the dropped resource is not compressed , the routine fails 
This indicates a low sophistication modification to the original dropper code to make it work with an uncompressed source 
The dropper binary contains an icon resource that resembles the 'Google Chrome ' browser icon , the re- source language is set to '' Chinese ( Simplified ) '' , which is consistent with the builder of the tool systems language set to Chinese 
This code appears to have been compiled on Wednesday May 4th , 2011 at 10:48:19 A.M. UTC ( equivalent to early evening time in China ) 
This export first attempts to stop a service called '' msupdate '' , which is not a known Microsoft Windows service despite the appearance 
In the case of installation failure , rundll32.exe calls the main functions export 'CollectW3PerfData ' 
The main entry point to the DLL is named 'CollectW3PerfData ' , as it first creates and displays a fake Window with class '' NOD32 % d '' where % d is replaced with a pseudo-random number 
The window is however not visible and implements no specific functionality 
In order to accomplish this task , the newly created thread initializes networking APIs using WSAStartup ( ) and resolves some other APIs dynamically using LoadLibrary ( ) and GetProcAddress ( ) 
The C2 location in this sample is statically defined as 1.9.5.38:443 ( Malaysia : Tmnet , Telekom Malaysia Bhd ) 
While ther is 'dead code ' that will download the C2 location from an HTTP URL that could be defined in the binary , using the User-Agent string '' Google '' , this code is not activated due to the format of the stat- ically defined C2 location using an IP address 
This indicates the use of a 'boiler plate code ' or a builder software package that automates the creation of the malicious sample 
When a connection can successfully be established to the C2 server , the sleep timer is reset to two seconds for the next attempt 
The network protocol used by this sample resembles a 'Type-Length-Value ' layout in both directions 
Each 16 byte request header consists of : Zero or more of specified bytes of additional payload then follows the header 
Providing additional payload of any larger size will result in a trivial exploitable stack buffer overflow that allows arbitrary code execution due to the absence of any security features 
However , exploitation of this vulnerability is unnecessary due to the already available unauthenticated command execution capabilities of this backdoor 
Certain commands initiate a second connection to the C2 in a separate thread using the same network protocol but providing a different request command identifier than for the initial beacon 
Note that such an account does not normally exist in an Active Directory environment 
Additionally , the primary C2 connection allows for requests to start additional connections to the C2 imple- menting the following functionality : This sample is typical of a post exploitation tool ; it is written in .NET 2.0 
This code appears to have been compiled on Thursday May 26th , 2011 at 10:21:44 A.M. UTC ( early evening time in China ) 
A detailed listing of command line arguments can be viewed in Appendix A 
The sample contains an embedded IP address for C2 that is stored in an encrypted format as a string re- source : The first two bytes of this string represent the base 16 length of the encrypted string , in this case , '' 0x14 '' 
Following this is a base64 encoded string of the specified length 
Once this string has been decoded using base64 , the result is then XOR 'd with the fixed value of 0xAA yielding the decoded IP address 202.86.190.3:80 ( Hong Kong : TeleOne ( HK ) Limited ) 
This value is then transformed using a simple algorithm in Appendix F into a 32 byte array 
Beacon , this is typical of this type of malicious sample , it allows the operator to separate various infected hosts in a targeted campaign 
The command format is derived from a structure consisting of : These fields are received as a sequence of serialized .NET objects in the order specified 
A detailed description of the possible values for commands is in Appendix D. It is important to note that the order in which the application defines them is not the same order as they appear to be coming over the network 
This binary is compiled with the /GS flag using Visual Studio 2010 , enabling stack buffer overflow detection 
This code appears to have been compiled on Sunday October 30 , 2011 at 12:43:33 P.M. UTC ( late evening time in China ) 
The code contains several Run Time Type Information ( RTTI ) artifacts that indicate most of the C++ class names were prefixed with the string '' PCC '' in the original source code 
Variants of this Trojan are sometimes detected under the name 'Derusbi ' by Microsoft , Trend , Sophos and Symantec AV engines 
The steps it takes to install itself onto a system are as follows : 2 
3 
4 
5 
6 
It then calls either the original or copy of regsvr32.exe with the parameters /s /u and the path to the copy of itself it made in Step 1 
The /u parameter means '' uninstall '' , which calls DllUnregisterServer , this is an unsophisticated method of DLL entry point obfuscation 
7 
DllUnregisterServer installs the driver and initiates the backdoor component 
If the process '' ZhuDongFangYu 
exe '' is running ( AntiVirus360 program from the Chinese 'Quihoo 360 Technology Co. , LTD ' 360 ) , or the username of the DLL 's host process context is not 'SYSTEM ' , the driver is not written to disk 
The malware contains a dynamic configuration stored in the Registry under and loads a default configuration embedded into the binary if such a configuration is not found 
The way this default configuration is loaded and parsed indicates that this malware has been built with a 'builder ' that takes a template sample and lets an unsophisticated user specify a configuration without recompiling any code 
This effectively hijacks the original service 's entry while retaining its functionality 
) , totaling 7 distinct supported C2 mechanisms 
In self-configuration , a connection via a proxy is attempted if the system wide Internet Explorer settings specify such a proxy 
The configuration found in this sample is set to automatic self-configuration , resulting in the following mechanisms being tried in this order : 1 
The C2 then responds with 64 bytes where the first four bytes must match the first four sent bytes to establish a connection successfully 
The remaining bytes are discarded 
Interestingly , the malware stores the first four bytes rotated right by seven bits and compares that value to the seven bits rotated right version of the server 's response , effectively neutralizing the rotation 's effect ; the purpose of this is unclear 
2 
A long-running HTTP POST request to the path '' /forum/login.cgi '' with a statically defined HTTP request string including HTTP headers ( optionally over a HTTP Proxy using CONNECT ) 
The malware requires the response to start with '' HTTP/1.0 200 '' or '' HTTP/1.1 200 '' and an absence of a '' Connection : close '' header 
3 
Two long-running HTTP requests to the same C2 ( optionally over an HTTP Proxy with original request verb ) , one GET request to '' /Photos/Query.cgi ? loginid= '' followed by a random number and one POST request to '' /Catelog/login1.cgi '' 
This demonstrates an attempt to use the most efficient communication channel first , falling back to more legitimate appearing channels as required in order to appear Request For Comment ( RFC ) compliant with the HTTP protocol 
Since this C2 mechanism is not attempted in self-configuration and was not configured for this binary , analysis was left out due to time constraints 
The C2 's binary data blobs are compressed 
No further encryption of the data takes place 
All C2 transport implementations contain code for accepting and handling server-side connections of the respective protocols 
However , this code does not appear to be invoked 
It appears that the author of this code shares the library that implements these transports for the client with the C2 server 
The handler class is responsible for parsing the remainder of the command 
It supports up to 1024 parallel connections 
The supported built-in commands are : The only command that is implemented directly in the main backdoor thread as a subprocedure call and not via a generic command handler class is command ID 256 
This sample is a packed 32-bit kernel driver extracted by the aforementioned DLL with an MD5 hash of : de7500fc1065a081180841f32f06a537 , this sample will only function on a Windows 32-bit kernel 
This code appears to have been compiled on Sunday October 9 , 2011 at 4:50:31 P.M. UTC ( very early morning time of Monday , October 10 in China ) 
This section describes how the driver performs its initialization routine 
The Windows API for creating events ( ZwCreateEvent ( ) , or CreateEvent ( ) in user mode ) already provides the ability to '' create-or-open '' an event , so the use of an initial ZwOpenEvent is superfluous and indicative of relatively limited Windows API knowledge of the author of that part of the code 
It is interesting to note that some of the hex digits in the object name are mixed case which is potentially indicative of the code being re-appropriated from another source 
Tools such as Syser Debugger , or debugging through a virtual machine are unaffected by this technique 
The sample , rather than importing the KdDisableDebugger ( ) API using conventional methods , looks up the API through MmGetSystemRoutineAddress ( ) instead 
All of the other APIs used by the driver are imported normally , so this is not a technique to hide import APIs used throughout the driver 
Searching Google for '' MmGetSystemRoutineAddress '' and '' KdDisableDebugger '' results in dozens of Chinese language blogs which explain how to use this technique to '' Disable WinDbg '' 
Checking the version is necessary because Windows versions beginning with Vista utilize a redesigned TCP/IP net- work stack , most hooking operations will require a different implementation for these versions 
On versions prior to Windows Vista , the TCP/IP driver creates a \Device\Tcp device object through which most network requests are piped through 
On Vista and later , TCP/IP has been split up into multiple components , and IP connection enumeration , which this driver is targeting , is managed by \Device\nsiproxy instead 
The NSI hook , targets IOCTL 0x12001B , which is used by NsiGetObjectAllParameters ( ) in nsi.dll when users typically run commands such as netstat.exe or use any of the IP Helper APIs in iphlpapi.dll 
This functionality is nearly identical to the code posted by Edward Sun ( aka cardmagic , sunmy1 @ sina.com , onlyonejazz @ hotmail.com , cardcian @ mail.ustc.edu.cn , QQ # 28025945 ) from Hefei , Anhui province ( Nanjing Military District ) on July 8 , 2007 , then a China-based researcher at Trend Micro ( now working at Kingsoft Chinese AV Company ; LinkedIn profile page : http : //www.linkedin.com/profile/view ? id=84082731 ) at http : //forum.eviloctal.com/viewthread.php ? action=printable & tid=29604 ( See Appendix G ) 
CrowdStrike has no information connecting Mr. Sun to this intrusion activity , his code appears to have been appropriated by the actor to add similar functionality to their code 
This IOCTL has the exact same functionality as the NSI specific IOCTL 
This IOCTL was the mechanism used on Windows versions prior to Windows Vista 
The system call hooking targets three functions : ZwSaveKey ( ) , ZwQueryValueKey ( ) , and ZwEnumerateValueKey ( ) 
Because the system call stub uses the EAX register as an index for the system call ID , and a '' mov eax , imm32 '' instruction '' instruction is used , this second DWORD will match the system call ID 
It then adds this index to the value of KeServiceDescriptorTable.Base , which is the exported kernel variable ( on 32-bit Windows only ) which directly points to the system call table 
This is one of the simplest ways to do a system call hook , but will not work on 64-bit Windows as this variable is not exported in addition to the protection provided by Microsoft PatchGuard 
Once the MDL is associated to the non-paged buffer , the sample locks the underlying pages using the Windows API MmProbeAndLockPages ( ) 
It uses the standard '' mov cr0 , eax '' technique , turning off the Write Protect ( WP ) bit as it does this 
When the hook is installed , it writes a special DWORD value , 'KDTR ' , which allows it to prevent double-hooking or badly-hooking the system call , during unhooking , this value is also checked 
In the ZwSaveKey ( ) hook , access to \\REGISTRY\\MACHINE\\SYSTEM is blocked 
RegSaveKey ( ) which is the user-mode implementation of the kernel ZwSaveKey ( ) API , is typically used when performing an offline backup of a particular registry key 
hook is the ZwQueryValueValue ( ) hook , which looks for '' Parameters '' key of a service within the registry at \\REGISTRY\\MACHINE\\SYSTEM\\ControlSet001\\Services\\ 
The user-mode service stores configuration data in the '' Security '' subkey of the RPC registry key , this component will obfuscate the user-mode configuration data 
The driver does not make any efforts to hide its own key , nor does it specifically check for '' RPC '' before '' Security '' , which can lead to random data being obfuscated 
The final hook , ZwEnumerateValueKey ( ) , is similar in structure to the ZwQueryValueHook key , due to the fact that these APIs provide almost identical functionality when it comes to reading registry values 
This allows the driver to receive the 'CMKEYOBJECT ' which is then used with ObQueryNameString ( ) to get the key/value path 
However , no call to ObDereferenceObject ( ) is ever made , which means that all registry objects being sent to these APIs are eventually leaked 
In the registry hook , it was noticed that '' CurrentControlSet001 '' was used as the target , if the target machine was using a '' last known good '' configuration , or a roaming hardware profile , the registry hook would not function as intended 
This is the reason the Microsoft implemented a symbolic link to \\CurrentControlSet which ensures that regardless of the machines configuration any request will access the correct registry key 
This threat actor leaves several key fingerprints which can be used to identify compromised systems 
These digital fingerprints are unique to this adversary for this campaign 
The following network signatures are designed for the popular Open Source IDS called Snort 
These signature can be ported to other formats upon request 
The following file system artifacts are indicative of a compromised host : The following Windows Registry artifacts are indicative of a compromised host : The backdoor may be detected by several different Anti-Virus products under a signature with the name : Attribution in the cyber domain is always a tricky subject when relying solely on malicious samples 
Compiler artifacts and language settings can of course be deliberately masked or spoofed 
CrowdStrike uses a unique approach of comprehensive threat analysis in order to decipher attributable components 
Based on the corroborating evidence discovered in the course of this analysis , it appears there are numerous indications that this is a Chinese-speaking actor 
ZhuDongFangYu.exe is a component of 360 360􀆔􀆔􀆔􀆔 , a Chinese security product available from http : //www.360.cn/ 
Speculatively this may be because this security product detects this rootkit , or the author was attempting to prevent accidental infection on systems running this Anti-Virus product 
The obfuscation of the KdDisableDebugger ( ) function call is seen on several Chinese language forums , and can be seen being reused in several code samples on those forums 
As previously mentioned there is no advantage associated with using this call obfuscation , and appears to be reused for no apparent reason other than the attackers have copied code directly from forum code 
This post is currently mirrored on dozens of Chinese hacking websites 
Similarly the system call hooking is less impressive after searching for '' IoAllocateMdl '' and '' cr0 '' ( bbs.pediy 
The ldasm inline hooking is also repeated in numerous postings to Chinese forums 
One particular website ( http : //read.pudn.com/downloads197/sourcecode/windows/sys- tem/927802/CCRootkit/RootkitSys/HookSSDT.c.htm ) had an almost identical ldasm loop that tried to identify the exact same code sequences 
While the driver does not use pool tags for most of its allocations , it does utilize them in the networking hooking code , much like the examples found on the Chinese language forums 
This sample uses pool tags : 'tnet , ' and 'KDTR ' 
Although the meaning of the KDTR tag is not obvious , we assess with high confidence that this is a shortened version of : '' Kernel DeTouR '' , which coincides with the matching functionality of the detour-style inline hook 
The driver code ( MD5 : dae6b9b3b8e39b08b10a51a6457444d8 ) appears to be a combination of various code that is easily searchable on the Internet , and almost always attributed to Chinese language forums and websites 
The system call hooking parts of the code appear to be identical to the HookSSDT.c code authored by Steven Lai 'embedlinux ' and utilized in what the author titled 'CC Rootkit ' on on August 4 , 2008 who 's email address is hqulyc @ 126.com 
This user has a QQ identity of : 5054-3533 , QQ is a popular instant messaging chat client used almost exclusively in China 
His real name according to his QQ profile ( http : //user.qzone.qq.com/50543533 ) appears to be Steven Lai 
He was is 28 years old ( born September 5 , 1983 ) and lives in Xiamen , Fujian province ( Nanjing Military Region ) 
According to his profile , he has worked at Xiamen XOCECO New Technic Co. , Ltd. ( http : //www.likego.com/en/about.asp ) , a company that builds audio/video systems for transportation systems 
Mr. Lai is not being identified as the actor , his code however was used by whomever built the kernel driver utilized by the backdoor and for this reason we are providing the background on this individual 
The samples involved in this incident are typical of attacks commonly associated with the People's Republic of China ( PRC ) 
These code samples have a variety of Tools , Techniques , and Procedures ( TTPs ) that are used to track and identify specific adversary groups 
The sophistication of the actor responsible this incident is difficult to quantify without visibility into the activities that transpired on the victims network 
The ability to conduct Incident Response ( IR ) including forensics , and log analysis , greatly augments this visibility into these aspects of the incident 
Some indications as to the adversaries ' capabilities can be derived from the captured samples alone 
The dropper code ( MD5 : 14c04f88dc97aef3e9b516ef208a2bf5 ) does not utilize any techniques that are unique or unusual , and is consistent with tools , techniques , and procedures of attacks targeting proprietary information and generally attributed to the PRC 
The presence of dead code and its replacement by a more simple obfuscation method to hide the to-be-dropped dll binary file indicates code reuse on the attacker side 
The 'dead code ' utilizes a more sophisticated compression algorithm provided by a third party which was rendered useless for some reason 
This may have been a result of the attacker modifying an existing tool , or unknowingly using a re-purposed tool 
The dropper resources indicate the compiler used to build the tool was running on a system that utilized the Chinese '' Simple '' language pack and was built on Wednesday May 4th , 2011 at 11:04:24 A.M. UTC ( early evening time in China ) 
While this can be deliberately spoofed as a 'false flag ' other indicators including the C2 are consistent with this having been the work of a Chinese speaking actor 
The code quality is not impressive , and contains a trivial stack buffer overflow vulnerability 
Despite the buf- fer overflow , the C2 channel lacks any command authenication or encryption , apart from the initial beacon encryption/obfuscation using a statically compiled XOR key 
The sample uses TCP port 443 for commu- nication , but makes no attempt to mimic the SSL protocol typically used on that port number , which would provide enhanced Operational Security ( OPSEC ) 
This code appears to have been compiled on Wednes- day May 4th , 2011 at 10:48:19 A.M. UTC ( early evening time in China ) 
This tool is built in Microsoft .NET framework , which is typically an indication of a less sophis- ticated attacker , because .NET is easier to develop in but requires the .NET framework be present on the victim machine 
The tool appears to have been compiled on Thursday May 26th , 2011 at 10:21:44 A.M. UTC ( early evening time in China ) 
The code base for the sample was developed in C++ 
The code appears to have been compiled on Sunday October 30 , 2011 at 12:43:33 P.M. UTC ( late evening time in China ) 
The DLL itself contains traces of the original C++ class names that were utilized in the source code , which in general were prefixed with 'PCC ' 
The implementation of these techniques has some unique idiosyncrasies that permit direct attribution to the source code Steven Lai posted 
The implementation of these techniques has some unique idiosyncrasies that permit direct attribution to the source code Steven Lai posted 
Implemented values for cmdID are as follows : cmdType can be one of the following ( Interesting commands explained in detail ) : string0 can have one of the following values dependant upon command id and type 
cardmagic writes : Windows Vista has changed alot on network module , many old port hiding materials are no longer usable 
In this post , I will share with you a simple code to hide port under Vista , hope it is useful for some guys 
Actually under Windows Vista , netstat.exe will call InternalGetTcpTable2 which is exported by Iphlpapi.dll to list all open ports , then InternalGetTcpTable2 will transfer control to NsiAllocateAndGetTable which is exported by nsi.dll , and finally nsi.dll involve NsiEnumerateObjectsAllParametersEx to interact with kernel mode module of NSI -- nsiproxy.sys 
nsiproxy.sys is almost like a wrapper of netio.sys , it will then call internal subroutines of netio.sys 
Here , we will use a relatively easy way -- '' NSI Kernel Module Dispatch Routine Hook '' to demonstrate the specified port hiding uner Vista 
Dispatch routine hook is an old topic , this time , we will apply this method to nsiproxy.sys 
Our clients often ask us to assess the threat Russia poses in cyberspace 
Russia has long been a whispered frontrunner among capable nations for performing sophisticated network operations 
This perception is due in part to the Russian government 's alleged involvement in the cyber attacks accompanying its invasion of Georgia in 2008 , as well as the rampant speculation that Moscow was behind a major U.S. Department of Defense network compromise , also in 2008 
These rumored activities , combined with a dearth of hard evidence , have made Russia into something of a phantom in cyberspace 
In this paper we discuss a threat group whose malware is already fairly well-known in the cybersecurity community 
This group , unlike the China-based threat actors we track , does not appear to conduct widespread intellectual property theft for economic gain 
Nor have we observed the group steal and profit from financial account information 
The activity that we profile in this paper appears to be the work of a skilled team of developers and operators collecting intelligence on defense and geopolitical issues – intelligence that would only be useful to a government 
We believe that this is an advanced persistent threat ( APT ) group engaged in espionage against political and military targets including the country of Georgia , Eastern European governments and militaries , and European security organizations since at least 2007 
They compile malware samples with Russian language settings during working hours consistent with the time zone of Russia 's major cities , including Moscow and St. Petersburg 
While we do n't have pictures of a building , personas to reveal , or a government agency to name , what we do have is evidence of long- standing , focused operations that indicate a government sponsor – specifically , a government based in Moscow 
We are tracking this group as APT28 
APT28 targets insider information related to governments , militaries , and security organizations that would likely benefit the Russian government 
Malware compile times suggest that APT28 developers have consistently updated their tools over the last seven years 
Since 2007 , APT28 has systematically evolved its malware , using flexible and lasting platforms indicative of plans for long-term use 
The coding practices evident in the group's malware suggest both a high level of skill and an interest in complicating reverse engineering efforts 
• Malware compile times suggest that APT28 developers have consistently updated their tools over the last seven years 
• APT28 malware , in particular the family of modular backdoors that we call CHOPSTICK , indicates a formal code development environment 
Such an environment would almost certainly be required to track and define the various modules that can be included in the backdoor at compile time 
• APT28 tailors implants for specific victim environments 
Indicators in APT28 's malware suggest that the group consists of Russian speakers operating during business hours in Russia 's major cities 
More than half of the malware samples with Portable Executable ( PE ) resources that we have attributed to APT28 included Russian language settings ( as opposed to neutral or English settings ) , suggesting that a significant portion of APT28 malware was compiled in a Russian language build environment consistently over the course of six years ( 2007 to 2013 ) 
Over 96 % of the malware samples we have attributed to APT28 were compiled between Monday and Friday 
More than 89 % were compiled between 8AM and 6PM in the UTC+4 time zone , which parallels the working hours in Moscow and St. Petersburg 
These samples had compile dates ranging from mid-2007 to September 2014 
Three themes in APT28 's targeting clearly reflect areas of specific interest to an Eastern European government , most likely the Russian government 
Many of APT28 's targets align generally with interests that are typical of any government 
However , three themes in APT28 's targeting clearly reflects areas of specific interest to an Eastern European government , most likely the Russian government 
These include the Caucasus ( especially the Georgian government ) , Eastern European governments and militaries , and specific security organizations 
This increases the likelihood that recipients will believe that the email is legitimate and will be interested in opening the message , opening any attached files , or clicking on a link in the body of the email 
Since spearphishing lures are tailored to the recipients whose accounts APT28 hopes to breach , the subjects of the lures provide clues as to APT28's targets and interests 
For example , if the group's lures repeatedly refer to the Caucasus , then this most likely indicates that APT28 is trying to gain access to the accounts of individuals whose work pertains to the Caucasus 
Similarly , APT28 's practice of registering domains that mimic those of legitimate news , politics , or other websites indicates topics that are relevant to APT28 's targets 
We identified three themes in APT28 's lures and registered domains , which together are particularly relevant to the Russian government 
In addition to these themes , we have seen APT28 target a range of political and military organizations 
We assess that the work of these organizations serves nation state governments 
The Caucasus , a region that includes Chechnya and other Russian republics and the independent states of Georgia , Armenia , and Azerbaijan , continues to experience political unrest 
The Georgian government 's posture and ties to the West are a frequent source of Moscow 's frustration , particularly after the 2008 war 
Overall , issues in the Caucasus likely serve as focal points for Russian intelligence collection efforts 
APT28 is likely seeking information on Georgia's security and diplomatic postures 
Specifically , the group has targeted the Georgian Ministry of Internal Affairs ( MIA ) and the Ministry of Defense ( MOD ) 
We also observed efforts to target a journalist working on issues in the Caucasus and a controversial Chechen news site 
APT28 made at least two specific attempts to target the Georgian Ministry of Internal Affairs 
The MIA harbors sensitive information about the inner workings of Georgia 's security operations , the country 's engagement in multilateral institutions , and the government 's communications backbone 
It is responsible for : APT28 made at least two specific attempts to target the MIA 
This probably referred to the MIA facility in the Ortachala district of Tbilisi , Georgia 's capital city 
APT28 also appeared to target Georgia 's MOD along with a U.S. defense contractor that was training the Georgian military 
The U.S. contractor was involved in a working group to advise the MOD and Georgian Armed Forces , assess Georgia's military capabilities , and develop a military training program for the country 
We believe that APT28 's targeting of the MOD aligns with Russian threat perceptions 
The growing U.S.-Georgian military relationship has been a source of angst for Russia 
Georgia and Russia severed diplomatic relations following the Russia-Georgia War in 2008 , and Georgia has since sought to align itself more closely with western security organizations 
Additionally , in June 2014 , despite Russia 's vocal objections , Georgia , along with Ukraine and Moldova , signed association accords with the EU 
This move placed all three countries more firmly in the EU 's political , economic , and security spheres of influence 
Georgian military security issues , particularly with regard to U.S. cooperation and NATO , provide a strong incentive for Russian state-sponsored threat actors to steal information that sheds light on these topics 
Targeting journalists could provide APT28 and its sponsors with a way to monitor public opinion , identify dissidents , spread disinformation , or facilitate further targeting 
( Reason Magazine is a US-based magazine ) The letter welcomed the individual as a contributor and requested topic ideas and identification information in order to establish him at the magazine 
The body of the letter suggests that APT28 actors are able to read at least two languages – Russian and English 
The grammar of the letter also indicates that English is not the author 's first language , despite it purportedly originating from a US-based magazine 
This implies that Russian may be the APT28 author 's preferred language 
Targeting journalists could provide APT28 and its sponsors with a way to monitor public opinion , identify dissidents , spread disinformation , or facilitate further targeting 
Several other nation states are suspected of targeting journalists and dissidents to monitor their activity , including China and Iran. , Journalists in the Caucasus working on Caucasus independence issues would be a prime target for intelligence collection for Moscow 
Journalists critical of the Kremlin have long been targets of surveillance and harassment , and a number of governments and human rights organizations have publicly criticized the government for its treatment of journalists and its increasing consolidation of control over the media 
Of particular note , the Kavkaz Center is a Chechen-run website designed to present an alternative view to the long-running conflict between Russia and Chechen separatists 
In 2004 and 2013 , Russia 's Foreign Minister voiced his displeasure that a Swedish company continues to host the Kavkaz Center website 
Eastern European countries ' political and military postures are traditionally core Russian government interests 
The Kremlin has long regarded the former Soviet Republics and satellite states as in its sphere of economic , political , and military interest 
Over the past two decades , as many of these states joined NATO and the EU , Russia has attempted to regain its influence in the region 
Many of APT28 's targets parallel this continued focus on Eastern European governments and militaries 
We have evidence that APT28 made at least two attempts to compromise Eastern European government organizations : • In a late 2013 incident , a FireEye device deployed at an Eastern European Ministry of Foreign Affairs detected APT28 malware in the client 's network 
The Polish security company indicated that the sample was '' sent to the government , '' presumably the Polish government , given the company 's location and visibility 
We have evidence that APT28 made at least two attempts to compromise Eastern European government organizations 
These domain registrations not only suggest that APT28 is interested in Eastern European political affairs , but also that the group targets Eastern European governments directly 
Baltic Host is a multinational logistics planning exercise , hosted annually since 2009 by one of the three Baltic States ( Estonia , Latvia , and Lithuania , all three of which are on Russia 's border ) on a rotational basis 
In June 2014 , this event was integrated with a larger U.S. Army training event , and focused on exercises to improve interoperability with regional allies and partners. , This domain registration suggests that APT28 sought to target individuals either participating in the exercises or interested in Baltic military and security matters 
Such targets would potentially provide APT28 with sensitive tactical and strategic intelligence concerning regional military capabilities and relationships 
These exercises are a particular point of interest in Moscow : pro- Kremlin press cited Russia 's interpretation of these military exercises and NATO 's involvement as a '' sign of aggression , '' and Russia 's Foreign Minister publicly stated that the exercise was '' a demonstration of hostile intention 
'' APT28 's lures and domain registrations also demonstrate their interest in NATO and other European security organizations 
NATO remains a chief Russian adversary , or in the words of Russia 's 2010 military doctrine , a '' main external military danger '' particularly as it moves '' closer to the borders of the Russian Federation 
'' As the traditional western counterweight to the Soviet Union , Russia regards NATO , particularly NATO 's eastward expansion , as a threat to Russia 's strategic stability 
APT28 also registered a domain name imitating the Organization for Security and Cooperation in Europe ( OSCE ) , an intergovernmental organization that has cited widespread fraud in numerous Russian state elections 
Insider information about NATO , the OSCE and other security organizations would inform Russian political and military policy 
We also observed a user that we suspect works for NATO HQ submit an APT28 sample to VirusTotal , probably as a result of receiving a suspicious email 
APT28 also demonstrated an interest in defense attaches working in European countries 
In addition to targeting European security organizations and governments , it appears that APT28 is targeting attendees of European defense exhibitions 
'' Among other events , the SMi Group is currently planning a military satellite communications event for November 2014 
Targeting organizations and professionals involved in these defense events would likely provide APT28 with an opportunity to procure intelligence pertaining to new defense technologies , as well as the victim organizations' operations , communications , and future plans 
APT28 has targeted a variety of organizations that fall outside of the three themes we highlighted above 
However , we are not profiling all of APT28 's targets with the same detail because they are not particularly indicative of a specific sponsor 's interests 
They do indicate parallel areas of interest to many governments and do not run counter to Russian state interests 
Other probable APT28 targets that we have identified : Our analysis of some of the group 's more commonly used tools indicates that APT28 has been systematically updating their malware since 2007 
APT28 's tools are suggestive of the group 's skills , ambitions , and identity 
Our analysis of some of the group 's more commonly used tools indicates that APT28 has been systematically updating their tools since 2007 
APT28 is most likely supported by a group of developers creating tools intended for long-term use and versatility , who make an effort to obfuscate their activity 
This suggests that APT28 receives direct ongoing financial and other resources from a well-established organization , most likely a nation state government 
APT28 's malware settings suggest that the developers have done the majority of their work in a Russian language build environment during Russian business hours , which suggests that the Russian government is APT28 's sponsor 
• SOURFACE : This downloader is typically called Sofacy within the cyber security community 
CORESHELL is an updated version of SOURFACE 
• CHOPSTICK : This is a modular implant compiled from a software framework that provides tailored functionality and flexibility 
A number of the malware variants that we profile below , especially the CHOPSTICK family , demonstrate formal coding practices indicative of methodical , diligent programmers 
The modularity of CHOPSTICK alone , with its flexible and lasting platform , demonstrates planning for long-term use and versatility 
From a high level , these ciphers share a similar design across the malware families but differ slightly in the internal arithmetic operations 
APT28 has made incremental and systematic changes to the SOURFACE downloader and its surrounding ecosystem since as early as 2007 
These changes indicate a long-standing and dedicated development effort behind APT28 
We have observed samples of the SOURFACE downloader compiled between 2007 and 2014 
First , a malware family is a collection of malware in which each sample shares a significant amount of code with all of the others 
There are exceptions : for example , some files contain public and standard code libraries that we do not take into consideration when making a family determination 
A malware ecosystem is a group of malware families that work together to perform the same objective 
Perhaps the simplest and most typical ecosystem is a dropper and a backdoor that are used together 
In April 2013 , based on compile time , the group began to make significant alterations to the SOURFACE downloader 
They started by changing the compiled DLL name to '' coreshell.dll '' and making minor changes to the network communications , as seen in Figure 7 
The hostname , volume serial number and OS version data are encoded in the new URL format 
As seen in the table below , the SOURFACE/ CORESHELL developers also made other modifications that changed the exported function name and file size over time 
In April 2013 , based on compile time , the group began to make significant alterations to the SOURFACE downloader 
Variants of the SOURFACE second stage backdoor , EVILTOSS , share some code similarities with SOURFACE 
Many of its variants we have seen are named netui.dll 
Interestingly , we found an antivirus report from 2004 detailing what appears to be an early variant of EVILTOSS 
Although we have not conclusively attributed this sample to APT28 , it does suggest the possibility that APT28 has been operating since as early as 2004 
A modular development framework suggests the group has had an organized development effort since as early as 2007 
We call this backdoor CHOPSTICK , a somewhat ironic name that comes from our semi-random name generator 
The modular design allows flexible options for compiling variants with different capabilities as needed , as well as deploying additional capabilities at runtime 
This allows the developers to make targeted implants , including only the capabilities and protocols necessary for a specific environment 
Such a modular framework suggests the group has had an organized development effort since as early as 2007 
A formal development environment , in which code is versioned and well-organized , would almost certainly be required to track and define the various modules that can be included in the backdoor at compile time 
CHOPSTICK variants may move messages and information using at least three methods : 1 
These protocols are covered in more detail in Appendix D. 2 
All information required for the email was hardcoded in the backdoor 
3 
Local copying to defeat closed networks 
During our research into APT28 's malware , we noted two details consistent across malware samples 
The first was that APT28 had consistently compiled Russian language settings into their malware 
The second was that malware compile times from 2007 to 2014 corresponded to normal business hours in the UTC + 4 time zone , which includes major Russian cities such as Moscow and St. Petersburg 
PE resources include language information that can be helpful if a developer wants to show user interface items in a specific language 
Non-default language settings packaged with PE resources are dependent on the developer 's build environment 
Each PE resource includes a '' locale '' identifier with a language ID '' composed of a primary language identifier indicating the language and a sublanguage identifier indicating the country/region 
'' At the time of the writing of this paper , we had identified 103 malware samples that were both attributed to APT28 and contained PE resources 
Table 5 shows the locale identifiers with associated language and country/region for these samples 
The samples with Russian language settings were compiled between late 2007 and late 2013 , as depicted in Figure 9 
This consistency over a long timeframe suggests that the developers of APT28 malware were using a build environment with Russian language settings at least some of the time and made no effort to obscure this detail 
Overall , the locale IDs suggest that APT28 developers can operate in both Russian and English 
Of the 140 malware samples that we have attributed to APT28 so far , over 89 % were compiled between 0400 and 1400 UTC time , as depicted in Figure 10 
Over 96 % were compiled between Monday and Friday 
This parallels the working hours in UTC+0400 ( that is , compile times begin about 8AM and end about 6PM in this time zone ) 
This time zone includes major Russian cities such as Moscow and St. Petersburg 
We started researching APT28 based on activity we observed on our clients ' networks , similar to other targeted threat groups we have identified over time 
We assess that APT28 is most likely sponsored by the Russian government 
We summarize our key observations about APT28 in Figure 11 below 
APT28 's characteristics-their targeting , malware , language , and working hours-have led us to conclude that we are tracking a focused , long- standing espionage effort 
Given the available data , we assess that APT28 's work is sponsored by the Russian government 
We use the term '' threat group '' to refer to actors who work together to target and penetrate networks of interest 
These individuals may share the same set of tasks , coordinate targets , and share tools and methodology 
The art of attributing disparate intrusion activities to the same threat group is not always simple 
Different groups may use similar intrusion methodologies and common tools , particularly those that are widely available on the Internet , such as pwdump , HTran , or Gh0st RAT 
There may be overlaps between groups caused by the sharing of malware or exploits they have authored , or even the sharing of personnel 
Individual threat actors may move between groups either temporarily or permanently 
A threat actor may also be a private citizen who is hired by multiple groups 
Multiple groups , on occasion , compromise the same target within the same timeframe 
Distinguishing one threat group from another is possible with enough information , analytical experience , and tools to piece it all together 
We can analyze multiple incidents and tell by the evidence left behind that a given incident was the result of one threat group and not another 
Threat actors leave behind various forensic details 
Their emails may contain certain patterns ; files have specific names , MD5 hashes , timestamps , custom functions , and encryption algorithms 
Their backdoors may have command and control IP addresses or domain names embedded 
These are just a few examples of the myriad of forensic details that we consider when distinguishing one threat group from another 
At the most basic level , we say that two intrusion events are attributed to the same group when we have collected enough indicators to show beyond a reasonable doubt that the same actor or group of actors were involved 
We track all of the indicators and significant linkages associated with identified threat groups in a proprietary database that comprises millions of nodes and linkages between them 
In this way , we can always go back and answer '' why '' we associated cyber threat activity with a particular group 
Over time the downloader has evolved and the newer versions , usually compiled with the DLL name 'coreshell.dll ' , are distinct enough from the older versions that we refer to it as SOURFACE/CORESHELL or simply CORESHELL 
This appendix focuses on these newer versions 
The encryption algorithm is a custom stream cipher using a six-byte key 
CORESHELL has used the same user agent string ( '' MSIE 8.0 '' ) that SOURFACE previously used , but in more recent samples CORESHELL uses the default Internet Explorer user agent string obtained from the system 
Figure 11 shows an example POST request 
When Base64 decoded , the POST content looks like this : The key used to encrypt the message is six bytes long and is appended to the end of the message 
In this is example the key would be : 30 ac e5 21 e4 a6 
When the message is decrypted , the resulting plaintext is : The following table contains a breakdown of each of the field 's C2 message 
The command is identified by the NULL terminated UNICODE string '' OK '' ( O\x00\K\x00\x00\ x00 ) 
The command is Base64 encoded and immediately follows the '' OK '' string 
Figure 12 shows a sample CORESHELL command : The Base64 decoded string is : The following table contains a description of each field in the command message : When the above command '' 10 41 70 41 10 42 33… '' is decrypted using the key '' 01 01 01 01 01 01 01 01 '' the following command message is produced : The implant supports the following four command identifiers from the controller as seen in Table 8 
The first byte of the command message specifies the command type and is immediately followed by the PE or shellcode to be executed 
In this example the command byte is 04 indicating the following bytes are shellcode 
This framework allows for a diverse set of capabilities across malware variants sharing a common code base 
This appendix documents variants using HTTP communications 
The user HKU\S-1-5-19 corresponds to the LOCALSERVICE account SID 
The key is a combination of a 50-byte static key and a four-byte salt value randomly generated at runtime 
The static key is derived from opcodes in the backdoor 
The RC4 encryption used here also uses a 50- byte static key plus four-byte random salt value 
It does not wait for a response from the server to begin uploading 
Each HTTP request contains multiple Base64 encoded URL parameters , however only one parameter contains information encoded by the malware ( '' ai= '' ) and the rest of the URL parameters appear to be randomly generated per request 
The Base64 encoded text of this parameter begins with a number of randomly generated alphabetical characters presumably intended to prevent people from Base64 decoding the whole string without some knowledge of how the malware family works 
The first four bytes of the message are an XOR key for the remainder of the data 
Once decrypted using the XOR key , an 11-byte sequence is revealed 
The first seven bytes are static , and are hard-coded in CHOPSTICK , while the last four bytes appear to be unique 
This encoded string is also prefixed with random characters designed to break the output of a Base64 decode operation on the entire string 
The first 15 bytes of the decoded message body comprise another 11-byte sequence similar to the sequence stored in the '' ai= '' parameter as described above 
Decrypting these bytes yields another static seven-byte sequence , followed by four unique bytes 
The remainder of the message body consists of the RC4 encrypted data containing the HTML-formatted user activity log , edg6EF885E2.tmp 
CHOPSTICK backdoors are compiled within a modularized development framework 
This means that two separate CHOPSTICK backdoors may contain vastly different functionality , depending on which modules were included at compile time 
Figure 14 includes an example from a CHOPSTICK v1 variant : To decode the POST content , the first step is to remove characters from the Base64 string ( the number of characters to remove may vary between different communication channels ) 
In the example from Figure 14 , the number of characters removed is seven 
The next 4 bytes '' f8 dc 33 9e '' are a salt value that is appended to the end of an RC4 key 
Once decrypted , the message looks like the following : The strings '' V4MGNxZWlvcmhjOG9yZQ '' and '' = < < \xee '' are hardcoded in the implant 
The module information starts at offset 0x20 with the string '' 01 00 00 '' and is formatted as follows : The modules included in this CHOPSTICK v1 implant are : Our determination of a CHOPSTICK '' v1 '' versus '' v2 '' is based on the self-identification of the kernel ID and associated modules 
Compare the list of CHOPSTICK v1 modules in Table 12 with the list of modules in an example CHOPSTICK v2 variant in Table 13 : The kernel IDs 0x0001 and 0x0002 indicate different versions 
The corresponding modules in each backdoor also are consistently identified with 0x01 and 0x02 , respectively , in the second byte 
In both variants the modules with keystroke log , file system access , and command shell capabilities have the consistent identifiers 0x10 , 0x11 , and 0x13 , respectively , in the first byte 
This suggests that the first byte in the module ID identifies the module type whereas the second byte identifies the kernel version 
The kernel sends commands to each module using its module ID 
The commands that each module understands are likely consistent from build to build 
Table 14 and Table 15 show examples of commands that each module understands 
There is a missing space in the MediaPlayer directory and the filename is missing the 'o ' character 
Sample HTTP traffic is displayed in Figure 15 
OLDBAIT handles APIs very similarly to SOURFACE and EVILTOSS 
There is a setup routine that loads the imports into a table and all API calls reference an index to this table 
In SOURFACE and EVILTOSS the table is stored in a global variable while in OLDBAIT this table is allocated at runtime and a pointer is passed between functions 
Over the last 10 months , Kaspersky Lab researchers have analyzed a massive cyber-espionage operation which we call '' Epic Turla '' 
The attackers behind Epic Turla have infected several hundred computers in more than 45 countries , including government institutions , embassies , military , education , research and pharmaceutical companies 
The attacks are known to have used at least two zero-day exploits : We also observed exploits against older ( patched ) vulnerabilities , social engineering techniques and watering hole strategies in these attacks 
When G-Data published on Turla/Uroburos back in February , several questions remained unanswered 
One big unknown was the infection vector for Turla ( aka Snake or Uroburos ) 
The attacks are still ongoing as of July 2014 , actively targeting users in Europe and the Middle East 
Note : A full analysis of the Epic attacks is available to the Kaspersky Intelligent Services subscribers 
Watering holes ( waterholes ) are websites of interest to the victims that have been compromised by the attackers and injected to serve malicious code 
So far we have n't been able to locate any e-mail used against the victims , only the attachments 
The PDF attachments do not show any '' lure '' to the victim when opened , however , the SCR packages sometime show a clean PDF upon successful installation 
Some of known attachment names used in the spearphishing attacks are : In some cases , these filenames can provide clues about the type of victims the attackers are targeting 
Some of the injected websites include : In total , we observed more than 100 injected websites 
Currently , the largest number of injected sites is in Romania 
Here 's a statistic on the injected websites : The distribution is obviously not random , and it reflects some of the interests of the attackers 
For instance , in Romania many of the infected sites are in the Mures region , while many of the Spanish infected sites belong to local governments ( City Hall ) 
Most of the infected sites use the TYPO3 CMS ( see : http : //typo3.org/ ) , which could indicate the attackers are abusing a specific vulnerability in this publishing platform 
] au '' 
For a full list of C & C servers , please see the Appendix 
The Epic Turla attackers are extremely dynamic in using exploits or different methods depending on what is available at the moment 
The attackers operate the mothership using a network of proxies and VPN servers for anonymity reasons 
We were able to get a copy of one of the motherships , which provided some insight into the operation 
To change the file , they are using the '' Task editor '' from the menu 
Some other unknown IPs were also observed in the targeting schedules 
There is also an '' except.css '' file where attackers log the reasons they did n't try to exploit certain visitors 
This makes the analysis more difficult 
This exploit only works on unpatched Microsoft Windows XP systems 
Other known detection names for the backdoor is Trojan.Wipbot ( Symantec ) or Tavdig 
The malware behavior is defined by a configuration block 
The configuration block usually contains two hard-coded C & C URLs 
He have also seen one case where the configuration block contains just one URL 
Most samples , especially old ones , have the ID 1156fd22-3443-4344-c4ffff 
In addition to generic searches , some very specific lookups have been observed as well 
This scheme was implemented in April 2014 
Note : the filename can change across victims 
On one Central Asian government 's Ministry of Foreign Affairs victim system , the filename used was '' adobe32updt.exe '' 
In addition to these custom tools , we observed the usage of standard administration utilities 
In several cases , an interesting update has been observed -- a malware from a different , yet related family 
Several plugins for the '' Carbon system '' are known to exist 
Note : the command and control servers www.losguayaberos [ 
] com and thebesttothbrushes [ 
] com have been sinkholed by Kaspersky Lab 
The plugins for the Carbon system can be easily recognized as they always feature at least two exports named : Several Epic backdoors appear to have been designed to work as Carbon system plugins as well - they require a specialized loader to start in victim systems that do not have the Carbon system deployed 
Some modules have artifacts which indicate the Carbon system is already at version 3.x , although the exact Carbon system version is very rarely seen in samples : The author of the Carbon module above can be also seen in the code , as '' gilg '' , which also authored several other Turla modules 
We are planning to cover the Turla Carbon system with more details in a future report 
Internally , the backdoor is named '' Zagruzchick.dll '' : The word '' Zagruzchick '' means '' boot loader '' in Russian 
The Control panel for the Epic motherships also sets the language to codepage '' 1251 '' : Codepage 1251 is commonly used to render Cyrillic characters 
The threat actor behind the '' Epic '' operation uses mainly hacked servers to host their proxies 
The hacked servers are controlled through the use of a PHP webshell 
This shell is password protected ; the password is checked against an MD5 hash : The MD5 '' af3e8be26c63c4dd066935629cf9bac8 '' has been solved by Kaspersky Lab as the password '' kenpachi '' 
Once again , it is also interesting to point out the usage of Codepage 1251 in the webshell , which is used to render Cyrillic characters 
There appears to be several links between Turla and Miniduke , but we will leave that for a future blogpost 
This is the country distribution for the top 20 affected countries by victim 's IP : According to the public information available for the victims ' IPs , targets of '' Epic '' belong to the following categories : When G-Data published their Turla paper , there were few details publicly available on how victims get infected with this malware campaign 
Our analysis indicates this is a sophisticated multi-stage infection ; which begins with Epic Turla 
Most recently , we observed this attack against a Kaspersky Lab user on August 5 , 2014 , indicating the operation remains fresh and ongoing 
Note : A full analysis of the Epic attacks is available to the Kaspersky Intelligent Services customers 
On September 24 2014 , FireEye observed a new strategic web compromise ( SWC ) campaign that we believe is targeting non-profit organizations and non-governmental organizations ( NGO ) by hosting iframes on legitimate websites 
FireEye has not yet attributed this activity though we have identified links to the Sunshop Digital Quartermaster , a collective of malware authors that supports multiple China-based advanced persistent threat ( APT ) groups 
FireEye previously established detection measures for this threat activity , ensuring our clients were prepared for these intrusion attempts well in advance of threat actor implementation 
On September 24 , FireEye observed SWCs , likely conducted by a unitary threat group based on shared infrastructure and tools , on at least three different websites : an international non-profit organization that focuses on environmental advocacy , and two different NGOs that promote democracy and human rights 
Figure 1 displays one of the iframes 
A GET request to this URI returned the following content : The 'bin ' param shown in Figure 2 is decoded from ASCII into hex by the Java exploit 
Once decoded , FireEye identified the payload as a Poison Ivy variant 
However , the malware author misspelled multiple words when attempting to put in versioning information for this particular build 
The Poison Ivy backdoor also had a RTMANIFEST PE resource with a SHA256 fingerprint of 82a98c88d3dd57a6ebc0fe7167a86875ed52ebddc6374ad640407efec01b1393 
This same RTMANIFEST resource was documented in our previous Sunshop Digital Quartermaster report 
FireEye previously identified this specific RTMANIFEST as the 'Sunshop Manifest , ' and we have observed this same manifest resource used in 86 other samples 
As we stated in the Quartermaster report , we believe this shared resource is an artifact of a builder toolkit made available to a number of China- based APT groups 
This activity represents a new SWC campaign 
We suspect threat actors are leveraging their access to compromised websites belonging to NGOs and non-profits to target other organizations in the same industries 
These websites are often visited by organization employees and other organizations in the same industries , allowing threat actors to move laterally within already compromised networks or gain access to new networks 
While FireEye has not attributed this activity to a specific threat group , we frequently observe China-based threat actors target non-profits and NGOs , and we suspect that they seek to monitor activity within their borders that may lead to domestic unrest or embarrass the Chinese government 
For example , in 2013 , FireEye observed China-based threat actors steal grant applications and activity reports specifically related to an international NGO 's China-based activities 
We suspects threat actors sought to monitor these programs and involved individuals 
The three organizations whose websites are hosting the malicious iframes have China-based operations 
FireEye is releasing information on this campaign to allow organizations to investigate and prepare for this activity in their networks 
We believe non-profits and NGOs remain at elevated risk of intrusion and should be especially wary of attempts to compromise their networks using SWC 
Threat actors may use SWCs to achieve this goal , but FireEye does not discount the possibility that threat actors will use other means at their disposal , including phishing 
Based on past threat actor activity in this industry , FireEye expects threat actors are motivated to steal programmatic data and monitor organizations ' programs in specific countries 
If China-based threat actors are behind the observed campaign , FireEye expects that organizations with operations in China are high-priority targets 
FireEye currently has detection measures in place that should allow users of FireEye products to detect this SWC activity 
It is also likely that other industries or organizations were affected by this SWC activity , since these sites are public facing and frequently visited 
Special thanks to Google 's Billy Leonard for providing additional information and research 
Thanks to the following authors for their contributions : Mike Oppenheim , Ned Moran , and Steve Stone 
This entry was posted in Threat Intelligence , Threat Research by Sarah Engle and Ben Withnell 
Bookmark the permalink 
Cyber espionage has been a hot topic through the last years 
Computer attacks known as '' APT '' ( Advanced Persistent Threat ) have become widely reported and emphasized by the media , damages are now considered as real and strategic trends are moving in cyber defense 
AIRBUS Defence & Space – CyberSecurity unit responds to such attacks for its customers every day , developing a complete range of solutions 
Today , we decided to release publicly information on a specific group of APT attackers known as '' Pitty Tiger '' 
This information comes directly from investigations led by our Threat Intelligence 
Pitty Tiger is a group of attackers that have been active since at least 2011 
They have targeted private companies in several sectors , such as defense and telecommunications , but also at least one government 
We have been able to track down this group of attackers and can provide detailed information about them 
We were able to collect and reveal their '' malware arsenal '' 
We also analyzed their technical organization 
Our investigations indicate that Pitty Tiger has not used any 0day vulnerability so far , rather they prefer using custom malware , developed for the group 's exclusive usage 
Our discoveries indicate that Pitty Tiger is a group of attackers with the ability to stay under the radar , yet still not as mature as other groups of attackers we monitor 
Pitty Tiger is probably not a state-sponsored group of attackers 
They lack the experience and financial support that one would expect from state-sponsored attackers 
We suppose this group is opportunistic and sells its services to probable competitors of their targets in the private sector 
We have been able to leverage several attackers profiles , showing that the Pitty Tiger group is fairly small compared to other APT groups , which is probably why we saw them work on a very limited amount of targets 
At the end of this report , we provide indicators of compromise to help people detect current Pitty Tiger attacks 
APT attacks follow what we call the '' APT kill chain '' 
The kill chain describes briefly the way attackers do perform their actions 
It can be summarized by the following scheme : The reconnaissance phase commences when an attacker selects a new target and involves the acquisition of information about that target 
There is very little information available about this phase , and there is little data about it 
The only way to collect information about this phase would be to already monitor all attackers ' actions at this step , which is hardly feasible 
The longer the attackers spend time in attempting to understand their target and its online presence , the easier it will be to find efficient ways to penetrate that company 's systems 
This reconnaissance phase is both about finding information to break into the targeted network successfully and about searching for data which could help to accelerate sensitive information isolation ( like the name of a key employee for example ) 
This phase mostly relies on open sources from the Internet : social networks , press releases , white papers , corporate websites , search engines , but also on some active tools like vulnerability scanners etc 
At this stage , the APT attackers have a solid knowledge of their target and its key employees 
In fact , they can even send just a single e-mail 
The method has one major drawback : it will also infect third parties who visit the website 
Attackers have developed ways to avoid this 
If their reconnaissance phase has been done effectively , they already know all IP ranges used by the target company 
Direct attacks against servers of the target can also be a way to penetrate the target 's network 
In case one backdoor falls , there will be others 
They use lateral moves between machines inside the network , and look for everything they need 
This step is very hard to detect , since they only use valid credentials and legitimate administration tools such as PsExec 
This phase is not the end of an APT attack 
For more information about all the APT phases , please refer to our APT Kill Chain blog post serie 
During our regular investigations on APT cases , one particular variant of malware caught our attention , because we had not faced it before 
We decided to spend some time to investigate around this malware and found out that it was used exclusively by a single group of attackers 
This malware family is known as '' PittyTiger '' by the anti-virus research community 
Our researches around this particular malware family revealed the '' Pitty Tiger '' group has been active since 2011 , yet we found other publications which could probably be attributed to the same group of attacker back in 2010 
This group uses other malware and tools during their APT operations , in addition to the PittyTiger RAT 
A variant of the infamous Gh0st RAT dubbed '' Paladin '' has been used repeatedly by the PT group , together with other RATs which seem to be developed exclusively for the PT group : '' MM RAT '' ( aka Troj/Goldsun-B ) , and '' CT RAT '' 
Another variant of Gh0st RAT named '' Leo '' has been found inactive on a c & c server 
We also found another malware , named '' Troj/ReRol.A '' 
Our investigation has been focused on the data we could get from these c & c servers but also on the Pitty Tiger environment 
This whitepaper aims to expose the view we have on the group , especially on their infrastructure and capabilities 
We hope this publication will bring further counter analysis from the research community to enrich the global common threat knowledge 
We would advocate that this method is unwise when you want to stay furtive , and doing it from a c & c server is very surprising , to say the least 
While the Pitty Tiger group is experienced on some aspects on its running APT campaigns , it definitely lacks some maturity here 
It is generally the first step of the initial compromise for Pitty Tiger campaigns 
This vulnerability affects Microsoft Office versions up to Office 2010 
The discovery of this '' old '' vulnerability exploitation in June 2014 could mean that the Pitty Tiger group has no direct access to 0day exploits , or not enough budgets to buy some 
It could also mean they use their low range exploit by default because it is working on their targets and is sufficient to compromise their workstations 
The Word document we initially found was probably a '' test '' document used by the group 
Very few variants of Troj/ReRol.A are public 
Once the data is deciphered , the last byte of the clear text should also be 0xc3 
We have been able to decrypt the communications and confirmed what is transmitted to the c & c server 
The c & c part consists of two files : The dr.asp registers the following keywords : These two binaries were no longer available on the server 
However , we found various files which could have been used as '' 32.exe '' in the past : The 322.exe file is a legitimate , Chinese , calc.exe tool 
It might have been used by the attackers to perform tests 
The 3 others binaries are RATs , which will be detailed in the next parts 
This RAT is the origin of the attackers ' group name 
'' PittyTiger '' is a mutex used by the malware 
'' Pitty Tiger '' is also a string transmitted in the network communications of the RAT , as you will see in this chapter 
This id consists of the infected computer name followed by a dash and the lower word of the disk serial id 
We have been able to confirm that the author of those two families of malware is the same person , as will be seen in the next chapter about '' CT RAT '' 
We have been able to acquire both the client and the server parts 
We found two instances of the same binary with different names – 32mm.exe and mm32.exe 
This RAT seems to be an evolution of PittyTiger , since a specific server binary we found could handle both requests from CT and PittyTiger , and was indicated as compatible with PittyTiger 
The RC4 key is the Unicode form of the requested URL 
The c & c part is a Windows binary written in .NET 
We found 2 versions : The About form gives the name of the developer ( s ) : The version of the controller which can handle both PittyTiger and CT shows the same author ( s ) : As these screenshots show , the switch between PittyTiger and CT was probably in the last semester of 2013 
The text can be translated , thanks to Google Translate , as : Further discussion about this author is provided in subsequent sections 
We named this malware '' MM RAT '' at the beginning of our investigation , before we found an existing name for it , '' Troj/Goldsun-B '' according to Sophos 
We have been able to acquire both a client and server part for it 
It contains the '' 1.6.0 '' version number , and uses the password '' 9ol.8ik , '' to authenticate with the bots 
The management protocol is the same as the bots protocol , with different CGI files : The bots ' answers to remote commands can be retrieved by requesting the '' Reply.sec '' file ( e.g 
GET /httpdocs/mm/ < botid > /Reply.sec ) These network patterns might ring bells in some researcher 's minds 
The network communication used by this binary are the same as those used by the Enfal malware , which has been used in the past by the Lurid group ( APT attackers ) and by other threat actors in China 
An examination of the code did not reveal code similarities with the Enfal malware 
We have been able to get both a client and server part of it 
This malware is a variant of the infamous Gh0st RAT 
Our specific sample uses '' ssss0 '' instead of the usual '' Gh0st '' header for network communications 
The commands ID used in the communication protocol have also changed , but the features are quite the same 
The configuration is directly embedded in the binary , and deciphered at runtime 
'' EY '' could stand for '' Ernst & Young '' 
It would not be very surprising , since a lot of different attack groups do use anti-virus vendors or other big company 's names to try to look more legitimate 
Pitty Tiger is no exception , as detailed later in this report 
We also found two c & c binaries , claiming to be versions 2.1 and 2.2 of the Paladin RAT controller 
Version 2.1 answers to the '' ssss0 '' header , while version 2.2 uses the classical '' Gh0st '' header 
Additionally to the Paladin RAT , we found another variant of Gh0st RAT , named '' Leo '' 
Although we have found it on a c & c server of the group , there is no evidence that is has been used by the group , in opposition to Paladin which is used often by Pitty Tiger 
Our investigation has focused on three particular c & c servers used by the group 
These c & c servers , unlike the other c & cs used by the group , have been misconfigured 
Once parsed and dumped , it provided us with more insight 
We found several domains used by the Pitty Tiger group , the most interesting ones being detailed in this chapter 
Pitty Tiger , like other APT attackers , often use anti-virus '' familiar names '' when registering domains or creating subdomains 
Some examples can be avstore.com.tw , sophos.skypetm.com.tw , symantecs.com.tw , trendmicro.org.tw etc 
The registration information for this domain has been the same since 2013-06-04 : This information has been used to register another domain , skypetm.com.tw , which has also been used by the Pitty Tiger group 
Our research also led us to the discovery of four different malware families connected to subdomains of avstore.com.tw : This domain has shown two different WHOIS entries through time : The most recent registration information is also used for avstore.com.tw 
There is an increase in the registrations from 2010 on 
All the e-mail addresses used are connected to the Pitty Tiger group 
Mapping the victims of such a targeted campaign is not an easy task 
We have found the Pitty Tiger group to be very active against one particular private company from the defense industry and one academic network of a government , , yet we think it was done to be used as a proxy for some of the group 's operations 
We have also found some connections from other companies to the c & c servers , yet we did not find evidence that they were real victims 
These alleged victims do work in different sectors and are located mostly in European countries 
It might be surprising to see a company specialized in web development here , yet it has built websites for interesting potential targets 
We have to mention that we only had access to three of the several attackers ' servers 
Therefore , we suppose the Pitty Tiger group could have more targets than what we could confirm 
During the course of our investigations , we discovered a RAR archive on the attacker 's server containing 5 Word documents and one small C source code 
These documents belong to the defense company which has been compromised 
The documents were still exhibiting comments from various users , showing it was an ongoing work and not old documents 
This other company could be a partner or competitor 
Since we were unable to determine the intended use of this specific document , we can only suppose that it could be used to provide commercial advantages to competitors of that company , or used by a foreign state 
During our investigation , we found out interesting information about the Pitty Tiger group itself 
After analyzing the various collected elements , we have tried to draw a portrait of this particular threat 
We have been able to get all the RDP connections logs to one c & c server : These connections are either VPS or dynamic IP addresses , mostly from China 
This IP address belongs to an ADSL dynamic pool in the Wuhan area ( Hubei's provincial capital ) 
There are 11 IP addresses from Chinese dynamic ADSL ranges : 9 from Fuqing ( Fujian province ) , one from Fuzhou ( Fujian 's province capital ) and one from Nanchang ( Jiangxi 's province capital ) 
The last one came from a VPS instance located in Los Angeles ( California , USA ) but purchased by a China based VPS provider XeVPS which belong to the AS38197 ( Sun Network Hong Kong Limited ) 
This information was still available when we got access to the c & c server 
The c & c IP address , 198.100.113.27 , can be seen there 
Other log files showed that '' Toot '' is using virtual machines for his tests 
We can also see the system : Microsoft Windows XP SP3 
The '' P '' field is the language ID 
1028 means '' Chinese traditional '' 
We have also seen tests run by '' toot '' with a language ID of 2052 , which is '' Chinese simplified '' 
The '' M '' field is probably used for versioning 
It is a hardcoded string in the binary 
Here is a follow-up of the commands launched by the bot controller , in a standard command-line shell : The attacker goes on like this , using his tools , and then ends the communication with this RAT on that computer 
In addition to all information already shown , we saw Toot connect to an account on a cloud service named '' Baidu Drive '' 
The e-mail address linked to this account is dyanmips @ qq.com ( QQ-ID : 2589315828 ) 
We could find traces of two other e-mail accounts associated to Toot , ciscodyanmips @ qq.com ( QQ ID : 204156335 ) and ciscodynamips @ qq.com ( QQ ID : 1878836793 ) 
We did not find more information about user '' Toot '' , yet we miss Chinese language capabilities 
The controller part of CT RAT/PittyTiger RAT revealed the following '' about '' information , once translated from Chinese to English language : CT console ( compatible pittytiger ) v1.3 2013.12 by Trees and snow We believe this translation of the author 's name might not be accurate due to the use of automated translation tools 
Moreover , we have strong suspicions that there is not a single individual nicknamed '' Trees and snow '' but rather two programmers nicknamed '' Trees '' and '' Snow '' 
'' Trees '' could also be '' Cold '' 
We noticed that the symbol for this word is translated differently according to the context it is used in 
Once again , we lack Chinese language skills 
We identify the two nicknames on the current campaign as Automn Snow ( 秋雪 ) and Cold Air Kiss ( 风吻寒 ) 
While we are confident that these people are indeed the developers of both PittyTiger and CT RAT malware , we are not sure they belong to the PittyTiger group 
These developers might just have been hired to develop these RATs 
They might also just be selling it to the PittyTiger group 
There is no trace of usage from other attacking groups , we believe the PittyTiger RAT is exclusively used by this group of attackers 
According to indicators we gathered and threat activities profiling we have some hypothesis on the way the group is conducting its operations 
We have strong evidence of a bot operator position 
We identify one nickname for this position , the user known as TooT 
As we did not see other nickname , we think that TooT is one person and not a group of persons 
We also identified a malware development position 
We identified two nicknames for this position on the current campaign , Automn Snow ( 秋雪 ) and Cold Air Kiss ( 风吻寒 ) 
Yet we are unsure that they belong to the group , they might just be a third party providing or selling their malware 
We have a strong suspicion of a coordinator position , which coordinates the bot operator , provides him with some logistics support ( weaponized document , tools… ) and reviews the programmers work 
This position could imply a communication channel with another manager 
We named this position 'Chen ' , in relation with several references of this common Chinese name in c & c WHOIS and other investigation materials 
We have some suspicion of a customer relationship manager position that may act as an interface between a customer and Chen 
We named this position 'Lilly ' 
We have been lucky enough to get the controller part of Pitty Tiger and CT RAT , and even to get a kind of hybrid controller made for CT RAT but also supporting Pitty Tiger 
We suppose that the CT RAT is the new evolution of Pitty Tiger and that it will replace Pitty Tiger in the following months 
The presence of a Chinese version of '' calc.exe '' , the official calculator provided in Microsoft Windows , is interesting 
In addition to those tools , we found some interesting scripts 
This file is 67320 lines long , and uses 5610 different passwords for each of 12 users contained in this file 
The user names are clearly the result from a user enumeration and are dedicated to a particular French victim 
The passwords listed in this file are either build from several campaigns or from the current campaign 
A lot of passwords are related to the targeted company and might be previous passwords from users 
We have also discovered a pack of files which can be used to trigger an Internet Explorer vulnerability ( CVE-2014-0322 ) 
The date of these files , namely Tope.swf and index.html , was 2014/02/18 , a few days after the revelation of existing exploits in the wild used in APT attacks 
We do not know if the Pitty Tiger group used this exploit or not , but found no trace indicating they did 
A lot of different attackers seem to have used that vulnerability since 
Determining who is exactly behind an APT campaign is difficult 
We tried to extract different technical indicators , together with contextual elements 
Yet some IP addresses in the USA and in Hong Kong have also been found ; All the items listed in this chapter are strong indicators that the attackers might be Chinese 
Pitty Tiger is a group of attackers that have been active since at least 2011 
Pitty Tiger is probably not a state-sponsored group of attackers 
The attackers lack the experience and financial support that one would expect from state-sponsored attackers 
We suppose this group is opportunistic and sells its services to probable competitors of their targets in the private sector 
One governmental network has been targeted by the group , yet we do not have any evidence of the purpose of this attack 
We suppose this particular attack has been executed to provide a usable bounce for the group 
The campaign we studied has been largely focused on one particular target 
We suspect the Pitty Tiger group to work according to an opportunistic business model : this group might offer its services to third parties from the private sector 
This group seems to be very small compared to other APT groups 
We have leveraged several profiles and could identify some attackers to a certain extent 
We believe this group might keep working as it is now , with limited budgets , or grow to extend its attacking campaign capabilities 
This list of indicators is provided in order to help people detect Pitty Tiger APT campaign 
The Darkhotel APT is a threat actor possessing a seemingly inconsistent and con- tradictory set of characteristics , some advanced and some fairly rudimentary 
In- hospitably operating for almost a decade , the threat actor is currently active 
Darkhotel tools are detected as '' Tapaoux '' , '' Pioneer '' , '' Karba '' , and '' Nemim '' , among other names 
These might be GoogleToolbar , Adobe Flash , Windows Messenger , etc 
This group of attackers seems to know in advance when these individuals will arrive and depart from their high-end hotels 
So , the attackers lay in wait until these travelers arrive and connect to the Internet 
The FBI issued advisories about similar hotel incidents ; Australian government offi- cials produced similar , newsworthy accounts when they were infected 
While an FBI announcement related to attacks on hotel guests overseas appeared in May 2012 , related Darkhotel samples were already circulating back in 2007 
And available Darkhotel server log data records connections as early as Jan 1 , 2009 
When visiting the same hotels , our honeypot research systems could n't attract a Darkhotel attack 
This data is inconclusive , but it points to misuse of check-in information 
The Darkhotel actor maintained an effective intrusion set at hotel networks , providing ample access to unexpected points of attack over several years 
These staging points also provide the attackers with access to check-in/check-out and identity information of visitors to high-end and luxury hotels 
The attackers were very careful with the placement of these iframes and executables on trusted resources - the hotels ' network login portals themselves 
Those portals are now reviewed , cleaned and undergoing a further review and hardening process 
We observed traces of a couple of these incidents in late 2013 and early 2014 on a victim hotel 's network 
Outside reports of the same activity at other hotels provide enough data to confirm the same careful operations there 
The attack technique blurs the line between a couple of common APT tactics ; fairly inaccurate '' watering holes '' or '' strategic web compromises '' and more accurate spearphishing techniques 
In this case , the Darkhotel attackers wait for their victim to connect to the Internet over the hotel Wi-Fi or the cable in their room 
There is a very strong likelihood the targets will connect over these resourc- es , and the attackers rely on that likelihood , much like at a watering hole 
While setting up the attack , the Darkhotel attackers knew the target 's expected arrival and departure times , room number , and full name , among other data 
So , here we have yet another unique characteristic of this attacker - they employ a loosely certain but highly precise offensive approach 
These Japanese archives , translated for Chinese speaking viewers , appear to be sexual in nature , part of an anime sex/military comic scene , exposing the likely interests of potential targets 
The p2p bittorrent Darkhotel offering is listed here , posted on 2013.11.22 
It was spread throughout 2014 
This torrent serves up an almost 900 mb file 
The rar archive decompresses to a directory full of encrypted zips , the associated decryptor and a password file for decrypting the zips 
There are tens of thousands of down- loads of these individual torrents 
Examples include comics and anime offerings 
These subproject efforts targeted defense industrial base ( DIB ) , government , and NGO organizations 
Email content on topics like nuclear energy and weaponry capabilities was used as a lure 
Early accounts were posted on contagio describing attacks on NGO organi- zations and government policy makers 
This crew occasionally deploys 0-day exploits , but burns them when required 
In early 2014 , our researchers exposed their use of cve­2014­0497 , a Flash 0-day described on Securelist in early February 
The Darkhotel actors typically sign their backdoors with digital certificates of one kind or another 
However , the certificates originally chosen by this crew are very interesting because of their weak keys and likely abuse by attackers 
Here is a listing of the certs that were commonly used to sign Darkhotel malcode , requiring advanced mathematical capabilities to factorize the keys at the time 
They are not the only certificates used by the group 
More recent activity suggests that the group has stolen certificates to sign their code 
All related cases of signed Darkhotel malware share the same Root Certificate Authority and Intermediate Certificate Authority that issued certificates with weak md5 keys ( RSA 512 bits ) 
We are confident that our Darkhotel threat actor fraudulently duplicated these certificates to sign its malware 
These keys were not stolen 
Many of the certificates were noted in a 2011 Fox­IT post '' RSA­512 Certificates Abused in the Wild '' 
To further support this speculation please note the non­specific Microsoft Security Advisory below , the Mozilla advisory addressing the issue at the time , and the Entrust responses 
From Microsoft 's security advisory from Thursday , November 10 , 2011 : '' Microsoft is aware that DigiCert Sdn 
Bhd , a Malaysian subordinate certifica- tion authority ( CA ) under Entrust and GTE CyberTrust , has issued 22 certifi- cates with weak 512 bit keys 
While this is not a vulnerability in a Microsoft product , this issue affects all supported releases of Microsoft Windows 
There is no indication that any certificates were issued fraudulently 
Instead , cryptographically weak keys have allowed some of the certificates to be dupli- cated and used in a fraudulent manner 
Microsoft is providing an update for all supported releases of Microsoft Windows that revokes the trust in DigiCert Sdn 
Bhd 
The update revokes the trust of the following two intermediate CA certificates : Digisign Server ID – ( Enrich ) , issued by Entrust.net Certification Authority ( 2048 ) Digisign Server ID ( Enrich ) , issued by GTE CyberTrust Global Root '' From Mozilla 's 2011 response : '' While there is no indication they were issued fraudulently , the weak keys have allowed the certificates to be compromised 
Furthermore , certificates from this CA contain several technical issues 
They lack an EKU extension specifying their intended usage and they have been issued without revocation information 
'' From Entrust 's response : '' There is no evidence that the Digicert Malaysia certificate authorities have been compromised 
'' Here are some notes on the costs and technical requirements of attacking these certificates 
The computing power required to crack and factor an RSA 512 bit key was $ 5000 and the period of time required was about 2 weeks 
( see http : //lukenotricks 
blogspot.co.at/2010/03/rsa­512­factoring­service­two­weeks.html ) In October 2012 , Tom Ritter reported that it would cost about $ 120­- $ 150 , per- haps even as little as $ 75 
Going even further back , there was much discussion about the technical meth- ods of cracking these keys : DJ Bernstein 's 2001 paper on building a machine reducing the cost of integer factorization with Number Field Sieve techniques , breaking 1024 bit RSA keys 
RSA 's reaction and 2002 statement on whether or not 1024 bit RSA keys are broken : '' NIST offered a table of proposed key sizes for discussion at its key man- agement workshop in November 2001 [ 7 ] 
For data that needs to be protected no later than the year 2015 , the table indicates that the RSA key size should be at least 1024 bits 
For data that needs to be protected longer , the key size should be at least 2048 bits 
'' Recent Tapaoux attacks and backdoors include malware signed with strong SHA1/RSA 2048 bit certificates , suggesting certificate theft 
It is clean , well­written , kernel level malcode 
The languages of its strings are a mix of English and Korean 
It is signed with the familiar '' belinda.jablonski @ syniverse.com '' digital certificate 
It buffers , then communicates logged user data to the running user mode component 
Its encryption algorithm is similar to RC4 
The interesting part is that the module randomly generates the key and stores it in an unexpected place : in the middle of the log file name 
Hence , the numeric part of the filename is used as a seed for the pseudorandom number generator 
The rand function is statically linked to ensure same results on different computers 
The Darkhotel toolset consists of multiple components that have been slightly modified over time 
If a special file exists on the system , the module will not start calling back to C & C server until the special file is 180 days old 
This malware is 220Kb in size 
More technical details are provided in Appendix D. This malware is 63kb in size 
Pioneer.dx '' 
Observed downloaded components are signed with a familiar expired certificate from www.esupplychain.com.tw , issued by Cybertrust SureServer CA 
Some IDs appear to be related to geographic interests , others do not seem obvious 
We gathered a list of Darkhotel campaign IDs shown below 
Internal IDs and c2 resources overlap across these com- ponents , there is no pattern of distribution according to connectback resources 
The most common id is '' DEXT87 '' : This infrastructure team appears to employ a lesser skillset than top notch campaigns , maintaining weak server configurations with limited monitoring and defensive reactions , and making some simple mistakes 
However , they are ef- fective at maintaining a fully available infrastructure to support new and existing infections 
Overall , victims in our sinkhole logs and KSN data were found across the globe , with the majority in Japan , Taiwan , China , Russia , Korea and Hong Kong 
The following C & C domains have been sinkholed and redirected to the Kaspersky Sinkhole Server Our Kaspersky Security Network detected Darkhotel infections across thousands of machines , mostly related to the Darkhotel p2p campaigns 
These geolocation estimates probably provide the most accurate picture of where Darkhotel activity is occurring 
Here is a pie chart to better visualize the proportions of attack activity throughout the world 
As you can see , over 90 % of it occurs in the top five countries : Japan , followed by Taiwan , China , Russia and Korea 
Also , many researcher systems are connected to the sinkholed domains 
However , this graph of current sinkhole callbacks presents a low confidence distribution of victim geolocation , with India , Japan , Ireland , Korea , China and Taiwan in the top slots 
Removing India and Ireland , the set more closely matches our KSN data 
The ddrlogs appear to maintain callback data that the attackers want to set aside in error logs 
Many of the callback URLs have errors , many are from unwanted IP ranges , and others are clearly unwanted researcher sandbox system callbacks 
Those records are formatted in the following manner : Only 120 IP addresses perform the '' B '' checkin , and 90 % of these are from the range 150.70.97.x 
This entire range is owned by Trend Micro in Tokyo , JP 
A handful of the remaining addresses , like 222.150.70.228 , appear to come from other ranges owned by Trend Micro in JP 
One outlier comes from an El Sal- vadoran ISP , and another is connected to a Japanese ISP 
Approximately 20,000 IP addresses perform the '' L '' checkin 
Other ddrlogs may include '' A '' tags as well 
The '' A '' tag labels unwanted checkins from untargeted locations , like Hungary and Italy 
The '' B '' tag labels unwanted checkins from Trend Micro IP ranges 
The '' L '' tag labels unwanted checkins from a variety of ranges , but includes odd IP like the loopback address , 127.0.0.1 , clearly an error 
Entries in these logs include callback URLs that have spaces and unusual charac- ters that do not conform to the required base64 character dictionary 
When an unauthorized user attempts to access a Darkhotel web interface for victim management without the correct passkey , the html page and table layout renders properly , but all the data values on the page are returned as garbled ciphertext 
Collected data probably is presented in order of importance : Here is an example of one of these web pages : Clearly , some automated analysis activity involving researchers ' sandbox tools are filling up these logs 
From June 2013 to April 2014 ( approximately an 11 month period ) , in only 15 ddrlog files , we observe almost 7,000 connections from research sandbox systems 
The network connections provide a1= through a3= values identifying a QEMU based sandbox , all sourced from only 485 WAN IP ad- dresses 
Under 30 lan IPs are recorded , all in the same 172.16.2.14­126 range 
This system ( s ) uses a '' Dave '' user account and '' HOME­OFF­D5F0AC '' Windows system name 
These characteristics correspond with network activity generated by GFI Soft- ware 's '' CWsandbox '' tools , now owned by '' ThreatTrack Security '' 
For the past seven years , a strong threat actor named Darkhotel , also known as Tapaoux , has carried out a number of successful attacks against a wide range of victims from around the world 
It employs methods and techniques which go well beyond typical cybercriminal behavior 
The Darkhotel crew 's skillset allows it to launch interesting cryptographical at- tacks , for instance factoring 512 bit RSA keys 
Its use of 0-days is another indica- tor of a strong threat actor 
The targeting of top executives from various large companies around the world during their stay at certain '' Dark Hotels '' is one of the most interesting aspects of this operation 
The exact method of targeting is still unknown - for instance , why some people are targeted while others are not 
The fact that most of the time the victims are top executives indicates the attackers have knowledge of their victims whereabouts , including name and place of stay 
This paints a dark , dangerous web in which unsuspecting travelers can easily fall 
While the exact reason why some hotels function as an attacker vector are unknown , certain suspicions ex- ist , indicating possibly a much larger compromise 
We are still investigating this aspect of the operation and will publish more information in the future 
A further interesting trait is the deployment of multiple types of campaigns , both targeted and botnet 
We expect the Darkhotel crew to continue their activities against DIB , Govern- ment and NGO sectors 
The appendix released with this paper provides technical indicators of compromise which should help victims identify the malicious traffic and enable targets to protect themselves better against attack 
We believe the attack is a strategic Web compromise targeting American military personnel amid a paralyzing snowstorm at the U.S. Capitol in the days leading up to the Presidents Day holiday weekend 
Based on infrastructure overlaps and tradecraft similarities , we believe the actors behind this campaign are associated with two previously identified campaigns ( Operation DeputyDog and Operation Ephemeral Hydra ) 
This blog post examines the vulnerability and associated attacks , which we have dubbed '' Operation SnowMan 
'' After compromising the VFW website , the attackers added an iframe into the beginning of the website's HTML code that loads the attacker 's page in the background 
The attacker 's HTML/JavaScript page runs a Flash object , which orchestrates the remainder of the exploit 
The exploit includes calling back to the IE 10 vulnerability trigger , which is embedded in the JavaScript 
The exploit targets IE 10 with Adobe Flash 
So installing EMET or updating to IE 11 prevents this exploit from functioning 
The vulnerability is a previously unknown use-after-free bug in Microsoft Internet Explorer 10 
Then the exploit code parses the error resulting from the XML load order to determine whether the load failed because the EMET DLL is not present 
The exploit proceeds only if this check determines that the EMET DLL is not present 
For example , the attacker corrupts a Flash Vector object and then accesses the corrupted object from within Flash to access memory 
We have discussed this technique and other ASLR bypass approaches in our blog 
One minor difference between the previous approaches and this attack is the heap spray address , which was changed to 0x1a1b2000 in this exploit 
After successful exploitation , the code repairs the corrupted Flash Vector and flash.Media.Sound to continue execution 
The beginning of the file is a JPG image ; the end of the file ( offset 36321 ) is the payload , encoded with an XOR key of 0×95 
The attacker appends the payload to the shellcode before pivoting to code control 
The compile date of the payload was 2014-02-11 , and the last modified date of the exploit code was also 2014-02-11 
This suggests that this instantiation of the exploit was very recent and was deployed for this specific strategic Web compromise of the Veterans of Foreign Wars website 
A possible objective in the SnowMan attack is targeting military service members to steal military intelligence 
In addition to retirees , active military personnel use the VFW website 
It is probably no coincidence that Monday , Feb. 17 , is a U.S. holiday , and much of the U.S. Capitol shut down Thursday amid a severe winter storm 
This domain currently resolves to 118.99.60.142 
The domain info [ 
] flnet [ 
] org also resolved to this IP address on 2014-02-12 
The info [ 
] flnet [ 
] org domain overlaps with icybin [ 
] flnet [ 
] org and book [ 
] flnet [ 
The threat actor responsible for Operation DeputyDog also used the '' HTTPS '' version of the Gh0st 
The me [ 
] scieron [ 
] com domain previously resolved to 58.64.199.22 
The book [ 
] flnet [ 
] org domain also resolved to another IP in the same subnet 58.64.199.0/24 
Specifically , book [ 
] flnet [ 
] org previously resolved to 58.64.199.27 
Others domain seen resolving to this same /24 subnet were dll [ 
] freshdns [ 
] org , ali [ 
] blankchair [ 
] com , and cht [ 
] blankchair [ 
] com 
The domain dll [ 
] freshdns [ 
] org resolved to 58.64.199.25 
Both ali [ 
] blankchair [ 
] com and cht [ 
] blankchair [ 
] com resolved to 58.64.199.22 
A number of other related domains resolve to these IPs and other IPs also in this /24 subnet 
For the purposes of this blog , we 've chosen to focus on those domains and IP that relate to the previously discussed DeputyDog and Ephemeral Hydra campaigns 
Figure 1 illustrates the infrastructure overlaps and connections we observed between the strategic Web compromise campaign leveraging the VFW 's website , the DeputyDog , and the Ephemeral Hydra operations 
Other tradecraft similarities between the actor ( s ) responsible for this campaign and the actor ( s ) responsible for the DeputyDog/Ephemeral Hydra campaigns include : We observed many similarities from the exploitation side as well 
At a high level , this attack and the CVE- 2013-3163 attack both leveraged a Flash file that orchestrated the exploit , and would call back into IE JavaScript to trigger an IE flaw 
The code within the Flash files from each attack are extremely similar 
This entry was posted in Advanced Malware , Exploits , Targeted Attack , Threat Research , Vulnerabilities and tagged 0day , zero-day by Darien Kindlund , Dan Caselden , Xiaobo Chen , Ned Moran and Mike Scott 
Bookmark the permalink 
By 2014 , the number of Android users has grown to 1.1 billion and the number of Android devices has reached 1.9 billion 
At the same time , enterprises are also embracing Android- based Bring Your Own Device ( BYOD ) solutions 
For example , in Intel 's BYOD program , there are more than 20,000 Android devices across over 800 combinations of Android versions and hardware configurations 
Although little malware has been found in Google Play , both Android apps and the Android system itself contain vulnerabilities 
When the target is identified , a '' Sidewinder Targeted Attack '' exploits popular vulnerabilities in ad libraries , such as Javascript-binding-over-HTTP or dynamic- loading-over-HTTP , etc 
It is a well-known challenge for an attacker to call Android services from injected native code that does n't have Android application context 
Finally , we show that this threat is not only real but also prevalent due to the popularity of Android ad libraries 
We hope this paper kickstarts the conversation on how to better protect the security and privacy in third-party libraries and how to further harden the Android security framework in the future 
To understand the security risks brought by a Sidewinder Targeted Attack , we first explain one possible attack mechanism ( illustrated in Figure 1 ) that is similar to that of Sidewinder missiles 
Like an infrared homing system , the attacker then seeks '' emission '' from ad libraries running on the target device to track and lock on it 
Once the target is locked on , the attacker can launch advanced persistent attacks 
Figure 2 shows a proof-of-concept attack control interface 
This attack targets one of the ad libraries described in this paper 
The security risks become obvious by looking at what the attacker can do with this control interface 
Based on this precise position information , it is easy to identify individuals or groups of '' VIP '' targets by which offices they are in 
In this section , we explain in more detail the risks of remote attacks on the Android devices 
Android uses the JavaScript binding method addJavascriptInterface to enable JavaScript code running inside a WebView to access the app 's Java methods ( also known as the Javascript bridge ) 
However , it is widely known that this feature , if not used carefully , presents a potential security risk when running on Android API 16 ( Android 4.1 ) or below 
We call this the JavaScript-Binding-Over-HTTP ( JBOH ) vulnerability 
This applies to insecure HTTPS channels as well 
Based on the official data in June 2014 , ~60 % of Android devices are still running API≤16 
Note that API > 16 platforms are not necessarily secure 
If the app is targeting at a lower API level , Android will still run it with the lower API level for compatibility reasons 
Figure 3 shows the targeted API of popular Google Play apps , each of which has over 50,000 downloads 
We can see that a large portion of apps are targeting at API≤16 
Starting with Android 4.2 ( API > 16 ) , Google introduced the @ JavascriptInterface anno- tation to explicitly designate and restrict which public Java methods in the app were accessible from JavaScript running inside a WebView 
We call these exposed JS binding annotation interfaces '' JS Sidedoors 
'' For example , we found a list of sensitive Javascript interfaces that are publicly ex- posed from certain versions of a real-world ad library : createCalendarEvent , makeCall , postToSocial , sendMail , sendSMS , takeCameraPicture , getGalleryImage , registerMicListener , etc 
Similar to JBOH , DEX loading over HTTP or insecure HTTPS ( DLOH ) is another serious issue raised by ad libraries 
It appears this method makes sending SMS easy 
However , some other operations require Android context or registering Java callbacks 
Android context provides an interface to the global information about an app 's environment 
Many Android functionalities , especially remote call invocations , are encapsulated in the context 
We discuss attacks requiring context in a later section 
In this section , we explain attacks that do n't need Android context , and discuss their security risks 
Commercial one-touch root apps claim they can root more than 1,000 brands ( > 20,000 models ) 
towelroot , which exploits a bug found recently in Linux kernel , claims that it can root most new devices released before June 2014 
Although only processes with root privilege can ptrace others , child processes are able to ptrace their parents 
Because the shell launched from the Javascript bridge is a child process of the host app , it can ptrace the host app 's process 
Note that only apps with android : debuggable set as '' true '' in the manifest can be ptraced , which limits its adoption 
Sending SMS does not require context or user interaction 
s16 is the type marker represents '' 16 bit string , '' and packageName is the host app 's package name , where we can obtain from the information posted from the ad libraries 
The sequence number of the remote calls can be found in the corresponding Android Interface Definition Language ( AIDL ) files 
Many other Android services can be invoked in the same way , including sending SMS As mentioned , it is more convenient to directly obtain the Android context via the Javascript bridge 
Code in Listing 4 , for example , is an easy way to get context from anywhere of the application 
Operations like taking pictures and recording videos need to register Java callbacks 
The attackers either need to boot a Java VM from the Javascript bridge , or to inject code into the host app 's Java VM 
Fortunately , Android Runtime offers another way to load Java Native Interface ( JNI ) code into the host app using Runtime.load ( ) 
There are other ways to obtain Android context , like reflecting to the private static context variable of WebView 
However , without Java VM instances , it 's difficult to take pictures and record videos 
After our submission to Black Hat in April 2014 , we noticed that MWR was also concurrently and independently working on this issue 
They published a similar mechanism in June 2014 
Android users may perform copy-paste on important text content 
For example , there are many popular password-management apps in Google Play , enabling the users to click-and-copy passwords and paste them into login forms 
Android has no permissions restricting apps from accessing the global clipboard 
We have notified Google about this issue 
Android Open Source Project ( AOSP ) classifies Android permissions into several protec- tion levels : '' normal , '' '' dangerous , '' '' system , '' '' signature '' and '' development '' , , 
Dangerous permissions '' may be displayed to the user and require confirmation before pro- ceeding , or some other approach may be taken to avoid the user automatically allowing the use of such facilities 
'' In contrast , normal permissions are automatically granted at installation , '' without asking for the user 's explicit approval ( though the user always has the option to review these permissions before installing ) '' 
If an app requests both dangerous permissions and normal permissions , Android only displays the dangerous per- missions by default 
If an app requests only normal permissions , Android does n't display any permission to the user 
We have found that certain '' normal '' permissions have dangerous security impacts 
These two permissions enable an app to query , insert , delete , or modify all launcher configuration settings , including icon insertion or modification 
After our notification , Google has patched this vulnerability in Android 4.4.3 and has released the patch to its OEM partners 
However , according to Google , by 7 July 2014 , 17.9 % Android devices are using Android 4.4 
Given that Android 4.4.2 and below has this vulnerability , over 82.1 % Android devices are vulnerable 
With the CHANGE WIFI STATE permission , Android processes can change the proxy settings of WIFI networks ( not solely the currently connected one ) 
To do this , the attacker can use the remote calls exposed by WifiManager to obtain the WifiConfiguration objects , then create new proxySettings to replace to a corresponding field 
Note that the proxySettings field is a private Java field not intended to be accessed by other processes 
Unfortunately , the flexible and powerful Java reflection mechanism ( especially the forName ( ) , getField ( ) , setAccessible ( ) calls ) exposes such components to the attackers for arbitrary read or write operations 
Android audio recording via the MediaRecorder APIs does not need user interaction or consent , which makes it easy to record sound in the background 
On the contrary , taking pictures and recording videos are more challenging 
First , this requires registering Java callbacks 
Second , Android warns that '' Preview must be started before you can take a picture '' 
It seems that taking pictures and recording videos without user notification is impossible 
However , security largely depends on the correct implementation and enforcing a flawless implementation is difficult 
On some of the popular phones ( models anonymized for security consideration ) , startPreview ( ) is required to take pictures/record videos ; However , it 's highly possible that on these devices takePicture ( ) fails to check whether a view has been presented to the user 
Fortunately , we have never witnessed a case where the MediaRecorder can shoot videos without calling setPreviewDisplay 
But we were able to create and register a dummy SurfaceView to the WindowManager , which made taking photos and videos possible even on devices that properly checked for an existing preview 
It is well known that communication via HTTP is prone to hijacking and data tamper- ing 
Switching to HTTPS may not solve this issue since the HTTPS security relies on a flawless implementation , which is difficult 
For example , there are cases where the developer failed ( intentionally or unintentionally ) to check the server 's certificate 
We found that some of the most popular ad libraries ( see Table 3 ) have this issue 
Note that even if the ad libraries have a correct and rigorous implementation , the SSL library itself may contain serious vulnerabilities that can be exploited by MITM attacks , 
Almost every ad library uploads local information from Android devices 
Based on our observations , they do so mostly for purposes such as checking for platform compatibility and user interest targeting 
The information most frequently uploaded includes IMEI , Android version , manufacturer , Android ID , device specification , carrier information , host app information , installed app list , etc 
Table 3 lists the info uploaded from the top five popular ad libraries 
Listing 7 is a captured packet posted to the remote ad server by one of the ad libraries 
It is captured from a popular Google Play app 
From this packet we can tell the device 's screen density ( d-device-screen-density ) , screen size ( d-device- screen-size ) , host app 's pack- age name ( u-appBId ) , host app 's name ( u-appDNM ) 1 , host app 's version ( u-appVer ) , user agent ( h-user-agent ) , localization ( d-localization ) , mobile network type ( d-netType ) , screen orientation ( d-orientation ) , and GPS location ( u-latlong-accu ) 
The most important infor- mation is the GPS location , where the victim 's latitude , longitude and the location precision are shown 
It is reasonable for an ad to obtain this information to improve the ad-serving experience 
To locate victims effectively , an attacker needs to monitor large-scale network traffic containing such private information 
DNS hijacking is legally and maliciously used in many situations including traffic management , phishing and censorship 
Historically , there were many BGP hijacking attacks that affected YouTube , DNS root servers , Yahoo , and many other important Internet services 
We used the FireEye Mobile Threat Prevention ( MTP ) engine to analyze all of the ~73,000 popular apps from Google Play with more than 50,000 downloads , and identified 93 ad libraries 
The detailed ad library inclusion statistics are shown in Figure 4 
Seventy-one % of the apps contain at least one ad library , 35 % have at least two ad libraries , and 22.25 % include at least three ad libraries 
The largest ad inclusion number is 35 
Since Google is cautious about the security of the products it directly controls , we exclude Google Ad from the following discussion 
For security considerations , in this paper we anonymize the names of the other 92 ad libraries , using Ad1 , Ad2 , ... , Ad92 to refer to them , where the subscripts represent the rankings of how many apps include the ad libraries 
The top five popular ad libraries ' inclusion and download statistics are listed in Table 2 
We analyzed the 92 ad libraries found in the popular Google Play apps , and summa- rized the communication channel vulnerabilities in Table 3 
Combined with the uploaded information column we can learn about the data the attackers can obtain 
Fifty-seven of the 92 ad libraries in the popular Google Play apps have the JBOH issue 
Specifically , four of the top five ad libraries are subject to this problem ( shown in Table 2 ) 
Seven of the 92 ad libraries are prone to DLOH attacks 
Particularly , some versions of Ad5 in Table 3 have this problem 
The affected Google Play apps number and the accumulated download counts are listed in Table 4 
Millions of users are still under the threat of Sidewinder Targeted Attacks 
First we need to improve the security and privacy protection of ad libraries 
For example , we encourage ad libraries ' publishers to use HTTPS with proper SSL certificate validation , and to properly encrypt network traffic 
Meanwhile , Google itself needs to further harden the security framework 
This may prove difficult because : 1 
Android is a complex system 
Any sub- component 's vulnerability may impact the security of the whole system 
Fragmentation makes the situation even more challenging 
2 
The trade-off between usability , performance and security always matters , and market demand frequently dictates that security comes last 
Many Android developers do not even understand how to program securely ( as shown in the JBOH issue ) 
3 
Many security patches are not back-ported to old versions of Android ( like the launcher settings problem described earlier ) , even though older versions are widely used 
4 
There is always information asymmetry in the development chain 
For example , it usually takes several months for vendors to apply security patches after Google releases them 
Albeit challenging , we hope that this work can kickstart a conversation , both on improved security and privacy protection in third-party libraries and on a hardened Android security framework 
FireEye has invented a purpose-built , virtual machine-based security platform that provides real-time threat protection to enterprises and governments worldwide against the next generation of cyber attacks 
These highly sophisticated cyber attacks easily circumvent traditional signature-based defenses , such as next-generation firewalls , IPS , anti-virus , and gateways 
The FireEye Threat Prevention Platform provides real-time , dynamic threat protection without the use of signatures to protect an organization across the primary threat vectors and across the different stages of an attack life cycle 
The core of the FireEye platform is a virtual execution engine , complemented by dynamic threat intelligence , to identify and block cyber attacks in real time 
FireEye has over 1,900 customers across more than 60 countries , including over 130 of the Fortune 500 
Original release date : December 19 , 2014 Microsoft Windows US-CERT was recently notified by a trusted third party of cyber threat actors using a Server Message Block ( SMB ) Worm Tool to conduct cyber exploitation activities recently targeting a major entertainment company 
Listening Implant : During installation of this tool , a portion of the binaries is decrypted using AES , with a key derived from the phrase '' National Football League 
This special message is not preceded with a length or XOR encoded 
There are no callback domains associated with this malware since connections are inbound only on a specified port number 
The implant may have an associated configuration file which can contain a configurable port 
Hostname , username , and password are then obtained from the configuration file 
Technical and strategic mitigation recommendations are included in the Solution section below 
US-CERT recommends reviewing the Security Tip Handling Destructive Malware # ST13-003 
Cyber threat actors are using an SMB worm to conduct cyber exploitation activities 
Due to the highly destructive functionality of this malware , an organization infected could experience operational impacts including loss of intellectual property and disruption of critical systems 
Users and administrators are recommended to take the following preventive measures to protect their computer networks : Use and maintain anti-virus software – Anti-virus software recognizes and protects your computer against most known viruses 
It is important to keep your anti-virus software up-to-date ( see Understanding Anti-Virus Software for more information ) 
Keep your operating system and application software up-to-date – Install software patches so that attackers ca n't take advantage of known problems or vulnerabilities 
Many operating systems offer automatic updates 
If this option is available , you should enable it ( see Understanding Patches for more information ) 
Review Security Tip Handling Destructive Malware # ST13-003 and evaluate their capabilities encompassing planning , preparation , detection , and response for such an event 
Review Recommended Practices for Control Systems , and Improving Industrial Control Systems Cybersecurity with Defense-in-Depth Strategies ( pdf ) 
The following is a list of the Indicators of Compromise ( IOCs ) that can be added to network security solutions to determine whether they are present on a network 
The malware has the following characteristics : While the original filename of this file is unknown , it was likely '' diskpartmg16.exe '' 
It contains what appear to be hostnames , IP addresses , and the number 2 
Entries in the file have the structure '' HOSTNAME | IP Address | 2 '' 
These copies are named according to the format '' taskhostXX.exe '' ( where X is a randomly generated ASCII character ) 
The following command-line string is then executed : '' cmd.exe /c net stop MSExchangeIS /y '' 
This SYS file is a commercially available tool that allows read/write access to files and raw disk sectors for user mode applications in Windows 2000 , XP , 2003 , Vista , 2008 ( 32-bit ) 
This SYS file is a also a commercially available tool that allows read/write access to files and raw disk sectors for user mode applications in Windows 2000 , XP , 2003 , Vista , 2008 ( 64-bit ) 
A summary of the C2 IP addresses : Snort signatures : Listening Implant : Lightweight Backdoor : Proxy Tool : Malware associated with the cyber threat actor : Below are potential YARA signatures to detect malware binaries on host machines : Because of the highly destructive functionality of the malware , an organization infected with the malware could experience operational impacts including loss of intellectual property ( IP ) and disruption of critical systems 
Actual impact to organizations may vary depending on the type and number of systems impacted 
Implement the indicators of compromise within your systems for detection and mitigation purposes 
Encourage users to transfer critical files to network shares , to allow for central backed up 
Execute daily backups of all critical systems 
Periodically execute an '' offline '' backup of critical files to removable media 
Establish emergency communications plans should network resources become unavailable 
Isolate any critical networks ( including operations networks ) from business systems 
Identify critical systems and evaluate the need for having on-hand spares to quickly restore service 
Ensure antivirus is up to date 
Disable credential caching for all desktop devices with particular importance on critical systems such as servers and restrict the number of cached credential for all portable devices to no more than three if possible 
This can be accomplished through a Group Policy Object ( GPO ) 
Disable AutoRun and Autoplay for any removable media device 
Prevent or limit the use of all removable media devices on systems to limit the spread or introduction of malicious software and possible exfiltration data , except where there is a valid business case for use 
This business case must be approved by the organization Chief IT Security Officer , with policy/guidance on how such media should be used 
Consider restricting account privileges 
It is our recommendation that all daily operations should be executed using standard user accounts unless administrative privileges are required for that specific function 
Configure all standard user accounts to prevent the execution and installation of any unknown or unauthorized software 
Both standard and administrative accounts should have access only to services required for nominal daily duties , enforcing the concept of separation of duties 
Lastly , disable Web and email capabilities on administrative accounts 
Compromise of admin accounts is one vector that allows malicious activity to become truly persistent in a network environment 
Ensure that password policy rules are enforced and Admin password values are changed periodically 
Consider prohibiting hosts within the production environment or DMZ from sharing an Active Directory enterprise with hosts on other networks 
Each environment should have separate forests within Active Directory , with no trust relationships allowed between the forests if at all possible 
If necessary , the trust relationships should be one-way with the low integrity environment trusting the higher integrity environment 
Consider deployment of a coaching page with click through acceptance ; these are traditionally deployed in an environment to log the acceptance of network acceptable use policy or to notify users of monitoring 
Coaching pages also provide some measure of protection from automated malicious activity 
This occurs because automated malware is normally incapable of physically clicking an acceptance radial button 
Automated malware is traditionally hardcoded to execute , then retrieve commands or additional executables from the Internet 
If the malware is unable to initiate an active connection , the full train of infection is potentially halted 
The danger still exists that the physical user will authorize access , but through the use of coaching pages , infections can be limited or at least the rate of infection reduced 
Monitor logs -- Maintain and actively monitor a centralized logging solution that keeps track of all anomalous and potentially malicious activity 
Ensure that all network operating systems , web browsers , and other related network hardware and software remain updated with all current patches and fixes 
Organizations should review Security Tip Handling Destructive Malware # ST13-003 and evaluate their capabilities encompassing planning , preparation , detection , and response for such an event 
Always keep your patch levels up to date , especially on computers that host public services accessible through the firewall , such as HTTP , FTP , mail , and DNS services 
Build host systems , especially critical systems such as servers , with only essential applications and components required to perform the intended function 
Any unused applications or functions should be removed or disabled , if possible , to limit the attack surface of the host 
Implement network segmentation through V-LANs to limit the spread of malware 
Consider the deployment of Software Restriction Policy set to only allow the execution of approved software ( application whitelisting ) 
Recommend the whitelisting of legitimate executable directories to prevent the execution of potentially malicious binaries 
Consider the use of two-factor authentication methods for accessing privileged root level accounts or systems 
Consider deploying a two-factor authentication through a hardened IPsec/VPN gateway with split-tunneling prohibited for secure remote access 
Deny direct Internet access , except through the use of proxies for Enterprise servers and workstations 
Perform regular content filtering at the proxies or external firewall points of presence 
Also consider the deployment of an explicit versus transparent proxy policy 
Implement a Secure Socket Layer ( SSL ) inspection capability to inspect both ingress and egress encrypted network traffic for potential malicious activity 
Isolate network services , such as email and Web application servers by utilizing a secure multi-tenant virtualization technology 
This will limit the damage sustained from a compromise or attack of a single network component 
Implement best practice guidance and policy to restrict the use of non-Foundation assets for processing or accessing Foundation-controlled data or systems ( e.g. , working from home , or using a personal device while at the office ) 
It is difficult to enforce corporate policies , detect intrusions , and conduct forensic analysis or remediate compromises on non-corporate owned devices 
Minimize network exposure for all control system devices 
Control system devices should not directly face the Internet 
Place control system networks behind firewalls , and isolate or air gap them from the business network 
When remote access is required , use secure methods , such as Virtual Private Networks ( VPNs ) , recognizing that VPN is only as secure as the connected devices 
Industrial Control System ( ICS ) -CERT and US-CERT remind organizations to perform proper impact analysis and risk assessment prior to taking defensive measures 
In February 2014 , the experts of the G DATA SecurityLabs published an analysis of Uroburos , the rootkit with Russian roots 
We explained that a link exists between Uroburos and the Agent.BTZ malware , which was responsible for '' the most significant breach of U.S. military computers ever 
'' Nine months later , after the buzz around Uroburos , aka Snake or Turla , we now identified a new generation of Agent.BTZ 
We dubbed it ComRAT and , by now , analyzed two versions of the threat ( v3.25 and v3.26 ) 
As reported earlier this year , Agent.BTZ used the same encoding key and the installation log file name as Uroburos 
ComRAT , in its version 3.25 , shows the same behavior 
Taken everything into consideration , the indications we saw during our analyzes lead to the supposition that the group behind Agent.BTZ and Uroburos is still active and is pursuing the Agent.BTZ path once more to improve and change the RAT 
The analyzed file is the latest version we identified : v3.26 
The version identification is described in the chapter '' Log files '' 
The major difference between this version and the older version ( s ) will be described there 
This file is the main payload of the malware 
The two files are Microsoft Windows dynamic libraries 
We noticed that the file name is still the same as the file name used by Agent.BTZ in the past 
This library is the real payload 
If the malware version is older than 3.26 , the xored key is the same as the dropper key 
Concerning the version 3.26 , the malware uses a new non-ASCII key 
Here is an example of decoded log file for the version 3.26 : We can identify the version of the malware thanks to the PVer flag 
This domain is far from unknown , as it has been mentioned in BAE System 's Uroburos ( aka Snake ) analysis paper as C & C server domain for the Uroburos malware 
Another connection between the cases 
That is the reason why the sample is detected as Uroburos ( aka Turla ) 
The same code was used by Agent.BTZ and also the dll loaded into userland during the Uroburos analysis 
In version 3.26 , the author changed the key and remove the known file name 
This action can be an indication for the developer 's effort to hide this connection 
The main difference is the design 
ComRAT is more complex and cleverer 
It is by far a more complex userland design than Agent.BTZ 
These differences , mainly the more complex design , lead us to give this malware a new name 
The analyzed dropper of v3.25 has a compilation date of February 6th 2014 
The more recent dropper of v3.26 , which has all the mentioned changes implemented , reveals a compilation date of January 3rd 2013 
This analysis shows that even after the Uroburos publication in February 2014 , the group behind this piece of malware seems to be still active 
In any case , the ComRAT developers implemented new mechanisms , changed keys , removed log files to hide their activities and tried to disguise the connections between the RAT ComRAT , the rootkit Uroburos and the RAT Agent.BTZ as much as possible 
However , we can still follow the evolution of the malware by comparing the versions 
The persistence mechanism discovered in October 2014 makes it possible to intrude into a system in a really discreet manner and we estimate that other actors will use the same persistence mechanism in the near future 
We will definitely keep our ears and eyes open and continue analyzing 
In May 2014 , the U.S. Department of Justice charged five Chinese nationals for economic espionage against U.S. corporations 
The five known state actors are officers in Unit 61398 of the Chinese People 's Liberation Army ( PLA ) 
In response , the Chinese government stated that the claims were '' absurd '' and based on '' fabricated facts '' 
China then went even further , stating '' The Chinese government , the Chinese military and their relevant personnel have never engaged or participated in cyber theft of trade secrets 
'' We believe that organizations , be they governments or corporations , global or domestic , must keep up the pressure and hold China accountable until lasting change is achieved 
Not only did the U.S. Government offer in its criminal indictment the foundation of evidence designed to prove China 's culpability in electronic espionage , but also illustrated that the charges are only the tip of a very large iceberg 
Those reading the indictment should not conclude that the People 's Republic of China ( PRC ) hacking campaign is limited to five soldiers in one military unit , or that they solely target the United States government and corporations 
Rather , China 's decade-long economic espionage campaign is massive and unrelenting 
Through widespread espionage campaigns , Chinese threat actors are targeting companies and governments in every part of the globe 
At CrowdStrike , we see evidence of this activity first-hand as our services team conducts Incident Response investigations and responds to security breaches at some of the largest organizations around the world 
We have first-hand insight into the billions of dollars of intellectual property systematically leaving many of the largest corporations - often times unbeknownst to their executives and boards of directors 
The campaign that is the subject of this report further points to espionage activity outside of Unit 61398 , and reveals the activities of Unit 61486 
Unit 61486 is the 12th Bureau of the PLA 's 3rd General Staff Department ( GSD ) and is headquartered in Shanghai , China 
The CrowdStrike Intelligence team has been tracking this particular unit since 2012 , under the codename PUTTER PANDA , and has documented activity dating back to 2007 
The report identifies Chen Ping , aka cpyy , and the primary location of Unit 61486 
This particular unit is believed to hack into victim companies throughout the world in order to steal corporate trade secrets , primarily relating to the satellite , aerospace and communication industries 
With revenues totaling $ 189.2 billion in 2013 , the satellite industry is a prime target for espionage campaigns that result in the theft of high-stakes intellectual property 
While the gains from electronic theft are hard to quantify , stolen information undoubtedly results in an improved competitive edge , reduced research and development timetables , and insight into strategy and vulnerabilities of the targeted organization 
Parts of the PUTTER PANDA toolset and tradecraft have been previously documented , both by CrowdStrike , and in open source , where they are referred to as the MSUpdater group 
This report contains details on the tactics , tools , and techniques used by PUTTER PANDA , and provides indicators and signatures that can be leveraged by organizations to protect themselves against this activity 
Our Global Intelligence Team actively tracks and reports on more than 70 espionage groups , approximately half of which operate out of China and are believed to be tied to the Chinese government 
This report is part of our extensive intelligence library and was made available to our intelligence subscribers in April 2014 , prior to the US Government 's criminal indictment and China 's subsequent refusal to engage in a constructive dialog 
Targeted economic espionage campaigns compromise technological advantage , diminish global competition , and ultimately have no geographic borders 
We believe the U.S. Government indictments and global acknowledgment and awareness are important steps in the right direction 
In support of these efforts , we are making this report available to the public to continue the dialog around this ever-present threat 
CrowdStrike has been tracking the activity of a cyber espionage group operating out of Shanghai , China , with connections to the People 's Liberation Army Third General Staff Department ( GSD ) 12th Bureau Military Unit Cover Designator ( MUCD ) 61486 , since 2012 
The attribution provided in this report points to Chen Ping , aka cpyy ( born on May 29 , 1979 ) , as an individual responsible for the domain registration for the Command and Control ( C2 ) of PUTTER PANDA malware 
In addition to cpyy , the report identifies the primary location of Unit 61486 
PUTTER PANDA is a determined adversary group , conducting intelligence-gathering operations targeting the Government , Defense , Research , and Technology sectors in the United States , with specific targeting of the US Defense and European satellite and aerospace industries 
The PLA 's GSD Third Department is generally acknowledged to be China 's premier Signals Intelligence ( SIGINT ) collection and analysis agency , and the 12th Bureau Unit 61486 , headquartered in Shanghai , supports China 's space surveillance network 
Domains registered by Chen Ping were used to control PUTTER PANDA malware 
These domains were registered to an address corresponding to the physical location of the Shanghai headquarters of 12th Bureau , specifically Unit 61486 
This report contains additional details on the tactics , tools , and techniques used by PUTTER PANDA , and provides indicators and signatures that can be leveraged by organizations to protect themselves against this activity 
➔ Putter Panda is a cyber espionage actor that conducts operations from Shanghai , China , likely on behalf of the Chinese People 's Liberation Army ( PLA ) 3rd General Staff Department 12th Bureau Unit 61486 
This unit is supports the space based signals  intelligence ( SIGINT ) mission 
➔ The 12th Bureau Unit 61486 , headquartered in Shanghai , is widely accepted to be China 's primary SIGINT collection and analysis agency , supporting China 's space surveillance network 
➔ This is a determined adversary group , conducting intelligence- gathering operations targeting the Government , Defense , Research , and Technology sectors in the United States , with specific targeting of space , aerospace , and communications 
➔ CrowdStrike identified Chen Ping , aka cpyy , a suspected member of the PLA responsible for procurement of the domains associated with operations conducted by Putter Panda 
➔ The group has been operating since at least 2007 and has been observed heavily targeting the US Defense and European satellite and aerospace industries 
➔ There is infrastructure overlap with Comment Panda , and evidence of interaction between actors tied to both groups 
There are several pieces of evidence to indicate that the activity tracked by CrowdStrike as PUTTER PANDA is attributable to a set of actors based in China , operating on behalf of the Chinese People 's Liberation Army ( PLA ) 
Specifically , an actor known as cpyy ( Chen Ping ) appears to have been involved in a number of historical PUTTER PANDA campaigns , during which time he was likely working in Shanghai within the 12th Bureau , 3rd General Staff Department ( GSD ) 
PUTTER PANDA has several connections to actors and infrastructure tied to COMMENT PANDA , a group previously attributed to Unit 61398 of the PLA 
Table 1 shows the domains that appear to have been registered by these actors , and the original email address used where known 
The most significant finding is that an actor known as cpyy appears to have registered a significant number of C2 domains 
This actor is discussed in the next section 
Many of the domains have had their registrant information changed , likely in an attempt to obfuscate the identity of the operators 
For instance , several domains originally registered by cpyy had their email address updated to van.dehaim @ gmail.com around the end of 2009 ; for siseau.com the change occurred between July 2009 and November 2009 , and for vssigma.com , the change occurred between August 2009 and December 2009 
Historical registrant information for anfoundation.us , rwchateau.com , and succourtion.org was not available prior to 2010 , but it is likely that these domains were also originally registered to a personally attributable email account 
Similarly , several domains registered to mike.johnsonmj @ yahoo.com have had their registrant email updated during March 2014 ( see Table 2 ) 
These registrant changes may indicate an increased awareness of operational security ( OPSEC ) from the PUTTER PANDA actors 
The recent changes to the domains shown in Table 2 may indicate that the operators are preparing new campaigns that make use of this infrastructure , or they are attempting to disassociate all these 
Although no attributable information was found on the email addresses associated with the domains described above ( aside from cpyy and httpchen – see below ) , several other domains were found to have been registered by some of these addresses 
domains from a single email address , perhaps due to OPSEC concerns or issues with the specific email account 
The subdomains associated with these domains via DNS records , along with some of the domain names themselves , point to some areas of interest for the PUTTER PANDA operators ( see also Droppers in the following Technical Analysis section ) : • Space , satellite , and remote sensing technology ( particularly within Europe ) ; • Aerospace , especially European aerospace companies ; • Japanese and European telecommunications 
It is likely that PUTTER PANDA will continue to attack targets of this nature in future intelligence- gathering operations 
Based on passive DNS records , several PUTTER PANDA associated domains have resolved to IP address 100.42.216.230 : Additionally , several subdomains of ujheadph.com resolved to this IP : Another subdomain of ujheadph.com has been observed in connection with distinctive traffic originating from the 3PARA RAT ( described below ) , making it probable that this domain is also associated with PUTTER PANDA 
The decipherment.net domains resolved to this IP address from 11 October 2012 to at least 25 February 2013 , and the botanict.com domain resolved from 11 October 2012 to 24 March 2013 
During part of this timeframe ( 30 June 2012 - 30 October 2012 ) , a domain associated with COMMENT PANDA resolved to this same IP address : login 
aolon1ine.com 
Additionally , for a brief period in April 2012 , update8.firefoxupdata.com also resolved to this IP address 
The use of the same IP address during the same time suggests that there is perhaps some cooperation or shared resources between COMMENT PANDA and PUTTER PANDA 
Although not as conclusive as the links to COMMENT PANDA , IP address 31.170.110.163 was associated with VIXEN PANDA domain blog 
strancorproduct.info from November to December 2013 
In February 2014 , this IP address was also associated with PUTTER PANDA domain ske.hfmforum 
com 
While not directly overlapping , this potential infrastructure link is interesting , as VIXEN PANDA has previously displayed TTPs similar to COMMENT PANDA ( other CrowdStrike reporting describes VIXEN PANDA malware that extracts C2 commands embedded between delimiters in web content ) , and has extensively targeted European entities 
11 Several email addresses have been associated with cpyy , who also appears to use the alternate handles cpiyy and cpyy.chen : The cpyy.net domain lists '' Chen Ping '' as the registrant name , which may be cpyy 's real name , as this correlates with the initials '' cp '' in '' cpyy '' 
A personal blog for cpyy was found at http : //cpiyy.blog.163.com/ 
The profile on this blog ( shown in Figure 2 below ) indicates that the user is male , was born on 25 May 1979 , and works for the '' military/police '' ( 其他- 军人/警察 ) 
This blog contains two postings in the '' IT '' category that indicate at least a passing interest in the topics of networking and programming 
A related CSDN profile for user cpiyy indicates that cpyy was working on or studying these topics in 2002 and 2003 
Another personal blog for cpyy ( http : //www.tianya.cn/1569234/bbs ) appears to have last been updated in 2007 
This states that the user lives in Shanghai , and has a birthdate identical to that in the 163.com blog 
cpyy was also active on a social networking site called XCar , stating that he lived in Shanghai as early as 2005 through 2007 ; he said in a post , '' Soldier 's duty is to defend the country , as long as our country is safe , our military is excellent '' , indicating a feeling of patriotism that could be consistent with someone who chose a military or police-based career 
On the XCar forum , cpyy.chen used a subforum called POLO ( hacker slang for '' Volkswagen cars '' ) to communicate with other users Linxder , peggycat , '' Naturally do not understand romance '' ( 天生不懂浪漫 ) , '' a wolf '' ( 一只大灰狼 ) , '' large tile '' ( 大瓦片 ) , '' winter '' ( 冬夜 ) , '' chunni '' ( 春妮 ) , papaya , kukuhaha , Cranbing , '' dusty sub '' ( 多尘子 ) , z11829 , '' ice star harbor '' ( 冰星港 ) , '' polytechnic Aberdeen '' ( 理工仔 ) , '' I love pineapple pie '' ( 我爱菠罗派 ) , and '' she 's distant '' in 2007 
Although superficially the discussion is about cars , there is a repeated word in the text , '' milk yellow package '' or '' custard package '' or '' yoke package '' ( 奶黄包 ) 
This could be a hacker slang word , but it is unclear as to the definition 
The conversation alludes to Linxder being the '' teacher '' or '' landlord '' and the other aforementioned users are his '' students '' 
Linxder references how he has '' found jobs '' for them 
It is possible that this is a reference to hacking jobs wrapped up in car metaphors 
Linxder is the handle of an actor associated with the likely Shanghai-based COMMENT PANDA group 
Linxder , cpyy , and xiaobai have all discussed programming and security related topics on cpyy 's site , cpyy.org , which hosted a discussion forum for the 711 Network Security Team ( see below ) 
cpyy also appears to have a keen interest in photography ; his 163.com blog includes several photographs taken by cpyy in the blog postings and albums section 
Some of these photographs also appear in a Picasa site ( examples are shown in Figures 5 and 6 ) belonging to a user cpyy.chen 
An album in this site named '' me '' has several shots of what is likely cpyy himself , from 2005 , 2006 , and 2007 , shown to the right : An account on rootkit.com , a popular low-level software security site , existed for user cpyy and was accessed in at least May 2004 
This account was registered with primary email address cpyy @ cpyy.net and backup email address cpyy @ hotmail.com ; it listed a date of birth as 24 May 1979 , consistent with cpyy 's other profiles 
The IP address 218.242.252.214 was associated with this account ; it is owned by the Oriental Cable Network Co. , Ltd. , an ISP located in Shanghai 
Registration on this forum shows that cpyy had an interest in security-related programming topics , which is backed up by the postings on his personal blog and CSDN account 
One of the sites registered to cpyy was used to host a web-based email service , along with a forum on www 
cpyy.net 
Both of these services were apparently run by the 711 Network Security Team ( 711网络安全小组 ) , a group that is now likely defunct , but has previously published security-based articles that have been re-posted on popular Chinese hacking sites such as xfocus.net 
One of these articles , entitled '' IMD-based packet filtering firewall to achieve the principles '' , is apparently authored by xiaobai , with email address xiaobai @ openfind.com.cn ; it was published on the '' GRATEFUL '' ( 饮水思源 ) security digest list that is hosted by Shanghai Jiao Tong University ( SJTU ) 
This digest list/bulletin board was also frequented by ClassicWind , an actor possibly linked to the Shanghai-based , PLA-sponsored adversary group COMMENT PANDA , as described in 
This Tipper also indicates that '' the Chinese Communist Party ( CCP ) and the People 's Liberation Army ( PLA ) aggressively target SJTU and its School of Information Security Engineering ( SISE ) as a source of research and student recruitment to conduct network offense and defense campaigns '' , so it is possible that the 711 Network Security Team members came to the attention of the Chinese state via this institution 
An additional connection to SJTU comes from a C2 domain , checalla.com , used with the 4H RAT in 2008 
This domain was registered to httpchen @ gmail 
com at the time , and this address was also used to make a posting on the GRATEFUL BBS ( shown in Figure 7 ) 
The posting indicates that httpchen is located at the 闵行 ( Minhang ) campus of SJTU and was posting using IP address 58.196.156.15 , which is associated with the China Education and Research Network ( CERNET ) , a nationwide network managed by the Chinese Ministry of Education 
It also states that httpchen is studying at the school of Information Security Engineering within SJTU 
Several pieces of evidence indicate that cpyy probably has connections to , or is part of , the Chinese military – specifically the PLA Army 
In addition to his declaration on his personal blog that he works for the '' military/ police '' , and contacts with actors such as Linxder that have been previously associated with hacking units within the PLA , cpyy 's Picasa site contains several photographs that hint at military connections 
First , a monochrome picture from the 大学时代 ( '' college '' ) album posted in February 2007 shows several uniformed individuals : It is not clear whether this picture includes cpyy , or just friends/ associates/relatives 
A picture from the 中学时代 ( '' high school '' ) album posted in February 2007 shows a male – likely cpyy based on the clothing shown in the second picture , which matches the pictures of cpyy shown above – performing exercise in front of a group of likely soldiers and an officer : Although somewhat unclear , pictures from the album 2002年的生日 ( '' 2002 birthday '' ) , also posted in February 2007 , show the celebrant ( likely cpyy ) in khaki clothes that are possibly military wear 
The most compelling pictures , however , are found in the 宿舍 and 办公室 albums ( '' dormitory '' and '' office '' ) 
A shot of probably cpyy 's dormitory room shows in the background two military hats that appear to be Type 07 PLA Army officer peak hats : 18 This album also contains a shot of the exterior of a building with several large satellite dishes outside : This same building and the satellite dishes also appear in the '' office '' album 
The reflection effects observed on the windows of this building could be due to coatings applied to resist eavesdropping via laser microphones and to increase privacy , which would be consistent with a military installation conducting sensitive work 
Above is an image from the same album of what appears to be a larger dish , in front of the Oriental Pearl Tower , a significant landmark in Shanghai : As mentioned above , checalla.com was used for command and control with the PUTTER PANDA 4H RAT in 2008 
This domain was registered to httpchen @ gmail.com , and in May 2009 the domain registration details were updated to include a Registrant Address of '' shanghai yuexiulu 46 45 202 # '' 
A search for this location reveals an area of Shanghai shown in Figure 8 
Figure 9 shows an enlargement of satellite imagery from within this area , depicting a facility containing several satellite dishes within green areas , sports courts and a large office building 
Satellite imagery from 2009 showing another aspect of this office building , along with a likely vantage point and direction of camera , alongside probably cpyy 's photograph from the same angle , is shown in Figure 10 : Based on the Shanghai location , and common features , it is highly likely that the location shown above is the same as that photographed by cpyy and shown in the '' office '' and '' dormitory '' albums 
Further confirmation can be found from photos uploaded by a user on Panoramio who tags the image as being located in Chabei , Shanghai , China ( 31° 17 ' 18.86 '' N 121° 27 ' 9.83 '' E ) 
This image is exceptionally similar to building shown in cpyy 's '' office '' album ( see Figure 11 below ) 
According to a public report on the Chinese PLA 's General Staff Department ( GSD ) , the 12th Bureau of the 3rd GSD is headquartered in the Zhabei district of Shanghai and '' appears to have a functional mission involving satellites , likely inclusive of intercept of satellite communications and possibly space-based SIGINT collection '' 
The same report also lists a Military Unit Cover Designator ( MUCD ) of 61486 for this bureau 
A webpage published on a Chinese government site detailing theatrical performances involving members of the PLA lists an address of '' 闸北区粤秀路46号 '' ( 46 Yue Xiu Road , Zhabei District ) for '' 总参61486部队 '' ( 61486 Forces General Staff ) 
A search for this location shows an identical area to that shown in Figure 8 
It can therefore be concluded with high confidence that the location shown in cpyy 's imagery , along with the satellite images above , is the headquarters of the 12th Bureau , 3rd GSD , Chinese PLA – also known as Unit 61486 
This unit 's suspected involvement in '' space surveillance '' and '' intercept of satellite communications '' fits with their observed targeting preferences for Western companies producing technologies in the space and imaging/remote sensing sectors 
The size and number of dishes present in the area is also consistent with these activities 
Observed build times for the PUTTER PANDA tools described in this report range from 2007 to late 2013 , indicating that the actors have conducted several campaigns against their objectives over a period of several years 
A build time analysis of all known samples is shown in Figure 1 below , relative to China time 
Although this shows that there is some bias in the build time distribution to daylight or working hours in China , which is more significant if a possible three-shift system of hours is considered ( 0900-1200 , 1400-1700 , and 2000-2300 ) , this evidence is not conclusive 
There is also some evidence that build times are manipulated by the adversary ; for example , the sample with MD5 hash bc4e9dad71b844dd3233cfbbb96c1bd3 has a build time of 18 July 2013 , but was supposedly first submitted to VirusTotal on 9 January 2013 
This shows that the attackers – at least in 2013 – were aware of some operational security considerations and were likely taking deliberate steps to hide their origins 
There is strong evidence to tie cpyy , an actor who appears to have been involved in historical PUTTER PANDA operations , to the PLA army and a location in Shanghai that is operated by the 12th Bureau , 3rd GSD of the PLA ( Unit 61486 ) 
Another actor tied to this activity , httpchen , has declared publically that he was attending the School of Information Security Engineering at SJTU 
This university has previously been posited as a recruiting ground for the PLA to find personnel for its cyber intelligence gathering units , and there is circumstantial evidence linked cpyy to other actors based at SJTU 
Given the evidence outlined above , CrowdStrike attributes the PUTTER PANDA group to PLA Unit 61486 within Shanghai , China with high confidence 
It is likely that this organization is staffed in part by current or former students of SJTU , and shares some resources and direction with PLA Unit 61398 ( COMMENT PANDA ) 
The most common of these , the 4H RAT and the 3PARA RAT , have been documented previously by CrowdStrike in previous CrowdStrike Intelligence reporting 
This analysis will be revisited below , along with an examination of two other PUTTER PANDA tools : pngdowner and httpclient 
This RAT was first analyzed by CrowdStrike in April 2012 , but a historical analysis shows that it has been in use since at least 2007 by the PUTTER PANDA actors 
A listing of metadata for known samples , including C2 information , is shown in Appendix 1 
Other observed exported filenames are msacem.dll and mrpmsg.dll , although the RAT has also been observed in plain executable ( EXE ) format 
The decoding algorithm is illustrated in Figure 10 below 
The key and modulo values vary on a per-sample basis 
Decoded C2 settings , along with sample metadata , are listed in Appendix 2 
The RAT is programmed in C++ using Microsoft Visual Studio , and it makes use of the object-oriented and parallel programming features of this environment ; Standard Template Library ( STL ) objects are used to represent data structures such as strings and lists , and custom objects are used to represent some of the C2 command handlers ( e.g. , CCommandCMD ) 
Standard Windows primitives such as Events are used to synchronize across these threads , with a shared global structure used to hold state 
A sample request and its structure are shown in Figure 12 
Returned tasking is decrypted using the DES algorithm in CBC mode with a key derived from the MD5 hash of the string HYF54 & % 9 & jkMCXuiS ( as used in the secondary beacon shown above ) 
If this fails , the RAT will fall back to decoding the data using an 8-byte XOR with a key derived from data returned from the HashData API with the same key string 
Some of the supported commands are implemented using C++ classes derived from a base CCommand class : •C CommandAttribe – Retrieve metadata for files on disk , or set certain attributes such as creation/ modification timestamps 
• CCommandCD – Change the working directory for the current C2 session 
•C CommandCMD – Execute a command , with standard input/output/error redirected over the C2 channel 
• CCommandNOP – List the current working directory 
However , other commands are not implemented in this way 
These other commands contain functionality to : • Pause C2 activity for a random time interval 
• Shutdown C2 activity and exit 
•P rovide a date and time before which beaconing will not resume , recorded in the file C : \RECYCLER\ restore.dat as noted above 
The use of C++ classes that inherit from a base class to carry out some of the tasking commands , along with the use of concurrency features , indicates that the developers of the RAT put some thought into the architecture and design of their tool , although the decision to implement some commands outside of the class-based framework is curious , and may indicate multiple developers worked on the RAT ( or a single developer with shifting preferences for his coding style ) 
The pngdowner malware is a simple tool constructed using Microsoft Visual Studio and implemented via single C++ source code file 
This sample contains a PDB path of Y : \Visual Studio 2005\Projects\branch-downer\ downer\Release\downer.pdb , but other similar paths Z : \Visual Studio 2005\Projects\pngdowner\Release\ pngdowner.pdb and Z : \Visual Studio 2005\Projects\downer\Release\downer.pdb have also been observed in other samples 
Appendix 3 lists metadata for known pngdowner samples 
A hard-coded user agent of myAgent is used for thisrequest , and subsequent communication with the C2 server 
Content returned from this request to the C2 server will be saved to a file named index.dat in the user's temporary directory ( i.e. , % TEMP % ) 
This file is expected to contain a single line , specifying a URL and a filename 
Content returned from this request will be saved to a file , but then immediately deleted 
Although the version mentioned here uses C++ , along with Visual Studios Standard Template Library ( STL ) , older versions of the RAT ( such as MD5 hash b54e91c234ec0e739ce429f47a317313 ) , built in 2011 , use plain C. This suggests that despite the simple nature of the tool , the developers have made some attempts to modify and perhaps modernize the code 
Both versions contain debugging/progress messages such as '' down file success '' 
Although these are not displayed to the victim , they were likely used by the developers as a simple means to verify functionality of their code 
The decoded data is then checked for the string runshell 
Shell commands from the server are followed by an encoded string $ $ $ , which indicates that the shell session should continue 
Slight variations on the C2 URLs are used for different phases of the C2 interaction : Given the lack of a persistence mechanism and low level of sophistication , it is likely that httpclient – like pngdowner – is used as a second-stage or supplementary/backup tool 
Appendix 4 lists metadata for observed httpclient samples 
Several instances of this dropper have been observed , most commonly in association with the 4H RAT , but also in relation to other tools that will be described in forthcoming reporting 
This dropper is simplistic in nature , and is compiled from a single C++ source code file 
It contains a Word document in plaintext ( written to BienvenueaSahajaYogaToulouse 
doc ) , along with an executable ( Update.exe ) and DLL ( McUpdate.dll ) 
Module names corresponding to Outlook Express ( msinm.exe ) , Outlook ( outlook.exe ) , Internet Explorer ( iexplore.exe ) , and Firefox ( firefox.exe ) are used 
The common theme throughout these documents is space technology ( BienvenueaSahajaYogaToulouse.doc does not follow this trend , but could be targeted at workers at the Toulouse Space Centre , the '' largest space centre in Europe '' ) , indicating that the attackers have a keen interest in this sector , which is also reflected in the choice of name for some of the C2 domains used ( see the Attribution section above ) 
A number of specific and generic detection methods are possible for this RAT , both on a host and on the network 
These are detailed below , and are designed to expand upon the indicators reported in other CrowdStrike reporting 
The following Windows registry artifacts are indicative of a compromised host : redacted ) The presence of the following file system artifacts is indicative of a compromised host : A file mapping named & *SDKJfhksdf89*DIUKJDSF & *sdfsdf78sdfsdf also indicates the victim machine is compromised with PUTTER PANDA malware 
In addition the domains listed in the Appendices and in the Attribution section , the generic signatures below can be used to detect activity from the malware described in this report 
In addition to the indicators described above , PUTTER PANDA have some distinct generic TTPs : PUTTER PANDA are a determined adversary group who have been operating for several years , conducting intelligence-gathering operations with a significant focus on the space sector 
Research presented in this report shows that the PUTTER PANDA operators are likely members of the 12th Bureau , 3rd General Staff Department ( GSD ) of the People 's Liberation Army ( PLA ) , operating from the unit 's headquarters in Shanghai with MUCD 61486 
Strategic objectives for this unit are likely to include obtaining intellectual property and industrial secrets relating to defense technology , particularly those to help enable the unit 's suspect mission to conduct space surveillance , remote sensing , and interception of satellite communications 
PUTTER PANDA is likely to continue to aggressively target Western entities that hold valuable information or intellectual property relevant to these interests 
The detection and mitigation guidance given in this report will help to minimize the risk of a successful compromise by these actors , and future CrowdStrike reports will examine other elements of the PUTTER PANDA toolset 
CrowdStrike Falcon Intelligence portal provides enterprises with strategic , customized , and actionable intelligence 
Falcon Intelligence enables organizations to prioritize resources by determining targeted versus commodity attacks , saving time and focusing resources on critical threats 
With unprecedented insight into adversary tools , tactics , and procedures ( TTPs ) and multi-source information channels , analysts can identify pending attacks and automatically feed threat intelligence via API to SIEM and thirdparty security tools 
Access to CrowdStrike Falcon Intelligence is geared toward all levels of an organization , from the executivewho needs to understand the business threat and strategic business impact , to the front-line securiyt professional struggling to ! ght through an adversary's attack against the enterprise 
CrowdStrike Falcon Intelligence is a web-based intelligence subscription that includes full access to a variety of feature sets , including : CrowdStrike Falcon Host is an endpoint threat detection and response product that identifies unknown malware , detects zero-day threats , and prevents damage from targeted attacks in real-time 
Falcon Host is comprised of two core components , the cloud-based management console and the on-premises host-based sensor that continuously monitors threat activity at the endpoint to prevent damage in real-time 
Falcon Host leverages a lightweight kernel-mode sensor that shadows , captures , and correlates low- level operating system events to instantly identify the adversary tradecraft and activities through Stateful Execution Inspection ( SEI ) at the endpoint and Machine Learning in the cloud 
As opposed to focusing on malware signatures , indicators of compromise , exploits , and vulnerabilities , Falcon Host instead identifies mission objectives of the adversary leveraging the Kill Chain model and provides realtime detection by focusing on what the attacker is doing , as opposed to looking nfor a specific , easily changeable indicator used in an attack 
Without performing intrusive and performance- impacting scans of the system , Falcon Host 's highly efficient real-time monitoring of all system activity is the only security solution that provides maximum visibility into all adversary activities , including Adversary-in-Motion : reconnaissance , exploitation , privilege escalation , lateral movement , and exfiltration 
Falcon Host delivers insight into past and current attacks not only on a single host , but also across devices and networks 
Stateful Execution inspection Stateful Execution Inspection ( SEI ) tracks execution state and links together various stages of the kill chain , from initial code execution to data exfiltration 
CrowdStrike 's Real-time Stateful Execution Engine performs inspection and analysis to understand the full context of a cyber attack 
SEI is critical to understanding the entire attack life cycle and preventing the damage from advanced malware and targeted attacks 
Existing security technologies that focus solely on malware signatures , incidators of compromise , exploits , and vulnerabilities fail to protect against the majority of attacks as they are blind to the full scope of adversary activity 
CrowdStrike is a global provider of security technology and services focused on identifying advanced threats and targeted attacks 
Using big-data technologies , CrowdStrike 's next-generation threat protection platform leverages real-time Stateful Execution Inspection ( SEI ) at the endpoint and Machine Learning in the cloud instead of solely focusing on malware signatures , indicators of compromise , exploits , and vulnerabilities 
The CrowdStrike Falcon Platform is a combination of big data technologies and endpoint security driven by advanced threat intelligence 
CrowdStrike Falcon enables enterprises to identify unknown malware , detect zero-day threats , pinpoint advanced adversaries and attribution , and prevent damage from targeted attacks in real time 
CrowdStrike Services is a wholly owned subsidiary of CrowdStrike responsible for proactively defending against and responding to cyber incidents with pre and post Incident Response services 
CrowdStrike 's seasoned team of Cyber Intelligence professionals , Incident Responders , and Malware Researchers consists of a number of internationally recognized authors , speakers , and experts who have worked on some of the most publicized and challenging intrusions and malware attacks in recent years 
The CrowdStrike Services team leverages our Security Operations Center to monitor the full CrowdStrike Falcon Platform and provide cutting-edge advanced adversary intrusion detection services 
The full spectrum of proactive and response services helps customers respond tactically as well as continually mature and strategically evolve Incident Response program capabilities 
Context Information Security distribute Context Threat Intelligence ( CTI ) reporting under the Traffic Light Protocol ( TLP ) , a method of classifying a document in order to promote the distribution of sensitive information between individuals , organisations or communities in a controlled and trusted way , based on the originator 's wishes 
The various levels of the TLP are represented by the following colours : Sources may use TLP : RED when information can not be effectively acted upon by additional parties , and could lead to impacts on a party 's privacy , reputation , or operations if misused 
Recipients may not share TLP : RED information with any parties outside of the specific exchange , meeting , or conversation in which it is originally disclosed 
TLP : RED information will be passed verbally or in person 
Sources may use TLP : AMBER when information requires support to be effectively acted upon , but carries risks to privacy , reputation , or operations if shared outside of the organisations involved 
Recipients may only share TLP : AMBER information with members of their own organisation who need to know , and only as widely as necessary to act on that information 
Sources may use TLP : GREEN when information is useful for the awareness of all participating organisations as well as with peers within the broader community or sector 
Recipients may share TLP : GREEN information with peers and partner organisations within their sector or community , but not via publicly accessible channels such as publication or posting publicly on the Internet 
Sources may use TLP : WHITE when information carries minimal or no foreseeable risk of misuse , in accordance with applicable rules and procedures for public release 
Subject to standard copyright rules , TLP : WHITE information may be distributed freely , without restriction 
On 2nd January 2014 a Systems Administrator at the Monju fast breeder reactor facility in Japan noticed suspicious connections emanating from a machine in the control room , coinciding with what was a seemingly routine software update to a free media player 
The Japanese Atomic Energy Agency is investigating further 
Gom Player originates in South Korea and in some parts of Asia it is a popular alternative to Windows Media Player 
It is unclear whether every machine trying to download an update received this malware or whether only machines which fitted a certain profile were infected 
The 'Gh0st RAT ' has been used extensively in attacks linked to the Chinese state , though it is important to remember that the code is publicly available and can be modified and used by anyone 
The targeting of a Japanese nuclear facility however , is consistent with Chinese state intelligence requirements 
If this is the work of a Chinese group then we feel the targeting may go much further than the Civil Nuclear sector and thus be of interest to the wider Energy Sector and industry as a whole 
In order to inform the Energy Sector and beyond about this attack , we have compiled a technical summary of the attack and have provided a number of Indicators Of Compromise ( IOCs ) which can be used to aid detection 
It is likely that the attackers would redeploy their implant against other targets , albeit with a delivery mechanism more tailored to the location of the intended victims 
If this was indeed the case , then the nature of this attack is certainly more targeted than one that would cover the entire userbase of the GOM Player product , with victims comprising of the Japanese Government in addition to those at the Monju nuclear facility 
Oddly , this file is padded with null bytes , resulting in a 25 megabyte file 
Analysis of this malware revealed it to be a variant of the Gh0st RAT , often used by Chinese actors ( including those who are state-motivated or directly state-sponsored ) 
Specifically , the initial five bytes of the communications ( often used to denote a campaign or victim ) are 'HTTPS ' , amended from the original 'Gh0st ' ; the same as the traffic produced by the VOHO Gh0st variant 
by John Scott-Railton and Seth Hardy With the collaboration of Cyber Arabs 
Media coverage : Associated Press , Forbes This report describes a malware attack with circumstantial links to the Islamic State in Iraq and Syria 
In the interest of highlighting a developing threat , this post analyzes the attack and provides a list of Indicators of Compromise 
A Syrian citizen media group critical of Islamic State of Iraq and Syria ( ISIS ) was recently targeted in a customized digital attack designed to unmask their location 
The Syrian group , Raqqah is being Slaughtered Silently ( RSS ) , focuses its advocacy on documenting human rights abuses by ISIS elements occupying the city of Ar- Raqah 
In response , ISIS forces in the city have reportedly targeted the group with house raids , kidnappings , and an alleged assassination 
The group also faces online threats from ISIS and its supporters , including taunts that ISIS is spying on the group 
Though we are unable to conclusively attribute the attack to ISIS or its supporters , a link to ISIS is plausible 
The malware used in the attack differs substantially from campaigns linked to the Syrian regime , and the attack is focused against a group that is an active target of ISIS forces 
As the Syrian Civil War continues , Syrian citizen journalists and nonviolent activists operate in an increasingly unsafe environment 
The regime has never welcomed their work , and has often targeted them for arrest and detention , and a multi-year hacking campaign ( see Pro-Regime / Regime Linked Groups ) 
Additionally , not all elements of the Syrian opposition have uniformly supported nonviolent activists and citizen journalists 
More recently , in areas like Raqqah , nonviolent activists face a new and exceptionally grave threat : ISIS 
A growing number of reports suggest that ISIS is systematically targeting groups that document atrocities , or that communicate with Western media and aid organizations , sometimes under the pretext of finding '' spies '' 
Ar-Raqqah , the city in which the case study is located , is situated in northern Syria and continues to be a key conflict flashpoint of the Syrian Civil War 
In the spring of 2013 , Islamists and Free Syrian Army ( FSA ) fighters took over Ar- Raqqah from regime forces 
As ISIS gained momentum , they consolidated their control over the city , edging out FSA- affiliated groups through attacks , summary executions , and kidnappings against a range of groups , including ethnic and religious minorities 
During 2014 , there were a number of reports-many unconfirmed-that ISIS confiscated smartphones and laptops from captured activists 
According to Syrians who experienced these searches and spoke with one of the reports ' authors , ISIS sometimes extracts data from confiscated smartphones and laptops to collect information about people and groups they are targeting , as well as to seek evidence of '' un-Islamic '' activities 
As ISIS cements their control of Ar-Raqqah and other territories , reports have emerged recently ( though not all of them confirmed ) suggesting that elements within ISIS are growing increasingly sophisticated at imposing control and targeting opponents using digital methods 
Reports about ISIS targeting Internet cafés have grown increasingly common , and in some cases reports point to the possible use of keyloggers as well as unspecified '' IP sniffers '' to track behaviour in Internet cafes 
Nonviolent activists and citizen journalists based in Ar-Raqqah have provided the outside world with much of what we know about how ISIS treats the population 
These activists and journalists face mortal danger for their actions , and reports have emerged of their detention and torture at the hands of ISIS 
As ISIS continues to use social media to push the message that it is welcomed by the population of Ar-Raqqah , groups like Raqqah is being Slaughtered Silently ( RSS ) provide a compelling counter narrative 
RSS has n't escaped ISIS ' notice , and the group has been targeted for kidnappings , house raids , and at least one alleged targeted killing 
At the time of writing , ISIS is allegedly holding several citizen journalists in Ar-Raqqah 
In addition , RSS is targeted online by ISIS supporters with harassment , including threats to the physical safety of its members 
For example , ISIS supporters have claimed that ISIS has established a system of CCTV cameras in Ar-Raqqah to observe residents ' movements 
While this claim may be a bluff or exaggeration , at least one ISIS supporter has indicated on social media that this system could be used to look for members of RSS 
The Citizen Lab analyzed this attack with the consent of RSS , which requested that their name be used in this report 
The message was carefully worded , and contained references specific to the work and interests of RSS 
Thank you for your efforts to deliver a true picture of the reality of life in Raqqah 
As Syrians residing in Canada we are working with media because we believe in the importance of shedding light on the realities of life in Syria , and Raqqah in particular 
We are preparing a lengthy news report on the realities of life in Raqqah 
We are sharing some information with you with the hope that you will correct it in case it contains errors 
We have prepared a map of the city of Raqqah , in addition to a preliminary report 
We hope that you have a look at it with them and inform us of any errors 
We also hope that if you happen to be on Facebook , you could provide us with the account of the person responsible for the campaign , if you do n't mind , so that we can communicate with him directly 
You can see a preliminary copy of the report on this linkhttp : //tempsend [ DOT ] com/ [ Redacted ] With all respect [ Name Redacted ] We are unsure why the attacker specifically mentions Canada in the email lure 
However , it is well known that Syria's extensive diaspora ( including in Canada ) regularly engages in advocacy , sometimes in coordination with groups within Syria 
Thus , the message is not on its face implausible 
This functionality would be especially useful to an adversary unsure of whether it can maintain uninterrupted Internet connectivity 
Accessing the link provided in the malicious e-mail sends the user to a .zip file hosted on file-sharing site tempsend.com 
At the time of writing the file had been downloaded only 10 times This file is a self-extracting archive with an icon intended to suggest to the victim that it is itself a slideshow 
When run , the file opens a slideshow of Google Earth screen captures to the victim , displaying a series of locations in Syria , and highlighting an '' ISIS HQ '' and other images showing the alleged locations of US airstrikes 
Programs appear to make use of the Visual C++ Runtime Library 
Detections were low when the file was first submitted to VirusTotal , for example 
The malware has no obfuscation processes and is not highly technical in its development or interaction with Windows 
However , the attacker has not correctly implemented encrypted e-mail : the malware will not attempt to use a TLS connection in certain cases 
As a result , account login credentials may be readily available in network traffic 
The password for the zipped file is also present in the binary without encryption or obfuscation 
Citizen Lab researchers have developed the Targeted Threat Index ( TTI ) as a tool to standardize information about the sophistication of targeted threats against civil society groups in our research 
The index captures information about the level of social engineering used ( '' Targeting Sophistication '' ) , and adds a Technical Sophistication value for the attack as a multiplier 
Taken together it rates a 3 for Targeting Sophistication and a 1.25 for Technical Sophistication by our metric , yielding a TTI score of 3.75 
Citizen Lab research using the TTI has found that , despite low levels of technical sophistication , with well-crafted social engineering malware attacks remain highly effective against civil society groups 
More information is available about the TTI in a recent Usenix Security paper 
There are at least three possible sources for this malware attack : We evaluate each of these possibilities in turn , drawing on the information available to us after almost three years of tracking regime-linked malware 
Pro-regime malware actors have continually targeted the Syrian opposition with waves of malware since at least late 2011 
Those campaigns have been extensively reported on by a range of groups , including Kaspersky , FireEye , Citizen Lab , the Electronic Frontier Foundation , and many others 
Regime-linked malware has a number of common features that typically serve as distinguishing characteristics : Social engineering focusing on the needs and interests of the opposition 
Frequent use of Dynamic DNS providers like no-ip 
These characteristics are not all present in every sample , but we have typically found one or more in almost every binary we have examined that is Syrian regime-linked 
This malware attack differs from known regime-linked groups in each of these elements 
Nor does it have RAT functionality 
The lack of overlap in Tactics , Techniques , and Procedures ( TTPs ) between this attack and prior attacks does not rule out Syrian regime-linked attackers 
It is possible that regime-linked groups are trying a new approach 
However , given that known regime-linked groups continued to remain active during the same date range using familiar TTPs , this scenario seems unlikely 
In addition , it would be strange for regime-linked malware groups to undertake significant effort to prepare and send an implant that has significantly less functionality than what they commonly use 
Taken together , we find this evidence supports the hypothesis that familiar regime-linked groups did not conduct the attack 
RSS operates in territory controlled by ISIS , and has faced extensive targeting by ISIS 
Currently , they appear to be directly targeted by ISIS for kidnappings and other retaliation , including executions 
In addition , ISIS supporters have explicitly suggested that the group is under surveillance and actively hunted 
Together this evidence suggests that ISIS has a strong motivation for using social engineering and/or malware to locate the members of RSS 
We think there are several features of the malware attack that align with the needs and constraints of ISIS and its supporters in Ar-Raqqah , more so than other groups , as we understand them 
The social media activity of members of RSS is often highly public 
Their location and exact membership , however , is secret 
We speculate that if an attacker were interested in maintaining long-term surveillance of the activities of RSS they could have employed a RAT 
However , if the attacker were interested in unmasking the location of its targets so they could be physically tracked down , collecting IP data and system info would be a more reasonable approach 
ISIS or its supporters clearly have a strong interest in the ( rudimentary ) location tracking of the members of RSS that this malware provides 
Internet connectivity in Raqqah is extremely limited , and some of it is under ISIS control 
Knowing the IP address of a target could quickly narrow down targets to specific locations , and specific Internet services , or Internet cafes in Raqqah 
Given that the identities and locations of RSS members are closely guarded , such information would hold significant intelligence value for ISIS 
Armed with this kind of information , ISIS could physically harm people within Raqqah ( and it is also possible that they have the ability to operate in some capacity in border areas of Turkey ) 
Little is publicly known about the technical capabilities of ISIS and its supporters ; however , reports have begun to emerge suggesting that ISIS is interested in expanding its abilities 
In addition , ISIS has reportedly gained the support of at least one individual with some experience with social engineering and hacking : Junaid Hussain ( aka TriCk ) , a former member of teamp0ison hacking team 
While Mr. Hussain and associates have reportedly made threats against Western governments , it is possible that he or others working with ISIS have quietly supported an effort to identify the targeted organization , which is a highly visible thorn in the side of ISIS 
It is possible that the attack is the product of actors working for unknown purposes and targeting RSS 
Given the activities of RSS , however , it is unclear who this might be 
It is not possible , for example , to reject the theory that some unknown group within the FSA , or other groups opposing the Assad regime are responsible 
Citizen journalists in Ar-Raqqah were previously critical of arbitrary arrests carried out by non-ISIS groups in 2013 
However , it is unclear why those groups , which no longer control Ar-Raqqah , would be interested in RSS in November 2014 
It is likely that third party actors , including several intelligence services , are closely monitoring various actors in the conflict through a range of electronic means 
However , there is little reason to suggest that they would use a tailored but technically rudimentary attack to target RSS in particular 
After considering each possibility , we find strong but inconclusive circumstantial evidence to support a link to ISIS 
However , we are unable to connect this attack directly to ISIS , Mr. Hussain , or other ISIS supporters 
If indeed ISIS or its supporters are responsible , it seems reasonable that such an offensive capability may still be in development 
We hope that publishing this report will draw attention to a new and concerning threat that includes ISIS critics among its targets 
If ISIS is responsible , while this attack targets in-country impediments to ISIS objectives , other targets may include ideological or military adversaries abroad 
Whether or not ISIS is responsible , this attack is likely the work of a non-regime threat actor who may be just beginning to field a still-rudimentary capability in the Syrian conflict 
The entry costs for engaging in malware attacks in a conflict like the Syrian Civil War are low , and made lower by the fact that the rule of law is nonexistent for large parts of the country 
In still other parts ( under regime control ) , malware attacks appear to be state sanctioned 
Citizen Lab research into targeted digital threats against civil society confirms that civil society groups face grave threats from targeted malware attacks , despite being under-resourced to defend against them 
The case highlighted here is no exception : lack of IT and security resources have made it difficult for the Syrian opposition to address targeted and persistent digital threats against them 
In addition , if ISIS is indeed responsible , this case suggests how easy it is for belligerents in a conflict to begin fielding basic offensive digital capabilities , and how quickly the capabilities can be pointed at unarmed civil society groups 
As most organizations working on issues surrounding Syria are aware , malware delivered with good social engineering is a constant source of danger 
This particular attack can be prevented by not opening files sent by unknown persons 
However , many attacks in Syria come from hijacked accounts and impersonate people known to the targets 
Social engineering remains an unsolved problem , and continues to compromise groups throughout the Syrian opposition and their supporters 
This attack reaffirms the dangers posed by social engineering attacks , whether they deliver phishing campaigns or malware 
The circumstantial evidence of ISIS involvement suggests that groups working on topics that ISIS considers a threat , and their partner organizations and supporters , should urgently examine their security policies and assess the possible risks to their operations , and the consequences of exposure of sensitive information to ISIS 
Even if the link to ISIS turns out to be incorrect , it is possible that this will be a threat in the future 
Individuals and groups at risk can also consult materials in Arabic provided by Cyber Arabs including a series of very accessible videos on digital security 
The malware files Files dropped by the malware Collected Information Files ( unencrypted ) Exfiltrated file ( encrypted ) Registry Keys Acknowledgements : We are grateful to Cyber Arabs and the Institute for War and Peace Reporting for their critical work and assistance 
Special thanks to : several anonymous Syrians , Masashi Crete-Nishihata , Sarah McKune , Morgan Marquis-Boire , Ron Deibert , Bill Marczak , Nart Villeneuve , Irene Poetranto , and Kristen Dennesen 
Support for this research is provided by grants from the John D. and Catherine T. MacArthur Foundation and the Ford Foundation 
In the world of malware threats , only a few rare examples can truly be considered groundbreaking and almost peerless 
What we have seen in Regin is just such a class of malware 
Its stealth combines many of the most advanced techniques that we have ever seen in use 
The level of sophistication and complexity of Regin suggests that the development of this threat could have taken well-resourced teams of developers many months or years to develop and maintain 
Regin is a multi-staged , modular threat , meaning that it has a number of components , each depending on others , to perform attack operations 
This modular approach gives flexibility to the threat operators as they can load custom features tailored to individual targets when required 
Some custom payloads are very advanced and exhibit a high degree of expertise in specialist sectors 
This modular approach has been seen in other sophisticated malware families such as Flamer and Weevil ( The Mask ) , while the multi-stage loading architecture is similar to that seen in the Duqu/Stuxnet family of threats 
Regin is different to what are commonly referred to as '' traditional '' advanced persistent threats ( APTs ) , both in its techniques and ultimate purpose 
Regin 's purpose is different 
This report provides a technical analysis of Regin based on a number of identified samples and components 
This analysis illustrates Regin 's architecture and the many payloads at its disposal 
Regin is a multi-purpose data collection tool which dates back several years 
Symantec first began looking into this threat in the fall of 2013 
Multiple versions of Regin were found in the wild , targeting several corporations , institutions , academics , and individuals 
It also has the ability to load custom features tailored to individual targets 
Some of Regin 's custom payloads point to a high level of specialist knowledge in particular sectors , such as telecoms infrastructure software , on the part of the developers 
More advanced payload modules designed with specific goals in mind were also found in our investigations 
In some cases , Symantec was only able to retrieve the threat samples but not the files containing stolen data 
Symantec is aware of two distinct versions of Regin 
Version 1.0 appears to have been used from at least 2008 to 2011 
Version 2.0 has been used from 2013 onwards , though it may have possibly been used earlier 
Version 1.0 appears to have been abruptly withdrawn from circulation in 2011 
Version 1.0 samples found after this date seem to have been improperly removed or were no longer accessible to the attackers for removal 
This report is based primarily on our analysis of Regin version 1.0 
We also touch on version 2.0 , for which we only recovered 64-bit files 
Symantec has assigned these version identifiers as they are the only two versions that have been acquired 
Regin likely has more than two versions 
There may be versions prior to 1.0 and versions between 1.0 and 2.0 
The Regin operators do not appear to focus on any specific industry sector 
Regin infections have been observed in a variety of organizations , including private companies , government entities , and research institutes 
Infections are also geographically diverse , having been identified mainly in 10 different regions 
The infection vector varies among targets 
A reproducible infection vector is unconfirmed at time of writing 
Regin has a six-stage architecture 
The later stages bring Regin 's main payloads into play 
This section presents a brief overview of the format and purpose of each stage 
The most interesting stages are the executables and data files stored in Stages 4 and 5 
The initial Stage 1 driver is the only plainly visible code on the computer 
Symantec Security Response has not obtained the Regin dropper at the time of writing 
The dropper could be transient rather than acting as an executable file and may possibly be part of the infection vector exploit code 
Once this happens , there are no remaining plainly visible code artifacts 
The first two bytes are used and the remaining bytes are set to zero 
The second byte indicates the exclusive maximum number of instances allowed to run , which is set to two 
This means no more than one instance should run at any time 
The first byte indicates how many instances were run or attempted to run 
Therefore , the potential combinations for the first two bytes are : Stage 3 is a kernel mode DLL and is not stored in the traditional file system 
Stage 3 can be found in the following locations : The file is six to seven times the size of the driver in Stage 2 
Stages 3 and above are based on a modular framework of code modules 
These modules offer functions through a private , custom interface 
Each file in stages 3 and above can '' export '' functionality to other parts of Regin 
In the case of Stage 3 , the following primitives are offered : These primitives are provided through a custom export methodology 
The Stage 3 DLL exports a wide range of functionality through a custom export methodology 
The interface used to export functionality does not make use of the traditional Windows DLL export mechanism by name or ordinal 
Exported Regin methods are referenced by a tuple consisting of a major and minor number 
Stage 3 exports hundreds of methods , organized into 12 different major groups 
The numbers used vary across versions 
We acquired artifacts using two different numbering schemes 
Table 2 is an example listing 
With Regin 's modular nature , Stage 4 kernel modules and Stage 5 user modules ( payloads ) can provide functionality and export routines using the same major and minor numbering scheme 
They are stored in two EVFS containers as files : • % System % \config\SystemAudit.Evt : Contains Stage 4 kernel drivers , which constitute the kernel mode part of Regin 's payload 
• % System % \config\SecurityAudit.Evt : Contains a user mode version of Stage 3 
The files are injected into services.exe 
Stage 4 also uses the same export methodology described in Stage 3 
Stage 5 consists of the main Regin payload functionality 
Stage 5 files are EVFS containers containing other files : Regin 's payload involves the DLLs contained in the SystemLog.evt EVFS container 
The payload functionality differs depending on the targeted computer 
Custom payload files will likely be delivered for each specific environment 
Such files are accessed by the major routines 3Dh 
Known extensions for EVFS containers are *.evt and *.imd 
The structure of a container is similar to the FAT file system 
One major difference is that files do not have a name ; instead , they 're identified using a binary tag 
The tag itself is the concatenation of a major number and a minor number 
The major number typically indicates the major function group that will handle the file 
A container starts with the header in Table 3 ( little-endian ordering ) 
The header is followed by the file entry table ( Table 4 ) 
Each file entry is 13h+taglen bytes long 
The sectors follow ( Table 5 ) 
A sector of sectsize bytes starts with a DWORD pointing to the next sector ( if the file does not fit within single sector ) , followed by sectsize-4 bytes of payload data 
Other layers of encryption and compression may also be in place , although those would be handled by higher level components 
The string 'shit ' is scattered in the packet for data validation 
In addition , CRC checks use the seed '31337 ' 
This information can be combined with another cookie for validation under the names USERIDTK , UID , GRID , UID=PREF=ID , TM , utma , LM , TMARK , VERSION , or CURRENT 
The extensible nature of Regin and its custom payloads indicate that many additional payloads are likely to exist in order to enhance Regin 's capabilities 
Furthermore , we have found data files accompanying payload modules that have not been recovered 
The following table describes the Stage 4 kernel payload modules and Stage 5 user mode payload modules , which we have seen several variants of Regin use 
Only a small amount of the 64-bit Regin files have been recovered 
These samples may represent version 2.0 or their differences may possibly be solely specific to 64-bit versions of Regin 
The recovered files do not appear to fundamentally vary from their 32-bit counterparts , apart from a few noteworthy differences 
The 32-bit and 64-bit versions of Regin use different file names 
These differences are shown in the first section of this paper as well as in the appendix 
Most importantly , in the 64-bit version of Regin , the names of containers are changed : The 64-bit version of Regin 's Stage 1 ( wshnetc.dll ) is no longer a kernel mode driver , as drivers under 64-bit Windows must be signed 
The 64-bit Regin 's Stage 3 has not been recovered 
We believe that it may not exist , as the 32-bit version is a driver 
Stage 4 is an orchestrator just like its 32-bit counterpart and it uses the same major and minor values to export functionality 
No Stage 5 payload modules have been recovered 
The development and operation of this threat would have required a significant investment of time and resources 
Threats of this nature are rare and are only comparable to the Stuxnet/Duqu family of malware 
The discovery of Regin serves to highlight how significant investments continue to be made into the development of tools for use in intelligence gathering 
Many components of Regin have still gone undiscovered and additional functionality and versions may exist 
Symantec and Norton products detect this threat as Backdoor.Regin 
Regin 's data files are classified as Stage 5 components and are contained in an EVFS container 
As the data files are stored in a container , they do not have names 
Just like Stage 5 modules , they are referenced by their filetag , which is the aggregation of the major and minor identifiers 
The major identifier indicates which major routine group likely handles or creates the file 
Not all data files have been recovered , so the information remains incomplete 
Data files associated with Stage 4 kernel modules have not been recovered Table 8 lists recovered data files used by Stage 5 modules 
The associated modules that supposedly manipulate those data files were not recovered 
The following details can be used to help determine whether you have been impacted by this threat 
We have written about NetTraveler before HERE and HERE 
Earlier this year , we observed an uptick in the number of attacks against Uyghur and Tibetan supporters using an updated version of the NetTraveler backdoor 
The .DOC file , which in reality is a '' Single File Web Page '' container , also known as '' Web archive file '' , appears to have been created on a system using Microsoft Office - Simplified Chinese 
It contains an exploit for the CVE-2012-0158 vulnerability , detected by Kaspersky Lab products as Exploit.MSWord.CVE-2012-0158.db 
Luckily , the encryption is relatively simple to break 
We identified several samples using this new encryption scheme 
A list of all the extracted C & C servers can be found below : We recommend blocking all these hosts in your firewall 
This year , the actors behind NetTraveler celebrate 10 years of activity 
Although the earliest samples we have seen appear to have been compiled in 2005 , there are certain indicators that point to 2004 as the year when their activity started 
For 10 years NetTraveler has been targeting various sectors , with a focus on diplomatic , government and military targets 
Most recently , the main focus of interest for cyber-espionage activities revolved around space exploration , nano-technology , energy production , nuclear power , lasers , medicine and communications 
The targeting of Uyghur and Tibetan activists remains a standard component of their activities and we can assume it will stay this way , perhaps for another 10 years 
Blue Coat researchers have uncovered a previously-undocumented , highly automated , and extremely sophisticated framework for performing targeted attacks 
Initial malware components were embedded in Rich Text Format ( RTF ) files 
Malware payloads designed for a wide array of potential devices , including home routers and mobile devices running iOS , BlackBerryOS or Android , were also recovered during the course of our research 
The malware components of this framework follow a plugin model , where new malware rely on other , previously delivered malware components to interact with the framework 
Initial attacks were largely focused on Russia and a few other Eastern European countries 
However , we have later seen that attackers are interested in targets all over the globe 
The framework is itself target-agnostic , and seems highly automated 
The operational security exhibited by the attackers is very good - among the best we have seen 
Although the attackers have left a few clues , we have been unable to provide attribution with any degree of accuracy 
The use of software vulnerabilities in order to execute malicious software on unsuspecting users ' computers is an important parameter to monitor 
This method of attack is not only known to have a considerable success rate , it is also often deployed by resourceful attackers and , as such , marks a threat worth paying attention to 
The use of exploits in document formats like PDF , DOC and RTF is in some ways especially noteworthy 
Documents are commonly exchanged via mail , which make them perfect for email-borne targeted attacks ; what is otherwise known as spear phishing 
In March , 2014 , Microsoft published information about a new vulnerability in Rich Text Format ( RTF ) 
This vulnerability , named CVE-2014-1761 ( Microsoft Word RTF Object Confusion ) , had already been used effectively by attackers at the time of the announcement 
Two previous vulnerabilities in the RTF file format , known as CVE-2010-3333 and CVE-2012-0158 , had become , by that time , mainstays of targeted attacks , so we tracked how attackers implemented this new exploit with keen interest 
By late August , we identified a malware espionage operation that used both the CVE-2014-1761 and CVE-2012-0158 vulnerabilities to trigger execution of the malicious payload , and which leveraged a single cloud service as the backbone of its entire visible infrastructure 
When we examined the suspicious documents , it was discovered that they were somewhat anomalous compared to the run-of-the-mill material 
Due to the many levels of obfuscation and indirection , we named this the Inception framework ; but there ends all similarity with the movie by the same name 
Leonardo DiCaprio is not associated with this investigation 
We initially knew little about who the actual targets were ; apart from one 
The email was apparently sent from '' Mrs. World '' ; note the Mrs. , and not Miss - World 
We soon discovered that our malware repository contained several other , similar documents , but these had come from other sources which did not include the email message , or any identifiable information about the targets 
However , the text of the documents covered a variety of topics mostly revolving around Russian issues relating to a variety of business sectors 
The following pages highlight a representative selection of these documents 
All documents that we have found so far have been rather standard Word documents , of the old 97-2003 compatible format based on OLE2 
Such documents can , and typically do , contain quite a bit of metadata : The name of the document creator ; the user who edited it most recently ; the name of the company whose copy of Word was used to create the document , et al 
Users can optionally configure Word to remove this metadata when a document is saved , and that 's exactly what the creator of these documents did , stripping out this potential source of attribution data 
However , Word documents in this format contain additional information , if you know where to look 
All Word documents of this format contain what 's known as a File Information Block ( FIB ) 
The FIB contains information about the file 's internal structure , and also – to some extent – data on the program used to create the file 
In the case of the samples we analyzed , all of the documents were saved using the same build of Microsoft Word from Office14 ( better known as Office 2010 ) 
In addition , documents can contain slack space in which old data remains 
For example , the decoy that came with the attack named '' Organigrama Gobierno Rusia.doc '' contains Visual Basic leftovers indicating that it originally was created on a computer that was configured to be used by a native Spanish speaker , apparently by an advisor at the Spanish Embassy in Moscow 
Despite the limited information at our disposal about the targets of these attacks , their content reveals some context about who the possible targets may have been 
The VBScript dropper code is also a little unusual 
It declares a Windows Management Instrumentation ( WMI ) object in order to reach components like the registry and file system 
One is a polymorphed dll file and the other a binary data file with no obvious internal structure 
The names of these dropped files change from attack to attack 
Other names observed were : The encrypted data files are named using random words apparently taken from a dictionary – '' acholias '' , '' arzner '' , '' bicorporate '' , '' crockrell '' , '' damnatorily '' etc 
Looking at one of the dropped dlls we can see the authors originally called it 95Num3P3gm.dll.polymorphed.dll 
It is hard to describe the polymorphed dlls with any real depth , as there is little consistency between them 
When two nearly identical dlls are encoded using the polymorphic scheme there is very little code in common 
The call graphs are different and key functions have varying number of arguments 
The sizes of buffers allocated are also randomized to mask their intent 
What is common is that somewhere along the execution cycle is one extremely large function ( over 200 kb in length ) where early in a large allocation is made where the un-obfuscated binary will be placed 
The binary is then built from de- obfuscating segments of it that have been dispersed through the '.rdata ' section 
Simply halting execution before this function call permits a researcher to extract the reconstructed DLL from memory 
Here , pausing execution before the call to 'loadpefrommemory ' reveals the extracted PE at the memory address pointed to by edx 
This reconstructed DLL , once loaded , will decode a configuration structure from its '.data ' section which contains three important details : the name of the encrypted data file dropped by the VBScript ; the AES key used to decrypt the file ; and the name of a unique global mutex to hold while running to prevent multiple instances 
This turns out to be yet another dll 
The first ordinal exported by this dll is located and then called , passing in the configuration and the name of the encrypted file on disk as parameters 
This last dll is the heart of the threat ( originally called q5Byo.dll in this instance 
This file contains the true intent of this campaign 
WebDAV is a communication standard that allows file management over HTTP or HTTPS 
Windows allows WebDAV sessions to be mapped as network resources 
The use of WebDAV as the communication channel is atypical for most malware samples we see 
By using a network resource , the actual web traffic originates from the system itself , and not from the process in which the malware resides 
All the authentication information for the WebDAV session including the URL , folders , path , user name , and password is stored within this last DLL in another AES-encrypted configuration structure in the binary 
A unique path , username , and password were used for each malware instance we 've seen in the wild 
Also contained within the configuration structure is information on how to name the survey data on the remote file server 
The binary reads from its configuration a string on how to generate the remote filename , and a list of extensions to use 
An example would be '' 1-7d0-8s '' , [ '' TIF '' , '' TAR '' , '' SIT '' ] which instructs the binary to generate a filename with 1 to 7 numeric digit characters followed by 0 to 8 ASCII letters with one of the three listed extensions such as '' 664gher.TAR '' 
The cloud storage provider in every case we have seen was the Swedish company CloudMe.com , which offers free and paid WebDAV cloud storage 
The URI model used by the malware is http : //webdav.cloudme.com/ % username % /CloudDrive/ which is a direct reference to file storage 
It must be noted that the CloudMe service is not actively spreading the malicious content ; the attackers are only using it for storing their files 
We notified CloudMe.com about the abuse of their services 
Their CEO , Mr. Daniel Arthursson , was none too happy about this , and was very helpful in our further research 
CloudMe has shared a great deal of log information related to this attack 
These indicate that there are many other accounts ( over 100 ) likely related to this attack system 
We have no way of verifying this with absolute certainty , but this is what we regard as a high confidence assumption 
The cloud accounts are not used for one-way communication only 
One such case is the franko7046 account , used against the previously mentioned bank CEO 
This is how we found the depp3353 account 
In this new account there was another surprise waiting for us – a download folder with two new encrypted files , 921.bin and 922.bin 
Once decrypted , these turned out to be PE executables 
The two new executables are plugins - quite similar to each other and obviously compiled on the same setup 
Of interest , both of the DLLs originally had the same internal name ( 78wO13YrJ0cB.dll ) 
Presumably the same PE sanitization script and parameters were used on both 
None of these plugins contain any means of CnC communication 
Neither are they ever written to disk 
This makes these modules extremely stealthy , flexible and compatible with multiple toolsets independent of what CnC method is being used 
This model makes it possible to do the intrusion in steps , with verification stages in between ; and the files will not be easily found on affected computers 
Based on the information gathered from these modules , the attackers appear to move to the next stage of their attack by placing more new components on the WebDAV shares 
Information about these uploads is limited by the fact that we do not have the AES keys to decrypt much of the uploaded data , but we have been able to see some upload patterns 
What we assume to be third-stage plugins appear on the shares as *.bin files of roughly 72kb 
However , the next day , another *.bin file of the same size will be uploaded to the share 
This is a pattern that repeats itself over all live accounts 
For Windows XP this will typically be '' Microsoft-WebDAV-MiniRedir/5.1.2600 '' , and for Windows 7 a common user-agent is '' Microsoft-WebDAV-MiniRedir/6.1.7601 '' 
Security researchers – and there are a few of them - connect in a variety of ways ; first of all , we see a number of connections that are indistinguishable from the way victims connect 
This happens when researchers use lab machines with live internet access to run the malware 
The only way we can tell these are researchers is because they connect from IP address ranges that are unlikely to be victims ; and they also tend to consist of short-lived sessions 
Some researchers set up scheduled tasks to scan the shares for new updates and malware 
We see a few variations of these – one typical configuration is where the requests contain a Python-related user-agent string 
Attackers , on the other hand , do n't appear to use Windows 
We know these are not researchers , because we can see malware files being uploaded by them : We have a log fragment in which the attackers uploaded a sequential series of updates ( from 1746.bin to 1774.bin ) within 1.5 hours on Sept 17th , spread over 27 different accounts and using 27 different IP addresses in the process 
The user-agent string shows that attackers likely have used a client based on the open source davfs2 file system for Linux to mount the WebDAV shares 
This client is used when uploading new malware , but also when the attackers scan their shares for new victim updates , in which case the shares are enumerated by requests in a scheduled manner 
The attackers have used a large number of IP addresses to access the shares 
As mentioned above , there is a rotation scheme in place in which a new IP address will be used after a few minutes of access against CloudMe accounts 
These IP 's are distributed widely over geographical locations and service providers , with a heavy bias towards South Korean ranges 
At first we thought these IP 's belonged to some commercial proxy service , particularly since several such proxy services also offer IP rotation 
However , this turned out to be a wrong assumption 
A superficial examination of the proxy IP addresses that connected to CloudMe showed them to be internet-connected devices of various kinds 
Many were Korean Tera-EP home routers ; but there were several other products represented 
We were able to do some forensic work on a compromised Tera-EP TE-800 device and discovered another dimension of the attacker 's infrastructure 
Under the ramfs mounted partition we found a stripped and statically linked MIPS-el binary named tail- 
Instances of this were also found under the running process list 
Each sample of the binary we were able to acquire was configured with a unique 32byte blowfish key and a small , encrypted section appended to the end of the binary 
This acts as a management interface 
From here the attackers can request a specific port to be opened as one of the following types : SOCKET , SOCKSS , SOCKAT , SOCKS5 , or STATUSPORT 
To prevent anyone else from accessing this service all communication on the management interface is encrypted using the same blowfish key 
This setup makes it difficult to identify embedded devices compromised with this malware by scanning open ports 
In the wild we witnessed the attackers connect to the management port and request SOCKSS connections 
This would open the specified port and wait for configuration data , which consists of a domain name ( webdav.cloudme.com ) , the destination port , and a variable length RC4 key , all of which encrypted using the blowfish key 
The graphic below illustrates a typical session 
The router proxy network provides another layer of indirection masking the attackers ' infrastructure 
However , because we captured traffic through one of these embedded devices we could identify other parts of their operation 
This IP would make connections hourly and poll the status of the router proxy malware 
This machine is most likely used to track which compromised routers are currently available for use 
However , later we observed that the Email sender IP at VOLIA vanished and the Unlocker server taking over its role as well 
Each of these connections used the correct encryption key , so we know that these accesses came from the attackers and not some opportunistic third party 
We were later notified by Symantec ( thanks , guys ! ) about a third 
These servers were hosted on domains that were registered by the attackers , using domain names clearly meant to look legitimate 
This is the only time we have seen attackers register domains in this investigation 
The mail proxies were : Registrant WHOIS information seems forged : The connections made from the Ukrainian host to the router were interesting 
From captured traffic it appears that the mail proxies have SOCKSv5 services running on obscure high ports 
We have documented that the attackers log in to these using apparently randomly generated usernames and passwords , a unique pair for each server 
Investigating the target email addresses , we saw several of these were found in this public document from the World Petroleum Council , including some addresses that are , at the present time , no longer valid 
And then , the ground shifted again 
There was no executable attachment in this mail , but instead a link shortened by the URL shortener service bit.ly , with the underlying link pointing to an IP address on a Dutch hosting service 
Clicking that link from a Windows PC only yielded a redirection to the BBC homepages , and using other devices did not give more data 
The bit.ly service does however provide information on the user creating the shortened link , and other links associated with this account 
In this case , the user was named nicolatesla53 
The nicolatesla53 account was created in July 2014 
From Oct 24th to Nov 21st this user created nearly 10000 shortened links – we harvested 9990 unique ones 
Three IP addresses were used for these links : The links themselves were on this format : As far as we were able to tell , there were three main types of actioncode : We have no sample of the actual MMS phishing messages apparently being sent , but we can see the page served when a user clicks a spammed link 
This is just a dialogue box asking for the password presumably included in the initial message , and the next stage likely involves download of malicious content 
We were in the middle of harvesting the servers for data on the various action codes when they all were abruptly taken offline ; so our data on which mobile operators are targeted is not complete 
We managed to get 66 of a total of 190 
The ones we know of are shown below 
A full breakdown of mobile operators and related links is included in the appendix 
The composition of links created for the various mobile operators is quite interesting , as one can speculate that they represent amount of actual or planned attacks in different countries 
With the top three operators being Vodafone , T- Mobile and Proximus ( Belgacom ) it seems these apparent phishing attacks are less focused on the Russian sphere than the previously discussed malware 
This map is not complete , though 
It represents only about 35 % ( 66/190 ) of all mobile operators targeted and 66 % ( 3152/4781 ) of all phishing links we managed to harvest 
In addition , some operators like Vodafone are global actors , so the map might show an unfair intensity in their HQ locations 
The rest of the bit.ly links used the action codes 743 or 1024 
And now things really get interesting 
By using mobile device HTTP User-Agents we were able to trigger downloads of malware components from some of these links 
The package we analyzed was 1.2MB in size 
It uses a custom DAO/Database scheme which uses accounts belonging to the virtual community Live Journal ( livejournal.com ) as data stores 
Three such accounts were found hardcoded in the package : The accounts all state that they belong to Iranian users 
This is very likely false 
The text in these posts starts first out in cleartext , but quickly turns into unreadable gibberish 
Based on registration data and folder configuration we believe these are legitimate but compromised Joomla servers 
And then an unexpected oddity shows up in the Java source : We were also able to download a similar malware sample ( BrowserUpdate.apk ) from one of the C & C servers 
This sample used different online accounts for its DAO/database functionality , but is otherwise quite similar to the first 
In this particular case , the FTP account is located on a legitimate ( if struggling ) hosting service in the UK 
In this case , there 's another clue : The WhatsAppUpdate project seems derived from an earlier template named SkypeUpdate 
By now , it came as no surprise when we triggered a download with a BlackBerry User-Agent 
The initial download was a Java Applications Descriptor , a text file designed for Over-The-Air installation of Java-based applications 
This JAD file contained the locations of the two Blackberry *.COD binaries which we then could download directly 
Since these COD files are also compiled Java code , they are possible to decompile to original source code 
In a similar fashion to the Android version , we find interesting strings there 
This time they are in Arabic : The earliest sample of Inception-related malware we have been able to obtain , was submitted to us in June 2014 
However , decoy document metadata shows that it was created late May 
The related cloud account was created just before that 
An examination of the other documents associated with the attacks show that they have been created at a steady pace all through summer and autumn 2014 and attacks are still ongoing 
Of interest is also the attackers ' activity patterns over the 24h cycle 
The main upload of new components to shares seems to be divided over two high–activity periods : 6:00 -10:00 UTC and 17:00 - 21:00 UTC 
No uploads were seen between 23:00 and 05:00 UTC 
It is however doubtful how indicative these timeframes are 
To illustrate , we looked into another and more obscure timing factor : The timing of the AES InitVector random seeds 
A random seed is the initial value passed into a pseudo-randomizer function 
The malware uses the random output to create what is known as an InitVector - a starting point for the AES encryption/decryption function 
The code used in some of the DLLs indicate that the attackers tend to use the C time ( ) function to generate random seeds 
This function returns values of granularity down to seconds 
Thus random seeds , and ultimately the InitVectors , are functions of these quite coarse units of time 
Since we know the time window to be within a few days of the upload time we were able to brute force the time values that would generate the corresponding InitVectors 
Thus , we were able to say to the second when the file was created – and most times were identified to be in the range 1500 - 2200 GMT 
Unfortunately , we had to reject these data 
Either the attackers ' system clock is wrong or a fixed offset is added to the random seed 
Either way , the data ca n't be trusted ; and shows that nothing can be taken at face value 
This executable , ( sccm.exe , md5 dd8790455109497d49c2fa2442cf16f7 ) is a classical Chinese APT implant 
This development was unexpected for several reasons 
First of all , it apparently breaks the strict , obfuscatory operational security built into the Inception framework 
Another factor which is out of character is the coding style 
All Inception-related malware is written using Visual Studio 2010 
The downloaded sccm.exe is written using Visual C++ 6 ; and has a PE header compile date of October 2010 
This date can be forged , and indeed , all Inception-related malware has some level of forgery in the compile dates 
However , the sccm.exe compile date matches the Quarian developer toolset and coding style to a better degree than the other files distributed through Inception 
According to DomainTools.com the msname.org domain registration timed out September 27th 2014 
It was left inactive and was not renewed until Nov 12th 
This means that the attackers distributed malware that would be out of action for a long time ( last distribution of sccm.exe was September 26th ) 
Because of all this we consider sccm.exe as an unreliable indicator 
It is likely to be a red herring purposefully placed on shares where the attackers have seen signs of access by security researchers 
At one instance the attackers seem to have slipped up 
Instead of using their scheduled task , they apparently did something manually on a WebDAV share 
This is visible because the request came from an apparent attacker IP , but used yet another User-Agent : '' gvfs/1.12.3 '' 
Gvfs is the virtual filesystem for Gnome desktop 
The action on the account was abnormal as well ; an apparent file upload : When WebDAV shares are mapped up as drives by the operating system , any action taken by the attacker follows the same pattern as on the attacker 's local drive 
In the case above , it seems the attacker attempted to edit a new document , which by default is given the name '' Untitled document '' in Gnome 
This might indicate that the attacker 's operating system language is Spanish 
Of course , Spanish is one of the world 's most widespread languages , so one can not infer much from this 
There is even a small possibility that the phenomenon is a pure artifact ; for example that a Spanish-speaking researcher connected to the same account using the same Linux-based setup as the attackers 
This attack system shares a number of properties that are somewhat similar with the Red October campaigns detailed by Kaspersky Labs in 2013 
For more information about this see : The '' Red October '' Campaign - An Advanced Cyber Espionage Network Targeting Diplomatic and Government Agencies However , there are also clear differences 
The code is fully rewritten ; there appears to be little code overlap , at least in the initial stage malware 
The coding style is different , with different solutions to programmatic problems , different use of exception handling , and different use of C++ classes 
It 's hard to believe that the same programmers are responsible for the two code bases 
The Red October malware contained linguistic markers that pointed towards Russian speaking attackers 
No such clues have been found in the Inception- related malware ; there is a marked difference in the attention to detail and information leakage 
It is certainly possible that the same people have organized both Inception and Red October , but there are no clear indications to this effect 
The Windows-based malware in this paper generally contains very few noticeable strings apart from what is commonly found in software , and clearly randomized strings 
What exists – like the word '' polymorphed '' in the early DLL versions - is standard English with few discerning features 
This changes a bit when we look at the mobile malware 
In the Android malware we find Hindi comments in the Java source code 
In the Iphone malware we find project paths referencing one '' JohnClerk '' , and a few typos like '' conutry '' 
In one of the Blackberry binaries we find the string '' GodSaveTheQueen '' , a rather blunt hint towards Britain , as well as Arabic log strings 
These and other indicators have led us to conclude that the Inception attackers are setting a new standard for deliberate disinformation and red herrings in a malware espionage operation 
Some clues might have been added by accident , but none of these indicators can be trusted in any way 
Thus we are not going to assume anything about who might be behind these attacks 
The whole Inception setup shows signs of automation and seasoned programming 
The amount of layers used in this scheme to protect the payload of their attack seems excessively paranoid 
The names of the files both when dropped and their original names along with the callback directories , paths and mutexes used all seem to be dynamically generated 
This suggests that this a large campaign and we 've only seeing the beginning of it 
Initially many of the targets were located in Russia or related to Russian interests , but as the campaign has evolved we have verified targets in countries all over the world 
It is clear that this infrastructure model does not need to be applied solely against a few targets , or even need to be hosted at CloudMe 
The framework is generic , and will work as an attack platform for a multitude of purposes with very little modification 
The attribution indicators point in different directions and ca n't be given much weight 
These attacks can in theory be the creation of nation states or resourceful private entities - we consider it very unlikely that they are performed by one or just a few individuals 
haarmannsi.cz sanygroup.co.uk ecolines.es blackberry-support.herokuapp.com ( DynDNS ) The following entities have helped in big and small ways 
Big thanks to all 
We also owe a big debt of gratitude to Ryan W. Smith of Blue Coat who helped us tremendously with the analysis of the mobile malware 
The energy sector has become a major focus for targeted attacks and is now among the top five most targeted sectors worldwide 
Companies in the sector are facing a growing risk of having their services interrupted or losing data 
The threat to energy firms is only likely to increase in the coming years as new developments , such as further extensions of smart grids and smart metering expose more infrastructure to the Internet 
Equipment that is not connected to the Internet and other networks is not immune to threats and there has already been a number of successful attacks against isolated systems 
Operators of critical infrastructure , as well as energy utility companies , need to be aware of these threats and prepare accordingly 
The threat to energy firms comes from several different sources 
In some cases , espionage from competitors is the primary motive , with data on new projects , exploration and finances being targeted 
Disruption and destruction are the goals of other attacks 
Some instances appear to be state sponsored , such as the disruption of the Iranian nuclear program by the Stuxnet worm in 2010 , one of the attacks that began this trend 
Others appear to be the work of hacktivists with political or environmental agendas 
Internal attackers , like disgruntled employees , are also a major source of attacks that often lead to service disruption 
The majority of the actors behind these attacks have grown more sophisticated in the way they attack 
During the monitoring period from July 2012 to June 2013 , we observed an average of 74 targeted attacks per day globally 
Of these , nine attacks per day targeted the energy sector 
Accounting for 16.3 percent of all attacks , the energy sector was the second most targeted vertical in the last six months of 2012 , with only the government/public sector exceeding it with 25.4 percent of all attacks 
The high ranking was mainly due to a major attack against a global oil company , which we observed in September 2012 
However , in the first half of 2013 the energy sector continued to attract a high proportion of attacks , ranking in fifth place with 7.6 percent of targeted attacks 
Not all of the attacks analyzed used highly sophisticated tools 
Most of them could have been prevented by following best practice guidelines for protecting the IT infrastructure and the industrial components , indicating that despite high revenues and strategic importance , many energy sector companies are not prioritizing cybersecurity 
The number of targeted cyberattacks in general has risen in the past few years 
In addition to this , the rate of attack exposure has also risen , with more companies becoming aware of attacks , expecting them and searching for indications of compromise 
It is not a new phenomenon , but its importance has grown 
The Council on Foreign Relations , a US think tank , reported that energy companies , including oil and gas producers , were often the focus of targeted attacks during summer 2012 
In May 2013 the US Department of Homeland Security ( DHS ) warned of an increase in sabotage attacks against US energy companies located in the Middle East 
The government had tracked multiple attacks and issued a warning together with the Industrial Control Systems Cyber Emergency Response Team ( ICS-CERT ) 
A report by the US Congress supported this picture , stating that many power utilities companies were under constant or daily attack through cyberspace 
Taking into account that successful breaches of critical infrastructures are still rare and that these numbers included generic malware infections , it nevertheless highlights the potential for cyberattacks in the energy sector 
As in most sectors , attackers are often after valuable information 
For example , we have seen attackers target intellectual property such as technology for photovoltaic research and wind turbines , or data on gas field exploration 
Information such as this is of high value and can generate huge profits for attackers or their sponsors 
The same information can also be misused for an act of sabotage 
Many power utilities companies fear disruptive attacks the most , regardless of whether it is done by internal or external attackers 
The energy sector has a high potential for critical disruption through sabotage attacks 
Any interruption to the power grid would cause substantial chaos and cascading effects resulting in financial loss 
In the past there have been quite a few attacks that included targets in the energy sector 
Some of these were more focused , like Stuxnet , Duqu , Shamoon/Disttrack and Night Dragon 
Others saw power companies targeted among many other sectors , such as Hidden Lynx , Nitro , Flamer , Net Traveler and Elderwood to name a few 
One of the biggest examples , and a game changer for many organizations , was Stuxnet 
This targeted sabotage attack , which is believed to have been aimed against uranium enrichment facilities in Iran , made clear what could be done through cyberattacks 
For example , such a case happened in May 2013 , when a small fuel distribution company in North Carolina fell victim to a cyberheist that transferred US $ 800,000 from the company 's bank account 
Such threats spread broadly and might impact any person , regardless of their employer 
These attackers aim at infecting as many computers as possible in order to maximize their chances of profits 
For this paper we focused on email data from targeted attacks between July 2012 and June 2013 
Even though watering holes are becoming more frequently used in targeted attacks , it is unfortunately quite difficult to reliably map these to individual campaigns 
A blocked drive-by download attempt does not give any indication if it was a targeted attack or just general noise 
In quite a few cases we see the same common malware , like Poison Ivy , being used by generic attackers and by targeted attacks 
In such cases the sole difference between a sophisticated targeted attack and a generic one lies in the person commanding the malware 
Historically most industrial control systems ( ICS ) and supervisory control and data acquisition ( SCADA ) systems were in separated networks not connected to the Internet or any other network 
Unfortunately this security through segregation approach does not fully protect against cyberattacks 
In reality , networks are rarely completely isolated 
Often some configuration updates are periodically installed or log files are transferred 
If systems are not directly connected , the method of choice for these types of interactions is usually through a USB stick or a non-permanent modem connection , which provides a way into the restricted networks 
If networks are truly segregated , this would mean that there would be no software updates installed , leaving old vulnerabilities open 
There are also issues around processes 
For example , the revocation lists for digital certificates are seldom updated and therefore certificates which are no longer valid can not be checked properly and would still be accepted 
With the increasing desire for connectivity now reaching industrial plants , many operators have started to connect their ICS to the Internet 
New adapters can bridge to older technology which was never intended to be controlled over the Internet , allowing it to be connected easily 
This allows for efficient centralized monitoring and , to some extent , remote control of equipment 
Depending on the type of machinery controlled through the human-machine interface ( HMI ) of the ICS , not all modifications are possible 
Some systems are physically connected in a pure read-only mode for monitoring 
And even if they are fully connected , some turbines have physical limitations or emergency systems based on physical effects that can not be overridden by the digital controller 
Thus , not all Hollywood scenarios of open flood gates or turbines that fly through the air are possible 
In the future , more systems are going to implement the failsafe switches in software , opening up the vector for malware attacks 
An additional source of concern is that some countries have started to open the energy market for smaller private contributors 
This means that almost anyone can use mini power plants like water , wind or photovoltaic sites to feed energy back into the power grid 
Often these operators do not have a full IT staff supporting the facilities at hand , which might lead to more vulnerable installations 
Furthermore they may deploy new technology which might be untested and contain some unknown vulnerabilities 
While these smaller sites make up only a small portion of the grid , new decentralized power input feeds are a challenge for the balance of the power grid as well and need to be carefully monitored 
Small outages or changes can have a domino effect for the whole power grid 
To increase the exposure of energy firms even further , sites like SHODAN , which is essentially a search engine for devices , enable anyone to easily find exposed controllers on the Internet 
Of course not all of the industrial control systems connected to the Internet are critical systems or even real ones 
Some researchers have started to create honey pot systems in order to study the attackers , which have apparently already attracted attackers like the Comment Crew/APT1 group , who have broken into these decoy systems 
Smart grids and smart metering are bringing significant change to the world 's power systems 
Experts predict that billions of smart meters and sensors will be installed worldwide over the next ten years 
They enable utility companies to measure energy consumption at a more granular level , creating better flow patterns and enabling different prices for consumption based on the time of day and location 
This development brings new opportunities , as well as new challenges 
As with any connected infrastructure , it is important to secure the network and its endpoint on multiple levels 
In addition to the issue of securing these devices , smart grids will produce a huge amount of data which , depending on regulations , will need to be kept for audits 
Some of this data may be sensitive and could raise privacy concerns if not properly protected 
This could easily grow to petabytes of data that needs to be safely stored and managed 
It is beyond the scope of this paper to address all the challenges associated with smart grids and smart meters 
Symantec has created a dedicated whitepaper for this topic : How to protect critical infrastructure , mitigate fraud and guarantee privacy 
As a member of the CRISALIS project , Symantec is following these developments closely and is helping to secure critical infrastructure together with partners from academia and different industry sectors 
There have been numerous cyberattacks against the energy sector over the past few years 
Not all of them were the work of sophisticated attackers ; some incidents were just collateral damage caused by malware infections or bad configuration issues 
These incidents highlight the fact that such attacks can happen and that they can have real life consequences 
In 2013 part of the Austrian and German power grid nearly broke down after a control command was accidentally misdirected 
It is believed that a status request command packet , which was broadcast from a German gas company as a test for their newly installed network branch , found its way into the systems of the Austrian energy power control and monitoring network 
Once there , the message generated thousands of reply messages , which generated even more data packages , which in turn flooded the control network 
To stop this self-inflicted DDoS attack , part of the monitoring and control network had to be isolated and disconnected 
Fortunately the situation was resolved without any power outages 
In some cases the attacker tried to extort money from the energy companies , threatening them with further blackouts 
Fortunately the power plant was already offline due to maintenance and the installed secondary backup monitoring system was unaffected by the worm 
Nevertheless the incident raised safety concerns 
The attack was not too sophisticated as it was easily spotted 
A small modification of the PLC code instead would probably have gone unnoticed for a long time 
In 2001 an attack took place against California 's power distribution center , which controls the flow of electricity across California 
Due to apparently poor security configuration , the attacker was able to compromise two Web servers that were part of a developer network and penetrate further from there 
Fortunately the attackers were stopped before they managed to attack any systems which were tied into the transmission grid for the Western United States 
According to Russian officials , the largest natural gas extraction company in the country was successfully attacked in 2000 
Through this switchboard , the flow for individual gas pipelines could have been modified , which would easily have caused widespread disruption 
Aside from these incidents , there have also been a number of more serious and well-documented targeted attacks against the energy sector : The Stuxnet incident and its relatives Duqu , Flamer and Gauss are some of the most talked-about cases of targeted attacks 
The first recorded appearance of what we now call Stuxnet version 0.5 was in November 2007 
Since then , a handful of different versions have been found and analyzed 
Stuxnet 1.x is based on what is now known as the '' tilded '' platform ; whereas Stuxnet 0.5 is based on the Flamer framework 
The code segments and programming style differ , which indicates that two different programming teams were most likely responsible for the different branches of Stuxnet 
Thorough investigation into the mechanism and functions of this threat started in July 2010 
The most notable vulnerability is the Microsoft Windows Shortcut 'LNK/PIF ' Files Automatic File Execution Vulnerability ( CVE-2010-2568 ) , which allows it to auto-execute on USB drives 
This was most likely the first infection vector used by Stuxnet 
In the end , Stuxnet propagated further than its authors probably intended 
We have monitored more than 40,000 infected IP addresses in 155 countries 
Many of those systems are most likely just collateral damage and were not intended to be infected by the attackers 
For example multiple computers at Chevron were infected by Stuxnet , without any damage being done 
Stuxnet 's payload focused on PLCs , which are used to control different industrial components 
The target of the Stuxnet operation is believed to be a uranium enrichment facility in Iran 
Closing the valves at certain points in time would lead to an increase of pressure that could damage the equipment 
By speeding the centrifuges up and slowing them down repeatedly , the output quality could be spoiled and the centrifuges themselves could be damaged 
This minimized the collateral damage at other facilities and showed that the attackers had in-depth knowledge of the targeted uranium enrichment facilities 
Operation Night Dragon , which was uncovered in 2010 , is a typical example of global oil companies being targeted , but this time not with the aim of disruption in mind 
The attackers did not use any zero-day vulnerabilities during their attacks 
Rather they used publicly available tools for each individual job 
In August 2012 an extremely destructive cyberattack hit an estimated 30,000 computers at one of the largest oil producers of the world in Saudi Arabia 
The W32.Disttrack malware used in this attack , also known as Shamoon , consists of three components : a dropper , a wiper and a reporter module 
The wiper component is only activated when a hardcoded configuration date has been passed 
This enables a coordinated , '' time bomb '' scenario 
The malware does not contain any payload against ICS , like Stuxnet does for PLCs , and is not as sophisticated 
According to the company , no computer related with the production or distribution of oil was affected , since the operational network is separated and specially protected 
One group that claimed responsibility for the attack posted on Pastebin that it was an anti-oppression hacker group 
The attack was prompted by disappointment with some of the regimes in the Middle East , the group said 
True or not , this shows that it is not necessarily only state-sponsored attackers who are carrying out disruptive attacks 
Sabotage attacks usually fall into the orbit of hacktivists , who seek attention rather than profit 
Some sources reported that the attackers had help from insiders , which would explain the so far unclear infection vector 
Soon after this attack became known , a Qatari gas company was attacked in a similar way 
The attacks are simple to carry out 
They often follow the same pattern , starting with a reconnaissance phase to gather all publicly available information 
The last phase may also involve a disruption attack if the goal is sabotage 
For a more detailed analysis of the attack phases , see Appendix C. A spear phishing attack consists of an email with either a malicious attachment or a link to a malicious website 
Such emails are sent in bulk to a handful of key users 
These waves are often repeated till enough people fall for the bait and compromise their computers 
For analysis on the social engineering themes used , attack details and attachment types used , see Appendix A 
Some of the spear phishing campaigns are smaller in scale and are focused on specific targets 
For example , on January 1 , 2013 a global energy research company was targeted 
All receiving email addresses started with a letter between G and R , covering half of the alphabet 
Whether there was a second wave of emails using the other half of the alphabet or whether the attackers only got their hands on part of the address book remains unknown 
All emails had either the subject line '' 2013 , Obama QE4 ! Merry Christmas ! '' or '' 2013 , Obama QE4 ! '' 
It is common to see spear phishing attacks take place around holidays , as people are receiving more emails during these times and are less likely to perform due diligence while opening them 
The same family of dropper has been used in previous targeted attacks against other sectors , indicating that a group with multiple interests is behind the attacks 
A week later , on January 7 , 2013 , the group attacked the same company again 
Seventy emails were sent to 58 individuals using either '' 2012-13 NFL Playoffs Schedule '' or '' Re : 2012-13 NFL Playoffs Schedule '' as a subject line 
In this wave , the attackers used a similar AVP.dll to the one used before 
In some of the emails , an additional CHM file with an old exploit was used in an effort to maximize the chances of a successful infection 
After this second wave , the attack ceased 
A global oil company , with offices around the world , had been under continuous attack for some time , but in September 2012 we noticed an upsurge in activity , with 34 times more suspicious emails than on average 
This provided a clear indication that something suspicious was going on 
At the end of this wave of emails , a hotel chain , a rental car company and two financial institutions were also targeted by the same attacker 
This may have been an attempt to find further information that could be used in a future social engineering attack against the oil company 
In total , 136 email accounts at the oil company were targeted 
A regional sales manager in Greece received 412 emails over the 12 month period , with 155 different attachments 
A HR person in the same country received the second largest amount of emails with 90 in total 
Seventeen other people were targeted between 70 and 90 times , many in the same region 
The rest of the targeted people received less than five emails each , in what seems to have been an undirected spraying in the hope that at least some would fall for the bait 
Clearly the one person that received the highest volume of emails was deemed to be of high value to the attackers 
Possible explanations for the attack could be that a competitor wanted to know more about some upcoming deal or details on the oil field exploration , but this would be highly speculative 
Many of the emails came from the same country as the main targeted sales manager 
None of them linked to third party sites for drive-by downloads 
Of the attachments , 1,588 had a .exe extension 
Of those , 842 had a .pdf.exe extension 
The attackers did not use any zero-day exploits to drop a payload 
Other sub-domains at the same free host and DNS service have been used by other groups to spread malware in the past 
It is unknown if the attackers succeeded in their goal and if valuable information has been extracted 
The attacks did not completely disappear , but the email volume decreased significantly to only a few emails per week afterwards 
As with all targeted attacks , there are many different groups of attackers operating in this field 
These attacks can not be attributed to only one group or geographical region 
We have seen individuals , competitors , hacktivist groups and possible state sponsored agents carrying out attacks against energy companies 
Some of the attacks have been purely opportunistic , seeking any valuable information available 
Other campaigns look like they were planned over a lengthy period and carried out methodically with a clear goal in mind 
The attackers tend to go after valuable information , including maps of new gas fields or research on efficient photovoltaic generators 
This information can be of great value to competitors or nations that want to make progress in the same field 
Another motivation for attackers is to profit from the information stolen by blackmailing the company 
The same information can be used to carry out sabotage attacks designed to disrupt ICSs , as the energy sector is also a primary target for sabotage attacks which will not generate direct profit for the attacker 
A competitor might be interested in generating bad press and bad customer experience for a rival company , in order to win some new clients 
For example , in January 2013 a group claiming to be related to Anonymous posted access details for what they said were Israeli SCADA systems for power plants and other systems 
Meanwhile , '' Operation Save the Arctic '' targeted multiple oil companies around the globe in protest against drilling plans in the Arctic 
Disgruntled employees are also a source of attacks that should not be underestimated 
With their knowhow about internal critical processes and systems they often know how to inflict serious damage 
They may be able to perform system modifications that could go unnoticed for a long periods 
For all regular client computers , the well-established best practice guidelines apply 
These computers are often the first ones to be attacked 
Once compromised , the attacker will use these computers and try to explore deeper into internal networks 
Securing and hardening of deployed operating systems with a working strategy for patch deployment is important 
Reoccurring security awareness training can help users to identify social engineering attempts and prevent them from falling victim to them in the first place 
The company can perform penetration testing on Web and network applications but also on ICSs to identify and remedy any vulnerability 
For examples Web applications should be tested against SQL injection attacks 
This can also help confirm if applied polices are followed through , if the patch level is correct on all computers and if systems are compliant 
Companies can monitor the Internet for information about attacks in the same vertical and apply lessons learned where possible 
In addition , different layers of security products can help achieve better overall protection 
• Security Information and Event Manager system ( SIEM ) : Using a SIEM can help correlate all related alerts in one place 
This centralized view can be cross referenced with threat intelligence data to generate prioritization and an action plan 
Painting the bigger picture of the overall security state can reveal previously unnoticed attacks 
For example failed login attempts on internal servers could indicate a password breach 
This includes logging of critical systems and synchronization of time among multiple systems 
• Ingress and egress filtering : Filtering the network traffic with firewalls , content filters and IPS allows the control of data flows 
This can prevent attackers from reaching internal systems 
It is important to also monitor outbound traffic , as data exfiltration is a key point for cyberespionage 
It should be noted that with the increased use of cloud services and mobile devices , some traffic might never pass through the company 's gateways 
Where traffic blocking is too disruptive at least monitoring should be implemented 
• Data loss prevention ( DLP ) : DLP solutions can track the access and flow of critical information and prevent it from leaving the company or encrypt it automatically 
• Endpoint protection : Depending on the usage pattern of the computer , different solutions are available to protect the endpoint 
Antivirus solution with proactive detection methods like behavioral analysis and reputation scanning can prevent unknown malware from installing itself 
HIPS ( host based intrusion prevention systems ) , behavioral lockdown or whitelisting can protect computers from any kind of unwanted tampering without the need of constant updates 
• System protection : For non-standard IT systems , hardening can increase the security 
On industrial systems which are not often updated or that can not be updated , exploitation can be prevented with the help of lockdown solutions like Symantec Critical System Protection ( CSP ) 
Through policies , only trusted system applications are allowed to run 
ICS should be regularly checked and upgraded if new firmware exists 
Where this is not possible HIPS and behavioral lockdown tools can be used to secure computers 
• Email filtering : Proper email filtering can prevent many spear phishing attempts from reaching users 
They can help minimize the risk of an untrained user falling for social engineering tricks 
• Authentication : Some of the ICS contain hardcoded passwords and , wherever possible , these should be changed 
ICS frequently use weakly authenticated protocols that allow for impersonation attacks 
Where possible those authentication methods should be upgraded or at least closely monitored 
Strong authentication or PKI should be used where applicable 
Industrial control systems ( ICS ) should be specially protected and monitored 
The control system and control network should be secured 
Where possible , ICS should be separate from the Intranet 
Isolating these networks alone is often not enough to protect the control network , but it can make it more difficult for attackers to succeed 
For some systems it can make sense to have a plan to quickly disconnect or separate critical machines in the event of a detected cyberattack 
Cyberespionage campaigns and sabotage attacks are becoming increasingly common , with countless threat actors attempting to gain a foothold in some of the best protected organizations 
At this stage , roughly five targeted attacks per day are being mounted on firms in the energy sector 
These attacks have become increasingly sophisticated , although the capabilities and tactics used by these threat actors vary considerably 
In the second half of 2012 , the energy sector was the second most targeted with 16 percent of all the targeted attacks 
This strong increase was mainly due to a large scale attack against one global oil company 
In the first half of 2013 , the energy sector was ranked fifth with 7.6 percent of all attacks focused on this sector 
In general we have observed that attackers are becoming more efficient and focusing on smaller operations that attract less attention 
The attackers tend to go after valuable information – such as maps of a new gas field – but the sector is also a major target for sabotage attacks , which will not generate direct profit for the attacker 
Such disruptive attacks do already happen and may lead to large financial losses 
State sponsored agents , competitors , internal attackers or hacktivists are the most likely authors of such sabotage attacks 
Fortunately , there have not been many successful sabotage attacks against energy companies to date 
However , the increasing number of connected systems and centralized control for ICS systems means that the risk of attacks in the future will increase 
Energy and utility companies need to be aware of these risks and plan accordingly to protect their valuable information as well as their ICS or SCADA networks 
Social engineering is an essential part of spear phishing campaigns 
A cleverly chosen , enticing message may prompt the user into opening an attachment 
It is evident that most attackers are carefully selecting the themes that they use for their attacks 
Some groups use real news stories and copy the text directly from the newspaper websites 
Others try to appeal to personal hobbies in order to get the user 's attention 
In the energy sector the most commonly used theme for spear phishing emails was money related ( e.g 
'' Wage Data 2012 '' ) followed by sports related themes ( e.g 
'' 2012-13 NFL Playoffs Schedule '' ) 
In general any topic can be used in a social engineering attempt , which makes it even harder for regular users to spot the attacks 
Here are a few examples of subject lines used , listed by category : In the last six month of 2012 the average number of targeted attacks observed per day was 87 ( with 14 in the energy sector ) 
In the first six month of 2013 the average number decreased to 60 targeted attacks per day ( five in the energy sector ) 
The spike in August and September 2012 is mostly related to a large scale attack against a global oil company 
The increase in May 2013 was due to multiple attacks against financial services , public sector and IT service organizations 
The government and public sector was quantitatively the most attacked sector , with 25.4 percent of all targeted attacks falling in this sector for the last half of 2012 and 24 percent for the first half of 2013 
The energy sector accounted for 7.6 percent of all targeted attacks , making it the fifth most targeted sector in the first six month of 2013 
This was a big decrease from 16.3 percent of all attacks in the last half of 2012 , when it was the second most attacked sector 
This spike in 2012 is mainly due to a large attack campaign against a global oil company which took place in September 2012 
On average we saw 18.6 mail accounts being attacked for any given target company in the last half of 2012 ( 60.7 in the energy sector ) and 5.6 email accounts in the first half of 2013 ( 10 in the energy sector ) 
Overall , we see a trend of the attacker conducting more focused attacks against fewer individuals 
This generates less noise and the risk of getting noticed or discovered is smaller 
These emails are sent in small bursts and then repeated against a changing target space till enough computers are compromised 
Half of all the attachments analyzed used an extension that would run directly when double clicked 
This old method is still the most common scheme used 
Of all attachments analyzed , 38 percent were .exe and 12 percent were .src files 
In total only 6 percent used double extensions like .pdf.exe to fool the user 
It should also be noted that 23 percent were Microsoft Word documents using some exploit to execute custom code on the computer 
There were also some more exotic extensions used like AutoIt scripts ( .au3 ) and ZX-Edit files ( .zed ) , but these are the exception rather than the rule 
It might be that the attackers tried to bypass some email filtering software by experimenting with different attachment types 
Sometimes even older exploits like the Microsoft DirectX DirectShow Length Record Remote Code Execution Vulnerability ( CVE- 2009-1539 ) in .mp4 files are still occasionally used 
This indicates that either not all attackers have the knowhow to use newer exploits that are publicly available or they speculate that the target has not patched all computers 
Some of the attackers do not seem to be too sophisticated 
For example they used '' www 
[ COMPANY-NAME ] .com.exe '' as an attachment name , clearly missing that the '' .com '' at the end would be sufficient to run it and the additional '' .exe '' was not needed 
To identify a series of targeted attacks that are likely performed by the same individuals , we have used a novel attack attribution methodology named TRIAGE 
Developed by Symantec Research Labs , TRIAGE is data mining software that relies on multi-criteria decision analysis and intelligent data fusion algorithms to reliably link different attacks to the same source 
This framework has been developed in order to automate cyberintelligence tasks and reduce the time needed to get insights into organized cybercrime activities 
By enabling rapid analysis of large security data sets , Symantec analysts can then quickly and more efficiently attribute various waves of cyberattacks to a specific attack campaign likely run by the same individuals 
The TRIAGE framework was recently enhanced with novel visualizations thanks to VIS-SENSE , a European research project aiming at developing visual analytics technologies for network security applications 
Since its original conception , TRIAGE has been successfully used to analyze the behavior of cybercriminals involved in various types of Internet attack activities , such as rogue antivirus websites , spam botnets operations , scam campaigns and targeted attacks performed via spear phishing emails 
As with any other targeted attacks , attacks against the energy sector often follow the same pattern 
It can be broken down in different phases of attack 
It should be noted that we have seen attackers modify their behavior and exceptions from the norm and this is possible especially if the target company has special circumstances or security measures in place 
During this phase the attacker tries to learn as much as possible about the targeted organization 
Information sources often include social networks , job posting sites and press releases 
This enables the attacker to learn the contact details of possible target individuals as well as context that can be used in social engineering scenarios 
The attacker will often create a list of implemented security software used at the targeted company from whatever information is available 
These investigations often start completely passively without any direct contact with the company , since there are many data sources publicly available 
Subsequently the attacker can use more interaction if needed 
Some attackers go through all the effort of creating a fake social media account and befriending key employees 
After a period of small talk , to create a false sense of security , such a connection can then be used to pass on an infected document or find out about some key information 
Depending on the targeted location , physical reconnaissance and eavesdropping may also be used 
The actual break-in occurs during this phase 
There are two main avenues of attack 
For example the Hidden Lynx group stopped using a zero-day vulnerability in a large watering hole attack after Microsoft released details on the vulnerability 
This helped to cover their activities and avoid unwanted attention 
For more difficult targets , man-in-the-middle attacks can be used 
Due to the complexity of such an attack , they are rarely used 
Depending on the skills of the attacker and the time available , the attacker might also attack systems at the perimeter , such as Web servers , and try to break in from there 
The malware used is not always sophisticated 
In these cases the person behind the malware orchestrating the commands is what makes the difference between a targeted attack and a broad generic infection 
Having said this , on very unique targets , we will often see the use of a specifically designed piece malware , such as in the case of Stuxnet 
Depending on the protection measures implemented by the target , the attackers may also digitally sign their malware creation 
In the past there have been quite a few cases where code signing certificates were stolen and later misused to sign malware in order to pass it unnoticed to high value targets 
Once the attacker has a foothold on one system , the next step is to create a plan for lateral movement through the network until the interesting data is found 
With watering hole attacks especially , it can happen that computers that were not targeted get infected 
Infected computers need to be assessed by the attacker and , if necessary , removed to keep the profile , and with that the chances of exposure , low 
Any account detail can be useful to them 
Domain administrator passwords are of especially high value , as they can help greatly in moving further through the Intranet 
Once new systems are identified the attacker will attempt to hop onto them as well 
This can either be proprietary systems , such as the case of Trojan.Jokra in South Korea , or OS-specific , such as hijacking Windows Update , in the case of Flamer 
Especially in cases of wiping attacks , such Trojan.Jokra , this is a very efficient way to disrupt as many computers as possible 
The capture and exfiltration phases are not always present 
If the sole goal of the attackers is to cause a disruption they may directly jump to a destructive payload 
However , in most cases information is extracted first , which in turn allows the sabotage to be constructed more efficiently at a later phase 
This can be done with different levels of sophistication 
In addition to this , the amount of data sent and the timing can be chosen in a smart way 
In some instances the infected computer might not have a direct connection to the Internet 
This is when any destructive payload is launched 
If the attackers are only after information this phase might not happen at all 
The targets and the goals for disruption attacks can be very different , there is no such thing as one- size-fits-all for disruption attacks 
For example , Stuxnet was tailored to attack a specific uranium enrichment facility and would not work against a different target 
In recent times , wiper Trojans have been popular in attacks against the energy sector 
This can happen on any operating systems and we have seen scripts for different UNIX flavors being used as well 
Depending on the disaster recovery plan in place , these computers can be remotely recovered 
However , there may still be an outage while the computers are being restored 
A personal note from Cylance , CEO Stuart McClure On February 24 , 1989 , United Flight 811 left Honolulu , Hawaii , on its way to Auckland , New Zealand , with 364 souls on board 
Somewhere between 23,000 and 24,000 feet an enormous explosion ejected nine passengers into the dark void over the Pacific Ocean 
This aviation disaster was later determined to have been caused by a simple design flaw combined with the lack of corrective action 
Boeing and the FAA had known about this problem for over one year prior to the accident 
The result : nine people lost their lives 
The other 337 passengers plus 18 crew members who survived , live with the memory every day ; all of it due to a highly preventable design flaw 
As a 19-year-old young adult , I was grateful to have survived but I had no idea how that single event would impact my future in such a profound way 
Much of my passion for cybersecurity can be directly attributed to that fateful day 
The United Flight 811 accident proves just how important it is to detect flaws before tragedy strikes 
Preventable disasters like this are what motivates the Cylance team to create a safer world 
We do everything we can to uncover the flaws in technologies before they damage the physical or cyber world 
Our mission is simple : to protect the world 
This report is an attempt to deliver on that mission 
After tracking hackers both personally and professionally for more than 26 years , there is no doubt in my mind that the release of the information contained in the Operation Cleaver report is vital to the security of the world's critical infrastructure 
The focus of the Operation Cleaver report is on one particular Iranian team we 've dubbed Tarh Andishan , the infrastructure they utilize , as well as their tactics , techniques and procedures 
Roughly translated , '' Tarh Andishan '' means '' thinkers '' or '' innovators '' 
This team displays an evolved skillset and uses a complex infrastructure to perform attacks of espionage , theft , and the potential destruction of control systems and networks 
While our investigation is ongoing , and we presently have limited visibility inside many of the compromised networks , Cylance observed Tarh Andishan actively targeting , attacking , and compromising more than 50 victims since at least 2012 
Cylance is committed to responsible disclosure and has refrained from exaggeration and embellishment in this report , limiting our content to only that which can be definitively confirmed 
However , we have speculated on the possible motivations behind these attacks , given our deep knowledge and understanding of the cyber landscape 
We have made every effort to notify all affected entities prior to publishing this report 
Additionally , all personally identifiable information about the members of Operation Cleaver has been withheld 
We do n't care who the adversary is , where they work or reside , who they 're dating or what party photos they upload to Facebook – all we care about is preventing campaigns like Operation Cleaver from negatively affecting the real world 
Iran is the new China 
The group is believed to work from Tehran , Iran , although auxiliary team members were identified in other locations including the Netherlands , Canada , and the UK 
The group successfully leveraged both publicly available , and customized tools to attack and compromise targets around the globe 
The targets include military , oil and gas , energy and utilities , transportation , airlines , airports , hospitals , telecommunications , technology , education , aerospace , Defense Industrial Base ( DIB ) , chemical companies , and governments 
During intense intelligence gathering over the last 24 months , we observed the technical capabilities of the Operation Cleaver team rapidly evolve faster than any previously observed Iranian effort 
As Iran 's cyber warfare capabilities continue to morph , the probability of an attack that could impact the physical world at a national or global level is rapidly increasing 
Their capabilities have advanced beyond simple website defacements , Distributed Denial of Service ( DDoS ) attacks , and Hacking Exposed style techniques 
With minimal separation between private companies and the Iranian government , their modus operandi seems clear : blur the line between legitimate engineering companies and state- sponsored cyber hacking teams to establish a foothold in the world 's critical infrastructure 
Iran 's rising expertise , along with their choice of victims , has compelled us to release this report sooner than we would have liked in order to expose Operation Cleaver to the world 
The evidence and indicators of compromise we provide in this report will allow potentially unaware victims to detect and eliminate Cleaver 's incursions into their networks 
Iran has been severely impacted by debilitating and extremely advanced malware campaigns since at least 2009 
These campaigns have targeted Iran's nuclear program , and oil and gas operations 
Hacking campaigns sourced out of Iran are nothing new 
Since the early 2000 's , the information security industry as a whole has tracked teams like the Iranian Cyber Army , which mainly focuses on patriotic hacking ( website defacements ) 
After the release of Stuxnet , Iran 's motivations appear to have shifted 
Retaliation for Stuxnet began almost immediately in 2011 with campaigns like the certificate compromises of Comodo and DigiNotar 
These attacks served as a warning , showcasing the rapid evolution of Iran 's hacking skills 
A major retaliation came in the form of 2012 's Shamoon campaign , which impacted RasGas and Saudi Aramco 
It 's estimated that Shamoon impacted over 30,000 computer endpoints and cost the affected companies tens-of-thousands of hours recovering from the attacks 
The direct financial impact from this retaliation and amount of downtime experienced were staggering 
Shamoon was truly a watershed event for security defenders 
It was the first glimpse into the real capabillity and intention of Iranian cyber operations 
We see the same motivation and intent here in Operation Cleaver : establishing a beachhead for cyber sabotage 
We saw further Iranian backlash in late 2012 and early 2013 in the form of Operation Ababil's Distributed Denial of Service ( DDoS ) attacks against US banks 
Yet more backlash was witnessed with FireEye's exposure of Operation Saffron Rose , an espionage campaign executed by the Ajax Security Team in 2014 
In June 2013 , Israeli Prime Minister Benjamin Netanyahu accused Iran of carrying out '' non-stop '' attacks on '' [ Israel 's ] vital national systems '' including '' water , power and banking '' 
The following September of 2013 , the Wall Street Journal accused Iran of hacking into unclassified U.S. Navy computers in San Diego 's NMCI ( Navy Marine Corp Intranet ) ,5 which we can confirm was part of Operation Cleaver 
While previously reported operations attributed to Iran have largely focused on Defense Industrial Base ( DIB ) companies , the United States Federal Government , or targets in Middle Eastern countries , Operation Cleaver has instead focused on a wide array of targets , including energy producers and utilities , commercial airlines and airports , military intelligence , aerospace , hospitals , and even universities – with only ten of the targets based in the United States 
Such broad targeting demonstrates to the world that Iran is no longer content to retaliate against the US and Israel alone 
They have bigger intentions : to position themselves to impact critical infrastructure globally 
The string cleaver is found several times in a variety of custom software used in Operation Cleaver , including : We believe our visibility into this campaign represents only a fraction of Operation Cleaver 's full scope 
We believe that if the operation is left to continue unabated , it is only a matter of time before the world 's physical safety is impacted by it 
While the disclosure of this information will be a detriment to our ability to track the activity of this group , it will allow the security industry as a whole to defend against this threat 
As such , we are exposing this cyber campaign early in an attempt to minimize additional real-world impact and prevent further victimization 
• Persian hacker names are used throughout the campaign including : Salman Ghazikhani , Bahman Mohebbi , Kaj , Parviz , Alireza , and numerous others 
• Numerous domains used in the campaign were registered in Iran 
• Infrastructure leveraged in the attack was registered in Iran to the corporate entity Tarh Andishan , which translates to '' invention '' or '' innovation '' in Farsi 
• Source netblocks and ASNs are registered to Iran 
• Hacker tools warn when their external IP address traces back to Iran 
• The infrastructure is hosted through Netafraz.com , an Iranian provider out of Isfahan , Iran 
• The infrastructure utilized in the campaign is too significant to be a lone individual or a small group 
We believe this work was sponsored by Iran 
• US Military targets including NMCI in October 2013 
Confirmed targeting of global government entities 
• Networks and systems targeted in critical industries like energy and utilities , oil and gas , and chemical companies 
• Various global telecommunications , technology , healthcare , aerospace , and defense companies were breached as part of the operation 
• The ability to build customized tools to compromise any target they choose 
• Over the past two years , Cylance has collected over 8GB of data including over 80,000 files of exfiltrated data , hacker tools , victim logs , and highly sensitive reconnaissance data 
• Data from sinkholed command and control servers has allowed us to track this active campaign 
• Cylance is releasing more than 150 IOCs and samples associated with the Cleaver campaign to empower the security community to detect existing compromises in their own organizations , as well as potentially block future attacks from these teams 
• This campaign continues Iran 's retaliation for Stuxnet , Duqu , and Flame 
• This is a state-sponsored campaign 
• There is a possibility that this campaign could affect airline passenger safety 
• This campaign 's intentions may be to damage Industrial Control Systems ( ICS ) , Supervisory Control and Data Acquisition ( SCADA ) systems , and impact Critical Infrastructure and Key Resources ( CIKR ) 
• This campaign could be a way to demonstrate Iran 's cyber capabilities for additional geopolitical leverage , due to the breadth and depth of their global targets 
• There is an intense focus on CIKR companies in South Korea , which could give Iran additional clout in their burgeoning partnership with North Korea 
In September 2012 , Iran signed an extensive agreement for technology cooperation agreement with North Korea , which would allow for collaboration on various efforts including IT and security 
• Iran is recruiting from within the universities and potentially using 'hackers for hire ' 
The Cleaver team targets some of the most sensitive global critical infrastructure companies in the world , including military , oil and gas , airlines , airports , energy producers , utilities , transportation , healthcare , telecommunications , technology , manufacturing , education , aerospace , Defense Industrial Base ( DIB ) , chemical companies and governments 
Countries impacted include Canada , China , England , France , Germany , India , Israel , Kuwait , Mexico , Pakistan , Qatar , Saudi Arabia , South Korea , Turkey , United Arab Emirates , and the US 
Unlike Stuxnet , no exotic exploitations ( such as 0-days ) were observed 
We discovered over 50 victims in our investigation , distributed around the globe 
Ten of these victims are headquartered in the US and include a major airline , a medical university , an energy company specializing in natural gas production , an automobile manufacturer , a large defense contractor , and a major military installation 
The four targets in Israel and the five targets in Pakistan are comprised of education , aerospace , airports , airlines , healthcare and technology 
Further victims were identified in numerous Middle Eastern countries as well as ones in Northern Europe including the UK , France , and Germany 
Central America was not immune either with a large oil and gas company on the list 
In fact , oil and gas was a particular focal point for the Cleaver team , going after no less than nine of these companies around the world 
Universities were targeted in the US , India , Israel , and South Korea 
They had a penchant for pictures , passports , and any specifc identifying information 
Perhaps the most bone-chilling evidence we collected in this campaign was the targeting and compromise of transportation networks and systems such as airlines and airports in South Korea , Saudi Arabia and Pakistan 
We were witnessed a shocking amount of access into the deepest parts of these companies and the airports in which they operate 
Despite today 's trend toward attacker attribution , we believe it offers little real benefit to the day-to-day cyber defender 
However , in this report we offer our observations on the sources of Operation Cleaver in order to benefit those that rely on attribution such as Law Enforcement 
Operation Cleaver is believed to consist of at least 20 hackers and developers , collaborating on projects and missions to support Iranian interests 
Many of the targets were predominately English-speaking and a majority of the team members were capable of reading and writing in English 
We present evidence that this team is operating , at least in part , out of Iran and in the interests of Iran 
The skills and behavior of the Operation Cleaver teams are consistent with , and in one case surpasses , Iran 's cyber capabilities as we know them today 
For a complete list of IPs and domains related to this campaign , please refer to the Indicators of Compromise section 
This IP address was also observed in multiple software configurations 
This particular net block was used over an extended period of time , indicating these were under the Cleaver team's physical control 
Additionally , prior netblocks used by the same team demonstrated to us that this was n't simply a case of proxying or '' island hopping '' 
For more information see the Tarh Andishan section of this report 
While this IP was this registered in the Netherlands , we believe they used Softlayer 's Citrix demo environment to launch these attacks which is consistent with proxying or '' island hopping '' 
A number of Cleaver 's attack methods require a persistent server 
In many cases , these servers were referenced by domain names 
The following malicious domains are operated by this organization and are grouped by the registrant 's email address 
As is typical with malicious domains , the Whois data for most of these domains contained falsified information 
We managed to obtain a large collection of the internally developed tools used by the Cleaver team , many of which were developed by its members 
Due to operational security failures , these tools contain information that provided us insight into their organization and operations 
In the tool named Shell Creator 2 , there are three main components 
The web shell is accessible by the shell client directly 
The shell client is a portion of Shell Creator 2 that was not designed to be run on a compromised computer 
The shell client , which is developed in Java and is easily decompiled , is a simple interface with a feature to protect the operator from making a critical mistake 
The country of origin is then shown to the user , to inform them of what country it appears they are connecting from 
The assumed purpose of this feature is to ensure that a proper proxy is in use , and the real origin of the attacker is not revealed 
After decompiling the shell client , we found the following code segment controlling the display of this IP location information 
This code handles the XML response from freegeoip.net , and displays the information as different colors based on different attributes 
For instance , if the string '' ERROR '' is in the response , the text is displayed with the color magenta 
If the string IRAN is in the response , the text is displayed with the color red 
It should be noted that no other country name contains the substring IRAN 
This is done with Windows Credential Editor ( WCE ) and Mimikatz in combination with PsExec 
Different versions of this malware contain ASCII art which names the authoring group as Zhoupin ( in '' leetspeak '' as '' Zh0up ! n '' ) 
For more information on Net Crawler , see the Tactics , Techniques and Procedures section 
TinyZBot is a bot written in C # and developed by the Cleaver team 
It is the longest developed malware family discovered by this group , and has been used in campaigns for close to two years 
How it operates can vary greatly from version to version 
For a detailed technical analysis of TinyZBot , see the Tactics , Techniques and Procedures section 
As TinyZBot is developed in C # , many versions can be decompiled to code very similar to their originals , including names of namespaces 
We obtained multiple versions from which we were able to recover many of the original names of variables and namespaces 
In a number of these samples , the primary namespace for TinyZBot is named ZhoupinCleaver 
In every version of TinyZBot that is not obfuscated , there is a code base referred to as Cleaver 
This code base is also shared in other malware developed by this organization , such as Csext 
PrivEsc is a blatant plagiarism of an existing exploit for Microsoft Windows released in January 2010 called MS10-015 , '' Vulnerabilities in Windows Kernel Could Allow Escalation of Privilege '' , popularly known as the KiTrap0D exploit which was released publicly 
The Cleaver team clearly modified the source code and compiled a new version 
The only detectable modification was to change the original author 's name to instead display the following : Zhopin Exploit Team This is not the only case of this team relabeling others ' work as their own 
Logger module is a component of the PVZ ( PVZ is shorthand for Parviz , one of the members of the Cleaver team ) bot tool chain 
The logger module binary 's file description value is the following : Roughly translated from Persian , this text says : This text could potentially be a note intended to stay internal , or could be an attempt to persuade an unsuspecting victim to assume the file is not malicious 
The Product Name value is GOOD FILE 
For more information on the PVZ bot tool chain , see the Tactics , Techniques , and Procedures section 
CCProxy is a publicly available proxy server for Windows , which can handle a variety of protocols 
We do not believe that this organization was involved in the development or modification of CCProxy , but they have been observed using it 
We recovered a CCProxy configuration , which exposed various operational details 
The configuration allowed for remote connections , limited by a username as well as a limited IP range 
The username was User-001 , which is the default value 
The limited IP range covered one IP : 78.109.194.114 
This IP address is located in Iran , and is owned by Tarh Andishan 
The configuration also indicates which address the CCProxy server should listen on for incoming connections such as web ( 80 ) and mail ( 25 ) 
Log output from the network port scanning application NMAP was recovered from a staging server 
The header of this NMAP log indicates that the computer used to run nbrute/nmap was set to Iran Daylight Time at the time of execution 
With no known victims located in Iran , it is likely that this was executed on an attacker 's computer , and not on a victim 's computer 
A configuration file for a Squid proxy server was recovered 
Figure 12 : Squid configuration file showing the use of Tarh Andishan 's IP address 
The net range of 78.109.194.114/28 was inserted into the allowed local networks with an RFC comment appended in order to make it look like it was part of the default configuration 
It is likely this is the same reason a /28 net range was used , in order to not look like it was intended to only allow one IP 
This would give the same access to resources accessible from the Squid proxy server to this Iranian IP address 
Tarh Andishan is listed as the registrant for a number of small net blocks based upon the email address tarh.andishan ( at ) yahoo.com 
The net blocks appear to rotate over time and registrant information is altered to accommodate ongoing operations and avoid potential public exposure 
The networks are included below as well as the last time that net block was observed as active 
There are many seemingly legitimate Tarh Andishan related companies inside Tehran , but strong connections to Iranian backing have been difficult to prove definitively 
'' Tarh Andishan '' is often translated as '' Thinkers '' , '' Innovators '' and '' Inventors '' 
The net blocks above have strong associations with state-owned oil and gas companies 
These companies have current and former employees who are ICS experts 
Tarh Andishan has been suspected in the past of launching attacks in the interest of Iran 
In one of IranRedLine.org 's blog posts , the author speculates on Tarh Andishan 's involvement with the Iranian government by showing close proximity to SPND , the Organization of Defensive Innovation and Research ; however , the phone number listed under the registrant contact information has yet to be completely validated 
During this investigation , we were able to compile a considerable amount of information on some of the members of this organization 
The following profiles were built from reverse engineering , code analysis , open source intelligence , incident response and forensics work 
Personally identifiable information about these members is not being shared publicly as it could endanger their lives and would be irresponsible 
Parviz is a developer who worked on a variety of projects , and was primarily active in 2013 
His development skillset is based around his ability to develop in C/C++ 
He has been observed using Visual Studio 2010 , and his tools are written exclusively for Windows 
Some of his tools were found to be packed with ASPack 
Parviz is the primary developer of the PVZ bot and multiple parts of its tool chain 
Parviz is likely associated with the PVZ bot as his name in hardcoded into the PDB file paths 
Nesha is one of the offensive members of this organization 
A copy of an MS08-067 exploit developed in Python was recovered in which Nesha shamelessly replaced the original author 's name with his own 
Nesha 's passwords very commonly include own handle 
His passwords were frequently stored as hashes in backdoors , but common hash cracking methods were able to recover the plaintext versions 
His observed password use is as follows : Cylance observed Nesha participating in compromises involving the following techniques : Nesha has additionally been identified using a variety of internally developed tools as well as the following publicly available tools : Alireza appears to be one of the senior developers of this organization 
His tools are commonly developed in C++ , Java , and C # ( desktop and ASPX ) 
Alireza 's code appears to be reused internally on projects such as TinyZBot 
Alireza appears to be using a version control system for his code , and it is likely that others are using the same system 
Based on the paths , the version control system in use is likely Apache 's Subversion 
Use of a version control system is indicative of code sharing , but the use of an older system like Subversion , along with other evidence , suggests there is not a large amount of collaboration on projects and likely one developer working on each project at a time 
This is not behavior typical of a professional development team 
Alireza 's C # tools include the following techniques : Alireza 's Java tools include the following techniques : Alireza 's C++ tools include the following techniques : kaJ is a .NET developer , and has only been observed working in C # 
He has less English language proficiency than others in the organization , and likely has a supplemental role during compromises 
He has been observed developing tools which cater to specific challenges in a compromise 
His notable project was named Net Crawler , and a technical analysis of this tool can be found in the Tactics , Techniques and Procedures section 
Thanks to a recovered test configuration for Net Crawler , we were able to determine that kaJ 's development computer has the name dev-castle , where he has the username kaJ and the password oaolrJ @ vad 
kaJ is believed to be the creator of the Zhoupin ASCII art displayed in Net Crawler 
kaJ 's projects include the following techniques 
Jimbp is a .NET developer with minimal experience 
His projects appear to be supplemental to TinyZBot and are very simplistic 
It is believed he is the developer of the project Binder1 
This project was a simple malware binder which required manual configuration when compiling 
His other work included creating a new service wrapper for TinyZBot 
Of course many associated Iranian hacker teams have been identified in public and private security circles 
Some of the teams publicly known today include Iranian Cyber Army , Ashiyane , Islamic Cyber Resistance Group , Izz ad-Din al-Qassam Cyber Fighters , Parastoo , Shabgard , Iran Black Hats and many others 
However , even though the TTPs of the Cleaver team have some overlap to techniques used by Iranian Cyber Army ( botnets ) , Ashiyane ( SQL injection ) and Syrian Electronic Army ( phishing and RATs ) , we believe this is largely the work of a new team 
Some connections to Ashiyane were discovered in our investigations including a reference to hussein1363 , who had prior ties to the hacker group 
Additional connections between team members and individuals exist but are predominantly speculative and have only been shared with law enforcement 
Ultimately we believe the Cleaver team is a mix of existing team members and new recruits pulled from the universities in Iran 
The Cleaver campaign used a variety of methods in multiple stages of attacks 
In this section we'll cover the commonly observed methods during different stages of the attack 
The initial compromise gets the attackers their first foothold into the target network 
Once the ability to execute arbitrary code has been established , an attacker 's job becomes quite a bit easier 
Since the vector of initial compromise is usually determined by what is vulnerable on the target , we 'll cover just a few of the techniques we 've seen Operation Cleaver use to initiate the compromise 
It is made possible by a lack of input sanitization by the vulnerable application before supplying that input into a SQL database query 
Operation Cleaver has employed this technique numerous times across different organizations 
The domain EasyResumeCreatorPro.com was registered and a website setup which was a direct copy of a legitimate website at winresume.com 
This is how the original site looked : That 's not all they copied 
A binder is an application , which combines two executables ( desired software and malware ) into a single executable 
This attack evolved to appear more legitimate 
The attackers made the victims feel like they had a pending job opportunity at the industrial conglomerate Teledyne 
These domains included other companies as they tried to hit a wider audience 
Once all the forms are filled out , the user goes to the submission form 
This method is particularly effective not only because of its level of deception , but even if the victim suspects that they are infected with malware , they are not as likely to speak up about it , as they would need to explain why they were submitting a job application for another company 
This team did not utilize any novel methods of privilege escalation , but they were observed using a variety of publicly known exploits 
This vulnerability and the corresponding exploit were discovered and developed in 2010 
The plagiarized version used in Operation Cleaver was compiled in May 2013 , with a slight modification to the public source code 
This modification changed the author 's details to Zhopin Exploit Team 
Two of these tools used by Cleaver are Mimikatz and Windows Credential Editor 
These applications are zhMimikatz and MimikatzWrapper 
These applications store multiple versions of Mimikatz in their resources 
This technique is uncommon in malware and shows the advanced skillset of the Cleaver team 
Both tools were developed in C # 
In the following examples , the computer name is TheComputerName , the username of the logged in user is TheUser , and that user 's password is ThePassword 
At the time of execution , the system only has its own credentials available and no cached network credentials 
Output from MimikatzWrapper is essentially the same as zhMimikatz , despite being a different Visual Studio project 
It has the ability to do this with both Windows Credential Editor and Mimikatz 
Any credentials found are reported back to the original infection 
The following is a sample of some of the recovered results of Net Crawler executing on a live network : A more in depth analysis of Net Crawler , as part of the A Study in Bots series , will be available on Cylance 's blog 
This vulnerability has been patched since October 2008 , but many networks have failed to update their systems even to this day 
Operation Cleaver used a plagiarized version of a publicly available exploit for this vulnerability developed in Python 
Someone in the Cleaver team ( presumed to be Nesha ) modified the exploit to read '' By Nesha '' 
It makes use of WinPcap and is developed in C. Compared to some other publicly available ARP cache poisoning utilities , Jasus is poorly developed and without many useful features 
Cain & Abel is a publicly available toolkit , which covers a wide range of functionality that assists attackers once they have compromised a node on a network 
This is a versatile technique as it does not require any additional software which could be detected 
NetCat is a network tool which has many valid purposes but can also be used for malicious purposes 
NetCat 's network communications are in plaintext , and could be viewed by an egress filter looking to block the exfiltration of sensitive information 
The use of NetCat was later replaced with zhCat 
zhCat is a tool developed by the Operation Cleaver team which operates similarly to NetCat 
The command line help ( of a particular version ) shows the following options : Multiple obfuscation/encryption methods are available 
The –h argument enables HTTP mode 
For instance , if the attackers set up a zhCat instance listening on port 1000 on 192.168.116.128 in HTTP mode , the client instance of zhCat would use the following command : The server instance would use the following command : When we run both of these , we can send information just by typing it into the terminal of the running application 
Information can be supplied by standard input 
Note : research into ebizmba.com did not turn up any additional evidence of being involved with the development of zhCat 
These keys are stored inside zhCat 
PLink is one of the many utilities provided in the PuTTY ( SSH ) suite , which has many benign purposes 
It is capable of communicating over various protocols , the most notable being SSH 
The SSH protocol is a heavily utilized encrypted protocol , most commonly used for remote administration of UNIX based operating systems 
PLink is designed to implement some of the SSH functions related to forwarding traffic as well as other functionality 
The known recipient addresses of this information were testmail00001 ( at ) yahoo.com and TerafficAnalyzer ( at ) yahoo 
com 
In order to deceive anyone reading these emails , they made them appear to be a spam message that most would not think twice about 
For more information about TinyZBot , see the Persistence section 
This bot is the longest developed malware we have analyzed from this organization 
The earliest known version was compiled in January 2013 and we continued to see new versions being created actively 
TinyZBot was developed with the clear intention of targeted campaigns 
The name TinyZBot is assumed to be referring to this project as a less versatile version of the ZeuS botnet , although it does not exhibit the major browser injection features of ZeuS 
To be clear , TinyZBot shares no code with ZeuS or its variants , and is developed in a different programming language 
The majority of the code in TinyZBot was created by Cleaver 
TinyZBot supports a wide array of features that continually evolved over time 
For the evolution of features , see the History section 
Potential reasons for using SOAP are : 1 
SOAP-based communications are simple to implement in C # 
2 
As part of SOAP communications , a URI is specified 
This is internal to the sub-protocol , and does not necessarily reflect the URI of the host running the SOAP server ( ASMX file ) 
In the case of TinyZBot , and many examples for developing SOAP applications , this URI is tempuri.org 
The result of this is a cryptographically hashed version of the server time ( which must be obtained through a SOAP query ) , the TinyZBot 's GUID , and the TinyZBot 's AppUsageID ( campaign identifier ) 
The server time lookup query invokes the SOAP command GetServerTime 
The command file downloaded in this example is as follows : The first line is a timestamp of the command 
The TinyZBot command parser ignores it 
There are additional SOAP commands , but they will not be covered in detail 
The following is a list of all the SOAP commands : CheckFileMD5 , GetFile , GetFileList , GetServerTime , UploadFile 
An additional method was used for earlier versions 
Many of the images identified were of the popular Lebanese singer and actress Haifa Wehbe 
The earliest known version on TinyZBot was compiled on January 27 , 2013 
This early version had very little functionality 
The sender email address was dyanachear ( at ) beyondsys.com and emails were destined for testmail00001 ( at ) yahoo.com 
The following iteration compiled on March 12 , 2013 , only contained minor bug fixes 
The next version was compiled on April 24 , 2013 
This version starts to look more like an average bot 
This new command and control protocol allowed for the addition of quite a few other features 
The SOAP API used a dynamic password mechanism , which required the computation of a simple key in order to access certain parts of the API 
There were also some changes , which looked to be bug fixes , such as limiting the number of times sending an email could fail 
On May 14 , 2013 , we noticed a change which assisted in the identification of active targets 
At this time , the AppUsageId was total0 , but later we observed names , which aligned with active targets 
On June 17 , 2013 , there was an addition that allowed for the loading of configuration data from the PE 's resources 
At this time , it was limited to the exfiltration email address 
This version was not obfuscated with SmartAssembly We do not see a new version of TinyZBot until June 7 , 2014 
There are quite a few notable improvements , but nowhere near enough to indicate consistent development on the project for a year 
A new string encryption class is added , but the code was copied and pasted from a Microsoft example 
The emailing features were removed , but the classes which previously contained them were still present but empty 
Many more options were enabled to be loaded from PE resources 
The ability to add PE resources was added 
Another version was compiled on June 7 , 2014 , with no feature difference 
On June 17 , 2014 , we see2the first instance of Binder1 , which is aptly named , as it is a binder 
The legitimate application used in this version of Binder1 was compiled on August 22 , 2013 , and is a self-extracting archive of desktop wallpapers , including an image from the game Mirror's Edge 
The TinyZBot included was the version compiled on June 7 , 2014 
On August 2 , 2014 , we see another version without SmartAssembly obfuscation 
Three items were compiled on August 18 , 2014 
Two of them are TinyZBot binaries , which contain a minor key logging bug fix 
The third is a new Binder1 instance , which contains one of the TinyZBot instances compiled that day 
The legitimate application included in this binder is called Easyresumecreator and is a legitimate application named EasyRésuméCreatorPro 
This version targeted a major Saudi Arabian oil company 
From August 23 to August 26 , 2014 , new versions of TinyZBot were compiled with the AppUsageIds targeting major oil and gas companies in Qatar and Kuwait , Ministries of Foreign Affairs in the Persian Gulf , and a major airline holding company in UAE 
These versions of TinyZBot moved towards a more modular architecture where each component was in its own .NET assembly 
All of these were included in their own Binder1 instance , which also dropped Easyresumecreator 
There also seem to be improved software engineering practices in many locations 
On August 25 , 2014 , the version compiled on August 18 was submitted to VirusTotal in a ZIP archive located at http : //dl.doosan-job ( dot ) com/cv/EasyResumeCreator- v2.0.zip 
On September 9 , 2014 , a ZIP file containing TinyZBot and a configuration targeting a major US university with its AppUsageId was created 
This was discovered on an anonymous FTP server in the same IP range as dl.doosan-job ( dot ) com along with other malware 
From September 11 through September 17 , 2014 , some TinyZBot components were compiled , along with a new dropper 
When executed , the user is prompted to enter personal information , and at the end is given a button to submit the résumé to Teledyne , although nothing is actually submitted 
The AppUsageIds for these versions target a major US-based university as well as an Israeli aerospace company 
The service runs with the name Network Connectivity Manager 
TinyZBot , as well as some other tools ( Csext , Net Crawler ) initially would not run without a command line parameter set 
This command line parameter was opensesemi which is often stored in the application 's code in an obfuscated manner 
The binders and droppers for TinyZBot provided this command line argument and others when executing 
TinyZBot uses a dynamic mutex 
This was accomplished by combining a static preset prefix with the active process ID 
This backdoor does not require authentication , and its use appears to be straightforward 
There will be a detailed analysis of these backdoors posted to Cylance 's blog in the future 
PVZ is a name for a set of executables used together to create a botnet 
The name PVZ was assigned by us as this is one of the few tools this organization has not named themselves 
Communication is primarily unidirectional , as little information is provided from the bot to its command and control server 
The debug file path for PVZ-In is : PVZ-In has been observed using the file name ossisvc.exe 
The debug file path for PVZ-Out is : PVZ-Out has been observed with the file name osppsvc.exe 
Targeting information is supplied via command line parameters 
The debug file path for SYN Flooder is : SYN Flooder has been observed using the name ossysvc.exe 
Logger Module has been observed using the name ospcsvc.exe 
Its primary functionality is based on commands supplied by its configuration file 
The configuration file is able to store specific commands , which are intended to run at particular times 
If inside the United States , contact the Federal Bureau of Investigation ( FBI ) via either your local FBI team or FBI CYWATCH at 1-855-292-3937 or cywatch @ ic.fbi.gov 
2 
If outside the United States , contact your local , district , state or federal law enforcement authorities 
3 
If you have visibility into the attacks on your company and the tools and expertise to track them down , leverage the IOCs in Appendix A to identify their presence in your network , prevent them from expanding the scope of the compromise , and remove their access immediately 
4 
If you do NOT have visibility into the attacks , need help identifying an existing successful compromise in your organization , or more importantly wish to prevent this attack or attacks similar to Operation Cleaver , please contact your security provider 
5 
If you wish to contact Cylance for additional details not available in this report , please email opcleaver @ cylance.com 
6 
If you would like to learn more about Cylance products and professional services , or discuss how Cylance can mitigate Operation Cleaver 's impact to your organization , please contact us directly 
Iran in 2014 can probably be best described as galvanizing 
They have long been an '' enemy '' of the west , and the United States in particular , but today 's headlines include a variety of topics from nuclear talks to human rights to terrorism to cyber hacking 
Iran continues to be extremely active on the global stage – and thereby on the radar of every superpower 
Iran 's cyber sophistication has grown rapidly since the dawn of Stuxnet and they have used hard dollars combined with national pride to help build their cyber army 
Few doubt their commitment as a government and nation state to funding and recruiting cyber warriors to infiltrate and damage their enemies 
And it has been commonly postulated that almost all activity since 2010 coming out of Iran is associated with retaliation for Stuxnet/Duqu/Flame , which seems natural given the severity of the impact 
But they do n't need Stuxnet as motivation to want to hack the world 
They have long desired power on the political stage , in particular in the fight for nuclear power autonomy 
With the deadlines around the Iranian nuclear discussions pushed to 2015 , the attacks may be tied to negotiating power when discussing a pact with the nuclear superpowers of United States , Britain , France , Germany , Russia and China 
The inner workings of the Iranian government remain largely a mystery to the western world 
However , Iran 's control over its people and the private businesses birthed inside has been well reported 
In a 2014 Reuters article , the reporters detail how the secret Iranian organization called '' Setad Ejraiye Farmane Hazrate Emam '' has become one of the most powerful organizations in the country , capable of taking over properties and businesses , buying controlling interests in numerous sectors including finance , oil , telecommunications and many others totaling in upwards of $ 95B 
Even the US Treasury has documented an extensive fronting of companies in its report of Execution of Imam Khomeini 's Order ( EIKO ) , which through its two main subsidiaries controls 37 private businesses that are purely front companies for the Iranian government 
The history of Iran controlling the usage of the Internet and the very Internet on-ramps into Iran is well known , 
They have controlled much of the country 's Internet access to date and have taken over controlling interests in those companies to carry out their work 
Given Operation Cleaver's frequent spin-up and take-down of large IP blocks inside the AFRANET IP space inside Iran , and Iran 's well recorded investment in cyber warfare leads us to one simple conclusion : Iran is extremely active in the world of hacking 
Operation Cleaver 's intense focus on critical infrastructure companies , especially in South Korea , hints at information sharing or joint operations with Iran 's partner , North Korea 
In September , 2012 , Iran signed an extensive agreement for technology cooperation agreement with North Korea , which allows for collaboration on a variety of efforts including IT and security 
Operation Cleaver 's carefully selected targets like the oil and gas industry , energy and utility companies , as well as airlines and airports , indicates Iran 's desire to gain deep access into the world 's most critical environments 
The end goal of this operation is not known at this time 
University student recruitment was hinted at within Operation Cleaver and is consistent with Iran 's reported history of active warrior recruitment in the educational space 
Overall , there are many reasons that Iran may be pursuing the targets they did in Operation Cleaver 
While we may never truly know , it is important to consider all the above and more when trying to understand the why 
After tracking the Operation Cleaver team for over two years , we 're led to the inexorable conclusion : the government of Iran , and particularly the Islamic Revolutionary Guard Corps ( IRGC ) , is backing numerous groups and front entities to attack the world 's critical infrastructure 
As security experts in Critical Infrastructure and Key Resources ( CIKR ) , Industrial Control Systems ( ICS ) , Supervisory Control and Data Acquisition ( SCADA ) systems , Building Management Systems ( BMS ) , embedded systems and fixed-function systems , we know how easy they are to hack 
We have worked with countless customers and vendors throughout the years to notify them of vulnerabilities , assist with remediatation efforts , and help mitigate threats to their environments 
Unfortunately , many critical infrastructure organizations are unable to secure their complex envirnoments against modern attacks 
They fall victim to the '' glue flu '' , a malaise of feeling stuck , not wanting to change the status quo for fear they will find problems that they have no idea how to prevent 
This '' security anaphylaxis '' spells real disaster 
If Operation Cleaver does n't get the world to wake up to what is happening in the silent world of cyber , then perhaps nothing will 
Prevention is everything and we should never give up until it's achieved 
Challenge your trusted advisors 
Challenge your security vendors 
Demand better technology and services to detect , respond , but most importantly PREVENT not just contemporary attacks , but future exotic attacks that have yet to be imagined 
That is what truly disruptive and innovative technology is 
Do n't settle for anything less 
We hope that by exposing the Operation Cleaver team to the world , current global critical infrastructure victims can be notified , and prevent future victimization from suffering the consequences of '' status quo '' security 
Unlike United Flight 811 , perhaps we can prevent the next disaster 
DEFENDERS , NEVER GIVE UP ! In the face of growing and evolving threats , traditional cyber protection technologies are now widely considered inadequate 
The only way to regain the upper hand against a new generation of attackers , is to embrace something entirely new 
Something that '' thinks '' like an attacker 
Something that does n't rely on a trust model or care about hash lookups 
Something with a brain 
Cylance has eschewed the old foundations that existing cybersecurity products are built upon 
Instead , we 've based our approach on mathematics , machine learning , and data science 
This algorithmic approach has been proven to detect – and stop – exponentially more modern threats 
Leveraging algorithmic risk modeling , CylancePROTECT protects endpoints from everyday viruses , worms , trojans , and spyware , but unlike other security products , CylancePROTECT offers true future-proof protection against the most malicious threats in the world 
Advanced Persistent Threats ( APT ) , 0-days , and exotic exploitation techniques are easily detected and halted with little-to-no impact on the end-user 
Existing reactive solutions rely on a constant stream of signature updates for threat detection , which is not only costly and inconvenient , but also requires '' sacrificial lambs '' 
Only after a previously unseen threat has inflicted damage can the rest of the industry begin to detect it 
CylancePROTECT does n't require constant updates or even a network connection to protect against so-called '' previously undetectable '' threats 
By identifying and defusing attacks in near real time , before the attack can execute , we can finally do away with the need for a '' patient zero '' 
As Richard Stiennon , Chief Research Analyst at IT-Harvest , put it , '' Many vendors are trying to solve the endpoint problem , yet Cylance is the only one using the power of math to stop malware and with more effectiveness and efficiency than current solutions '' 
Interested in seeing what CylancePROTECT can do for your organization ? Contact us ! Cylance is one of the fastest growing cybersecurity technology firms in the US 
Cylance 's flagship product CylancePROTECT has been adopted by Fortune 500 companies and government agencies across the globe 
Cylance was founded by 27-year security industry luminary , Stuart McClure , former Global CTO of McAfee , original founder of Foundstone , and lead author of the international best-selling book Hacking Exposed 
In building Cylance , Stuart brought together the best scientific and executive minds from the likes of Cisco , Sourcefire , Google and McAfee 
The Cylance board of advisors includes former high-ranking officials from the DHS , the FBI , CIA , and executive titans of business 
CylancePROTECT is the only next generation endpoint security product that applies math to mute existing and future malware , viruses , worms , trojans , bots , APTs , 0-days , exploits , adware , spyware and hacking tools – without needing any updates or even a connection to the Internet 
The technology is founded on the principle that to fix the industry , you must start from scratch with a way as yet unseen 
CylancePROTECT does not rely on signatures of any sort ( blacklist or whitelist ) , behavioral analysis using IOCs , sandboxing analysis , heuristics , micro-virtualization , or dynamic detonation – to detect and prevent malicious files from executing on a target endpoint 
While every other endpoint security product must collect a sample , analyze , and write a signature to detect it , CylancePROTECT can detect malware before it executes by statically analyzing features found in the binary itself 
Features and Benefits of CylancePROTECT : • Near real time detection of malicious files , even if they 've never been seen in the wild 
• Can be used to augment existing endpoint security or be deployed as a complete replacement 
• Does not require any signature updates or connection to the cloud 
• An easy-to-use web management console with intuitive workflows 
• Low-impact endpoint agent 
For a demo of CylancePROTECT , contact a Cylance expert today ! Cylance 's Professional Services team is available to assist companies affected by this campaign 
Cylance is providing consulting to companies that may have been targeted by these advanced threat actors 
Cylance will perform initial triage in order to determine the extent to which your company has been affected by this campaign and work towards establishing a containment strategy 
Cylance has two tailored offerings for clients affected by this campaign 
The first one includes ICS in our incident response since many companies affected are in the Critical Infrastructure and Key Resources ( CIKR ) vertical 
The second offering 's focus is to deploy our proprietary tools and methodologies to detect and mitigate the threats posed by Operation Cleaver 
For more information on how the Cylance Professional Services team can assess and respond to attacks like the ones obseved in Operation Cleaver , contact sales @ cylance.com today 
Brian is a Sr. Security Researcher for Cylance who joined shortly after the company was established 
He is best known for his avid botnet research ( often going by '' botnethunter '' ) and for his novel malware analysis in the A Study in Bots blog series hosted by Cylance 
Brian has been a dedicated open-source developer as well as an advocate for public and private anti-botnet operations 
Brian actively develops techniques to combat cyber oppositions in positions where resources and leverage are in too limited of supply for conventional means 
These techniques , cultivated by Stuart McClure , are the Art of Deterrence 
In a previous investigation , Art of Deterrence techniques were successfully used to divert Indonesian hackers motivated by monetary gain away from their highest yielding target group 
Brian 's botnet research covers a wide range of topics , from using graph analysis to estimate the amount of ransom that has been paid to a ransomware operator , to utilizing IPv4 scanning techniques to identify and take down point of sale malware panels 
Stuart is founder , CEO/President and Chairman of Cylance 
Widely recognized for his extensive and in-depth knowledge of security products , Stuart McClure is considered one of the industry 's leading authorities in information security today 
A well-published and acclaimed security visionary with currently eleven books in print , McClure is the originating founder of the Hacking Exposed series of books , the most successful security book ever written 
From his work , he founded Foundstone in October of 1999 which sold to McAfee in 2004 
McClure brings over two decades of technology and executive leadership with profound technical , operational , and financial experience 
Besides Foundstone , Stuart held leadership positions at InfoWorld , Ernst & Young , Kaiser Permanente and a number of government agencies 
At McAfee , McClure held numerous positions including SVP/General Manager for the Security Management BU as well as EVP/Global Chief Technology Officer responsible for almost $ 3B worth of revenues 
Today , McClure is CEO of Cylance , a disruptive and innovative startup applying math to the problem of security 
Cylance products such as CylancePROTECT prevent the most advanced attacks in the world without signatures or sandboxing in realtime on the endpoint 
Cylance Services offer highly specialized security services such as incident response , forensics , compromise assessments and advanced penetration assessments for global critical infrastructure 
Cylance employees work passionately and tirelessly every day to achieve one goal : Protect the world from cyber attacks 
And with their efforts in tracking Operation Cleaver , they have achieved that goal 
Our endless thanks to all the Cylancers who contributed to this report 
The Operation Cleaver logo , created by Cylance specifically for this report , was inspired by the infamous logo used by the Army of the Guardians of the Islamic Revolution , also known in the west as the Iranian Revolutionary Guard Corps ( IRGC ) 
Due to the close connection between the members tracked in this report and the IRGC , it was only fitting to replicate the look and feel of the IRGC 's iconography as the anchor for this document 's branding 
The striking visual elements that make up the logo of the IRGC have very specific meanings : • The clenched fist holding a rifle , most likely an AK-47 , represents armed resistance 
• The globe symbolizes the IRGC 's worldwide ambitions 
• The book , from which the clenched first emanates , represents the Qur'an , connecting the religious ideals on which the group was founded to the armed struggle 
• The plants , possibly wheat , represent prosperity 
• The name of the group in Persian , the year in which it was founded and a passage from the Qur'an ( 8:60 ) 'And make ready against them all you can of power ' , are represented in text 
Several of the visual elements present in the IRGC logo have been carried over to the Operation Cleaver logo including : • A clenched fist , this time holding a cleaver , represents the group 's likely connection with the IRGC as well as armed resistence in general 
• The globe in the background represents Operation Cleaver 's worldwide reach 
• An ethernet cable connected to the clenched first represents the nature of these attacks ( cyber as opposed to traditional warfare ) 
• The hex string translates to '' Think Evil , Do Good '' , a mantra our research team lives by 
This Appendix details the IOCs discovered in the investigation of Operation Cleaver 
CylancePROTECT prevents the malware used in Operation Cleaver from ever executing 
These mutexes are used with the process ID of the malware as a suffix : Listed below are both the MD5 and SHA-256 hashes for samples related to Operation Cleaver 
Complex malware known as Regin is the suspected technology behind sophisticated cyberattacks conducted by U.S. and British intelligence agencies on the European Union and a Belgian telecommunications company , according to security industry sources and technical analysis conducted by The Intercept 
The hacking operations against Belgacom and the European Union were first revealed last year through documents leaked by NSA whistleblower Edward Snowden 
The specific malware used in the attacks has never been disclosed , however 
The Regin malware , whose existence was first reported by the security firm Symantec on Sunday , is among the most sophisticated ever discovered by researchers 
Symantec compared Regin to Stuxnet , a state-sponsored malware program developed by the U.S. and Israel to sabotage computers at an Iranian nuclear facility 
Sources familiar with internal investigations at Belgacom and the European Union have confirmed to The Intercept that the Regin malware was found on their systems after they were compromised , linking the spy tool to the secret GCHQ and NSA operations 
Ronald Prins , a security expert whose company Fox IT was hired to remove the malware from Belgacom 's networks , told The Intercept that it was '' the most sophisticated malware '' he had ever studied 
'' Having analyzed this malware and looked at the [ previously published ] Snowden documents , '' Prins said , '' I 'm convinced Regin is used by British and American intelligence services 
'' A spokesman for Belgacom declined to comment specifically about the Regin revelations , but said that the company had shared '' every element about the attack '' with a federal prosecutor in Belgium who is conducting a criminal investigation into the intrusion 
'' It 's impossible for us to comment on this , '' said Jan Margot , a spokesman for Belgacom 
'' It 's always been clear to us the malware was highly sophisticated , but ever since the clean-up this whole story belongs to the past for us 
The agency secretly installed so-called malware '' implants '' on the employees ' computers by sending their internet connection to a fake LinkedIn page 
The software implants used in this case were part of the suite of malware now known as Regin 
This involves the deployment of the malware in stages , making it more difficult to analyze and mitigating certain risks of being caught 
Based on an analysis of the malware samples , Regin appears to have been developed over the course of more than a decade ; The Intercept has identified traces of its components dating back as far as 2003 
Regin was mentioned at a recent Hack.lu conference in Luxembourg , and Symantec 's report on Sunday said the firm had identified Regin on infected systems operated by private companies , government entities , and research institutes in countries such as Russia , Saudi Arabia , Mexico , Ireland , Belgium , and Iran 
The use of hacking techniques and malware in state-sponsored espionage has been publicly documented over the last few years : China has been linked to extensive cyber espionage , and recently the Russian government was also alleged to have been behind a cyber attack on the White House 
Regin further demonstrates that Western intelligence agencies are also involved in covert cyberespionage 
GCHQ declined to comment for this story 
The agency issued its standard response to inquiries , saying that '' it is longstanding policy that we do not comment on intelligence matters '' and '' all of GCHQ 's work is carried out in accordance with a strict legal and policy framework , which ensures that our activities are authorised , necessary and proportionate 
'' The NSA said in a statement , '' We are not going to comment on The Intercept 's speculation 
'' The Intercept has obtained samples of the malware from sources in the security community and is making it available for public download in an effort to encourage further research and analysis 
( To download the malware , click here 
The file is encrypted ; to access it on your machine use the password '' infected 
'' ) What follows is a brief technical analysis of Regin conducted by The Intercept 's computer security staff 
Regin is an extremely complex , multi-faceted piece of work and this is by no means a definitive analysis 
In the coming weeks , The Intercept will publish more details about Regin and the infiltration of Belgacom as part of an investigation in partnership with Belgian and Dutch newspapers De Standaard and NRC Handelsblad 
In Nordic mythology , the name Regin is associated with a violent dwarf who is corrupted by greed 
It is unclear how the Regin malware first got its name , but the name appeared for the first time on the VirusTotal website on March 9th 2011 
Der Spiegel reported that , according to Snowden documents , the computer networks of the European Union were infiltrated by the NSA in the months before the first discovery of Regin 
Industry sources familiar with the European Parliament intrusion told The Intercept that such attacks were conducted through the use of Regin and provided samples of its code 
This discovery , the sources said , may have been what brought Regin to the wider attention of security vendors 
Also on March 9th 2011 , Microsoft added related entries to its Malware Encyclopedia : Two more variants of Regin have been added to the Encyclopedia , Regin.B and Regin.C 
Microsoft appears to detect the 64-bit variants of Regin as Prax.A and Prax.B 
None of the Regin/Prax entries are provided with any sort of summary or technical information 
They have an encrypted block which points to the location of the 2nd stage payload 
On NTFS , that is an Extended Attribute Stream ; on FAT , they use the registry to store the body 
This component consists of a service orchestrator working in Windows ' kernel 
This stage is composed of a service orchestrator located in user land , provided with many modules which are loaded dynamically as needed 
The sample has the following SHA256 hash : This sample gives a sense of the sophistication of the actors and the length of the precautions they have been taking in order to operate as stealthily as possible 
When a Windows kernel driver needs to allocate memory to store some type of data , it creates so called kernel pools 
Such memory allocations have specific headers and tags that are used to identify the type of objects contained within the block 
For example such tags could be Proc , Thrd or File , which respectively indicate that the given block would contain a process , thread or file object structure 
When performing forensic analysis of a computer 's memory , it is common to use a technique called pool scanning to parse the kernel memory , enumerate such kernel pools , identify the type of content and extract it 
Just like Regin loader drivers , this driver repeatedly uses the generic '' Ddk '' tag with ExAllocatePoolWithTag ( ) when allocating all kernel pools : The generic tag which is used throughout the operating system when a proper tag is not specified 
This makes it more difficult for forensic analysts to find any useful information when doing pool scanning , since all its memory allocations will mix with many generic others 
Windows kernel drivers operate on different levels of priority , from the lowest PASSIVELEVEL to the highest HIGHLEVEL 
This level is used by the processor to know what service give execution priority to and to make sure that the system does n't try to allocate used resources which could result in a crash 
This technique is another example of the level of precaution the developers took while designing this malware framework 
In an interview given to the Belgian magazine MondiaalNiews , Fabrice Clément , head of security of Belgacom , said that the company first identified the attack on June 21 , 2013 
In the same interview Clément says that the computers targeted by the attackers included staff workstations as well as email servers 
These statements confirm the timing and techniques used in the attack 
From previously identified Regin samples , The Intercept developed unique signatures which could identify this toolkit 
A zip archive with a sample identified as Regin/Prax was found in VirusTotal , a free , online website which allows people to submit files to be scanned by several anti-virus products 
The zip archive was submitted on 2013-06-21 07:58:37 UTC from Belgium , the date identified by Clément 
Sources familiar with the Belgacom intrusion told The Intercept that this sample was uploaded by a systems administrator at the company , who discovered the malware and uploaded it in an attempt to research what type of malware it was 
The archive contains : Along with other files The Intercept found the output of a forensic tool , GetThis , which is being run on target systems looking for malware 
From the content of the GetThis.log file , we can see that a sample called '' svcsstat.exe '' and located in C : \Windows\System32\ was collected and a copy of it was stored 
The malware in question is '' 0001000000000C1Csvcsstat.exesample '' 
This is a 64bit variant of the first stage Regin loader aforementioned 
The archive also contains the output of ProcMon , '' Process Monitor '' , a system monitoring tool distributed by Microsoft and commonly used in forensics and intrusion analysis 
This file identifies the infected system and provides a variety of interesting information about the network 
For instance : The following environment variable shows that the system was provided with a Microsoft SQL server and a Microsoft Exchange server , indicating that it might one of the compromised corporate mail server Fabrice Clément mentioned to Mondiaal News : Below is a list of hashes for the files The Intercept is making available for download 
Given that that it has been over a year since the Belgacom operation was publicly outed , The Intercept considers it likely that the GCHQ/NSA has replaced their toolkit and no current operations will be affected by the publication of these samples 
If it exists the module exits , if not ­the module creates one 
After that it compiles a string describing the system in the following format : « C P U : % CPUNAME % < br > Net card : % IP % ( % MACADDR % ) < br > » 
Next it checks if this string contains one of the following substrings : If any of these strings is found , the module terminates 
After that , there is a hardcoded value of 10 , which delays further execution of the module for 10 seconds 
If not , the module proceeds with network communication routine 
But if this file is found it does some additional checks 
After all , if the module is ready and allowed to communicate with C & C server it does that in the following manner 
1 
The malware locates «DEXT87» and reads the data appended to it 
The appended data should be an IP address in plaintext 
This is used a real C & C IP address 
Reading stops when non­digit or dot symbol is found 
Here is an example of shortest possible valid server response : 2 
Upon successful receiving of the file it is started in a new process 
This module is designed not to run on Windows with system default codepage set to Korean 
Bdagent.exe is a name for BitDefender Antivirus component 
Pushing ESC key closes the modal message box 
There is one interesting specifics in Microsoft IntelliForms which reveals attack- er 's interests 
IntelliForms technology keeps login/password information in the registry in encrypted form 
However , there is no clear information about the corre- sponding website which requires given login and password 
The only information Intelliforms offers about the place where given login/password should be used is a hash of the webpage URL 
They have implemented this logics in the malware 
String encryption/decryption functions use the following keys : The module works with all Firefox versions prior to Mozilla Firefox 12.0 
Depend- ing on version of Firefox , it can read Firefox database directly to dump stored se- crets or utilize one Firefox libraries to access the configuration data 
The module is linked with SQLite version 3.7.5 release candidate 2 , release hash ed759d5a9edb3bba5f48f243df47be29e3fe8cd7 dated as 2011­01­28 17:03:50 
This top level country code domain is quite exotic and is assigned to Pitcairn Islands , which is Overseas ter- ritory of the United Kingdom in the Pacific 
As of 2013 estimated population of Pitcairn Islands is only 56 people 
An official .pn domain costs $ 100/year from the registry , however .eu.pn domains seem to be given away for free 
«user2» in current sample ) ; < UniqueMachineId > is a 32 characters long hex string which derived from net- work card MAC address; < EncryptionKey > is symmetrical encryption key used to encrypt < UserId > and < GeneralSysInfo > values 
The malware uses text protocol , which is why potentially binary values of < UserId > and < GeneralSysInfo > are ad- ditionally encoded using Base64 algorithm 
< GeneralSysInfo > field contains only basic information about the system , i.e 
«Minmei» may be a reference to a popular Japanese anime and manga known as «The Super Dimension Fortress Macross» 
If yes it does additional port I/O specific to VMWare virtual machine ( the VMware hypervisor port : 0x5658; VMware hypervisor magic value : 0x564D5868 ) 
If it belongs to subnet 192.168.100 
* then the malware believes it 's running in a VM 
This string varies depending on the local system language and may be one of the following : % HOSTID % is a special value generated from local network card MAC address; % SYSINFO % is a string with general system information ( please see description above ) ; % AVSOFTID % is a string that contains indexes of AV software names in internal table of AV Identifiers ( please see the table above ) 
A large number of files are detected by Kaspersky Lab scanners as Virus.Win32 
Pioneer.dx 
This malware is 63kb in size 
It is bound to a variety of other software packages that vary in name , but the host package is consistently detected as '' Virus.Win32 
Pioneer.dx '' 
Win32.Agent.xwge ) from its .data section in memory with a simple xor 0xbb 
It then resumes the thread in the new process 
It is signed with the familiar '' '' digital certificate 
Here we see the local port variables assigned values And here , the ports are directly being read with READPORTUCHAR ( 0x64 ) and then READPORTUCHAR ( 0x60 ) : It buffers , then communicates the data to the running user mode component 
Here is debug output demonstrating this component 's data retrieval when the letter '' D '' is repeatedly pressed on the keyboard 
Keyscan make and break codes are '' 0x20 '' and '' 0xA0 '' and for the key press and key release for the '' D '' key 
The '' 0x1D '' value from port 0x64 that you see below is basically an indication that the output buffer is full and the keyboard is locked , so it is safe for the driver to access the key value in port 0x60 : These debug messages and code style are duplicates of what chpie posted in the past 
Its encryption algorithm is similar to RC4 
Interesting part is that the module randomly generates the key and stores it in an unexpected place : in the middle of the log file name 
Hence , the numeric part of the filename is used as a seed for the pseudorandom number generator 
Rand function is statically linked to insure same results on different computers 
In this day and age of interconnected cloud services and distributed content delivery networks ( CDNs ) , it is important for both CDN service providers and security professionals alike to recognize and understand the risks that these systems can introduce within an modern enterprise 
For organizations within both public and private sectors that leverage CDN platforms to dynamically deliver web content , it is important that the content is also routinely monitored 
Otherwise , malicious third-party content can be loaded into a target organization 's website without their knowledge , delivering untold risks to unwitting visitors 
The compromised CDN resource in question is a JavaScript file hosted at [ http : ] //cdn.afghanistan [ 
] af/scripts/gop-script.js The domain cdn.afghanistan [ 
] af is a legitimate CDN site used by the Afghan Ministry of Communications and IT ( MCIT ) to host web content that is displayed and used on many official gov.af websites 
The javascript URL ( [ http : ] //cdn.afghanistan [ 
] af/scripts/gop-script.js ) is called from numerous official Afghan Government websites , including the following : It is likely that this javascript URL itself is normally legitimate , but the attackers obtained access to the file and prepended the following malicious JavaScript functions to the beginning of the script : Note that the gov.af websites would not need to be compromised individually for this attack to be delivered to visitors of the sites , because it is the backend CDN infrastructure that is serving up the malicious script 
Judging by the last modified timestamp on the HTTP response of gop-script.js , which is Tue , 16 Dec 2014 08:07:06 GMT , this malicious CDN compromise was very recent in nature 
In fact , it occurred on the very same day that China 's Prime Minister Li Keqiang would meet with Abdullah Abdullah , the Chief Executive Officer of Afghanistan in Astana Kazakhstan , they would discuss infrastructure development and bilateral cooperation issues 
Looking at the EXIF metadata of the image of Keqiang meeting with Abdullah that is hosted on the Chinese embassy website we note a Tue , 16 December 2014 07:43:31 modify time as well as the www.news [ 
] cn watermark in the bottom righthand corner 
This indicates that the image of Keqiang and Abdullah was likely taken and edited sometime prior to 07:43:31 
While it is ambiguous as to which timezone the edits actually took place in ( Kazakhstan or China ) we assume the date timestamp references GMT because the press release states '' In the afternoon of December 15 local time… '' If we assume the photograph and afternoon meeting took place sometime prior to 13:43 Alma-Ata standard time ( +0600 ) this would closely correspond with a 07:43 GMT time stamp 
The modification of the gop-script.js by the attackers at 08:07:06 GMT likely tracks extremely close to a window of a few hours in which Keqiang met with Abdullah 
It is worth mentioning that a similar scenario occurred on June 20th when security researcher PhysicalDrive0 observed a malicious Java file hosted on the Embassy of Greece in Beijing 
At the time , a Chinese delegation led by Keqiang was visiting Greek Prime Minister Antonis Samaras in Athens 
Security researcher R136a1 aka '' thegoldenmessenger '' released a followup blog with detailed analysis of the Greek embassy compromise 
While these two separate events are not directly related , additional research into the status of ministerial and official government websites on or around the dates of notable Chinese delegations and or bilateral meetings may yield additional patterns of interest 
Upon closer inspection of the prepended malicious JavaScript code , one will notice the similarity in the update.javaplug-in [ 
] com naming convention and URL structure to the C2 domain java-se [ 
] com found in the Palo Alto Networks blog post Attacks on East Asia using Google Code for Command and Control and associated with Operation Poisoned Hurricane 
However , the malicious document.write driveby URLs listed above both result in 403 Forbidden errors as of December 18 , 2014 
While the 403 Forbidden errors may seem like an analytic dead end , the TCIRT also identified a malicious Java applet submission to VirusTotal that confirms the nature of this malicious activity 
This Java applet , SHA1 : 388E6F41462774268491D1F121F333618C6A2C9A , has no antivirus detections as of December 21st 
The applet contains its malicious class file at the path '' jre7u61windows/x86/Update.class '' 
Using historic context archived within ThreatConnect , the TCIRT concluded that this Java applet is from the same source code as the applet SHA1 : ADC162DD909283097E72FC50B7AB0E04AB8A2BCC , which was previously observed by the TCIRT at the Operation Poisoned Hurricane related URL [ http : ] //jre7.java-se [ 
] com/java.jar on August 15 , 2014 
This same certificate was also used to sign the Java applet that downloaded this malware 
Note that javaplug-in [ 
] com is the same root domain found in the compromised version of [ http : ] //cdn.afghanistan [ 
] af/scripts/gop-script.js as [ http : ] //update.javaplug- in [ 
] com/o/j.js , confirming that this Java malware is in fact directly associated with the Afghan MCIT CDN XSS compromise 
Full indicators of this activity and a YARA rule to detect the malware certificate can be found in the ThreatConnect Common Community under Incident 20141217A : Afghan Government Java Driveby and signature APTOnAndOncert.yara 
As the US and NATO reduce their troop levels in Afghanistan , China is posturing to fill the gap of influence that the west is leaving behind 
With plans to facilitate multilateral peace talks with the Taliban and establish major transportation projects which aim to bolster the Afghan economy , Beijing has been eyeing Afghanistan as part of its broader South Asian strategy 
It is important to consider that corporate enterprises are not immune to this tactic , and this is not just a technique that is used by APT threat actors 
If an enterprise 's website leverages a CDN to speed up content delivery , unintended consequences must be anticipated 
Fortunately , modern browsers now implement a security concept called '' Content Security Policy '' 
As long as the server 's response headers are configured properly , third party content may be restricted to originating from a narrow whitelist 
Just as attackers distribute malicious content to users en masse or CDN services distribute web content to users , security professionals must be able to quickly distribute actionable Threat Intelligence in formats readable by both humans and machines 
ThreatConnect is the industry 's first comprehensive Threat Intelligence Platform that enables enterprises to orchestrate the aggregation of Threat Intelligence from multiple sources , use integrated analytics and a robust API that gives enterprises the control to action their own Threat Intelligence , in the cloud and on premises 
Register for a free account now to view the Common Community shares and more 
At the end of April Microsoft announced that a vulnerability in Word was actively being exploited 
This vulnerability occurred in parsing RTF files and was assigned CVE-2014-1761 , a thorough analysis of which can be found on the HP Security Research blog 
MiniDuke was first discussed by Kaspersky in March 2013 in their paper The MiniDuke Mystery : PDF 0- day Government Spy Assembler 0x29A Micro Backdoorand shortly after in a paper by Bitdefender 
The exploit document was named Proposal-Cover-Sheet-English.rtf and is quite bland when compared to the documents that were used in 2013 , which were of a political nature 
We received the document on April 8th , only three days after the compilation of the MiniDuke payload , dated April 5th in the PE header 
The payload remains quite small at only 24 KB 
If any of these are found the shellcode skips the first 5 bytes of the function being called by manually executing prologue instructions ( mov edi , edi ; push ebp ; mov ebp , esp ) and then jumping to the function code as illustrated below 
The next graph presents the execution flow of this malware when the exploitation is successful 
As mentioned previously this version of the MiniDuke payload comes with two modules which we refer to as the main module and the TwitterJS module 
Once MiniDuke receives control it checks that the host process is not rundll32.exe and whether the current directory is % TEMP % 
As with the previous version of MiniDuke , it checks for the presence of the following processes in the system : If any of these are found in the system the configuration information will be decrypted incorrectly , i.e 
the malware will run on the system without any communication to C & C servers 
It looks for the tag '' X ) ) ) '' on the page ( MiniDuke was searching for '' uri ! '' in previous samples ) and if the tag is found it decrypts a URL from the data that follows it 
The Twitter account @ FloydLSchwartz does exist but has only retweets and no strings with the special tag 
In the event that MiniDuke is unable to retrieve a C & C URL from this account , it generates a username to search for based on the current date 
The search query changes roughly every seven days and is similar to the backup mechanism in previous versions that was using Google searches 
A Python implementation of the algorithm can be found in Appendix B 
Here is how the export address table of the patched binary looks after modifications 
When loaded , TwitterJS instantiates the JScript COM object and decrypts a JScript file containing the core logic of the module 
It first generates a Twitter user to search for ; this search term changes every 7 days and is actually a match to the real account name , not the Twitter account name 
The bot then visits the Twitter profiles returned by the search and looks for links that end with '' .xhtml '' 
When one is found , it replaces '' .xhtml '' with '' .php '' and fetches that link 
Information about the computer is embedded in the Accept HTTP header 
The first link on the retrieved page should contain base64 data ; the name attribute of the link is used as a rolling XOR key to decrypt the JScript code 
Finally , MiniDuke calculates a hash of the fetched script and compares it with a hardcoded hash in the TwitterJS script 
If they match , the fetched script is executed by calling eval ( ) 
The code hashing algorithm used by the component looks very much like SHA-1 but outputs different hashes ( you can find the complete implementation in Appendix B 
We decided to search for what was changed in the algorithm ; one of our working hypotheses was that the algorithm might have been altered to make collisions feasible 
We could n't find an obvious difference ; all the constants and the steps of the algorithm were as expected 
Then we noticed that for short messages only the second 32-bit word was different when compared to the original SHA-1 
By examining how this 2nd word was generated we finally discovered that this was caused by a scope issue 
As shown below the SHA-1 function used a variable named f : the function Z ( ) is then called which also uses a variable named f without the var keyword , causing it to be treated as a global variable rather than local to the function 
The end result is that the value of f is also changed in the SHA-1 function which affects the value of the 2nd word for that round and ultimately the whole hash for long messages 
A likely explanation of how this problem came to be is that the variable names were changed to single letters using an automated tool prior to embedding it in the payload 
The 2 f variables probably had different names in the original script which avoided the issue 
So this leaves us with two takeaways : 1 ) The difference in the hashing algorithm was unintentional and 2 ) Always declare your local variables with the var keyword 
; - ) We generated the list of Twitter search terms for 2013-2014 and checked if any of those were registered 
At the moment only one exists , @ AA2ADcAOAA , which is the TwitterJS account that was generated between August 21st and 27th 2013 
This account has no tweets 
In an effort to discover potential victims , we registered the Twitter accounts corresponding to the current week both for the main and TwitterJS components and set up tweets with encrypted URLs so that an infected computer would reach out to our server 
So far we have received connections via the TwitterJS accounts from four computers located in Belgium , France and the UK 
We have contacted national CERTs to notify the affected parties 
We detect the RTF exploit document as Win32/Exploit.CVE-2014-1761.D and the MiniDuke components as Win32/SandyEva.G 
We believe we 're seeing an evolution and development in Iranian-based cyber activity 
In this report , we document the activities of the Ajax Security Team , a hacking group believed to be operating from Iran 
Members of this group have accounts on popular Iranian hacker forums such as ashiyane [ 
] org and shabgard [ 
] org , and they have engaged in website defacements under the group name '' AjaxTM '' since 2010 
By 2014 , the Ajax Security Team had transitioned from performing defacements ( their last defacement was in December 2013 ) to malware-based espionage , using a methodology consistent with other advanced persistent threat actors in this region 
It is unclear if the Ajax Security Team operates in isolation or if they are a part of a larger coordinated effort 
The Ajax Security Team itself uses malware tools that do not appear to be publicly available 
Although we have not observed the use of exploits as a means to infect victims , members of the Ajax Security Team have previously used publicly available exploit code in web site defacement operations 
In sum , FireEye has recently observed the Ajax Security Team conducting multiple cyber espionage operations against companies in the defense industrial base ( DIB ) within the Unites States , as well as targeting local Iranian users of anti-censorship technologies that bypass Iran 's Internet filtering system 
The transition from patriotic hacking to cyber espionage is not an uncommon phenomenon 
It typically follows an increasing politicization within the hacking community , particularly around geopolitical events 
This is followed by increasing links between the hacking community and the state , particularly military and/or intelligence organizations 
In the late 1990 's and early 2000 's , a similar transition occurred within the Chinese hacking community 
Around this time a significant shift in philosophy began to take place 
Members of the Chinese hacking community that participated in such attacks soon found that transitioning to cyber espionage was more rewarding-both in terms of developing a more advanced skill set as well as in monetary remuneration 
One group known as NCPH ( Network Crack Program Hacker ) , whose founding member '' Wicked/Withered Rose '' was a patriotic hacker , made the transition to cyber espionage by founding a '' hacker-for-hire '' group that simultaneously developed an association with the Chinese military 
The group began developing zero-day exploits , rootkits and remote access tools ( RATs ) -using them in attacks against a variety of targets including the U.S. Department of Defense 
( One of this group 's associates , '' whg '' , is still active and is believed to have developed one variant of the PlugX/SOGU malware 
) The rationale behind this transition within the Chinese hacking community is nicely summed up in a message by the '' Honker Union of China '' to its members in 2010 : What benefit can hacking a Web page bring our country and the people ? It is only a form of emotional catharsis , please do not launch any pointless attacks , the real attack is to fatally damage their network or gain access to their sensitive information 
In Iran , the hacking community appears to be undergoing a similar transformation 
While a variety of Iranian hacker groups had engaged in politically motivated website defacements , the emergence of the '' Iranian Cyber Army '' in 2009 demonstrated '' a concentrated effort to promote the Iranian government 's political narrative online '' 
They targeted , among others , news organizations , opposition websites and social media 
This marked the beginning of a large- scale cyber offensive against the perceived enemies of the Iranian government 
Foreign news and opposition websites are routinely blocked in Iran , as are the tools that allow users in Iran to bypass these restrictions 
One of the key stakeholders in Iran 's Internet censorship program is the Iranian Revolutionary Guard Corps ( IRGC ) , under which the Basij paramilitary organization operates 
The Basij formed the Basij Cyber Council and actively recruits hackers in order to develop both defensive and offensive cyber capabilities 
There is increasing evidence to suggest that the hacker community in Iran is engaged in a transition from politically motivated defacements and denial of service attacks to cyber espionage activities 
This model is consistent with the Basij 's recruitment of paramilitary volunteer hackers to '' engage in less complex hacking or infiltration operations '' leaving the more technical operations to entities over which they have increasingly direct control 
As such , the capabilities of threat actors operating from Iran have traditionally been considered limited 
And unsurprisingly , Iran has reportedly increased its efforts to improve offensive capabilities after being targeted by Stuxnet and Flame 
All Internet Service Providers ( ISPs ) in Iran are required to implement filtering technology that censors access to content which the Iranian government deems unacceptable 
This content includes categories such as pornography and political opposition 
In response to these restrictions , Iranians have been increasingly using software that bypasses such filtering technology 
To counter anti-censorship efforts , Iran has attempted to block the use of certain software tools 
We have observed the Ajax Security Team use a malware family that they identify simply as 'Stealer ' 
This DLL is written in Delphi 
State is maintained between the stealer component IntelRS.exe and the FTP component AppTransferWiz.DLL using a file from the FTP server '' sqlite3.dll '' , as well as a global atom '' SQLiteFinish '' 
IntelRS.exe waits in an indefinite loop , until AppTransferWiz.DLL defines this state 
The filenames for these encrypted files follow this naming scheme : The { stolen data type } parameter indicates where the data was harvested from ( e.g. , a Web browser , an instant messenger application , installed proxy software ) 
It uses a key size of 256 bytes and block size of 128 bytes , which conforms to the FIPS-197 specification of AES-256 
It utilizes the passphrase 'HavijeBaba' and a salt of 'salam ! * % # ' as an input to PBKDF2 ( Password-Based Key Derivation Function 2 ) to derive the key and initialization vector for the encryption 
This key derivation implementation in .NET is done using the Rfc2898DeriveBytes class 
The passphrase and salt are Persian language words 
'' Havij '' means '' carrot '' , '' Baba '' means '' father '' , and '' Salam '' is a common greeting that means '' Peace '' 
We identified 17 droppers during this research , including : The 2009 compile time appears to have been forged , while the 2013 compile times may be legitimate 
In some cases , we found an implant but not the parent dropper 
In total , 22 of the 23 implants that we identified during our research had unique compile times ranging from 2013-10-29 until 2014-03-15 
We identified two implants that were both compiled on 2014-3-15 at 23:16 
These compile times appear to be legitimate and coincide with attempted intrusion activity attributed to these attackers 
Analysis of the PDB strings seen in the implants indicates that there may be more than one developer working on the source code for the Stealer builder 
The following two PDB paths were seen in the collection of implants that we collected : These strings indicate that the Stealer source code was stored in two different paths but not necessarily on two different computers 
The f : \ Projects\ path may be from an external storage device such as a thumb drive 
It is therefore possible that only one person has access to the source code , but keeps a separate repository on an external storage device 
Alternatively , the different file paths could be the result of two different actors storing their source code in two different locations 
In nine of the implants that we collected , we found a consistent portable executable ( PE ) resource with a SHA256 of 5156aca994ecfcb40458ead8c830cd66469d5f5 a031392898d323a8d7a7f23d3 
This PE resource contains the VSVERSIONINFO 
In layman 's terms , this can best be described as the metadata describing the executable file 
This specific PE resource contained the following information : Note the InternalName of 'Stealer.exe ' 
This is the attackers ' name for this malware family 
During our research , we recovered two different tools used by the members of the Ajax Security Team in conjunction with targeted intrusion activities 
The first tool , labeled the 'Stealer Builder ' was compiled on 2014-04-08 
This compile date may indicate that the group is still active 
We also noted that the Builder did not allow the attacker to select a new passphrase or salt used to encrypt the stolen data 
The passphrase 'HavijeBaba ' and a salt of 'salam ! * % # ' are both hardcoded into the builder 
During testing , we observed that backdoors generated by this Stealer Builder had a timestamp of 2013-12-19 
We had one backdoor in our repository with this same timestamp 
The VSVERSIONINFO PE resource mentioned above ( SHA256 5156aca994ecfcb40458ead8c830cd66469d5f5 a031392898d323a8d7a7f23d3 ) is an artifact of the Stealer builder that we recovered 
The builder generates an executable named IntelRapidStart 
exe 
This executable contains the aforementioned VSVERSIONINFO PE resource 
We also recovered a tool designed to encode plaintext into Base64 encoded text or decode Base64 encoded text into plaintext 
Members of the Ajax Security Team likely this use tool to encode the configuration data seen in RapidStartTech.stl files 
As noted above , the RapidStartTech.stl contains the backdoor 's FTP credentials , implant name , decoy name , and screenshot interval , along with boolean settings for startup , keylogger , and screenshot plugins 
Encoding and decoding Base64 data is a straightforward task and the standard Linux operating system offers a number of command line tools to achieve this task 
The presence of a Windows-based GUI tool that simplifies encoding and decoding Base64 data indicates that these tools may have been developed for less adept users 
The CnC infrastructure consists of distinct , but linked , clusters that have targeted both the users of anti-censorship tools in Iran as well as defense contractor companies in the U.S 
] org , which is registered to info @ usa.gov [ 
] us 
However , historical WHOIS information shows that the domain was registered by keyvan.ajaxtm @ gmail [ 
] com-the same domain used to register ajaxtm [ 
] org , the website of the Ajax Security Team 
The same email addresses were used to register variations of domain names associated with popular services provided by companies such as Google , Facebook , Yahoo and LinkedIn 
The second cluster comprises the CnC infrastructure used in the anti-censorship attacks 
] com 
The domain intel-update [ 
] com resolved to the IP address 88.150.227.197 , which also hosted domains registered by osshom @ yahoo [ 
] com , many of which are consistent with the pattern of registering domains with associations to Google and Yahoo services 
] com 
These two clusters are linked by a common IP address ( 5.9.244.151 ) , which is used by both ns2 
aeroconf2014 [ 
] org and office.windows- essentials [ 
] tk 
A third cluster of activity was found via analysis of 1d4d9f6e6fa1a07cb0a66a9ee06d624a 
The domain plugin-adobe [ 
] com resolved to 81.17.28.235 
While analyzing the data from the victims , we found that the majority had either their timezone set to '' Iran Standard Time '' or had their language setting set to Persian : The largest concentration of victims is in Iran , based on the premise that Persian language settings and '' Iran Standard Time '' correlate the victim to be geographically located in Iran 
The Ajax Security Team appears to have been formed by personas named '' HUrr ! c4nE ! '' and '' Cair3x '' in 2010 
Both members were engaged in website defacements prior to the forming of the Ajax Security Team , and both were members of Iranian hacker forums such as ashiyane [ 
] org and shabgard [ 
] org 
Other members include '' 0day '' , '' Mohammad PK '' and '' Crim3r '' 
The Ajax Security Team website at ajaxtm [ 
] org had a Web forum with at least 236 members 
The group published several exploits for content management systems and engaged in defacements 
Initially , the defacements seemed to be motivated by a desire to demonstrate the group 's prowess-they even defaced an Iranian government website 
However , the group appears to have become increasingly political 
For example , in a blog post in 2012 , '' Cair3x '' announced the targeting of Iran's political opponents 
In 2013 , the Ajax Security Team , and '' HUrr ! c4nE ! '' in particular , took part in '' # OpIsrael '' and '' # OpUSA '' 
By early 2014 , the Ajax Security Team appears to have dwindled 
There have been no defacements since December 2013 
The website and forum at ajaxtm [ 
] org operated by '' HUrr ! c4nE ! '' , aka '' k3yv4n '' , is no longer active 
'' HUrr ! c4nE ! '' has the most open/documented Internet persona of the Ajax Security Team 
He registered the ajaxtm [ 
] org domain name using the email address keyvan.ajaxtm @ gmail [ 
] com 
'' HUrr ! c4nE ! '' features prominently in all the group 's activities and defacements 
Although there has been a decline in public-facing Ajax Security Team activity , this coincides with an increase in malware activity linked to the group 's infrastructure 
The increasing politicization of the Ajax Security Team aligns with the timing of their activities against the perceived enemies of Iran 
In addition to attacking companies in the U.S. , they have targeted domestic users of anti-censorship technology 
While the objectives of this group are consistent with Iran 's efforts at controlling political dissent and expanding offensive cyber capabilities , the relationship between this group and the Iranian government remains inconclusive 
In one case , '' HUrr ! c4nE ! '' , using the email address keyvan.ajaxtm @ gmail [ 
] com , has been flagged for possible fraud by an online retailer 
While '' HUrr ! c4nE ! '' is engaged in operations that align with Iran 's political objectives , he may also be dabbling in traditional cybercrime 
This indicates that there is a considerable grey area between the cyber espionage capabilities of Iran's hacker groups and any direct Iranian government or military involvement 
On the spectrum of state responsibility , these attacks align with state-encouraged attacks , which are defined as attacks in which : Third parties control and conduct the attack , but the national government encourages them as a matter of policy 
Recruiting hackers through this model allows Iran to influence their activities , and provides the Iranian government plausible deniability , but a lack of direct control also means that the groups may be unpredictable and engage in unsanctioned attacks 
The increased politicization of the Ajax Security Team , and the transition from nuisance defacements to operations against internal dissidents and foreign targets , coincides with moves by Iran aimed at increasing offensive cyber capabilities 
While the relationship between actors such as the Ajax Security Team and the Iranian government is unknown , their activities appear to align with Iranian government political objectives 
The capabilities of the Ajax Security Team remain unclear 
This group uses at least one malware family that is not publicly available 
We have not directly observed the Ajax Security Team use exploits to deliver malware , but it is unclear if they or other Iranian actors are capable of producing or acquiring exploit code 
While the Ajax Security Team 's capabilities remain unclear , we know that their current operations have been somewhat successful as measured by the number of victims seen checking into to an Ajax Security Team controlled CnC server 
We believe that if these actors continue the current pace of their operations they will improve their capabilities in the mid-term 
FireEye has invented a purpose-built , virtual machine-based security platform that provides real-time threat protection to enterprises and governments worldwide against the next generation of cyber attacks 
These highly sophisticated cyber attacks easily circumvent traditional signature-based defenses , such as next-generation firewalls , IPS , anti-virus , and gateways 
The FireEye Threat Prevention Platform provides real-time , dynamic threat protection without the use of signatures to protect an organization across the primary threat vectors and across the different stages of an attack life cycle 
The core of the FireEye platform is a virtual execution engine , complemented by dynamic threat intelligence , to identify and block cyber attacks in real time 
FireEye has over 1,500 customers across more than 40 countries , including over 100 of the Fortune 500 
We thank Kenneth Geers and Jen Weedon for their support and analysis on these findings 
Thank you for subscribing to Episode 16 of the HP Security Briefing 
In this edition we discuss the cyber landscape within the Democratic People's Republic of Korea 
The Democratic People 's Republic of Korea ( DPRK ) , known in the West as North Korea , is a unique country with a military-focused society and an unconventional technology infrastructure 
While North Korea was formerly on the U.S. list of state sponsors of terrorism , it was removed in 2008 
However , due to North Korea 's hostility toward other nations , its pursuit of nuclear weapons , and human rights violations against its own citizens , the United Nations and many Western entities have placed sanctions and embargoes against North Korea 
For example , U.S. export laws forbid the sale of dual-use technologies , or those that can be used or repurposed for both civilian and military use , to North Korea 
< /n > 5 < /fn > Additionally , the U.S. has a military alliance with the Republic of Korea ( ROK ) , known in the West as South Korea , North Korea 's primary target of conflict 
Due to North Korea 's global interactions , its cyber warfare capabilities are of particular interest to the U.S 
According to a 2009 report by Major Steve Sin , an intelligence analyst at U.S 
Forces Korea , North Korean hackers have successfully penetrated U.S. defense networks more frequently than any other country that has targeted U.S. defense assets 
While Major Sin may have been overly optimistic about North Korea 's abilities , it is clear that they should not be underestimated 
Frank Cilluffo , co-director of the Cyber Center for National and Economic Security at George Washington University , testified before Congress that North Korea 's cyber capability '' poses an important 'wild card ' threat , not only to the United States but also to the region and broader international stability… '' In an April 2014 testimony given to the House Armed Services Committee , General Curtis M. Scaparrotti noted that '' North Korea remains a significant threat to United States ' interests , the security of South Korea , and the international community due to its willingness to use force , its continued development and proliferation of nuclear weapon and long- range ballistic missile programs , and its abuse of its citizens ' human rights , as well as the legitimate interests of its neighbors and the international community 
'' Scaparrotti stressed that '' While North Korea 's massive conventional forces have been declining due to aging and lack of resources…North Korea is emphasizing the development of its asymmetric capabilities 
North Korea 's asymmetric arsenal includes…an active cyber warfare capability 
'' While one would expect the regime 's digital infrastructure to also suffer from aging or lack of resources , these factors do not take away from their technical abilities to wage cyber warfare 
While the U.S. views North Korea 's cyber warfare program as the regime 's foray into modern asymmetrical warfare , South Korea views the regime 's cyber capabilities as a terroristic threat , -a build-up for an impending multifaceted attack 
It is important to note that , to date , no such attack has occurred 
According to a report written by Captain Duk-Ki Kim , Republic of Korea Navy officer and Ph.D. '' …the North Korean regime will first conduct a simultaneous and multifarious cyber offensive on the Republic of Korea 's society and basic infrastructure , government agencies , and major military command centers while at the same time suppressing the ROK government and its domestic allies and supporters with nuclear weapons 
'' South Korea 's view of North Korea as a terroristic threat may be an attempt to downgrade North Korea politically , since South Korea does not recognize the regime as a legitimate state 
South Korean reports also claim that North Korea 's premier hacking unit , Unit 121 , trails Russia and the U.S. as the world 's third largest cyber unit 
While this claim may be exaggerated , in 2012 , South Korean reports estimated North Korea 's hacker forces at around 3000 personnel 
In a July 2014 report from South Korea 's Yonhap News Agency , that figure was upgraded to 5900 hacker elite 
We must stress that although these claims have not been corroborated , South Korea has taken the regime 's cyber threats very seriously and is reportedly training 5000 personnel to defend against North Korean cyber attacks 
Obtaining details on North Korea 's cyber warfare capabilities is not an easy task 
This paper will examine the known cyber capabilities of North Korea 's regime and how the country maintains secrecy in these matters 
Through information obtained via open source intelligence ( OSINT ) , we will present what is known about North Korea 's cyber warfare and supporting intelligence and psychological operations capabilities 
The following conditions proved to be research roadblocks when gathering intelligence regarding North Korea 's cyber warfare capabilities :  Much of the intelligence available on North Korea is dated and may not accurately reflect the regime 's current capabilities 
 Much of the intelligence available on North Korea comes from U.S. or South Korean military or agency reports 
These reports omit details that are likely classified , such as specific IP addresses and individual actor information 
 While South Korea is an ally of the United States , its reports on North Korean cyber activity potentially contain incomplete or biased information 
Cultural factors that stem from a history of tension and conflict between the two nations may skew perception and make objectivity difficult 
 North Korea 's Internet infrastructure and the regime 's strict control over its use ensures that there are no rogue actors and that all officially sanctioned actors exercise careful OPSEC and PERSEC practices in order to prevent inadvertent information leaks 
In other words , there was no significant identifying information in the form of an OSINT trail left behind by the actors 
This hinders collection of original , actionable threat intelligence and individual actor attribution 
 North Korea is well-isolated from the outside world , and its strong intelligence and psychological operations presence effectively creates confusion via counterintelligence and disinformation about the regime 's capabilities 
For this reason , any '' official '' reports emanating from North Korea must be taken with a grain of salt 
This also hinders attempts to obtain original , actionable threat intelligence 
In order for Westerners to understand the North Korean mindset , it is necessary to examine the key components of North Korean political and ideological thought 
It is also necessary to provide a brief explanation of how North Korea and South Korea view one another , in order to understand the basis for conflict between the two 
North Korea has two primary ideologies that provide context for the regime 's motivations and activities : juche ( ju-cheh ) and songun ( sun-goon ) 
Juche is the official political ideology of North Korea 
It was instituted in 1972 and is based on the ideologies of Kim Il-Sung , the founder of the DPRK 
Juche emphasizes self-reliance , mastering revolution and reconstruction in one 's own country , being independent of others , displaying one 's strengths , defending oneself , and taking responsibility for solving one 's own problems 
North Korea 's air-gapped intranet , described below , exemplifies this philosophy in the country 's cyber infrastructure 
The juche philosophy explains North Korea 's disdain for outside cultural and political influence 
Juche challenges North Koreans to contribute to the regime 's chaju ( ja-ju ) , a concept of national sovereignty and independence 
The regime 's greatest fear is internal dissent and resulting destabilization 
In a June 2014 Reddit AMA session , Dr. Andrei Lankov , an expert on North Korean culture and society , noted '' there are also serious signs of public alienation and discontent 
And I can not rule out a public outbreak of such discontent in the near future 
Of course , if it happens , it will have a serious impact on the government 
'' Despite North Korea 's strong conviction in juche , the regime collaborates with and receives support from other nations 
However , due to this deep-seated ideology , it is doubtful that North Korea fully trusts these apparent allies 
Later in this document , we will show that North Korea relies heavily on China for Internet access 
North Korea also collaborates with China and Russia to train its cyber warriors and has longstanding political and military relationships with several nations 
Songun is North Korea 's '' military first '' doctrine 
Songun emphasizes the priority of the military in resource allocation and political and economic affairs 
This doctrine stems from the belief that the military is vital for preservation of chaju 
Understanding songun mindset gives context for this potential threat actor 's motivations 
According to a 2013 Congressional report , the strategy established under former leader Kim Jong-Il focused on '' internal security , coercive diplomacy to compel acceptance of its diplomatic , economic and security interests , development of strategic military capabilities to deter external attack , and challenging South Korea and the U.S.-South Korean alliance 
'' North Korea 's songun permeates the lives of all North Korean citizens 
Article 58 of the North Korean Constitution states that the nation should base itself on a nationwide defense system that includes all people 
North Korea , with a population of 25 million , has an active duty force of 1.19 million personnel , the fourth largest in the world 
The country 's reserve and paramilitary units comprise 7.7 million additional personnel 
In other words , over a third of the country's population serves in a military or paramilitary capacity 
Some North Korean youth aged 7-13 are inducted into the Korean Children 's Union 
The Korean Children 's Union is responsible for indoctrinating youths who pledge to build up their strength to later defend the regime 
Children aged 14-16 can begin military training as members of the Young Red Guards , a paramilitary unit 
Beginning at age 17 , North Koreans are eligible to join the Reserve Military Training Unit 
The Reserve Military Training Unit forms the core of North Korea 's reserves and is typically assigned to the front or regional defense in wartime 
The youngest age at which a citizen can be conscripted for active duty is unclear ; reported ages range from 18-20 
Youths can volunteer for active duty service at age 16 or 17 
The Worker-Peasant Militia , or Red Guards , includes males ages 17-60 and unmarried females ages 17-30 who are not part of active duty units or the Reserve Military Training Unit 
The regime has an impressive number of conventional weapons , considering the nation 's small land area and population size 
According to statistics released by CNN in 2014 , North Korea's ground arsenal includes 4100 tanks , 2100 armored vehicles , and 8500 pieces of field artillery 
The regime 's sea weaponry includes 70 submarines , 420 patrol combatants , and 260 amphibious landing craft 
Their airpower includes 730 combat aircraft , 300 helicopters , and 290 transport aircraft 
While the limits of the regime 's ballistic missile program are unknown , North Korea is thought to have fewer than 100 short-range missiles and fewer than 100 medium to long-range missiles 
However , in recent years , North Korea has suffered oil , fuel , electricity , and food shortages 
Without aid from another entity , the regime does not have sufficient resources to maintain and sustain the majority of its weapons and associated personnel for rapid deployment or prolonged combat 
Tension between North and South Korea has continued well past the armistice meant to end the Korean War 
Neither nation recognizes the other as a legitimate state 
South Korea 's constitution legally defines South Korean territory as the entire Korean peninsula and its adjacent islands , with '' North Korea '' being a part of South Korea 
North Korea also claims to be the sole government of the Korean Peninsula 
Each country 's claim of sovereignty and refusal to acknowledge the other as a legitimate state creates the condition for perpetual conflict 
North Korea 's negative sentiment towards the U.S. stems from two major factors : the U.S. – South Korea military alliance and North Korea 's perception that the U.S. is imperialistic and prone to exploitative capitalism 
In recent years , two primary factors have heavily influenced the current state of North Korea's relations with South Korea and her allies : the rise of the regime 's leader Kim Jong Un and the inauguration of South Korean president Park Guen Hye 
Kim Jong Un officially rose to power in April 2012 , following the death of his father Kim Jong Il in December 2011 
While his age remained a mystery for quite some time , it was later revealed that he was born in January 1983 , making him age 31 at present 
This makes Kim Jong Un the world 's youngest leader of an established nation 
The young leader 's rise to power brought about several changes in North Korea 
First , Kim Jong Un 's personal life is more public and more extravagant than that of his father 
Unlike his father , the young Kim is often accompanied by his wife when making public appearances 
Second , the young Kim , who is more high-tech than his predecessor , is reported to have an affinity for luxury items and is an avid gamer and basketball fan 
Third , Kim Jong Un is more totalitarian than his father 
Following his rise to power , the regime reportedly expanded its labor camps , and more military resources were allocated to target those attempting to defect 
Kim also executed his own uncle , a high-ranking official who did not share his ideals 
These moves indicate the regime 's priority to deter internal destabilization and dissent , which is perceived to be a greater threat than outside adversity 
According to Phil Robertson , deputy Asia director at Human Rights Watch , '' The government now recognizes that the accounts of escaping North Koreans reveal Pyongyang 's crimes – so it is doing what it can to stop people from fleeing 
'' Under Kim Jong Un 's rule , the regime has stepped up its nuclear materials production , and the propaganda distributed by state media has become more menacing 
The regime 's response to perceived threats has also become more volatile 
Christian Whiton , a former deputy envoy to North Korea , noted that following Kim Jong Un 's rise to power , '' the regime still acts in a very belligerent manner , but it seems less predictable , and more random 
'' Ellen Kim , assistant director of the Korea Chair at the Center for Strategic and International Studies , assessed the situation thusly : '' Since [ Kim Jong Un ] took power he has purged almost all of his elder guardians ... and filled his surroundings with new faces 
We are in a situation where we are learning about him a little bit every day through his unpredictable behavior and actions , which is why the current situation with North Korea is a lot more dangerous than before 
'' The regime's recent reaction to an upcoming film supports these statements 
The plot for the comedy film '' The Interview '' follows two talk show hosts who are asked to assassinate Kim Jong Un 
The regime even sent a complaint about the movie to the UN 
In response to the film , a North Korean official stated , '' The enemies have gone beyond the tolerance limit in their despicable moves to dare hurt the dignity of the supreme leadership 
'' The official referred to the movie as '' the most undisguised terrorism and a war action to deprive the service personnel and people of the DPRK of their mental mainstay and bring down its social system 
'' The official also issued a threat : '' If the U.S. administration connives at and patronizes the screening of the film , it will invite a strong and merciless countermeasure 
'' This reaction demonstrates North Korea 's priority of preserving the regime 's self-perceived dignity in the global arena and its intolerance of any disrespect directed at the Kim family 
While tensions between North and South Korea have persisted since the Korean War , these tensions escalated following the 2013 inauguration of South Korea 's current president , Park Geun Hye 
Her platform , in her words , is as follows : '' North Korea must keep its agreements made with South Korea and the international community to establish a minimum level of trust , and second there must be assured consequences for actions that breach the peace 
To ensure stability , trustpolitik should be applied consistently from issue to issue based on verifiable actions , and steps should not be taken for mere political expediency 
'' Shortly after Park 's inauguration , North Korea denounced UN Security Council Resolution 2094 , which is '' a resolution strengthening and expanding the scope of United Nations sanctions against the Democratic People 's Republic of Korea by targeting the illicit activities of diplomatic personnel , transfers of bulk cash , and the country 's banking relationships , in response to that country 's third nuclear test on 12 February [ 2013 ] 
'' North Korea also responded strongly to joint U.S.-South Korea military exercises in March 2013 , as is noted later in this paper 
North Korea 's cyber infrastructure is divided into two major parts : an outward-facing Internet connection and a regime-controlled intranet 
North Korea 's outward-facing Internet connection is only available to select individuals and is closely monitored for any activity that is deemed anti- regime 
Individuals using the outward-facing Internet connection must be authorized 
In 2013 , Jean H. Lee , the Associated Press bureau chief in Pyongyang , stated that foreigners visiting North Korea are allowed Internet access with no firewalls 
Common citizens are limited to using the Kwangmyong ( gwang me-young ) , a nationwide intranet with no access to the world outside North Korea 
According to Lee , Kwangmyong allows citizens '' access to the state media , information sources that are vetted by the government , and picked and pulled from the Internet and posted to their intranet site 
'' As of May 2013 , North Korea had only one '' Internet café 
'' A 2003 report from the Office of the National Counterintelligence Executive stated that North Korea 's '' Internet café '' was '' the only place in North Korea for the public to access the Internet '' and that foreigners were allowed to access the Internet from this café 
Whether citizens are allowed to access the Internet from this location is unknown 
Star Joint Venture Co. is responsible for providing North Korea 's Internet access 
Star Joint Venture Co. was established by the Post and Telecommunications Corporation in cooperation with Loxley Pacific in Thailand 
In December 2009 , Star Joint Venture became responsible for North Korea's Internet address allocation 
Previously , Internet access was provided by a German satellite link via Korea Computer Center Europe or via direct connections with China Netcom , which was later merged into China Unicom 
By October 2010 , North Korea had made its first known direct connection to the Internet , hosting an outward-facing Korean Central News Agency website accessible from the global Internet 
However , many of North Korea 's globally accessible websites are hosted in other countries 
In 2001 , South Korean reports indicated that North Korea had joined the International Telecommunications Satellite Organization ( INTELSAT ) 
As of April 2012 , North Korea reportedly used the Intelsat connection , which appeared in border gateway protocol ( BGP ) announcements 
Some reports referred to the Intelsat connection as North Korea 's backup Internet connection , in case the China Unicom connection fails 
A March 2013 post on the blog rdns.im showed that North Korea no longer used the Intelsat connection 
In the blog post , the author noted his method for proving that The Pirate Bay was not hosted in North Korea 
While his analysis of The Pirate Bay 's hosting is irrelevant to our research , he did detail that 175.45.177.0/24 always routes through AS4837 , and AS131279 
AS131279 is Star-KP , North Korea 's Star Joint Venture Company , and AS4837 is China Unicom 
The author concluded that '' all [ traffic ] is ONLY routed through China Unicom and NOT through Intelsat 
'' In February 2014 , North Korean and South Korean officials agreed to extend Internet access to Kaesong Industrial Zone , a jointly operated industrial complex just north of the border 
However , this would likely require a major electrical and network infrastructure expansion 
North Korea 's electrical grid can not support a large technological infrastructure 
Electrical power is reported to be unreliable and sporadic , with many citizens only receiving a few hours of electricity per day 
The photo above ( Figure 3 ) , from the International Space Station , shows North Korea 's sparse power grid , in comparison with surrounding nations 
We have highlighted North Korea in red 
Koryolink , the country 's only cellular phone network , is tightly controlled by the regime 
Cell phone data plans are not available to most users 
Most cellular phones can not access the Internet and can only make domestic calls 
According to a 2013 report , North Korea has a 3G data network for cellular phones 
Visiting reporter Jean H. Lee purportedly used this 3G network to post to both Twitter and Instagram 
However , citizens are not generally allowed to use the 3G network 
Email is also regulated by the regime 
The first email provider in North Korea was Silibank 
Silibank has servers in Pyongyong and Shenyang and is a joint venture with China 
The North Korean Silibank homepage is silibank.net , and the Chinese homepage is silibank.com 
In order to use the email service , users had to initially register , provide personal information , and pay a registration fee and monthly service fees 
This registration information was current as of 2001 
However , it is unknown whether the same process still applies 
WHOIS records for silibank.net show that the site was registered anonymously via a Japanese registrar 
This information can be found in Appendix A at the end of this paper 
Korea Computer Center ( KCC ) is North Korea 's leading government research center for information technology 
KCC has eleven regional information centers and eight development and production centers 
Other countries with KCC branch offices include China , Syria , Germany , and United Arab Emirates 
KCC has a vested interest in Linux research and is responsible for the development of North Korea 's national operating system , Red Star OS , which is discussed in more detail below 
KCC 's other projects have included a proprietary search engine , a document writer , a game called Jang-Gi , the Kwangmyong intranet , a food study program , a Korean input method editor , a pen-based English-Korean and Korean-English translator , Korean voice recognition software , a video conferencing system , a distance education system , SilverStar Paduk software , HMS Player , and the Samjiyon tablet 
In addition to research and development , KCC also monitors websites of foreign government and business entities and conducts technical reconnaissance to blueprint the technical specifications and vulnerabilities in foreign systems and technologies 
KCC has also been involved in clandestine information and cyber operations , serving as a command center 
North Korea 's proprietary operating system is Red Star OS 
The development of this Linux-based operating system started in 2002 
Red Star OS is only offered in the Korean language and features proprietary software including Naenara ( a Firefox-based browser ) , as well as a text editor , email client , audio and video players , and games 
Red Star OS 's keyboard layouts include Korean , English , Russian , Chinese , and Japanese 
Regime ideals extend to Red Star OS 
The readme file , which goes with the installation disc , reportedly includes a quote from Kim Jong-Il regarding the importance of North Korea having its own Linux-based operating system that is compatible with Korean traditions 
While prior versions of Red Star were KDE-based , version 3.0 mimics Apple 's OS X 
This could indicate the regime leader Kim Jong Un 's preference for the OS X environment , as Kim reportedly uses an iMac 
Citizens do not need permission to obtain Red Star OS 
However , the purchase of computers is heavily regulated 
The OS 's design suggests it was developed with means for the regime to monitor user activity 
North Korea is known to use two IP ranges 
175.45.176.0/22 is North Korea 's own IP block 
Additionally , North Korea 's Telecommunications Ministry is the registered user of China Unicom IP range 210.52.109.0/24 
The country 's only autonomous system ( AS ) number is AS131279 , and its only peer is AS4837 , the AS for China Unicom 
North Korea 's country code top-level domain ( ccTLD ) is .kp 
In 2007 , the .kp TLD was initially delegated to and administered by the German-based KCC Europe 
After KCC Europe failed to maintain the TLD , it was re-delegated to Star Joint Venture Company 
The .kp TLD uses the following nameservers and IP addresses : Various U.S. , U.N , and other sanctions prohibit export of dual-use technologies to North Korea 
In light of this , North Korea has managed to develop both hardware and software and hosts an annual National Exhibition of Invention and New Technologies to promote its products 
However , the regime has historically failed in its attempts at large-scale production of electronic components 
The country 's sparse electrical grid is one of the major obstacles hindering large- scale manufacturing 
Additionally , the famine in the early 1990 's negatively impacted existing manufacturing facilities , and the regime simply does not have the capital to modernize those factories 
A member of the World International Property Organization ( WIPO ) , North Korea joined the WIPO Patent Cooperation Treaty that protects patents and trademarks worldwide , and leverages intellectual property laws to ensure Westerners do not take credit for North Korean inventions 
The regime , in its efforts to isolate its citizens from Western influence , leverages intellectual property laws to ensure Westerners do not take credit for North Korean inventions 
This is ironic since foreign-made electronic components are sometimes smuggled into North Korea for military use and for personal use by the regime 's upper echelon 
A comparison of a scan of North Korea 's IP ranges in November 2010 , just one month after North Korea made its first direct connection to the Internet , and a series of several scans we conducted in May 2014 , shows that North Korea has made significant headway in establishing its Internet presence 
In the November 2010 scan , 175.45.176.0 - 175.45.176.16 showed a variety of devices including D-link , Cisco , Linksys , HP , and Nokia devices , and a Juniper networks firewall 
Operating systems detected included FreeBSD 6.x , Linux 2.6.x , and Red Hat Enterprise Linux 
175.45.176.14 returned '' Naenara '' as an html-title 
Most hosts in the 175.45.176.xx and 175.45.177.xx ranges were down 
As of 2014 , IP addresses 175.45.176.0 - 175.45.177.255 appear to be used for websites , nameservers , databases , email , and voice over IP ( VoIP ) 
In November 2010 , the 175.45.178.xx range showed all hosts down , and the 175.45.179.xx range showed most hosts were down 
In 2014 , several webservers and nameservers were found in the 175.45.178.xx range , and several nameservers and mail servers were found in the 175.45.179.xx range 
This comparison demonstrates that there has been some growth in DPRK Internet infrastructure over the past four years 
However , it seemingly lags behind even most third world nations 
The 2014 scans detected dated technology that is potentially susceptible to multiple vulnerabilities and consistently showed the same open ports and active devices on scanned hosts 
It is not clear whether the regime failed to notice and react to the scanning or whether the regime allows these open ports and devices to be detected or spoofed to serve as a distraction or possible honeypot 
Domains , nameservers , and mail servers present during the May 2014 scan are listed in Appendix B at the end of this report 
According to Alexa rankings , the three most visited websites in North Korea are kcna.kp , the official website of the Korean Central News Agency ( KCNA ) ; rodong.rep.kp , another North Korean news site ; and naenara.com.kp , North Korea 's official web portal 
Naenara translates to '' my country '' 
The kcna.kp site was registered using a Loxley.co.th email address and is administrated by Star Joint Venture Company 
The WHOIS Record can be found in Appendix A. Rodong.rep.kp was registered using the same loxley.co.th email address and is also administered by Star Joint Venture Company 
The WHOIS Record for this site can be found in Appendix A 
The WHOIS information for Naenara.com.kp was not available 
In March 2013 , there were reports that the Chrome browser was blocking Naenara.com.kp due to malware 
It is difficult to say whether this incident is a case of North Korea serving malware or whether a third party took advantage of an improperly secured website 
Several major North Korean websites are hosted outside of North Korea 
The popular Uriminzokkiri.com website , whose name translates to '' our nation , '' is hosted in China 
The administrative contact for the website is Kim Sejun , and the email address given as contact information is hyk1979 @ hotmail.com 
The WHOIS Record for this site can be found in Appendix A 
The website for Kim Il Sung Open University , otherwise known as '' Our Nation School '' is also hosted in China 
The WHOIS record for this site can be found in Appendix A 
At the top of North Korea 's military structure is the National Defense Commission ( NDC ) 
The NDC is also the highest branch of government and the regime 's supreme policymaking body 
Along with the Central Committee of the Workers ' Party of Korea and the Cabinet , NDC is at the top of North Korea 's political hierarchy 
Article 106 of North Korea 's Constitution gives the NDC the following powers :  The power to establish policies of the state in accordance with the military-first revolutionary line 
 The power to guide the armed forces and oversee defense building 
 The power to supervise and ensure the NDC and its chairman 's orders are executed and to establish necessary measures 
 The power to override any state decisions or directives that are in opposition to the NDC or its chairman 's decisions and directives 
 The power to create or remove central organs of the national defense sector 
 The power to create and bestow military titles above general-grade officer rank 
The NDC oversees several defense and intelligence bodies including the Ministry of State Security , the Ministry of People 's Security , the Ministry of People 's Armed Forces , and the Korean People's Army 
The Ministry of State Security ( MSS ) , also known as the State Security Department , is North Korea 's primary counterintelligence service 
It is considered an autonomous agent of the regime and reports directly to leader Kim Jong Un 
The MSS 's duties include oversight of North Korean prison camps , investigation of domestic espionage , repatriation of defectors , and overseas counterespionage operations 
The Ministry of People 's Security is also known as the Ministry of Public Security ( MPS ) 
Focused on domestic order , it oversees North Korea 's national police force , conducts criminal investigations and preliminary examinations , and oversees correctional facilities , excluding prison camps 
While the roles of the MSS and MPS focus more on intelligence than on cyber operations , the MSS also reportedly has a communications monitoring and computer hacking group 
The Ministry of People 's Armed Forces ( MPAF ) administrates the Korean People 's Army ( KPA ) and oversees the General Staff Department ( GSD ) , which is responsible for operational command and control of North Korea 's armed forces 
The General Staff Department also oversees the Reconnaissance General Bureau ( RGB ) , North Korea 's agency for clandestine operations 
The RGB has a role in both traditional and cyber operations 
In the past , the RGB has sent agents on overseas military assistance missions to train insurgent groups 
The RGB reportedly has a special operations forces ( SOF ) element and oversees six bureaus that specialize in operations , reconnaissance , technology and cyber matters , overseas intelligence collection , inter-Korean talks , and service support 
Two of these bureaus have been identified as the No 
91 Office and Unit 121 
The No 
91 Office , an office responsible for hacking , operates out of the Mangkyungdae-district of Pyongyang 
Unit 121 comprises both an intelligence component and an attack component 
Unit 121 's headquarters is in the Moonshin-dong area of Pyongyang , near the Taedong River 
It also has components that conduct operations from within China 
One of Unit 121 's command posts is Chilbosan Hotel in Shenyang , the capital of Liaoning Province , which borders North Korea 
Shenyang is a Chinese military district 
According to Dr. Alexandre Mansourov , an expert on North Korea and a visiting scholar at the U.S.-Korea Institute at Johns Hopkins University , '' They [ Unit 121 ] are believed to have conducted hacking operations from inside China that falsify classified data and disrupt U.S. and South Korean systems 
'' Both Unit 121 and an entity known as Lab 110 are reported to maintain technical reconnaissance teams responsible for infiltrating computer networks , hacking to obtain intelligence , and planting viruses on enemy networks 
Several entities are nested under the Workers ' Party 
The Central Party Committee oversees the Central Party Investigative Group , also known as Unit 35 
Unit 35 is reportedly responsible for technical education and training of cyber warriors 
The Unification Bureau 's Operations Department is responsible for cyber-psychological warfare , organizational espionage , and oversight of Unit 204 
Unit 204 's responsibilities include planning and execution of cyber-psychological warfare operations and technological research 
The Psychological Operations Department of the North Korea Defense Commission also engages in cyber-psychological warfare 
The 225th Bureau , or Office 225 , is responsible for training agents , infiltration operations in South Korea , and creation of underground political parties in order to incite disorder and revolution 
It plays a more traditional intelligence and psychological operations role , rather than focusing on cyber operations 
The United Front Department ( UFD ) conducts overt operations to create pro-North Korean groups in South Korea 
Examples of this activity include the Korean Asia-Pacific Committee and the Ethnic Reconciliation Council 
The UFD also manages inter-Korean dialogue and North Korea's policy toward South Korea 
Its operations are also more traditional rather than cyber-focused 
The Liaison Department of the Worker 's Party oversees a faction of ethnic North Koreans residing in Japan who are critical to North Korea 's cyber and intelligence programs 
This group , which was established in 1955 , is referred to by various names including the Chosen Soren , Chongryon , and the General Association of Korean Residents in Japan 
The Chongryon ascribe to juche and seek to preserve North Korean culture while living in Japan 
They operate North Korean style schools and refuse to assimilate with Japanese culture 
According to Mitsuhiro Suganuma , former section head of the second intelligence department of the Japanese Public Security Intelligence Agency ( PSIA ) , '' Chongryon is virtually under the direct control of the Liaison Department of the Workers ' Party of Korea , which has been in charge of North Korea 's covert operations and underground activities against South Korea 
Chongryon in Japan has been a strong support organization aimed at bringing a revolution in South Korea , or a red unification by force 
'' He also stated '' North Korea will continue to make Chongryon serve as Pyongyang 's pawn in covert operations against South Korea 
'' The Chongryon are vital to North Korea 's military budget , raising funds via weapons trafficking , drug trafficking , and other black market activities 
The group also forms '' front companies '' abroad that benefit the regime by generating hard currency 
One example is Unikotech , which was formed to sell KCC products abroad 
The Chongryon 's underground group known as the Gakushu-gumi , or '' the study group '' , gathers intelligence for North Korea and helps the regime procure advanced technologies 
The Chongryon 's role in North Korean intelligence and resource acquisition is discussed below in more detail 
The regime also has several government bodies under the Cabinet that oversee its infrastructure , intelligence , and technological development 
These include the Central Scientific and Technological Information Agency ( CSTIA ) , the Ministry of Electronics Industry , and the Ministry of Posts and Telecommunications 
The CSTIA collects , analyzes , and processes data regarding advanced science and technology then sends relevant information to appropriate areas of the national economy 
The amount of information contained in CSTIA's technical database makes it North Korea 's largest scientific facility 
According to a CIA article , review of CSTIA 's publications showed that China , Russia , and Japan are important sources of technical data 
CSTIA 's publications include newsletters and an 18-volume science and technology reference series 
The Ministry of Posts and Telecommunications is the body of oversight for Star Joint Venture Co. North Korea 's cyber warfare doctrine has not been clearly stated 
However , based on cultural and technical observations , we may deduce that North Korea 's cyber doctrine follows the tenets of juche nationalism and the songun doctrine 
Although North Korea 's limited online presence makes a thorough analysis of their cyber warfare capabilities a difficult task , it must be noted that what is known of those capabilities closely mirrors their kinetic warfare tactics 
Cyber warfare is simply the modern chapter in North Korea's long history of asymmetrical warfare 
North Korea has used various unconventional tactics in the past , such as guerilla warfare , strategic use of terrain , and psychological operations 
The regime also aspires to create viable nuclear weapons 
Asymmetrical warfare is defined as '' a conflict in which the resources of two belligerents differ in essence and in the struggle , interact and attempt to exploit each other 's characteristic weaknesses 
Such struggles often involve strategies and tactics of unconventional warfare , the 'weaker ' combatants attempting to use strategy to offset deficiencies in quantity or quality '' 
According to the aforementioned report to the House Armed Service Committee , '' Cyber warfare is an important asymmetric dimension of conflict that North Korea will probably continue to emphasize - in part because of its deniability and low relative costs 
'' North Korea 's poor economic state , further explains the regime 's reliance on these tactics 
In 2014 , the regime reportedly spent 16 % of its budget on defense 
The North Korean military places a strong emphasis on information warfare capabilities including political and psychological warfare and cyber or hacker warfare 
The report by Capt 
Duk-Ki Kim , Ph.D. highlighted North Korea 's counter-asymmetric strategy and ranked each based on intensity and frequency : Just ten years ago , experts noted that North Korea was one of the '' least network-ready and most isolated societies on the planet 
'' Today North Korea 's air-gapped networks and prioritization of resources for military use provide both a secure and structured base of operations for cyber operations and a secure means of communications 
North Korea 's hermit infrastructure creates a cyber-terrain that deters reconnaissance 
Because North Korea has few Internet connections to the outside world , anyone seeking intelligence on North Korea 's networks has to expend more resources for cyber reconnaissance 
A 2003 article by the U.S. Office of the National Counterintelligence Executive assessed that '' Development of the nation , rather than empowerment of the individual , appears to be driving DPRK efforts to develop domestic IT infrastructure and industry 
'' In November 2013 , Kim Jong Un referred to cyber warfare capabilities as a '' magic weapon '' in conjunction with nuclear weapons and missiles 
According to Kim Heung-kwang , a North Korean defector and former computer science professor , the regime has the following motivations for expanding its cyber warfare capabilities :  Cyber capabilities are a cost-effective way to offset North Korea 's lack of kinetic military prowess 
 North Korea 's school systems place a strong emphasis on math , giving the nation confidence in its programmers , cryptographers , and security researchers 
 In the modern warfare landscape , cyber capabilities are potentially more utilitarian than heavy artillery or aircraft 
 Cyber warfare capabilities provide a platform for espionage , psychological operations , and other forms of non-kinetic warfare 
 Considering the separatist nature of North Korea 's infrastructure , cyber warfare provides a strategic advantage since outbound attacks are possible , but inbound attacks would have limited reach 
 Cyber warfare allows North Korea to leverage the Internet 's inherent flaws for offensive purposes while maintaining its defenses , primarily via air-gapping its most critical networks from the outside world 
North Korea 's attack and defense capabilities reportedly include the following cyber warfare and electronic warfare components : offensive cyber operations ( OCO ) ; computer network operations ( CNO ) , which includes both computer network attack ( CNA ) and computer network exploitation ( CNE ) ; distributed denial of service ( DDoS ) ; satellite monitoring ; drones ; GPS jamming capabilities ; and deployment of electromagnetic pulse ( EMP ) 
North Korea 's OCO and CNO capabilities became apparent as early as 2004 , when North Korea reportedly gained access to 33 of 80 South Korean military wireless communication networks 
In June 2006 , an attack on the U.S. State Department originating in the East Asia-Pacific region coincided with U.S.-North Korea negotiations over the regime 's nuclear missile testing 
A month later , a South Korean military report implicated North Korea 's Unit 121 in hacking the South Korean and U.S. Defense Departments 
North Korea also tested a logic bomb in October 2007 
A logic bomb is malicious code programmed to execute based on a pre-defined triggering event 
Following the logic bomb test , the UN passed a resolution banning sales of certain computer hardware to North Korea 
North Korea considers its cyber warfare capabilities an important asymmetric asset in the face of its perceived enemies , the U.S. and South Korea 
While North Korea does not have an immersive digital culture , both the U.S. and South Korea are heavily dependent upon technological infrastructure for social , economic , and political stability 
For this reason , a cyber attack that cripples or compromises the reliability of the U.S. or South Korea 's technological infrastructure could have a far-reaching impact 
North Korea has reportedly used computer games for both illegal capital gain and orchestrating cyber attacks 
In 2011 , South Korean police arrested five individuals , including one Chinese national , for allegedly collaborating with North Korean hackers affiliated with the Korea Computer Center to steal money via online games 
According to South Korean reports , the culprits used an auto-player to quickly progress in the massively multiplayer online role-playing game ( MMORPG ) '' Lineage '' and were able to use the game 's market to obtain real currency 
In 2013 , South Korean officials released information stating they had found evidence that North Korea was using games as a medium for infecting machines and launching cyber attacks 
North Korea had used game downloads to infect 100,000 South Korean machines for a botnet used to launch a distributed denial of service ( DDoS ) attack against Incheon Airport 
This clever tactic sought to leverage a seemingly innocent game as a force multiplier in order to amplify the effects of a DDoS attack on a critical infrastructure target 
However , in this case , there was little impact on the target 
North Korea 's intelligence program is one of its strongest military assets , providing foundational support for all other military operations 
The regime 's cyber warfare capabilities , in particular , rely heavily on open-source intelligence ( OSINT ) collection and cyber-espionage 
As noted in a CIA publication , '' It is a significant irony of our information age that open-source intelligence is contributing to the survival and development of one of the world 's most secretive regimes 
'' Historically , the primary goals of the regime 's intelligence program included collection and dissemination of intelligence concerning any possible political , military , or economic threat to the regime 's security and stability 
Secondary goals have included '' acquisition of foreign military and civilian technologies and equipment , support of the DPRK 's foreign policy goals , training and support for foreign revolutionary and terrorist organizations , and the acquisition of foreign capital for state and intelligence operations 
'' North Korea has a broad reach for intelligence collection , which extends to cyber intelligence 
In April 2013 , Solutionary , a company providing managed security services , reported a marked increase in both overt attacks and information gathering attempts originating from North Korean IPs 
Solutionary refers to any overt external attacks on company networks or attempts to steal data as '' touches 
'' They reportedly recorded 12,473 of these touches in February 2013 , 11,000 of which were directed at a single financial institution 
As a baseline , Solutionary noted that typically only 200 incidents per month are traced to North Korean origin 
This is an interesting claim , considering that attacks attributed to North Korea are usually routed through other countries 
As mentioned above , a faction of ethnic North Koreans residing in Japan , known as the Chongryon , are critical to North Korea 's cyber and intelligence programs and help generate hard currency for the regime 
The Chongryon headquarters has been recognized as the de facto North Korean embassy in Japan 
In 2012 , the organization 's headquarters was seized to pay for the group's past due debts 
It was then purchased by a monk named Ekan Ikeguchi , who let the Chongryon continue to use the building in what he referred to as a '' goodwill gesture '' 
Ikeguchi is one of the Chongryon's many ties to organized crime 
Ikeguchi was arrested in the past for an attempted coup against the Japanese government 
He also has ties to the political group Nihon Seinensya , which is involved in illegal activities in conjunction with the yakuza syndicate Sumiyoshi-kai , which imports and sells amphetamines made in North Korea 
North Korea also has black market ties to Sumiyoshi-kai's rival syndicate , Yamaguchi-gumi 
Many members of the Kodo-kai , Yamaguchi-gumi 's ruling faction , are Korean-Japanese , with ties to North Korea 
Masahiro Namikawa , leader of the drug trafficking Seido-kai yakuza organization , also has ties to the Chongryon 
The Chongryon operate at least two websites , chongryon.com , which is in Japanese , and korea- np.co.jp 
WHOIS records for chongryon.com indicate that it was registered by '' guanin o '' using the email address park2 @ mac.com 
The WHOIS information for korea-np.co.jp 
shows that it was registered by Choson Shinbo Company Inc 
The WHOIS records for these sites can be found in Appendix A. Additionally , the Chongryon operate a ferry called the Mangyongbong-92 , the only direct transit from Japan to North Korea 
In 2003 , they were suspected of using the ferry to smuggle missile parts 
In 2006 , the ferry was temporarily banned from Japanese waters when Japanese officials discovered the Chongryon were using it to smuggle dual-use electronics to North Korea to be used for military purposes 
North Korea has a global network of state-run businesses located in 30 to 40 countries that is used for espionage activities 
The Reconnaissance General Bureau is responsible for oversight of this network 
The businesses include cafes and other non-suspect establishments 
The highest concentration of these is in China 
Members of this espionage network reportedly '' send more than $ 100 million in cash per year to the regime and provide cover for spies 
'' These establishments are also used for money laundering and drug trafficking 
The regime is also known to kidnap foreign citizens and use them as instruments for intelligence 
Prisoners are first tortured and psychologically conditioned to bend to the regime 's will 
They are then used based on their skillset 
This may include teaching their language to North Koreans , spreading propaganda in their native language , providing translation services , conducting military training , or other skills the regime deems useful 
In July 2014 , Japanese officials agreed to lift some sanctions on North Korea when the regime agreed to investigate the whereabouts of Japanese citizens who were allegedly abducted by North Korean agents decades ago 
Sanctions to be lifted include the ban on port calls to Japan by North Korean ships 
North Korea has also infiltrated important positions in South Korea for both intelligence and psychological operations purposes 
In 2011 , South Korea 's National Intelligence Service reportedly discovered the presence of Communist spies 
These spies within their trusted circles had been reporting back to North Korea for almost 10 years 
The embedded spies included a Democratic Party representative 
According to the agency , the spies were on a mission to infiltrate and influence the Democratic Party and to gather military intelligence 
The regime also attempts to infiltrate organizations made up of North Koreans who seek shelter in South Korea , in order to gain intelligence 
In the past several years , South Korea has arrested at least 14 defectors who were found to be spies 
These intelligence collection and counterintelligence capabilities are an attempt to provide the regime with a strategic asymmetrical advantage 
The regime leverages its human and cyber resources around the globe to provide an influx of intelligence , while very little credible intelligence about the regime 's activities and capabilities ever becomes available to the outside world 
North Korea continues to be a master of propaganda and deception and leverages the cyber realm for psychological operations 
Modern North Korean psychological operations tactics include distribution of propaganda via traditional media outlets , websites , and social media 
Many of these psychological operations campaigns are politically focused 
According to Dr. Andrei Lankov , the North Korean government has '' very rational and highly successful manipulators who usually get what they want by outsmarting everybody else in the process 
'' The regime 's Unit 204 is responsible for cyber-psychological operations 
These operations are PSYOP tailored for the cyber arena 
In order to be successful , cyber- psychological campaigns require speed , precision , and creativity 
These campaigns leverage the phenomenon of viral , unverified news stories that tend to rapidly propagate via social media , mobile text messaging , and other electronic communications 
This phenomenon creates an arena for strategic propagation of both fact and fiction for the purposes of sentiment manipulation 
Such messages may be used for recruitment , cyber mobilization , and to instill fear in a target population 
Cyber-psychological operations may also include mental suggestion using technology as a delivery mechanism for subliminal cues 
It is unknown whether North Korea possesses this capability 
North Korean citizens have access to state-approved social networks on the Kwangmyong 
The regime has a limited overt social media presence on the Internet 
Some of the known social media platforms employed by the regime include Twitter , Facebook , and YouTube 
The YouTube channel North Korea Today , operated by user rodrigorojo1 , features news clips from North Korea 
It is unclear whether this channel is officially sanctioned 
The North Korea Today YouTube channel also has corresponding profiles on Twitter and Facebook 
The Uriminzokkiri website , known for pushing juche ideology and anti-American and anti-South Korean messages , has accompanying social media profiles on YouTube , Google+ , and Facebook 
It also has Twitter profiles in both Korean and English 
North Korean propaganda is used for several purposes : to enforce the ideals of allies and sympathizers , to frame North Korea in a favorable light to outsiders , to sensationalize the regime 's perceived self-reliance and military prowess , and to shield its own citizens from the outside world 
Juche ideology and indoctrination of the regime's youth ensure support of the local population 
North Koreans accept military duty as an honor and strive to excel in their service to the regime 
In the spirit of juche , the regime uses disinformation to '' hide lapses or tout accomplishments that may have never been achieved 
'' Limiting citizen access to the outside world by instituting the Kwangmyong intranet , North Korea ensures its citizens are not exposed to outside information that is counterproductive to citizen indoctrination or in conflict with juche ideals 
North Korea portrays the West , particularly the United States , as an enemy 
The regime uses this strategy of shifting the population's negative sentiments toward an external entity to keep its citizens ignorant of North Korea 's own economic hardship , regime brutality , and systemic incompetence 
For example , prior to Kim Jong Il 's death in 2011 , North Korean media altered photos of their '' Dear Leader '' to make him appear younger and healthier than he really was 
This became obvious when the altered photos were compared to those taken by Western media around the same time 
According to Dr. Andrei Lankov , '' North Koreans now have a much better understanding of what is going on in the outside than they did before 
This is largely thanks to the spread of DVDs and video content in the country , but also because some of them have been to China and talk about what they have seen…many [ of ] them sincerely believe that the United States remains ready to attack at any moment and that Japan is an incurably aggressive place…nearly all of them swallow the official propaganda myths about the Korean War being started by the 'American Imperialists' who invaded them 
Hence , they see the outside world as an inherently dangerous place 
'' Some human rights groups seek to reach out to North Korean citizens and break them from this isolation 
In August 2014 , the New York-based charity Human Rights Foundation sponsored a hackathon in San Francisco called '' Hack North Korea '' to find new ways to get information in , out , and around North Korea 
The event brought together many programmers , human rights campaigners , and defectors 
North Korea even uses '' trolling '' as a PSYOP tactic 
On the Internet , '' trolls '' are users who post messages that are often crass , controversial , inflammatory , or offensive , in order to evoke a strong reaction or influence a reader 's opinion 
Often , the motivation for trolling is simply for the troll 's enjoyment 
The rude and offensive trolling tactics are in stark contrast to traditional forms of persuasive rhetoric 
However , North Korea reportedly utilizes over 200 military intelligence operatives to troll South Korean message boards and social media pages with pro-North Korean sentiments. < /fn > Matt Rhoades , director of the cyberspace and security program at the Truman National Security Project , said , '' North Korea 's cyber-development is almost just a new harassment mechanism for them , a low-cost , asymmetric method to harass its neighbor in the south… '' Leveraging the cyber and intelligence resources noted above , North Korea 's psychological operations serve an important strategic role 
The ability to influence outsiders , while effectively isolating its own population from most outside influence , allows North Korea to remain an enigma 
Additionally , in line with its PSYOP tactics , North Korea may strategically take credit for cyber attacks that were , in reality , launched by another entity 
Whether the targeted entity blames North Korea for the attacks , or the regime simply takes credit for an attack that has not yet been attributed , several PSYOP goals can come into play 
First , to claim credit for an attack amplifies the impact of a show of force , particularly if South Korea is the target 
This tactic can be used to stir sentiments in order to provoke a reaction 
Second , North Korea may lay claim to responsibility for an attack that exceeds its capabilities in order to seem more technologically advanced and more capable 
Third , any success , or the appearance thereof , enforces the juche ideal of regime self-sufficiency 
Finally , North Korea may act as a scapegoat and claim credit for a cyber attack of an ally such as China so the attack is not attributed to the real actors 
North Korea reportedly has the electronic warfare capabilities to jam GPS and to inject false GPS coordinates 
North Korea demonstrated these capabilities in March 2011 by jamming South Korea 's GPS signals during a joint U.S.-South Korea military exercise 
North Korea has the capability to create an EMP 
An EMP is a sudden , extreme outburst of atmospheric electricity creating an intense magnetic field that can burn out electrical equipment 
A report from the U.S. Department of Homeland Security ( DHS ) noted North Korea 's ability to deliver a nuclear warhead as a satellite over the South Pole , effectively creating the burst needed to deliver an EMP targeting the United States 
An EMP could effectively disrupt electronic communications including critical infrastructure components such as telecommunications , financial institutions , the energy sector , transportation , food and water delivery , emergency services , and space systems 
North Korea reportedly acquired its EMP technology from Russia 
North Korea also has a drone program 
The regime reportedly acquired its first drones in the late 1980 's or early 1990 's 
The regime 's drones are complimentary to its intelligence program and are primarily used for surveillance 
In early 2014 a North Korean drone crashed south of the 38th parallel , the line dividing North Korea from the south 
While early reports noted that the drones appeared similar to those manufactured by Chinese company Tauyuan Navigation Friend Aviation Technology , the company denied involvement 
Stressing the importance of the regime 's electronic warfare capabilities , in 1999 former regime leader Kim Jong Il said '' The basic key to victory in modern warfare is to do well in electronic warfare 
'' Since the regime 's advanced technology lags behind that of South Korea and the U.S. , its capability to disrupt the communications of these perceived adversaries is a vital asymmetric capability 
North Korea utilizes primary and secondary education and the university system to train its cyber warfare operators 
According to reports by defectors , the regime seeks out children who show mathematical talent and sends them through rigorous advanced training 
A vintage North Korean animation stresses the importance of mathematics in North Korean education 
The short film follows a young boy as he does his geometry homework 
The frustrated boy begins to daydream then has visions of going to war with the U.S. and needing geometry to effectively calculate missile trajectory during the battle 
Science and technology students are expected to learn foreign languages , which may include Chinese , Japanese , and English.233 Student emails , chats , and web browsing activities are heavily monitored 
Around age twelve or thirteen , chosen students are enrolled in accelerated computer courses at First and Second Geumseong Senior-Middle Schools 
The successful students are then sent to Kim Il-sung University , Kim Chaek University of Technology , or the Command Automation University , traditionally known as Mirim University 
Kim Il-sung University 's computer center was started in 1985 
Its computer courses have a heavy programming element 
The university reportedly developed the Intelligent Locker hard disc protection program , Worluf Antivirus , SIMNA ( simulation and system analysis program ) , a war games program , a hepatitis diagnosis and prescription system , and a C++ program development tool called FC 2.0 
Kim Il-sung University also has programs focusing on nuclear research 
Kim Chaek University of Technology was established in 1948 
In the late 1990s , it began to restructure its computer-focused courses to reflect more modern technologies 
As of 2002 , the university had three colleges focusing on computer science , information science and technology , and machine science 
Software developed by the university includes Computer Fax and SGVision , an image-reprocessing program used for steganography 
Students and instructors must submit a formal request for permission in order to use the Internet for research 
The Command Automation University periodically chooses around 100 students for an intensive five-year course prior to their assignment to serve in cyber intelligence and cyber warfare capacities 
Programs at the Command Automation University include command automation , computers , programming , automated reconnaissance , and electronic warfare 
Other students attend a two-year accelerated university program , then study abroad in Russia or China before they are assigned to a cyber-operator role 
The elite cyber operators are given special incentives 
For example , parents of students graduating from the cyber program with top scores are given the opportunity to live in Pyongyang ; and married cyber operators are given housing , a food allowance , and a stipend if operating overseas 
Due to the nature of their profession , these cyber elite are some of the only North Koreans allowed to access the outside Internet 
While this report focuses on North Korea 's cyber warfare capabilities , these capabilities can not be fully separated from the implications of partnerships with countries known to deal in illegal weapons trade with the regime 
Now that cyberspace has become a legitimate arena for warfare , these nations are also potential allies in the cyber realm 
For this reason , the regime 's key political and military relationships are explored below 
North Korea has a longstanding historical relationship with China 
During the Korean War ( 1950- 1953 ) , China allied with North Korea 's Communist forces 
China has also provided ongoing political and economic support to the regime 's leadership and is a primary trade partner 
North Korea is economically dependent on China 
North Korea gets an estimated 90 percent of its energy imports , 80 percent of its consumer goods , and 45 percent of its food supply from China 
This relationship is prudent – in the event of a military conflict , China can strategically use North Korea as a buffer zone between itself and South Korea , where many U.S. military personnel are stationed 
Chinese aid to North Korea also deters the likelihood that the regime will collapse , resulting in internal destabilization that could catalyze a U.S.-China conflict 
North Korea relies heavily on China for technological resources 
As noted above , North Korea relies on China 's Unicom for Internet access 
Additionally , the regime sends some of its cyber warriors to train in China and stations a portion of its Unit 121 personnel in Shenyang 
Some of North Korea 's official websites are hosted in China , and KCC has a branch office there 
North Korea also relies on China to provide much of its network hardware , including servers and routers 
North Korea has a long history of ties to Russia 
The former Soviet Union was the major sponsor of the North Korean state and a major trading partner 
Following the dissolution of the Soviet Union , aid to North Korea was halted and trade diminished significantly 
This chain of events contributed to North Korea 's eventual economic collapse , as it could not survive without aid 
North Korea currently has a collaborative relationship with Russia in the cyber realm 
The regime's CSTIA relies on Russia as one of several sources for technical data 
North Korea also sends some of its cyber warriors to train in Russia , and the regime reportedly acquired its EMP technology from there 
Political ties between Russia and North Korea have become stronger in recent months 
In 2014 , potentially as a result of the U.S. response to the Russian-Ukranian conflict , Russia began to strengthen ties with North Korea 
Negotiations reportedly included promises of trade and development projects 
Narushige Michishita , a North Korea and Asia security expert at Japan's National Graduate Institute for Policy Studies , stated '' By strengthening its relationship with North Korea , Russia is trying to enhance its bargaining position vis-à-vis the United States and Japan 
'' Russia also recently forgave most of the regime 's debts 
North Korea and Iran have longstanding political and military ties 
North Korea supplied Iran with conventional arms during the Iran-Iraq War 
Iran and North Korea reportedly collaborate closely in ballistic missile development efforts 
In the past , Iran provided the North Korean regime with necessary funds and oil in exchange for missile parts and technology 
In 2009 , a North Korean plane transporting 35 tons of weapons and allegedly bound for Iran was seized after making an unscheduled stop in Bangkok , Thailand 
That same year , United Arab Emirates seized a ship bound for Iran that was transporting several containers of North Korean weapons , including rocket-propelled grenades and ammunition 
Reportedly , the customer was a company affiliated with Iran 's Islamic Revolutionary Guard Corps 
North Korea also has cyberwar ties with Iran 
In 2012 , North Korea and Iran signed a technology treaty to help combat '' common enemies '' in cyberspace 
The treaty included provisions for cooperation in research , student exchanges , and joint laboratories 
Joint projects reportedly include IT information sharing , engineering , biotechnology , renewable energy , and sustainability 
F-Secure 's Mikko Hypponen stated , '' It 's highly likely that one of the reasons for this co-operation is for them to work together regarding their cyber defence and cyber offense strategies '' 
Hypponen cited Flame malware as a possible triggering event for the creation of this treaty 
Others also suspect that Iran and North Korea 's mutual interest in development of nuclear weapons and the need to protect refineries against malware such as Stuxnet were driving factors in the establishment of the treaty 
U.S. House Foreign Affairs Committee leaders assert that the treaty indicates North Korea and Iran are collaborating on a joint nuclear weapons program 
Additionally , North Korea , in conjunction with Iran and Syria , reportedly supports both Hamas and Hezbollah in procuring kinetic weaponry and communications equipment and in establishing operational infrastructure 
North Korea has both a cyber relationship and kinetic weapons ties with Syria 
KCC reportedly has a branch in Syria 
In 2007 , Israel launched an airstrike , destroying a Syrian target that was allegedly a nuclear facility under construction with North Korea 's assistance 
U.S. officials noted the facility was modeled on the North Korean nuclear reactor at Yongbyon 
The North Korea-Syria relationship becomes more important in the context of both countries ' ties with Iran 
As noted above , Iran , North Korea , and Syria jointly provide support to extremist groups Hamas and Hezbollah 
Additionally , as we explored in HPSR Security Briefing Episode 11 , Iran and Syria 's military alliances extend to joint SIGINT and cyber operations 
North Korea also has an interesting relationship with Cuba – one that includes supplying weapons and apparent attempts to illegally smuggle weapons 
In 2013 , a North Korean cargo ship on its return voyage was stopped near the Panama Canal 
The ship was carrying surface-to-air missile parts , disguised as containers of sugar 
In an attempt to save face , Cuba 's Ministry of Foreign Affairs stated that the cargo included '' 240 metric tons of obsolete defensive weapons -- two anti- aircraft missile complexes Volga and Pechora , nine missiles in parts and spares , two Mig-21 Bis and 15 motors for this type of airplane , all of it manufactured in the mid-20th century -- to be repaired and returned to Cuba 
'' Experts said the cargo appeared to include a SNR-75 Fan Song fire-control radar system for an SA-2 missile , a Soviet-era missile system that was also used in Cuba 
Following the incident , Fidel Castro credited former North Korean leader Kim Il-Sung for providing Cuba with weapons near the end of the Cold War 
Weapons included 100,000 AK rifles and necessary ammunition 
While no apparent cyber relationship exists between North Korea and Cuba at this time , their track record for weapons trade means the potential for future collaboration in the cyber realm can not be discounted 
 North Korea gains access to 33 South Korean military wireless communication networks  The U.S. State Department is attacked by entities in the East Asia-Pacific region 
The attacks coincided with State Department negotiations with North Korea regarding the regime 's nuclear missile tests 
( June )  A South Korean military official states North Korea 's Unit 121 has breached South Korean and U.S. military entities 
( July )  North Korea states that it is '' fully ready for any form of high-tech war 
'' ( June )  DarkSeoul DDoS and disk wiping malware targeting South Korean and U.S. government , media outlet , and financial websites 
These attacks also coincided with U.S 
Independence Day 
( July )  Malware for '' Operation Troy '' was likely planted 
It is interesting to note that much of North Korea 's cyber activity follows a distinct pattern 
Analysis of North Korean cyber activity gives insight into these patterns and also helps tie together North Korea 's strategic , tactical , and operational capabilities 
Strategic capabilities refer to the assets used in support of a long-term , overarching goal 
Tactical capabilities refer to the methods and maneuvers actually implemented in pursuit of the strategic goal 
Operational capabilities refer to the potential use of these capabilities 
In 2004 , in response to the annual U.S. – South Korea joint military exercises , North Korea reportedly gained access to 33 South Korean military wireless communication networks 
The next significant cyber attack attributed to North Korea was in June 2006 
The U.S. State Department was attacked by entities in the East Asia-Pacific region 
The attacks coincided with State Department negotiations with North Korea regarding the regime 's nuclear missile tests 
In July 2006 , North Korea 's Unit 121 reportedly breached South Korean and U.S. military entities 
This attack was concurrent with the regime 's test-fire of at least one long-range missile and several medium-range missiles 
2007 was politically tumultuous for North Korea 
Following multi-national talks , the UN's International Atomic Energy Agency ( IAEA ) ordered the shutdown of the regime 's nuclear facilities in Yongbyon in July 
Its nuclear efforts temporarily thwarted , North Korea tested a logic bomb in October 2007 
In April 2009 , North Korea ejected IAEA and U.S. nuclear compliance officials 
The regime indicated refusal to comply with any UN agreements regarding nuclear weaponry and announced it would reinstate its nuclear materials production 
The next month , North Korea conducted an underground nuclear test and voiced its confidence that the regime was well on its way to producing viable nuclear technology 
The UN called an emergency meeting condemning the nuclear weapons test , and South Korea joined the Proliferation Security Initiative ( PSI ) 
North Korea issued a statement via KCNA calling South Korea 's involvement in PSI an act of war 
In June 2009 , North Korea stated that it was '' fully ready for any form of high-tech war 
'' The following month , DDoS and disk wiping malware , later known as DarkSeoul , targeted South Korean and U.S. government entities , media outlets , and financial websites 
The attacks coincided with U.S 
Independence Day 
Other malware used for Operation Troy was also planted 
Operation Troy would continue for several years , largely undetected 
In early 2011 , political and military tensions were high 
In February , James Clapper , United States Director of National Intelligence , testified that North Korea likely had undeclared uranium enrichment facilities as part of its nuclear weapons program 
In March 2011 , South Korean media , financial , and critical infrastructure targets suffered a DDoS and disk-wiping malware attack later known as the '' 10 Days of Rain '' 
U.S. and South Korean military entities were also targeted by DDoS during this attack 
The attack used the DarkSeoul malware 
North Korea also disrupted South Korean GPS signals 
Additionally , North Korean actors reportedly attempted a DDoS attack against South Korea 's Incheon Airport that same month 
These incidents coincided with the annual U.S. – South Korea joint military exercises 
The following month , North Korean actors reportedly launched a DDoS attack against South Korea 's Nonghyup bank 
In 2012 , an attack on South Korean Newspaper JoongAng Ilbo was attributed to North Korean actors 
This attack also coincided with the timing of the annual joint U.S. – South Korea military exercises 
In September 2012 , North Korea signed a cyber treaty with Iran , agreeing the two nations would collaborate to combat '' common enemies '' in cyberspace 
The week of March 11 , 2013 , the U.S. and South Korea began their annual joint military exercise near the Korean Peninsula 
Like clockwork , attacks attributed to North Korea and now known as the March 20 attacks targeted three South Korean media outlets and Shinhan , Nonghyup , and Jeju banks 
North Korea also exhibited other hostile activity at that time 
North Korea cut communication with Seoul and announced it had scrapped the 1953 armistice between the two Koreas 
North Korea 's foreign ministry also issued a statement that it perceived this exercise as a precursor to invasion and that the regime would respond with a '' strong military counteraction '' if the situation escalated 
That same week , the North Korean military conducted a drone attack simulation 
On March 18 , the Uriminzokkiri YouTube channel posted an anti-U.S. video entitled '' Firestorms Will Rain on the Headquarters of War '' that showed a depiction of the White House in crosshairs , followed by an explosion 
The latter took place on June 25 , the anniversary of the start of the Korean War 
As evidenced above , much of North Korea 's cyber activity coincides with the annual U.S. – South Korea joint military exercises 
Attacks not following that pattern were typically in response to political events impacting the regime or correlated with significant dates , such as the anniversary of the start of the Korean War 
The regime 's strategic assets and tactical capabilities in the cyber arena seem to have evolved only slightly since 2009 
Most of the attacks attributed to North Korea employ limited tactics , and their operational capability demonstrates an increase in the frequency and volume of attacks but is otherwise unimpressive to date 
In June 2014 , the regime demanded cancellation of the annual U.S. - South Korea joint military exercise , attempting to use participation in the upcoming Asian Games as a bargaining chip 
The regime 's demands may have had other political motivations , as they preceded the July 2014 meeting between South Korean president Park and Chinese President Xi Jinping 
The meeting centered on trade and regional security issues , including the ever-present rhetoric around denuclearization of North Korea 
Both leaders were critical of Japan 's recent announcement to soften sanctions on North Korea 
As this report headed to press , the annual U.S. – South Korea joint military exercises were underway 
The most prominent North Korean threat actor group is the group responsible for the DarkSeoul malware 
According to statements from the South Korean government , North Korea 's Lab 110 were the actors behind the DarkSeoul malware 
South Korean intelligence reports stated that Lab 110 , which is affiliated with the regime 's defense ministry , was ordered by the North Korean regime to destroy South Korean communications networks 
Although the March 20 attacks used DarkSeoul malware , it is interesting to note that two groups , WhoIs Team and New Romantic Cyber Army Team , claimed responsibility for the '' March 20 '' 2013 attacks on South Korean media and financial institutions 
Some of the DarkSeoul attacks corresponded with significant dates , such as U.S 
Independence Day or the anniversary of the start of the Korean War 
DarkSeoul attacks go beyond denial of service and sabotage 
As early as 2009 , the group responsible for the Dark Seoul attacks launched '' Operation Troy '' , an espionage campaign targeting the South Korean military 
The operation was codenamed '' Troy '' due to the frequent use of the word '' Troy '' in the malware's compile path strings 
The March 2011 '' 10 Days of Rain '' DDoS attacks on U.S. and South Korean sites have also been attributed to the actors associated with DarkSeoul 
According to Symantec , the politically motivated attacks have required a level of intelligence , coordination , monetary support , and technical sophistication that suggests state sponsorship 
This designation means the group can be considered an advanced persistent threat ( APT ) 
A March 20 , 2013 attack attributed to the DarkSeoul actors targeted three South Korean media outlets and Shinhan , Nonghyup , and Jeju banks 
However , the targeted entities resumed normal operations shortly thereafter 
According to South Korean reports , the media outlets targeted corresponded with those listed by the North Korean regime in 2012 as right-wing press that manipulated South Korea 's public opinion 
In April 2012 , the regime reportedly listed those entities as attack targets 
McAfee found that these attacks were the culmination of the malware campaign they dubbed '' Operation Troy '' 
A report from IssueMakersLab tied the actors responsible for the March 20 , 2013 attacks to cyber attack activity occurring as early as 2007 
Details of the March 20 attack also suggested possible ties to China 
Additionally , researchers at AhnLab in South Korea noted a Chinese IP address linked to the attacks 
While no concrete evidence has been released that indicates Lab 110 was responsible for the DarkSeoul attacks , the responsible group 's targets , TTP , and attack timing demonstrate a strong pro-North Korean sentiment 
Known tactics , techniques and procedures Targets WhoIs Team is one of two groups that claimed responsibility for the '' March 20 '' attacks targeting South Korea 
A defacement on the LG +U webpage stated that it was '' Hacked by WhoIs Team '' and that the attackers would return 
The page featured three skulls 
However , no other attacks by WhoIs Team have been observed 
Known tactics , techniques , and procedures Targets Associated actors Based on North Korea 's affinity for disinformation and counterintelligence , we must note the distinct possibility that operatives claiming to be WhoIs Team are part of another group and that the defacement was a false flag operation meant to pin blame on RAONASRT 
RAONASRT is a South Korean white hat capture the flag ( CTF ) team , whose members also operate under the name '' WhoIs '' 
l RAONASRT ( the RaonSecure Advanced Security Research Team ) and its sub-teams WhoIs Team and Cpark Team have participated in and performed well in CTF contests such as the one hosted by DefCon 
In 2013 , a member of RAONASRT was invited to Blue House , the residence of the South Korean president , to meet with president Park and discuss the security industry 
RAONASRT runs the Secuinside CTF competition 
Their parent organization RaonSecure operates a whitehat training program 
The group also runs the Korea WhiteHat Contest , which is hosted by South Korea 's Ministry of National Defense and National Intelligence Service and supervised by South Korean Cyber Command 
For these reasons , it seems unlikely that the RAONASRT WhoIs Team would maliciously target South Korean entities 
IsOne is the group that claimed responsibility for the June 2012 attack on the website of South Korean newspaper JoongAng Ilbo 
The attack included an attempt to wipe JoongAng Ilbo 's servers as well as a defacement depicting a laughing cat 
Despite efforts to wipe the target 's servers , the target only suffered defacement and temporary downtime 
Although the groups have a similar name and both use a cat theme , it is unclear whether a CTF team known as '' The Cat is Number 1 '' and IsOne are the same actors 
'' The Cat is Number 1 '' members claim to hail from North Korea , but there is no hard evidence linking team members to the region 
Again , it seems that the actors responsible for the attack borrowed the moniker of another group 
According to South Korea 's National Police Agency , the attack on JoongAng Ilbo shares characteristics with previous attacks attributed to North Korean actors 
An investigation conducted by the agency 's Cyber Terror Response Center found that the actors targeting JoongAng Ilbo used two North Korean servers and 17 servers in 10 other countries 
One server maintained a constant connection to an IP address belonging to Joson Telecommunication Company , which is affiliated with North Korea 's Ministry of Posts and Telecommunications 
Investigators found that one of the servers used in the attack on JoongAng Ilbo was also used in the March 2011 DDoS attacks on South Korean critical infrastructure sites and the April 2011 attack on Nyongyup Bank 
Known tactics , techniques and procedures Targets The Kimsuky malware , which targeted South Korean think tanks , is loosely attributed to an actor referred to as Kimsukyang 
Little is known about the actor or group responsible for the malware 
However , the following email addresses are associated with the Kimsuky operation : The email address iop110112 @ hotmail.com was registered using the alias '' kimsukyang '' , and rsh1213 @ hotmail.com was registered using the alias '' Kim asdfa '' 
Kaspersky found that the Kimsuky operation used 10 IP addresses in two Chinese provinces that border North Korea : Jilin and Liaoning 
Known tactics , techniques and procedures Targets The New Romantic Cyber Army Team also took credit for the March 20 , 2013 attacks 
McAfee suspected New Romantic Cyber Army Team were responsible for Operation Troy and the resulting March 20 , 2013 attacks due to the group 's '' frequent use of Roman and classical terms in their code 
'' It is unknown whether Hastati is an alternate name for the group or whether Hastati is an individual actor within the group 
It is interesting to note that the malware associated with these actors uses the strings '' HASTATI '' and '' PRINCIPES '' to overwrite the MBR 
The name Hastati likely refers to a class of infantrymen of the early Roman Republic 
The Hastati were less experienced soldiers who fought on the frontlines with spears and swords 
Principes likely refers to more experienced Roman soldiers who fought on the second line of battle 
Known tactics , techniques and procedures Targets HP researchers had previously analyzed samples of the DarkSeoul dropper , and findings were published in our annual HP Cyber Risk Report 2013 
Analysis of this malware is included in Appendix C. Analysis of additional malware used in these campaigns produced no new findings and only corroborated what was found by external security researchers 
These publicly available analyses have been cited throughout the report 
Some of the malware samples were no longer publicly available 
However , CrowdStrike obtained these missing samples before they disappeared from the wild and conducted thorough analysis , which was released in their subscription-only reports 
While we can not divulge detailed information from those reports , an overview of the findings is provided below 
The majority of the malware used in cyber incidents attributed to North Korea were variations of three types of malware : dropper , wiper , and IRC remote access trojan ( RAT ) 
CrowdStrike's attribution of this malware to North Korean actors stemmed from two primary factors : Korean language characters found in the binaries and the propensity to specifically target South Korean entities 
Dropper samples consistently targeted AhnLab Policy Center as a propagation method 
This information is corroborated in a Black Hat Asia 2014 presentation by Fortinet researcher Kyle Yang 
CrowdStrike 's report also briefly noted the use of an update server vector 
Yang analyzed the malware 's update config metadata and matched its format to the AhnLab Policy Center 
To test its payload , Yang set up a server/client and executed the update through the server 
As Yang had predicted , it wiped the client 
While there are several variants of the wiper , all seem to have been used on the same date 
It is unclear why multiple wiper variants with slightly differing behavior were used for the same campaign 
One possible explanation is that multiple variants were used to minimize the operational damage to the mission in the case of an early detection of one of the variants 
For example , if one wiper variant was compromised or detected by antivirus or IDS signatures , the other variants may have differed enough to remain undetected , still resulting in mission success 
Prioxer has been linked to other 2011 attacks on South Korea 
It is unclear whether these downloaders were pushed out in the same update server vector as the wipers 
However , the two malware types both use the same packer 'Jokra ' and both contain the strings '' HASTATI '' and '' PRINCPES '' 
Based on the information above , we have identified strategic challenges that impact the development of North Korea 's cyber warfare capabilities 
We have also noted relevant implications : • The North Korean regime strictly controls all Internet infrastructure , meaning cyber activity by dissidents or autonomous hacker groups are very unlikely 
In other words , any cyber attacks originating in North Korea can be assumed to be state sponsored 
For this reason , according to defectors , the regime 's cyber operators do not typically launch attacks directly from within North Korea 
Instead , many regime-sponsored attacks are launched from cells based in China , U.S. , South Asia , Europe , and even South Korea 
• North Korea has a limited number of outgoing connections 
For this reason , there is a low probability of DDoS originating from within 
However , this does not preclude the use of botnets with a local C2 server or the use of networks in third-party nations to launch attacks 
As seen in the July 2009 attacks on South Korean and U.S. targets , North Korea has leveraged networks in countries such as Austria , Georgia , Germany , and even South Korea and the U.S. , in order to launch cyber attacks 
North Korea will likely be forced to rely on third parties for quite some time , due to its lack of sufficient infrastructure for launching large-scale CNO 
• Several outward facing websites are hosted in China and other countries 
This implies two possibilities : that North Korea 's infrastructure can not handle a heavy incoming traffic load or that the regime wants to separate the propaganda crafted for an outside target audience from internally-focused propaganda 
This arrangement seems unlikely to change in the foreseeable future 
• North Korea is known to have unstable power supplies , which limits scalability of the regime 's current CNO capabilities 
This is another reason why expansion of CNO capabilities using the nation 's own infrastructure seems unlikely in the foreseeable future 
• North Korea is known to have monetary deficiencies , which further limit expansion of infrastructure and CNO capabilities , at least without third-party aid 
North Korea continues to rely heavily on China for sustainment 
• Although we see few instances of overt cyber operations , that North Korea reportedly spends so much of its limited resources on training and equipping cyber operators speaks volumes 
The human element of the regime 's cyber war program , at least , has potential 
• Sanctions against North Korea and export laws prohibit the sale of certain technologies to the regime 
In other words , in order to obtain the technology needed for a cyber warfare program , the regime must improvise 
North Korea must develop its own technology , manufacture technology using plans obtained via industrial espionage , or rely on third parties to procure it for them 
However , the regime has historically failed in its attempts of large-scale production of electronic components 
At present , North Korea relies on China to provide much of its network hardware , including servers and routers 
It is unlikely that North Korea will compromise on its nuclear program , meaning sanctions will likely be longstanding , and the regime will have to continue to rely on third parties to procure technology 
Cyber incidents attributed to North Korean actors seem to follow distinct patterns :  According to reports by other researchers , the conventions and C2 structure used by North Korean cyber actors show continuity and consistency over time 
 The majority of the incidents attributed to North Korean actors consistently used wiper malware 
 Several of the incidents included defacements , with a different group taking credit each time 
Additionally , little information or attack history was found about any of the groups , aside from information acknowledged in this report 
These factors seem to indicate that a single group may have been responsible for several attacks over time , using different group names as a false flag 
 On more than one occasion , the malware included provisions to disable security software made by South Korean security company AhnLab 
This detail strengthens the case that the malware was written or modified to specifically target South Korean machines 
 The attacks followed an explicit pattern : most were around the time of U.S. – South Korean joint military exercises , while the others fell on a significant date or were in response to political events 
 The primary targets were South Korean and U.S. entities 
While these nations are traditionally targeted by the regime , it is also possible that South Korean entities are quick to attribute any attack on their infrastructure to North Korean actors 
In fact , in some cases , South Korean reports were the only source of attribution 
Does North Korea have sufficient cyber infrastructure and cyber warfare capabilities to harm the U.S. and its allies ? While North Korea 's cyber warfare capabilities pale in comparison to those of wealthier nations , the regime has made significant progress in developing its infrastructure and in establishing cyber operations 
The rate of this progress warrants a closer look at North Korea's motivations , TTPs , and capabilities 
As noted above , North Korea views the U.S. and South Korea as its primary adversaries 
The U.S. and South Korea are high-tech nations with economies that depend heavily on technology 
In contrast , North Korea does not have a high tech culture 
For these reasons , we should not overestimate the regime 's advanced cyber capability , yet we should never underestimate the potential impact of North Korea utilizing less advanced , quick-and-dirty tactics like DDoS to cripple their high-tech targets 
Both government and corporate entities are susceptible to being targeted by North Korean cyber attacks 
North Korean juche ideology places the survival of the regime as its primary goal , and any perceived threat to the regime may be targeted 
Several attacks on U.S. and South Korean government , financial , and critical infrastructure entities have been attributed to North Korean origins.. These attacks were often preceded by or occurred in conjunction with North Korea voicing negative sentiments about the targeted entities 
As we saw with Iranian cyber actors in HPSR Security Briefing Episode 11 , state sponsored cyber actors often launch an attack in response to a political trigger 
The same pattern seems to apply to pro-North Korean cyber actors , who have launched attacks to coincide with U.S 
Independence Day and the anniversary of the start of the Korean War , as well as propaganda and cyber attacks in response to joint military exercises between the U.S. and South Korea 
As shown by North Korea 's past behavior ( which is consistent with their doctrine ) , they are easily '' pushed into a corner '' 
At the slightest perceived threat , the regime responds with saber-rattling and peacocking 
The regime is extremely defensive and will , in turn , flex its muscles to show the world how capable it is , even if this is an inaccurate display of their overall capabilities 
The regime fears losing its control and the nation 's culture to the ever-growing threat of outside influence , as is evidenced in the regime 's reaction to the comedy film '' The Interview '' 
The regime has represented itself to its citizens as a powerful and capable entity and has used this status to control the populace 
For this reason , the regime 's leaders are forced to continually demonstrate this strength and power , or an illusion thereof , both domestically and globally , in order to maintain the status needed to ensure continued suppression of the population 
This show of power may require that the regime takes chances and stretches beyond its abilities at times , but in the spirit of juche and songun , the regime will continue this façade , fearful of losing the image its leaders have worked so hard to maintain 
North Korean cyber operations are not generally observed originating from home field IP address space , so geo-IP based blocking of traffic originating from those net-blocks is ineffective 
Given that North Korea has capable and technically trained forces and will demonstrate their power when they feel provoked , western entities should consciously avoid promoting ideas or doctrine that is blatantly slanderous to the regime 
Encouraging such ideas could cause those entities to become a focal point for North Korean cyber attacks 
Due to the fact that North Korean infrastructure is aging and its resources are not able to keep up with the rest of the world , entities with interesting R & D or IP ( intellectual property ) - especially military in nature – could become targets of interest for North Korea 
Interest in defense-related IP and R & D could also stem from North Korea 's relationship with China 
In the Chinese business culture , taking another entity 's IP or R & D is not stealing – it is accepted as business as usual 
It is possible that North Korea , if under Chinese influence , would adopt the same attitude , given the regime 's limited capacity for homegrown innovation 
Known DPRK targets have been limited primarily to South Korean and U.S. organizations and government entities 
For these targets , prudent measures should include : The dropper component that we examined was distributed as a UPX-packed binary 
• mRemote-an open source tool for centrally managing remote server connections using a GUI ( Kevin Kline , 2008 ) 
This tool is no longer being actively developed or supported 
• SecureCRT-a commercial SSH and Telnet client by VanDyke Software 
The password is decrypted after being extracted 
If these conditions are satisfied , the username , hostname , port , and password are extracted 
The password is then decrypted 
Less than a week after uncovering Operation SnowMan , the FireEye Dynamic Threat Intelligence cloud has identified another targeted attack campaign - this one exploiting a zero-day vulnerability in Flash 
We are collaborating with Adobe security on this issue 
Adobe has assigned the CVE identifier CVE-2014- 0502 to this vulnerability and released a security bulletin 
We 're dubbing this attack '' Operation GreedyWonk 
'' We believe GreedyWonk may be related to a May 2012 campaign outlined by ShadowServer , based on consistencies in tradecraft ( particularly with the websites chosen for this strategic Web compromise ) , attack infrastructure , and malware configuration properties 
On Feb. 13 , FireEye identified a zero-day Adobe Flash exploit that affects the latest version of the Flash Player ( 12.0.0.4 and 11.7.700.261 ) 
All three organizations are nonprofit institutions ; the Peterson Institute and Smith Richardson Foundation engage in national security and public policy issues 
If you have Java 1.6 , update Java to the latest 1.7 version 
If you are using an out-of-date Microsoft Office 2007 or 2010 , update Microsoft Office to the latest version 
These mitigations do not patch the underlying vulnerability 
But by breaking the exploit 's ASLR-bypass measures , they do prevent the current in-the-wild exploit from functioning 
GreedyWonk targets a previously unknown vulnerability in Adobe Flash 
Details of these techniques are available from our previous blog post on the subject ( in the '' Non-ASLR modules '' section ) 
Java 1.6 is no longer supported and does not receive security updates 
In addition to the MSVCR71.dll ASLR bypass , a variety of widely exploited code-execution vulnerabilities exist in Java 1.6 
That 's why FireEye strongly recommends upgrading to Java 1.7 
The Microsoft Office HXDS.dll ASLR bypass was patched at the end of 2013 
More details about this bypass are addressed by Microsoft 's Security Bulletin MS13-106 and an accompanying blog entry 
FireEye strongly recommends updating Microsoft Office 2007 and 2010 with the latest patches 
This PlugX sample was compiled on Feb. 12 , one day before we first observed it , indicating that it was deployed specifically for this campaign 
] name and adservice.no-ip [ 
] org resolved to 74.126.177.68 on Feb. 18 , 2014 
Passive DNS analysis reveals that the domain wmi.ns01.us previously resolved to 103.246.246.103 between July 4 , 2013 and July 15 , 2013 and 192.74.246.219 on Feb. 17 , 2014 
java.ns1 [ 
] name also resolved to 192.74.246.219 on February 18 
This exploit server hosted a Flash exploit file named BrightBalls.swf ( MD5 1ec5141051776ec9092db92050192758 ) 
Using passive DNS analysis , we see the domains windows.ddns [ 
] us and wmi.ns01 [ 
] us both resolved to 76.73.80.188 in mid-2012 
The domain ids.ns01 [ 
] us also overlaps with the domain wmi.ns01 [ 
] us on the IP 194.183.224.75 
This threat actor clearly seeks out and compromises websites of organizations related to international security policy , defense topics , and other non-profit sociocultural issues 
The actor either maintains persistence on these sites for extended periods of time or is able to re-compromise them periodically 
Based on these and other observations , we conclude that this actor has the tradecraft abilities and resources to remain a credible threat in at least the mid- term 
The driver component of Gen 1 and Gen 2 are drastically different in their operation and intent 
For the Gen 1 sub-family of Hikit , the driver acts as a NDIS ( network ) driver that is responsible for interfacing the DLL to the network while preventing a direct WinSock interface from occurring 
The trigger string varies by Driver and DLL sample 
Gen 2 uses a standard client-server malware model meaning that the malware no longer requires a direct Internet-facing network card , no longer uses a network driver for networking , and provides the ability to network multiple Gen 2 samples behind a firewall with greater ease ( from the attacker's perspective ) 
The Gen 2 sub-family , however , no longer employs network stealth provided by the Gen 1 network driver which exposes the C2 server addresses to analysts 
Each of the Hikit generations contains multiple sub-generations as the author ( s ) of Hikit have evolved their code over time 
There is a noticeable steep improvement over the code base of Gen 1 Hikit family during its 2011 development period 
The Gen 2 sub-generations share a similar improvement scale between late 2011 and late 2013 
The earliest known Hikit sample dates back to 31 March 2011 
Known as the Gen 1.0 sub-generation of Hikit Gen 1 , the first known sample of Hikit deviated from the later traditional Gen 1 model 
The Gen 1.0 sample was a standalone executable whereas subsequent Gen 1 sub-generations use a DLL running as a service 
The Gen 1.0 sample is clearly a work-in-progress 
The Gen 1.0 sample , while different than subsequent sub-generations , does still rely on the Driver component and for the most part the structure of the code does not differ much going forward into the Gen 1 evolution 
Less than three weeks after Gen 1.0 , the author ( s ) of Hikit move into Gen 1.1 
The notable change is that the Hikit model of using a DLL and driver , which has remained until present day , comes into being 
The code matures slightly between Gen 1.0 and Gen 1.1 but the functionality does not change 
Both Gen 1.0 and Gen 1.1 use plaintext data transmissions 
Development appears to halt on Gen 1 for 4 months between 20 June 2011 and 23 October 2011 based on a lack of available samples found 
During this time the development of Hikit appears to change locations 
Gen 1 samples have Program Database ( PDB ) file strings that identify the file path of the Hikit source code 
For Gen 1.0 and Gen 1.1 samples , the file path of the Hikit source code is consistently h : \JmVodServer\hikit 
Starting with Gen 1.2 , the file path switches to e : \SourceCode\hikitnew 
It is at this time that the functionality of Hikit Gen 1 begins to mature 
A more subtle change is the renaming of the '' socks5 '' command to simply '' proxy '' within the code 
The code within Hikit begins to mature but the overall functionality does not expand beyond the original set of commands found in Gen 1.0 
The other remarkable change within the Gen 1.1 to Gen 1.2 development is the way in which the session handshake trigger operates 
In Gen 1.0 and Gen 1.1 , the DLL instructs the Driver to listen for a specific string ( typically a HTTP request string ) and responds with another string 
In Gen 1.2 , the Driver has a hardcoded trigger string ( a specific HTTP request string ) and the DLL instructs the Driver to inspect a specific HTTP header field for a specific hexadecimal value 
This moves Gen 1.2 into more of a username/password authentication scheme whereas previous sub-generations could potentially be accessed by accidental HTTP requests 
At the same time , the Driver responds with a specific value with in the Etag HTTP header field 
This places Gen 1.2 into a more stealth position as a random , non-HTTP compliant response from Gen 1.0 and Gen 1.1 samples is more obvious than a legitimate HTTP response with a specially crafted Etag header 
Gen 1.2 's development cycle appears to exist between 23 October 2011 and 2 November 2011 with several new samples being found on the Internet having legitimate compile times during this time window 
There is , however , evidence that the development of Hikit Gen 1 and Gen 2 overlap by several months 
The earliest Gen 2 sample known to exist dates to 28 August 2011 , two months before the first known Gen 1.2 sample 
The last known Gen 1.2 sample , and by extension , the last known Gen 1 sample , dates to 9 April 2012 
The first known Gen 2 sub-generation , Gen 2.0 Alpha , much like Gen 1.0 , represents an early development version of the Gen 2 Hikit sub-family 
Gen 2.0 Alpha is a stand-alone Windows console executable that can run as a service executable 
Gen 2.0 Alpha supports the same commands as Gen 1.2 with an additional command that returns the infection 's configuration information 
On 9 February 2012 the first known sample for Gen 2.0 Beta is compiled by the developer ( s ) of Hikit 
Also a stand-alone console executable like Gen 2.0 Alpha , the Gen 2.0 Beta code changes internally without providing significant functionality improvements with the exception of now the executable uses a device driver to hide network , file , and registry artifacts related to its operation 
Both Gen 2.0 Alpha and Gen 2.0 Beta still retain PDB file path information within their binaries 
During the development phase of Gen 2.0 Alpha , development of the Gen 2.0 Alpha variants changes locations 
First version of the Gen 2.0 Alpha malware , from 28 August 2011 , has the PDB path located in H : \JmVodServer\Matrixnew2 whereas the file path for later Gen 2.0 Alpha and Gen 2.0 Beta binaries has the PDB path in E : \SourceCode\Matrixnew which suggests that the source code for both Gen 1 and Gen 2 existed on the same machine and moved at roughly the same time 
This may indicate either a single developer or a team ( or set of teams ) with shared resources 
The first known Gen 2.1 binary has a compile date of 17 April 2012 
Gen 2.1 represents the first Gen 2 sub-generation to use an executable-based loader , DLL and driver model , a model that all subsequent Gen 2 sub-generations employ 
The functionality of the Gen 2.1 sub-generation is the same as the previous generations with no new commands being introduced 
Gen 2.1 is the first sub-generation in the Gen 2 sub-family to introduce 64-bit binaries 
The Gen 2.2 sub-generation appears to have begun on 20 July 2012 
Gen 2.2 is notable for altering where the configuration information of the RAT is stored and using both DLL-based and executable- based loaders 
Also notable is the fact that the sub-generation spans a significant amount of time with intermittent periods of development 
The bulk of the Gen 2.2 samples that have the tell-tale marks of being the product of a builder have a compile date of 26 July 2013 , a full year after the first known Gen 2.2 sample 
Between 21 July 2012 and 20 February 2013 , there are no known Gen 2.2 binaries 
The two 20 July 2012 samples have different compile times indicating they were not the product of a builder but rather unique compilations 
Between 21 February 2013 and 27 February 2013 , there are 4 unique compilation dates for the DLL component with 7 unique , known Gen 2.2 DLLs 
The bulk of Gen 2.2 samples have a compile date of 26 July 2013 
There are approximately 25 known Gen 2.2 DLLs with the 26 July 2013 compile date 
The Gen 2.2 sub-generation appears to exist through at least 19 September 2013 
The last known Gen 2 sub-generation , Gen 2.3 , began on 12 December 2013 
Gen 2.3 is notable for its use of a legitimate SSL certificate as part of the handshake between the infected machine and the attacker 's C2 
Another interesting aspect of the Gen 2.3 sub-generation is that there is no longer a marker to designate the beginning of the embedded configuration 
Gen 2.1 and Gen 2.2 uses a specific string to indicate the beginning of the embedded configuration presumably in order to allow the builder to locate the configuration space when constructing a new configuration for the binaries 
Gen 2.3 , however , uses a specific location instead , requiring the builder to calculate the specific location using the PE/COFF header of the binary 
Also , while Gen 2.1 and Gen 2.2 retain the configuration within the DLL component , Gen 2.3 stores the configuration within the loader component 
This allows the attackers to configure the loader without having to update the DLL 
The evolution of Hikit is a long and drawn out series of small , incremental development changes 
The important take away from the evolution of Hikit is that the developers for Gen 1 appear to have changed in late 2011 and development of Gen 2 has a several month overlap with the development and usage of Gen 1 
The following table provides a quick reference to the generational ( and sub-generational ) designations of Hikit 
The Driver component for Hikit varies based on the specific Hikit sub-family ( Gen 1 or Gen 2 ) 
As such it is necessary to describe each in the context of its specific sub-family 
The Driver component of Gen 1 Hikit variants provides the interface between the victim 's network interface card ( NIC ) and the DLL 
The Driver is a NDIS ( network ) driver that integrates into the victim's network stack 
When the Driver removes data from the network stack , the Driver stores the removed data in local buffers for the Gen 1 DLL to query against 
In order to interact with the Driver , the DLL uses the function The Driver will remove data from the network stack only if a new channel is being established 
A new channel occurs when the Driver detects a trigger string 
The trigger string is typically a short form HTTP request with the following trigger strings found in the wild : Up to and including Gen 1.1 Drivers required the DLL to specify the trigger string in addition to the authentication value whereas Gen 1.2 Drivers had the trigger strings hardcoded 
In Gen 1.2 , whenever the Driver detects a trigger string , the Driver inspects the rest of the data received for the authentication value 
If the token follows the trigger string ( there is no specific limitation on how far from the trigger string the password token must be ) , then the Driver generates a new channel that the DLL will use as the conduit between the DLL and the client 
The Driver appears to be based off the NDIS example source code PassThru 
More specifically , the author ( s ) of the Driver appear to have used the modified version of the PassThru example , PassThruEx , by James Antognini and Thomas Devine from a 2003 blog post 
The Driver is a relatively straightforward piece of software 
The Driver is based primarily on the open source Agony rootkit and it has evidence of some portions of the code coming directly from a Chinese blog 
For reasons unknown , the authors of the Driver used code from a Chinese blog that details how to hide network connections on Windows Vista and later decided to keep the example IP address within the code 
Gen 2.0 introduced a single command to provide insight into an infected machine 's Hikit configuration ( something that is not necessary for Gen 1 variants since they are server-based ) 
The remote shell function uses the standard pipe redirection method for interfacing a network application ( in this case , the DLL ) to a hidden command shell 
The connect function provides the functionality to allow one Hikit DLL to interface with another DLL of a similar version 
The use of this functionality can best be illustrated by considering the fact that the Gen 1 Driver requires an exposed network interface in order for an external attacker to access the Gen 1 's RAT function 
This would prohibit lateral movement within a victim 's network as the bulk of any organization 's network infrastructure is not directly exposed to the Internet 
By using the connect command , an attacker can instruct the externally exposed Gen 1 DLL to route traffic to a Gen 1 DLL that is behind the firewall , effectively making the externally exposed Gen 1 DLL a local router for Hikit traffic 
This information is important for the attacker to have access to in order to determine if any aspect of the configuration is out of date ( thus requiring a new variant of the Gen 2 binary to be configured and deployed ) 
The information command returns to the attacker the complete configuration and current state of the Gen 2 malware 
As the name implies , the exit command causes the DLL to discontinue the current connection 
With the Gen 1 sub-family using a server model and the Gen 2 sub-family using the client model , understanding how each of the DLL components of the sub-families works is best done , as with the Driver above , in the context of the specific sub-family 
As noted previously in this report , the Gen 1 sub-family has several sub-generations but overall the functionality of the Gen 1 sub-family has remained constant 
With the exception of Gen 1.0 , the functionality of Gen 1 comes from the DLL component ( Gen 1.0 uses a stand-alone executable to achieve the same results ) 
The DLL contains only two exports : DllEntryPoint and DllRegisterServer 
The authors of Gen 1 used freely available source code found online for their removal function 
This requires sending OID 0x12C850 to the Driver and comparing the resulting 32-bit value with the required driver version 
If the version is incorrect ( i.e 
The DLL again checks the version of the Driver and , in some versions of the DLL , will print a message indicating the version of the Driver installed and report the '' Transate version '' ( the word translate is misspelled within the binary ) 
It appears that the Driver and the communication protocol version do not necessarily have to match exactly , allowing the possibility that the Driver and the DLL could be compiled at separate times 
If the Driver version is less than the '' Transate '' version ( indicating that the Driver is a version too old to support the necessary communication protocols ) , the DLL will , in some version of the DLL , print out a line to the screen indicating the DRIVERMINVERSION required along with the current Driver version 
It is unclear why this code exists given that the DLL will check the Driver version and correct the Driver if necessary prior to reaching the portion of the code that reports the DRIVERMINVERSION 
The DLL enters an infinite loop where the DLL waits for the Driver to report a new channel exists 
A channel represents an established connection between the Driver and an external party that has provided the proper initial request and , for Gen 1.2 variants , provided the proper authentication value 
This allows the DLL to service multiple channels at one time 
The HikitThreadFunc function is , at its core , a simple wait and respond loop 
The function begins by transmitting a Hikit command prompt to the client ( Hikit > ) before settling into an infinite loop of The communication scheme between the DLL and the client consists of a 20 to 24 byte header ( for Gen 1.0 and Gen 1.1 ) or a 28 byte header ( for Gen 1.2 ) followed by an optional payload 
The format of the Gen 1.0 and Gen 1.1 header is as follows : While the Gen 1.2 header is : For Gen 1.0 and Gen 1.1 samples , the magic field contains the string '' .. .. '' ( two dots followed by a space then two more dots ) 
Whereas the key field in Gen 1.2 samples contains a 32-bit value that represents the XOR key for the remainder of the PacketHeader and any additional payload data 
The XOR scheme works on 32-bit chunks of data where each 32-bit chunk of data is XOR 'd against the key value 
Version checking is important in all Gen 1 variants 
Gen 1 samples have a particular interest in the victim 's locale language preferences 
While it is typical for most RATs that provide remote shells to simply pass data unfiltered from client to server and server to client without regard to code pages , Gen 1 samples take special care to record the code page and locale information in each and every packet header that traverses the divide between client and server and server and client 
This could indicate that the authors of Gen 1 understood from an early stage in the development of Gen 1 that they would be attacking computer systems with different locales and code pages 
The Loader comes in the form of a standard executable image or a DLL image 
The only difference between the executable and DLL versions of the Loader comes in how they handle the initialization of the embedded DLL 
Figure 1 provides a side by side comparison of the startup routines for the executable and DLL Loaders 
The function LoadEmbeddedImage , as seen in part in Figure 2 , is responsible for this operation 
The Loader obfuscates many strings by using a simple XOR encoding scheme 
Decryption of encoded strings consists of taking the first value of the string as the XOR key , XOR'ing all subsequent bytes until the result of the XOR returns 0 
The decoding of the encoded strings is handled by the DecodeString function 
The Loader stores the embedded DLL within a Group Icon resource within a legitimate icon image 
In order to locate the embedded DLL , LoadEmbeddedImage will use the DecodeString function to decrypt the delimiter string ( which is typically zzzzzzzzzz or yyyyyyyyyy ) and then search the icon's resource memory for the delimiter string 
Once located , LoadEmbeddedImage will use the first 12 bytes immediately after the string as the information structure about the embedded DLL 
The structure ( seen below ) defines the size of the embedded DLL within the icon 's resource memory , the size of the DLL after it is decompressed and a 4-byte XOR key that LoadEmbeddedImage must use to decode the embedded DLL prior to decompression 
Another heap buffer is allocated with a size equal to the value of dwImageSizeDecompressed 
The decompression buffer along with the now decoded compressed buffer are given to lzodecompress which decompresses the compressed image using the LZO1X algorithm 
The Gen 2 DLL exposes five exported functions ( besides the DllEntryPoint/DllMain ) 
MatrixMain , however , has added functionality 
'' Network DDE Service '' ) and assign itself as the executable for the service 
Each communication burst ( either between the malware and the C2 or the malware and neighboring malware ) begins with a 24-byte header identical to the header found in Gen 1.2 
Immediately following the header is the type-specific ( as indicated by the dwPayloadType field ) payload data 
Note that the dwXORKey value is NOT encoded with the XOR value , but rather is the value that is used for encoding the header and payload 
Each DLL includes a hardcoded , default configuration 
At the time that the RAT functionality activates , the DLL will drop the current configuration to disk 
If the configuration file already exists , then the RAT will use the file version of the configuration over the default configuration 
The configuration data structure ( seen below ) doubles as a current state record for some aspects of the communication subsystem of the DLL 
When stored on disk , the configuration is preceded by a GUID value ( 16 bytes ) that represents the unique identifier for the specific infection 
The configuration is XOR encoded using the first 4 bytes ( as a DWORD ) of the GUID 
The DLL contains a device driver image embedded within an encoded buffer which the RAT functionality code will extract to the % TEMP % directory ( after XOR'ing the buffer with 0x76 ) 
\Globals\HTTPS ) 
In addition to the main Hikit malware , there are at least two examples of support programs that belong to the Hikit family 
Samples b04de6c417b6f8836e3f2d8822be2e68f4f9722b and 7c4da9deff3e5c7611b9e1bd67d0e74aa7d2d0f6 are examples of Gen 1.0 and Gen 1.2 operator consoles 
Detecting Hikit variants on disk and in memory is possible using the following YARA signature developed by Symantec : Detecting nominal Gen 1.2 and later network activity is problematic given the nature of the communication structure 
The encrypted nature of the nominal Gen 1.2 and later network traffic makes a signature difficult 
Snort signature 30948 may detect some Hikit based network traffic for only Gen 1.0 and Gen 1.1 
The event names change per infection , but have a common format 
It 's friday afternoon , I had a bit of free time and stumbled across this tweet by PhysicalDrive0 ( thx ! ) two hours ago and thought to give it a try to finally add a new article to this Blog ( first of 2014 ) : So , I went to Google to search for the domain of the Embassy of Greece Beijing and added the ( allegedly ) malicious java file package that was found by PhysicalDrive0 : Next , I loaded the 1.jar file into Java Decompiler to get the source code 
It showed , that the functionality is obfuscated in some way , e.g 
the function csfn ( String paramString ) decrypts all strings by '' removing '' the numbers of the string parameter : There are some other obfuscation techniques , but they are not important here 
Instead , the following deobfuscated code line in the function init ( ) gives us an idea where the actual payload is located : We can also see , that the java package contains a file named pack , so we open 7-Zip and unpack the file 
A quick view with a PE viewer showed , that it is a x86 PE executable not even encrypted ( SHA256 : b832e4b5a4829c8df6de7b42c5cb32ef25b5ab59072b4c2a7838404cd0dd5e5f ) : So , I opened IDA Pro to take a quick look at the functionality 
Together with the strings of the executable , we get a brief idea of what the purpose of this malware is 
To verify this , we open up Wireshark and run the executable 
But first , we combine the C & C server and the HTTP request and open the URL in our favorite Browser : As you can see , there is a string named microsoft followed by Base64 encoded data 
Side note : Is there also a Linux equivalent ? Next , we copy the Base64 encoded data and go to the following website to let us decode it into a file ( because I had the feeling it 's just another unencrypted executable ) : As a result , we get another executable ( SHA256 : a4863f44f48d1c4c050dd7baad767a86b348dd4d33924acf4e0a3cd40c6ae29f ) that was only Base64 encoded and not encrypted in any way : So again , we fire up our PE viewer and take a look at the important strings : Again , we load the executable into IDA Pro and quickly fly over the assembly code to get an idea of the functionality 
The attackers behind the breach of the New York Times ' computer network late last year appear to be mounting fresh assaults that leverage new and improved versions of malware 
The new campaigns mark the first significant stirrings from the group since it went silent in January in the wake of a detailed expose of the group and its exploits - and a retooling of what security researchers believe is a massive spying operation based in China 
The newest campaign uses updated versions of Aumlib and Ixeshe 
FireEye researchers spotted the malware when analyzing a recent attempted attack on an organization involved in shaping economic policy 
The updates are significant for both of the longstanding malware families ; before this year , Aumlib had not changed since at least May 2011 , and Ixeshe had not evolved since at least December 2011 
Cybercriminals are constantly evolving and adapting in their attempts to bypass computer network defenses 
But , larger , more successful threat actors tend to evolve at a slower rate 
As long as these actors regularly achieve their objective ( stealing sensitive data ) , they are not motivated to update or rethink their techniques , tactics , or procedures ( TTPs ) 
These threat actors ' tactics follow the same principles of evolution – successful techniques propagate , and unsuccessful ones are abandoned 
Attackers do not change their approach unless an external force or environmental shift compels them to 
As the old saying goes : If it ai n't broke , do n't fix it 
So when a larger , successful threat actor changes up tactics , the move always piques our attention 
Naturally , our first priority is ensuring that we detect the new or altered TTPs 
But we also attempt to figure out why the adversary changed - what broke ? - so that we can predict if and when they will change again in the future 
We observed an example of this phenomenon around May 
The previous versions of Aumlib had not changed since at least May 2011 , and Ixeshe had not evolved since at least December 2011 
We can not say for sure whether the attackers were responding to the scrutiny they received in the wake of the episode 
But we do know the change was sudden 
Akin to turning a battleship , retooling TTPs of large threat actors is formidable 
Such a move requires recoding malware , updating infrastructure , and possibly retraining workers on new processes 
The following sections detail the changes to Backdoor.APT.Aumlib and Backdoor.APT.Ixeshe 
Aumlib has been used in targeted attacks for years 
The sample , which was deployed against an organization involved in shaping economic policy , was downloaded from the following URL : The sample generated the following traffic : This output reveals the following changes when compared with earlier variants : The POST URI is changed to /bbs/search.asp ( as mentioned , earlier Aumlib variants used a POST URI of /bbs/info.asp 
Additional requests from the sample generated the following traffic : These subtle changes may be enough to circumvent existing IDS signatures designed to detect older variants of the Aumlib family 
The sample 832f5e01be536da71d5b3f7e41938cfb shares code with an older Aumlib variant with the hash cb3dcde34fd9ff0e19381d99b02f9692 
Ixeshe has been used in targeted attacks since 2009 , often against entities in East Asia 
The mark for this particular attack was [ ll65 ] 
Based on our observations , the most successful threat actors evolve slowly and deliberately 
So when they do change , pay close attention 
Knowing how attackers ' strategy is shifting is crucial to detecting and defending against today 's advanced threats 
But knowing the '' why '' is equally important 
That additional degree of understanding can help organizations forecast when and how a threat actor might change their behavior - because if you successfully foil their attacks , they probably will 
This entry was posted in Threat Intelligence , Threat Research by Ned Moran and Nart Villeneuve 
Bookmark the permalink 
This blog gives an overview of the first one , related to Afghanistan & Tajikistan 
The other campaign , where the targets were a number of high-profile organizations in Russia , will be the subject of Anton Cherepanov 's presentation at the ZeroNights security conference in Moscow this week 
Sometimes malware used in various attacks is unique enough to identify related incidents , which makes tracking individual botnets simpler 
An example is the BlackEnergy Lite variant ( also known as BlackEnergy 3 ) used by a group of attackers ( that was then given the name Quedagh , or Sandworm ) against targets in Ukraine and other countries 
BlackEnergy Lite is clearly distinguishable from the numerous binaries of the more common BlackEnergy 2 also circulating in-the-wild 
In other cases , attackers use more common tools for accomplishing their criminal goals 
For the past several weeks we have taken a closer look at a great number of detections of this malware in many unrelated incidents 
The image below shows the beginning of the CVE-2012-0158 shellcode in ASCII encoding within the document ( the opcodes 60 , 55 , 8bec disassemble to pusha ; push ebp ; mov ebp , esp ) 
Interestingly , though , the documents also contain the newer CVE-2014-1761 exploit that was extensively used in targeted attacks carried out by a number other malware families this year ( including BlackEnergy , Sednit , MiniDuke , and others ) 
However , this exploit is not implemented correctly due to a wrong file offset in the 1st stage shellcode 
Below we see the disassembly of the 1st stage shellcode where it checks the presence of the tag '' p ! 11 '' marking the beginning of the 2nd stage shellcode and loads it into memory 
Even though the tag and 2nd stage shellcode is present in the RTF , it 's at a different offset , and thus never is loaded 
Sophos ' Gabor Szappanos gives a possible explanation how these malformed samples may have come into existence 
ESET LiveGrid telemetry indicates that the attacks against these targets have been going on since at least June 2014 and continue through today 
We were able to pinpoint the targets to residents of the following countries : From the topics of the files used to spread the malware , as well as from the affected targets , it appears that the attackers are interested in gathering intelligence related to Afghan , Tajik and Russian military and diplomatic subjects 
Interestingly , most of the affected victims have another thing in common – a number of other RATs , file stealing trojans or keyloggers were detected on their systems on top of the Korplug RAT detection 
Since the functionality of these tools was partly overlapping with that of Korplug , it left us wondering whether the attackers were just experimenting with different RATs or were they supplementing some functionality that they were unable to accomplish 
Additional information about two malware families that were most often found accompanying Korplug infections is given below 
Some samples contain a digital signature by '' Nanning weiwu Technology co. , ltd '' 
Within the last six months , Invincea has discovered and stopped targeted malvertizing attacks against specific companies -- particularly those in the Defense Industrial Base 
The combination of traditional cyber crime methods ( malvertising ) with targeted attacks against Defense industrials for theft of IP represents another development in the on-going blending of techniques from cyber crime and advanced threat actors with nation state agendas 
We are tracking an on-going campaign against US Defense companies under the code name Operation DeathClick 
In this new targeted variation of malvertizing , the perpetrators are attacking specific organizations by leveraging real- time ad bidding networks and micro-targeting techniques developed over the last decade in online advertising 
The objective of these micro-targeted attacks against the Defense sector is likely theft of Intellectual Property more than ad fraud and indicates motive and sophistication characteristic of advanced threat actors 
While we discovered these attacks across multiple Defense companies , we expect it will not be long , if not already , before other highly targeted segments including Federal , Financial Services , Manufacturing , and HealthCare are victimized with the same micro-targeted malvertising 
The campaign described here does not represent a single flaw , 0-day , or unpatched bug , but rather a significant development in the adversary 's capabilities and strategy to leverage legitimate online advertising platforms on well-known ad supported websites via a technique called Real-Time Ad Bidding 
In other words , this problem will not be patched on Tuesday 
UPDATE : We have updated this document to include a new section on a campaign of distributing CryptoWall ransomware via malvertising 
While the attack vector is the same , we believe this to be motivated by cybercrime rather than theft of IP from Defense companies 
Malvertising has seen meteoric rise in 2014 
These exploit kits are hosted on compromised web servers across the world 
In other words , they leverage legitimate ad-supported popular websites together with compromised websites for hosting exploit landing pages , defeating black-listing techniques 
The lifetime of these ads and landing pages are measured in hours 
They are employing the tactics of real-time ad bidding to guarantee malicious ad delivery to intended targets of the campaign – building on a decade of work in real-time analytics for online ad placement , but for nefarious purposes 
The threat actors redirect their ads for just minutes at a time and then abandon their exploit kit pages forever 
This means that list-based threat intelligence feeds are rendered ineffective 
The domains used do not appear in any proxy blacklist , and the malware droppers delivered by the exploit pages always employ different signatures , evading traditional network and endpoint detection technology 
Ad delivery networks today are not incentivized to address the problem in a credible manner as they derive revenue from the criminal enterprise , while not being held accountable 
Turning a blind eye to the problem is rewarded economically 
Meanwhile the perpetrators are able to use traditional malvertising and ad fraud bots to fund the criminal enterprise 
Without cooperation of ad networks to vet the advertisers working through front companies , this attack vector will go unchecked 
For example , oppressive regimes trying to gather intelligence on activist protests can deliver ads to people getting email from within a specific locality where they are protesting 
Today , it is commonplace for micro-targeting techniques to be used as part of the toolset in legitimate online advertising 
For instance , a defense contractor , trying to win a new omnibus contract , can deliver targeted ads to online news sites frequented by Government program personnel 
The latest software product release can be delivered to Windows users visiting PC Magazine 's website 
A local car dealership can sense when someone is in the market for a new car and can deliver advertising to those users , based solely on browsing history 
Thus , it does n't matter where in the world you point your web browser -- an online video poker room , a fantasy football club homepage , a Pakistani news homepage , or even checking your own webmail at a trusted email provider 
These contractors had deployed world-class enterprise security defense in depth approaches to protect their intellectual property 
They had next generation firewalls that relied on threat intelligence feeds to do auto-blocking of known malicious sites 
They had malware interception technology that relied on known bad hashes to prevent malicious downloads 
The multiple proxies in place subscribed to real time feeds of known bad URLs 
They deployed AV at the gateways and on the endpoints 
Once targeted , an end user only needed to browse to any website , anywhere in the world , which contained a DoubleClick ad-partner embedded window 
Invincea stopped these attacks on the endpoints by containing the delivered exploits in secure virtual containers , while producing the forensics that led to this discovery 
Next we go in some detail about example attacks perpetrated against the defense firms 
It is important to note that the websites we show next that served up targeted malvertising were victims of malvertising campaigns with no knowledge of the malicious ads they were serving up 
These malicious ads were served up by 3rd party networks , who are unwittingly sourcing malicious content 
As we will discuss later , the 3rd party ad networks themselves are falling victim to malicious content campaigns 
A user visited his online fantasy football league homepage at Fleaflicker.com 
Figure 1 shows a screenshot of the page that was visited 
You will notice the two inline ad placements for DoubleClick ad delivery 
Note the prominent ad placements by AdChoice , a DoubleClick affiliate 
The timeline below shows the exact times and URLs visited 
Note the number of re-directs from Fleaflicker.com to different outside properties in Figure 3 
Invincea Threat Management provides a quick way to search for an MD5 hash on third party sites ( see Figure 4 ) 
An employee at a defense contractor visited a free Texas Poker online game 
The Poker site had advertisements on the page , one of which launched a similar attack as seen in before on other websites visited by employees at this firm 
It should be noted that Gpokr.com no longer appears to be serving advertisements from their site 
At the time of the incident , as seen in the logs below , an ad window was previously present 
In the event tree shown in Figure 7 , you will see that the winning bid redirected to a direct-to-IP site instead of a site via domain name 
Also , above is the first indication of specific executable DLL files 
Searches for these filenames returned zero results on VirusTotal 
Note the multiple DLL files written to disk and the spawning of rundll32.exe 
At this point , the Invincea-protected host recognized the unauthorized process and reverted itself to a clean state 
In another incident an employee checked their online Earthlink account 
This malvertising was from the same IP address seen in other incidents 
You will notice the inline advertisements on this page in Figure 9 
Note in the timeline in Figure 11 , how there was a 7 minute gap between the DoubleClick ad redirect and the delivery.first-impression.com ad 
This is an indication that the page was refreshed or the ad was refreshed on the page 
The same exploit IP address from the Gpokr event is present 
This event is the oldest , happening on September 11 
The three examples above are samples of the more than two dozen micro-targeted attacks we have witnessed and blocked as part of Operation DeathClick since mid-September 
Defense Industrial Base customers witnessed micro-targeted malvertising at a rate six times that of comparable private sector companies with similar defense-in-depth capabilities 
In these third-party arrangements , the content is frequently not vetted because billions of impressions are rendered in real-time 
Most of the content is legitimate ads 
Real-time ad networks are being used , often unwittingly , and some have taken steps to try and combat malicious use of their networks 
The Online Trust Alliance is one such industry group comprised of major software companies and ad networks working together to try and address this problem 
Our goal in this paper is to shed light on the micro-targeting of companies by criminal enterprise employing real-time ad networks , and to aid the industry in collectively addressing this problem 
Real-time ad bidding networks have evolved over the last ten years as a means of micro-targeting customers with advertising content they are more likely to click-on 
From Wikipedia : Real-time bidding ( RTB ) refers to the means by which ad inventory is bought and sold on a per- impression basis , via programmatic instantaneous auction , similar to financial markets 
[ 1 ] With real-time bidding , advertising buyers bid on an impression and , if the bid is won , the buyer 's ad is instantly displayed on the publisher 's site 
[ 2 ] Real-time bidding lets advertisers manage and optimize ads from multiple ad-networks by granting the user access to a multitude of different networks , allowing them to create and launch advertising campaigns , prioritize networks and allocate advertising stock 
Real-time bidding is a dynamic bidding process where each impression is bid for in ( near ) real time , against a static auction where the impressions are typically bundled in groups of 1,000 
A typical transaction begins with a user visiting a website 
This triggers a bid request that can include various pieces of data such as the user 's demographic information , browsing history , location , and the page being loaded 
The request goes from the publisher to an ad exchange , which submits it and the accompanying data to multiple advertisers who automatically submit bids in real time to place their ads 
Advertisers bid on each ad impression as it is served 
The impression goes to the highest bidder and their ad is served on the page.This process is repeated for every ad slot on the page 
Real time bidding transactions typically happen within 100 milliseconds from the moment the ad exchange received the request 
The bidding happens autonomously and advertisers set maximum bids and budgets for an advertising campaign 
The criteria for bidding on particular types of consumers can be very complex , taking into account everything from very detailed behavioral profiles to conversion data 
The following infographic summarizes how advanced adversaries are now micro-targeting companies using malvertising 
The marketplace and auction of ads sounds great for actual ads 
The price to win the bid to push malvertising to any page you happen to visit ranges from 45 to 75 cents per impression 
A malicious advertiser on a network may serve crafted , seemingly normal ads , a majority of the time 
In fact , the ads are often stolen copies from legitimate advertisers 
This establishes the attacker 's legitimacy and trust on the ad network 
Of course with real-time ad bidding , he can simply offer up low bids and his content would consistently lose in the marketplace 
Once the malvertiser detects that he has several infected hosts , he removes the redirection code and goes back to serving standard ad banners 
He then '' burns '' his temporary exploit kit drop site , moving his exploits to another location for a new campaign 
This allows the malicious advertiser to perform hit and run attacks , infect whomever he wants at whatever time he wants , and maintain his presence on the advertising marketplace without drawing undue attention to his activities 
In the sections below , we will provide highlights of the RTB industry , its targeting capabilities , and show how malvertisers have been mis-appropriating RTB networks to deliver malware 
The RTB ad networks provide significant micro-targeting capabilities that have long been used to serve legitimate content to users more likely to click on them 
In the following , we describe these capabilities to show the state of the art in RTB network capabilities 
The quoted material below are direct quotes from Real Time Bidding service providers linked 
Emphasis added by Invincea 
Audience Targeting : Bid on the audiences most valuable to you 
Each impression in the PubMatic auction can be enhanced with first- and third-party data ; giving buyers targeting capabilities across display , mobile , tablet and video inventory 
Media buyers can also cookie sync with publisher audiences to incorporate CRM , retargeting and exclusion strategies in their digital advertising 
Buyers have access to proprietary audience segments either directly through Private Marketplace deals or through the open market 
With hundreds of parameters available to you , PubMatic has your best audiences waiting for you 
With PubMatic , buyers are able to access pre-defined vertical or audience packages , seasonal packages , publisher and/or site-specific inventory packages as well as pre-selected publisher packages and pricing available in Private Marketplaces 
'' First-Impression Buy-Side offers the granular targeting , tracking , and reporting needed to help our clients make the most of their spend , along with an expert support team to advise when needed 
By leveraging real time buying , First-Impression Buy-Side gives media buyers the full control to maximize the value of an impression 
'' Could Malvertisers Track Exploits and their cost per impression ? Yes 
Many RTB networks provide a control panel to track advertising campaigns in real-time , along with notifications that bids have been won and who exactly was served the malware 
Below is a URL redirection log from First-Impression.com from a winning bid by a malvertiser 
In the URL are parameters such as the type of ad , the type of user-agent string of the ad reader specified ( which discloses browser and java versions ) , whether it is a retargeted ad based off of cookies ( this one was not ) , the price paid , which is 65.4 cents , and the notification to the malvertiser that his malvertising was delivered 
DoubleClick discusses their targeting capabilities in online documentation 
Since they specialize in knowing the location of their ad windows , they market those ad spaces to the actual advertisers and malvertisers , along with targeted demographics about the content pages , the visitors to the sites and more 
To showcase the variety of impression-level data available to buyers , consider the data made available through a connection to DoubleClick Ad Exchange 's real-time bidding API 
With ADX , a buyer could consider any of the following data passed from the seller with each impression : • Ad slot parameters : visibility ( above or below the fold ) , size , excluded creative attributes , excluded advertiser URLs , allowed vendor or ad technology 
• Geo parameters : country , region , metro , city 
• Content parameters : site URL , site language , seller network , vertical or category 
• User parameters : browser , operating system , anonymous cookie ( hashed ) , cookie age 
Just like when considering one type of data , by using the anonymous cookie parameter , buyers can consider first-party retargeting or third-party audience data from a data provider 
However , they can go further in the evaluation by looking at more of these parameters 
This helps a buyer learn much more about a particular user and a particular impression , gain a smarter answer to the three essential questions and make a more data-driven decision 
This sounds like a great way to advertise if you are in the marketing industry 
Consider how granularly a person can be targeted if this service is used maliciously 
If not targeted by the desktop , how about on the mobile platform ? Twitter 's Tailored Audiences just got a little more tailored 
Advertisers can now augment their customer data using mobile advertising IDs and mobile phone numbers as a way to reach existing customers and increase audience size 
In essence , the move is an extension of Twitter 's Tailored Audiences for CRM retargeting , which allows advertisers to use hashed non-PII email address to retarget existing customers 
( email addresses are twitter IDs- so you could be targeted for ad delivery based on your account name or known phone number ) Twitter also rolled out the ability to target lookalike audiences , a function that seems pretty similar to Facebook 's tool of the same name 
Twitter 's lookalike modeling uses a proprietary algorithm that examines modeled users looking for similarities related to behaviors , interests , location , demographic attributes and engagement patterns 
Twitter described its enhanced as '' part of improved targeting options to help advertisers reach additional users similar to their existing audiences 
'' Tailored Audiences , Twitter 's seeming answer to the Facebook Exchange ( FBX ) , officially launched back in December after running retargeting and database matching tests in July 
Twitter has appeared to follow Facebook 's lead with a number of its recent roll-outs , including site retargeting , CRM targeting and now retargeting via lookalike audiences 
( Facebook also makes it possible to target users by phone numbers through Custom Audiences 
) Neustar does provide a real-time bidding ad exchange , but their real market is IP intelligence that they sell to other advertising networks for the purposes of better targeting specific users 
In Europe , laws require that advertising networks allow people to opt out of having tracking cookies , which is how many advertisers used to rely upon for ad campaign targeting 
To get around this , Neustar perfected IP based targeting , which avoids cookies 
They are able to build IP specific browsing profiles based on IP subnets 
In a blog post below , Neustar boasts about their direct to IP range and enterprise advertising 
How can Neustar IP Intelligence target by IP ? While IP intelligence has been around for many years , the ability to effectively target advertising by audience , based on IP is very new 
Neustar IP Intelligence is currently working with select DSP platforms to buy impressions off of the exchanges based on the IP address rather than cookies 
This has only been possible with the recent emergence of real time bidding ( RTB ) 
The secret sauce is in understanding the IP and the methodology necessary for targeting ads appropriately against it 
Is an IP Address like a cookie ? No , an IP address only identifies devices on a network 
The IP address does not contain any PII and does not track or store any consumer usage or behavioral information 
( But IP ranges are registered by IANA , and you can easily know who owns the ranges ) Product Specific Questions Q1 : How does the process work ? The process works exactly like any advertising network 
Instead of buying inventory based on a cookie , Neustar is buying inventory based on an IP address 
We run the targeting specifics against our proprietary database and create a custom IP list to target against 
Neustar has set up relationships with partners that have built the functionality for this to work end-to-end for our advertisers 
Neustar offers a full service ad network 
Brand marketers who wish to advertise using IP Audience Targeting can work directly with Neustar to determine custom IP placements , run campaigns , optimization , reporting and billing 
Much like any traditional online publisher or online ad network , Neustar manages the entire process 
How does Neustar deliver its ads ? We use industry standard methods for delivering our ads , but what makes our approach special is that we bake in the IP data before delivering the inventory with our network partners , which allows us to target display ad campaigns to a specific business or organization 
We obtain inventory from ad exchanges , but have our own ad server 
Zedo , blamed for recent malvertising via DoubleClick , say they are now trying to protect against malvertisers in this blog here 
Less than a week after this announcement , they published another blog post that describes how they can push advertising to specific platforms , devices , as well as specific markets and networks : Users can now target ads to a specific device when trafficking ads 
An option for '' Device Targeting '' is now available under '' Targeting '' 
A creative targeted to a specific Device will serve only on that Device 
All major manufacturers/models are supported by this feature 
If a creative is not targeted to any specific device than it will serve on all device 
Apart from device , a user can target various devices based on different categories 
At any given point of time , a user can target multiple manufacturers and categories 
Apart from existing campaign reach report a user can now pull a reach report by creative 
The creative reach report is available along with all the existing parameters and can be pulled by month , week or day 
Creative reach report will show creative wise reach 
It will help to analyze how effective the reach of a creative was 
To be clear , RTB networks are legitimate platforms for displaying ads on ad-supported websites 
They enable micro-targeting of user 's interest , delivering content that a viewer would likely want to see 
Below are links to RTB providers to learn more 
Invincea has shown logs from a winning malvertising bid in the price range of 65 cents per impression 
That is one ad , on one page , paid for by the malvertiser 's account 
This implies that malvertisers have deep pockets , spending hundreds of dollars on ad impressions 
It is presumed that these ad banners paid revenue via referral bonuses to the malvertiser 
It is a pretty good return on investment , which in turn allows the malvertiser to fund his micro-targeted malvertising attack campaign 
It is ironic , however , that click fraud is what is driving the prices of RTB advertising so high 
Malvertising is not only a danger to end users , but it is a danger to the advertising industry as well 
The image from Figure 14 below shows a log file of Chrome , in this instance , renamed Oajvliewxpge.exe , injected via Java to run in the background 
Invincea detected this attack and killed the infection attempt 
This is one instance where the malvertiser wasted his 65 cents 
It should be noted that Invincea is uniquely capable of stopping this type of attack 
The introduction of Chrome as a browser , which is whitelisted by hash across the AV industry , would go unchecked by the AV and whitelisting applications industry 
The ability for advertisers and malvertisers to automatically redirect to self-hosted ad content or exploit pages is driving RTB malvertising 
The malvertiser creates the redirection in his normal ad prior to raising his bids to winning levels 
Once several victims are confirmed , those malicious landing pages have the content erased , and the automatic redirection removed to serve '' normal '' ads again 
Users are held hostage from their own work , pictures , personal , and proprietary material 
To learn more about the scourage of ransomware , see this blog 
According to Invincea analysis of ads delivered from first- impression.com , winning ad bids ranging from as low as 30 cents and as high as $ 1.70 , were delivered by a block of unique identifiers 
It is highly likely that the same attackers are using other RTB ad platforms 
This campaign matches the characteristics described by Proofpoint in its blog in terms of the exploitation methods 
Many companies have fallen prey to this attack over the past few months , making this one of the most successful Ransomware campaigns to date 
Below is a typical Cryptowall 2 infection as seen in the Invincea Management Server logs 
This winning ad placement ran on sports.yahoo.com – an Alexa Top 4 rated site 
Highlighted in order in Figure 22 is the common filename of obupdat.exe , which has ever changing hashes , followed by the TOR port , and the 3rd party ad platform of first-impression.com 
Analysis ( Original report ) : Timeline Analysis ( Original Report ) : Below in Figure 23 is the timeline of the Tor connections and SSL connections employed by CryptoWall 
Figure 25 shows the winning malvertising bid via RTB ad delivery from first-impression.com 
In Figure 26 below , we show the unique identifiers for the userID and campaigns to deliver CryptoWall malware that were blocked and audited by Invincea , including the websites that delivered the ads via a third-party ad network over the past month 
To reiterate , neither the websites listed here , nor the 3rd party ad network , necessarily was aware of the malicious ads they were serving to the website visitors 
It is likely they were not aware without ad screening technology 
In each event above , Invincea blocked an attempt to infect an endpoint with Cryptowall 2.0 and prevented CryptoWall from encrypting the user 's file system and holding it hostage 
Had the user not been running Invincea , the attack would likely have been successful , and the only way the user would have had to recover the encrypted files would be to pay the attacker the ransom 
This is an effective ransom technique , and one that is paying off well for the attackers , who use the income from the attacks to purchase Real Time Ad Bids on RTB networks to infect more users 
Most RTB ad providers allow for advertisers to host their own ad content 
This allows advertisers to directly collect web impression data of who is hitting which ads , from where , by which IPs , which user- agent strings , and just about anything else you could log about a website visit 
In addition , the advertising network does n't have to utilize their own disk space to host the image files , the flash videos or other online content 
RTB networks simply do the auctioneering and redirection to the winning content 
It is this weakness in security that malvertisers are taking advantage of 
If ad networks were to switch to a model where all content is actually hosted by them ( 1st party hosting ) , in a cloud , then the risk of malvertising would drop dramatically 
The RubiconProject has a Seller 's Cloud , which could be a security model for the RTB industry 
It is inherently more secure way of hosting ad content 
Invincea can protect users from this attack type among other targeted and opportunistic web-based threats 
Web proxy blocking updates , even in real time , will not stop new malvertising landing pages that appear and disappear within minutes 
Intelligence feeds from the premier intelligence providers , based on hostname , IP , URL or domain will not be able to block malicious malvertisers quickly enough 
Invincea protected users can simply browse and click anything online without fear of compromise or targeted malvertising attacks 
Non-Invincea users can attempt to OptOut of directed targeting where you can 
European privacy laws for forcing most ad providers to offer the opt-out service ; however , you often have to visit each ad provider individually to choose to opt out 
Note , that opting out merely places a blocking cookie in your browser 
This means that ad providers will not target or retarget based on cookies 
But as shown above , the new targeted advertising is via IP intelligence 
10/27 : For clarification , Invincea has added additional notes in this version that the websites shown here and the 3rd party real-time ad networks are being used unwittingly and their resources misappropriated by malvertisers to target companies for persistent remote access , click fraud , and other nefarious activities 
This is not a reflection on these companies , nor the services they provide 
This paper highlights the problem for greater awareness so the industry collectively can combat this problem perhaps with more effective screening at the source prior to displaying ads 
Naturally this piqued our interest , so we decided to peer down the rabbit hole 
Suffice to say , the hole was a lot deeper than we expected ! In fact , it went all the way back to the notorious Russian APT family MiniDuke , known to have been used in targeted attacks against NATO and European government agencies 
The malware used in this case is , however , not a version of MiniDuke 
It is instead a separate , distinct family of malware that we have since taken to calling OnionDuke 
But lets start from the beginning 
When a user attempts to download an executable via the malicious Tor exit node , what they actually receive is an executable '' wrapper '' that embeds both the original executable and a second , malicious executable 
Upon execution , the wrapper will proceed to write to disk and execute the original executable , thereby tricking the user into believing that everything went fine 
However , the wrapper will also write to disk and execute the second executable 
In all the cases we have observed , this malicious executable has been the same binary ( SHA1 : a75995f94854dea8799650a2f4a97980b71199d2 , detected as Trojan-Dropper : W32/OnionDuke.A ) 
In reality , the resource is actually an encrypted dynamically linked library ( DLL ) file 
It should be noted , that we believe all five domains contacted by the malware are innocent websites compromised by the malware operators , not dedicated malicious servers 
Through our research , we have also been able to identify multiple other components of the OnionDuke malware family 
One component , however , is an interesting exception 
What makes the overpict.com domain interesting , is it was originally registered in 2011 with the alias of '' John Kasai '' 
Within a two-week window , '' John Kasai '' also registered the following domains : airtravelabroad.com , beijingnewsblog.net , grouptumbler.com , leveldelta.com , nasdaqblog.net , natureinhome.com , nestedmail.com , nostressjob.com , nytunion.com , oilnewsblog.com , sixsquare.net and ustradecomp.com 
This strongly suggests that although OnionDuke and MiniDuke are two separate families of malware , the actors behind them are connected through the use of shared infrastructure 
However , it would seem that the OnionDuke family is much older , both based on older compilation timestamps and also on the fact that some of the embedded configuration data make reference to an apparent version number of 4 suggesting that at least three earlier versions of the family exist 
During our research , we have also uncovered strong evidence suggesting that OnionDuke has been used in targeted attacks against European government agencies , although we have so far been unable to identify the infection vector ( s ) 
Interestingly , this would suggest two very different targeting strategies 
On one hand is the '' shooting a fly with a cannon '' mass-infection strategy through modified binaries and , on the other , the more surgical targeting traditionally associated with APT operations 
In any case , although much is still shrouded in mystery and speculation , one thing is certain 
While using Tor may help you stay anonymous , it does at the same time paint a huge target on your back 
It 's never a good idea to download binaries via Tor ( or anything else ) without encryption 
The problem with Tor is that you have no idea who is maintaining the exit node you are using and what their motives are 
VPNs ( such as our Freedome VPN ) will encrypt your connection all the way through the Tor network , so the maintainers of Tor exit nodes will not see your traffic and ca n't tamper with it 
As the pro-democracy movement in Hong Kong has continued , we 've been watching for indications of confrontation taking place in cyberspace 
Protests began in September and have continued to escalate 
Additionally , at least one member of the popular online forum HKGolden was arrested for posting messages encouraging support for the OccupyCentral Pro Democracy movement 
The use of DDoS attacks as a political tool during times of conflict is not new ; patriotic hacktivist groups frequently use them as a means to stifle political activity of which they disapprove 
The question of state sponsorship ( or at least tacit approval ) in online crackdowns is often up for debate and ambiguous from a technical evidence and tradecraft perspective 
In this case , however , we 've discovered an overlap in the tools and infrastructure used by China-based advanced persistent threat ( APT ) actors and the DDoS attack activity 
We believe that these DDoS attacks are linked to previously observed APT activity , including Operation Poisoned Hurricane 
This correlation sheds light on the potential relationships , symbiosis and tool sharing between patriotic hacker activities designed to disrupt anti-government activists in China , and the APT activity we consistently see that is more IP theft and espionage-focused 
Next Media is a large media company in Hong Kong and the HkGolden forum has been used as a platform to organize pro-democracy protests 
All of the samples we identified have the '' NewVersion '' value of 20140926 
The full list of C2 servers we identified is as follows : On Oct. 21 , the control server at wakayamasatei [ 
] com responded with the following encoded configuration file : This configuration file can be decoded by stripping the leading and trailing @ $ @ characters 
At this point , a simple base64 and XOR decode will reveal the plaintext configuration 
The two different keys are 0x2A or 0x7E 
The IP 58.64.139.10 has hosted hkgolden [ 
] com – the domain for the HKGolden forum mentioned above 
The IP 124.217.214.149 hosted the attacker controlled domain p.java-sec [ 
] com 
It should come as no surprise that hkgolden [ 
] com , nextmedia [ 
] com , and appledaily.com [ 
] hk websites are now or previously have been blocked by the Great Firewall of China – indicating that the PRC has found the content hosted on these sites objectionable 
The most direct connection between these DDoS attacks and previous APT activity is the use of the QTI International and CallTogether code signing certificates , which we have seen in malware attributed to APT activity 
The QTI International digital certificate has been previously used to sign binaries used in APT activity including Operation Poisoned Hurricane 
Specifically , 17bc9d2a640da75db6cbb66e5898feb1 is a PlugX variant signed by the QTI International certificate 
The sample 0b54ae49fd5a841970b98a078968cb6b was signed with the QTI International certificate as well 
This sample was first observed during a drive-by attack in June 2014 , and was downloaded from java-se [ 
] com/jp.jpg 
The QTI International certificate was also used to sign e2a4b96cce9de4fb126cfd5f5c73c3ed 
The java-se [ 
] com website was previously used in other attacks targeting the pro-democracy movement in Hong Kong 
We first observed the presence of malicious javascript inserted into Hong Kong Association for Democracy and People's Livelihood on June 26 , 2014 , which appeared as the following : More recently , as noted by Claudio Guarnieri , the website of the Democratic Party of Hong Kong was seen hosting a redirect to the same malicious javascript 
The CallTogether certificate has been used to sign ecf21054ab515946a812d1aa5c408ca5 
We also found that the hkgolden [ 
] com website was compromised on Sept. 5 , 2014 and had a redirect to a malicious javascript again hosted at another jave-se [ 
] com host , which appeared as follows : Finally , as noted above the IP 124.217.214.149 was seen hosting the domain p.java-sec [ 
] com between Oct. 25 , 2014 and Oct. 27 , 2014 
As Brandon Dixon noted here , the java-sec [ 
] com domain is linked to the java- se [ 
] com by shared hosting history at the following IP address : It is unclear why these actors would attack an IP address they were actively using 
It 's possible that the attackers wanted to test their botnet 's capability by attacking an IP they were using to gather statistics on the size of the attack 
It is also possible that the attackers simply made a mistake and accidentally issued commands to attack their own infrastructure 
While not conclusive , the evidence presented above shows a link between confirmed APT activity and ongoing DDoS attacks that appear to be designed to silence the Pro Democracy movement in Hong Kong 
The evidence does not conclusively prove that the same actors responsible for the DDoS attacks are also behind the observed intrusion activity discussed above – such as Operation Poisoned Hurricane 
Rather , the evidence may indicate that a common quartermaster supports both the DDoS attacks and ongoing intrusion activity 
In either scenario , there is a clear connection between the intrusion activity documented in Operation Poisoned Hurricane and the DDOS attacks documented here 
While the tactics of these activities are very different from a technical perspective , each supports distinct political objectives 
Operation Poisoned Hurricane 's objective appeared to have in part been IP theft possibly for economic gain or other competitive advantages 
In the DDOS attacks , the objective was to silence free speech and suppress the pro democracy movement in Hong Kong 
The Chinese government is the entity most likely to be interested in achieving both of these objectives 
This entry was posted in Threat Intelligence , Threat Research and tagged advanced malware , Cybersecurity , malware , zero-day by Ned Moran , Mike Oppenheim and Mike Scott 
Bookmark the permalink 
One of the questions which comes up in the months after big security whitepaper disclosures is : where are they now ? In other words , what happened to the operators , tools , and infrastructure which was revealed in the reports , blog-posts , and press interviews 
Did they continue on as before , did they re-build the disclosed infrastructure and tools , did they go away and get jobs in another line of work ? In some cases , the disclosure had little , if any impact on the operation 
For example , after the McAfee ShadyRAT report in 2011 , there was absolutely no change in the attacks from the group behind this 
However , when Mandiant released their APT1 report in 2013 , there was a noticeable reduction in activity from the group – and much of the tools and infrastructure has not been seen since 
In the September 2010 issue of Foreign Affairs magazine , former US Deputy Secretary of Defense William J. Lynn discussed a cyber-attack which happened two years previously on the DoD's classified computer networks 
Lynn described how a foreign intelligence agency planted malicious code on the networks with the aim of transferring data to servers under their control 
The article included the now oft-quoted phrase 'digital beachhead ' to describe what was undoubtedly a significant compromise of US military systems 
Further reports in the press kept the story alive in 2011 , but since then this threat has received remarkably little attention 
However , the operation behind the attacks has continued with little modification to the tools and techniques , in spite of the widespread attention a few years ago 
There are some threats which come and go , whilst there are others which are permanent features of the landscape 
In this paper , we describe the tools and techniques of one of the most sophisticated and persistent threats we track 
We hope this will help victims identify intrusions and understand their need to improve defences 
Cyber security is a collaborative effort – the operation described in this paper again raises the bar for the security community in their efforts to keep up with the attackers in cyber-space 
When antivirus back-end classification platforms can not identify a malware family for an analysed malicious sample , they assign generic names , such as '' Trojan Horse '' or '' Agent '' 
The variant letters are also assigned automatically , by using hexavigesimal ( or Base26 ) notation 
That is , the variant letters are auto-assigned starting from '' A '' , followed with '' B '' , and so on until '' Z '' 
Next comes '' AA '' , '' AB '' and so on , until '' ZZ '' 
After that , the variant letters start from '' AAA '' , '' AAB '' and so on , until '' ZZZ '' 
Back in 2008 an unknown malicious file was discovered and auto-classified as '' Agent.BTZ '' , meaning it was registered as unknown malicious sample # 1,898 in an anti-virus classification system 
It was n't given an actual name , only a generic one 
Meanwhile , internally the authors behind this malware were using their own naming systems - with specific titles for their file components and projects such as '' snake '' , '' uroburos '' , '' sengoku '' , and '' snark '' used to denote variants of their framework 
A recent report from German security company GData described a sample from the '' uroburos '' variant of this framework 
Their report revealed the complex nature of this malware family , and showed that the operation behind '' Agent.BTZ '' has continued 
As a result of this disclosure , we are also releasing our own technical analysis of the threat , including a timeline of known samples , known Command-and-Control ( C & C ) servers , and other indicators to aid investigators in discovering attacks 
Reverse engineering of recent malware samples shows these to be much more advanced variants of Agent.BTZ , though still sharing many similarities and encryption methods with the original 
Further investigation allowed us to locate related samples compiled between 2006 and 2014 , and spanning across several distinctive generations 
The first section of this report gives an overview of the samples collected , where they were reported and the timelines derived from their analysis 
Snake 's architecture turned out to be quite interesting 
In general , its operation relies on kernel mode drivers , making it a rootkit 
At the same time , Snake exposed a flexibility to conduct its operations by engaging these noticeably different architectures 
the area of the computer system where application software executes 
the area where lower level system code such as device drivers run 
In both architectures , there is both 32-bit and 64-bit code involved 
In order to distinguish between these architectures , we will call them the usermode-centric and the kernel-centric architectures respectively 
The remainder of this report gives a detailed explanation of how the two Snake architectures embed themselves in the target system and communicate with the outside world 
We have also provided a set of technical indicators in the Appendix to enable organisations and the security research community to identify compromises 
In total we have collected over 100 unique files related to this espionage toolkit 
Many of these were submitted to online malware analysis websites by victims and investigators over several years 
In many cases the source country information of the submission is available 
These allow us to visualise the distribution of countries where this malware has been seen : Whilst this view is likely to only be the tip of the iceberg , it does give us an initial insight into the profile of targets for the Snake operations 
Other useful visualisations of the operations come from the compile timestamps 
Below is shown a table with a count of the number of files in our sample set from recent years 
Two samples compiled in late January 2014 show that this activity is ongoing 
Plotting the day of the week in which the samples were compiled shows a now familiar pattern for analysts of modern cyber-attacks 
The creators of the malware operate a working week , just like any other professional 
The single sample in our set which was compiled on a Saturday is an outlier , but does n't alter the conclusion 
Similarly , plotting the hour of the day in which the samples were compiled reveals another human pattern – the working day 
This has been adjusted to UTC+4 to show a possible fit to the operators ' local time 
The usermode-centric architecture of Snake is known to have been used from 2011 till 2014 , with the most recent sample compiled on January 28 , 2014 
One of the analysed samples exposed multiple debug messages and source control check-in logs 
It is not clear why those messages were allowed in the deployed driver - possibly an operational security lapse 
However , they give some insight into the internal structure of the source code 
For example , the analysed driver gave away the following source file names : The source control check-in log examples , showing the names of the developers to be 'vlad ' and 'gilg ' : It also exposed the project name of this particular variant as 'sengoku ' : Now it 's time to execute the driver and see what it does 
By communicating from within a process that also communicates , even a technically savvy user will find it challenging to detect Snake traffic among legitimate traffic 
The reason behind such difficulty is because modern web pages often fetch pages from the different web servers , including such data as additional scripts , CSS templates , advertising contents , analytics data , blogs , social networking data , etc 
When intercepted with the purpose of analysis , such traffic may literally represent itself hundreds of DNS and HTTP requests made when a popular website , such as a news website is open 
In order to test Snake 's communications with the C & C servers , and still being able to clearly distinguish its traffic , a small tool was built to generate GET request to a web server running on the analysed system 
The tool was named as chrome.exe in order to trigger the malware communications 
As long as the test tool named chrome.exe did not make any requests , its memory stayed pristine 
There were no injections made by the driver 
For example , Snake 's home directory could be C : \WINDOWS\ $ NtUninstallQ812589 $ 
Memory pipes is a common mechanism for Inter-Process Communications ( IPC ) 
When the pipe server reads such requests from the pipes , it performs the web request on behalf of a client by using WinINet APIs , so it effectively serves as a proxy 
Pipe server is a special mode of the injected DLL 
In its communication protocol with the driver it uses the IOCTL code of 0x222038 
However , the data appears to be defined in the structures , so it is very likely the DLL could be generated by a stand-alone builder that 'patches ' the DLL with the new/updated list of C & C 
by using the reconnaissance tool that is explained later ) 
The dropper itself is 32-bit , so it will run both on 32-bit and 64-bit Windows OS ( in WoW64 mode ) 
For example , some samples exposed these filenames : fdisk32.sys , A0009547.sys , or Ultra3.sys 
The filename of the dropper could be rknginst.exe or fdiskmon.exe 
Once executed , the driver first makes sure it is registered under a pre-defined name , such as Ultra3 
Other samples may have a different registration name , such as ~ROOT 
TDI is considered deprecated and will be removed in future versions of Microsoft Windows , but it 's still supported on Windows 7 
TCP/IP ) 
For SMTP traffic , it communicates back normal SMTP server responses , such as '' 250 Sender OK '' , '' 503 Bad sequence of commands '' , etc 
Another opportunity this mode unlocks is a peer-to-peer network mode with no centralised C & C 
The infected hosts are capable of transferring the following peer-2-peer commands defining fragment size , reliability parameters , new peer information , peer impersonation flags , etc 
Thus , it is not possible to reveal the contents of the Snake 's volume by accessing the contents of this file ( unless the encryption is broken , that is ) 
Enlisting the contents of the created volume is possible , along with creating files on it : However , as soon as IofCallDriver ( ) hook is removed , the same 'dir ' command will fail , as with no hook the rootkit can not decrypt the scrambled volume : The second volume \\.\Hd2 is not mapped to a file , so when a computer is switched off , its contents is lost 
Thus , it could be used as a temporary or a cache storage 
to pass commands , configuration parameters , binary images of additional Snake components 
The 64-bit version of Snake must deal with a number of additional security protections implemented in 64-bit editions of Microsoft Windows , the most significant of which are kernel driver signature validation and Kernel Patch Protection ( more commonly known as PatchGuard ) 
PatchGuard is a feature of 64-bit Windows which aims to prevent modification of the Windows kernel , something that is often performed by malware attempting to hide itself on an infected system 
Although PatchGuard is successful at preventing kernel patching once initialised , several published bypass approaches exist , 
The technique used by Snake appears to be similar to these approaches 
The driver signing policy enforced by all 64-bit versions of Windows from Vista onwards requires all kernel-mode drivers to be signed with a valid digital signature 
Does it resort to using bootkit technology , which has been used in the past to bypass protections to load unsigned 64-bit drivers ? The answer : No 
Bootkits must overwrite the Master Boot Record ( MBR ) and antivirus products are well trained to catch that kind of bad behavior 
The masterminds behind Snake rootkit seem to be well aware of this so what they resorted to instead is leveraging a vulnerability in a well-known virtualization product called VirtualBox , a product made by Oracle which is widely used by researchers to analyse malware 
VirtualBox driver version 1.6.2 was released in June 2 , 2008 
Two months later , in August 2008 , security researchers reported that its main driver component , which is signed under the entity '' innotek Gmbh '' , contained a privilege escalation vulnerability 
In a nutshell , the VirtualBox software installs a driver called VBoxDrv 
The driver is controlled with the Input/Ouput Control Codes ( 32-bit values called IOCTL ) passed along DeviceIoControl ( ) API 
One of the documented transfer methods that the system uses to pass data between the caller of DeviceIoControl ( ) API and the driver itself is called METHODNEITHER 
As per MSDN documentation , METHODNEITHER is a special transfer type when Input/Output Request Packet ( IRP ) supplies the user-mode virtual addresses of the input and output buffers , without validating or mapping them 
It is the responsibility of the driver to validate the addresses sent from user mode in order to make sure those addresses are valid usermode addresses 
The source code of the vulnerable driver ( shown below ) demonstrates how the integer value of the rc variable is first derived from the input parameters pDevObj ( device object ) and pIrp ( request packet ) 
Next , that integer value is written into the UserBuffer - an arbitrary address , pointed by the input parameter pIrp ( request packet ) 
This variable is used within the function SepInitializeCodeIntegrity ( ) , implemented within CI.dll 's function CiInitialize ( ) and imported by the NT core ( ntoskrnl.exe ) 
These exploits are bundled within the dropper in its resource section as executable files 
As seen from the check-in logs found within one of the recent samples , the time span covers almost 6 years from January 2007 till December 2012 , which is aligned with the first reports of Agent.BTZ 
Other similarities include the usage of the virtual partition \\.\Vd1 , the temporary file named FA.tmp , usage of files named mswmpdat.tlb , wmcache.nld , winview.ocx 
The cyber-espionage operation behind the Snake rootkit is well established , a sample comiled in January 2006 indicates that the activity would have begun in at least 2005 
Toolmarks left behind by the authors 'vlad ' & 'gilg ' , leave tantalizing clues as to the personas behind this 
From a technical perspective , Snake demonstrates two very different approaches to the task of building a cyber-espionage toolkit 
The complexity of the usermode-centric approach is on par with Rustock rootkit - it uses similar techniques 
It 's an old well-polished technology that evolved over the years and demonstrated its resilience and survivability under the stress of security counter- measures 
The complexity of the kernel-centric architecture of Snake is quite unique 
This architecture is designed to grant Snake as much flexibility as possible 
We expect much more will be uncovered by researchers in the coming weeks as the capabilities of this operation are further fleshed out 
However , as we implied in the opening section , we view this threat to be a permanent feature of the landscape 
Whether they dismantle this toolset and start from scratch , or continue using tools which have been exposed , remains to be seen 
For their targets though the considerable challenge of keeping secrets safe on sensitive networks will certainly continue for years to come 
Cyber Squared Inc. 's ThreatConnect Intelligence Research Team ( TCIRT ) tracks a number of threat groups around the world 
Beginning in the summer of 2013 , TCIRT identified a suspected Pakistani-origin threat group 
This group was revealed by TCIRT publicly in August 2013 
In the months following the disclosure , we identified new activity 
Cyber Squared partnered with experts at FireEye Labs to examine these new observations in an attempt to discover new research and insight into the group and its Operation '' Arachnophobia '' 
The following report is a product of collaborative research and threat intelligence sharing between Cyber Squared Inc. 's TCIRT and FireEye Labs 
• While we are not conclusively attributing BITTERBUG activity to Tranchulas or a specific Pakistani entity , we can confidently point to many characteristics of a Pakistan-based cyber exploitation effort that is probably directed against Indian targets and/or those who are involved in India-Pakistan issues 
• Early variants of the BITTERBUG malware had build paths containing the strings '' Tranchulas '' and '' umairaziz27 '' 
Tranchulas is the name of a Pakistani security firm ; Umair Aziz is the name of a Tranchulas employee 
• Following the release of our blog post highlighting this activity and the malware 's build strings , the threat actors appear to have modified their binary file paths to make them more generic 
• Employees at both the Pakistan-based hosting provider and Tranchulas appear within each others ' social networks 
On August 2 , 2013 , the TCIRT published the blog '' Where There is Smoke , There is Fire : South Asian Cyber Espionage Heats Up '' in which TCIRT identified custom malware , later dubbed BITTERBUG by FireEye , suspected to be linked to Pakistani-based exploitation activity directed against Indian entities 
We found debug path references to '' Tranchulas '' , which is also the name of a Pakistani security company 
Tranchulas claims to support '' national level cyber security programs '' and the development of offensive and defensive cyber capabilities 
At the time , the incident seemed to be an isolated one for TCIRT , but it was only the beginning 
Our suspicions of Tranchulas ' involvement in the activity began to mount , based on a series of events that occurred both before and after the release of our blog post 
During the past year , we communicated with Tranchulas and the Pakistan-based hosting provider 
Suspicious responses and oddly similar replies received from both companies to our inquiries , as well as anomalies in their email headers , prompted us to research the companies further 
Our research revealed : • The C2 hosting provider ( VPSNOC ) has likely been conducting business operations from within Pakistan , subleasing infrastructure from U.S. providers 
• VPNSOC and Tranchulas employees have maintained some type of undefined relationship given connections via social media 
• Both organizations have employed or are affiliated with personnel who have offensive cyber expertise 
• When TCIRT was initially contacted by Tranchulas following our original blog post , they denied any involvement in the activity 
Tranchulas maintained that they were being framed , and that they were already aware of the activity prior to both our blog post and our contact 
However , inconsistencies in their claims and their responses made such a scenario questionable 
TCIRT began tracking a set of activity involving a BITTERBUG variant in May 2013 
According to Whois records , those IP addresses were registered to a web-hosting firm in Kansas City , Missouri 
Based on public records , this organization appears to be a legal entity chartered to conduct business in Missouri 
On July 24 , 2013 , TCIRT contacted the Kansas City-based hosting provider to notify them of the malicious activities emanating from IP address 199.91.173.43 
The hosting provider subsequently introduced TCIRT to their client VPNSOC , the customer responsible for subleasing the IP address 
Later that day , TCIRT received a response from support @ vpsnoc.com providing limited information on the server and related traffic ( Figure 2 ) 
When TCIRT sent follow-up communications , VPSNOC did not respond , further increasing our suspicions 
While reviewing the metadata of VPSNOC 's July 24 , 2013 email response , we noticed the email was sent from a +0500 time zone 
This time zone usage is consistent with Pakistan 's time zone 
The TCIRT published details of the initial activity in the aforementioned blog post on August 2 , 2013 
Four days later on August , 2013 , the Tranchulas Chief Executive Officer , Zubair Khan , contacted us regarding the blog post and its subsequent press coverage 
Khan submitted '' ResponseThreatConnect.docx '' as an explanation of the observed activity to both the media and the TCIRT indicating that the debug paths using '' Tranchulas '' and '' umairaziz27 '' was '' done by developer of malware to portray wrong impression about Tranchulas and mislead malware analysts '' 
Notably , Khan included a screenshot of an email message 
The message was reportedly a response from VPSNOC to an email message from Tranchulas sent on July 21 , 2013 , purportedly to notify VPSNOC of the same malicious activity identified by TCIRT 
However , we noted certain anomalies in this message 
As seen in Figure 3 the '' email message '' was '' sent '' to VPSNOC from an unidentified tranchulas.com email address on '' Tue , Jul 21 , 2013 at 11:36 PM 
'' July 21 , 2013 was not a Tuesday and in fact was a Sunday 
The mismatched date suggests that this email message was potentially modified in order to support the claim that Tranchulas was aware of , and had already reported the exploitation activity 
TCIRT speculates that '' Tuesday '' was hastily chosen because our own official notification to VPSNOC was sent on Wednesday the 24th 
In addition , the '' response '' received by Tranchulas is nearly identical to that received by TCIRT 
We believe that Tranchulas may have obtained information about TCIRT 's notification to VPSNOC through a pre-established relationship 
The TCIRT responded to Mr. Khan 's official explanation with a follow-up inquiry , offering Khan an opportunity to explain the notable date inconsistency within the email screenshot 
The TCIRT also requested that Mr. Khan share the actual email message with the original attached headers 
Mr. Khan did not address the TCIRT question , but rather deferred our request to Mr. Hamza Qamar , a Penetration Testing Team Lead at Tranchulas 
On August 15 , 2013 , three days later , Qamar responded to TCIRT with a brief denial of any modifications to the screenshot ( other than email address anonymization ) and specifically referred TCIRT back to VPSNOC support ( support @ vpsnoc.com ) for any follow up questions 
Astonished by this dismissal and deflection , TCIRT immediately began to explore the relationship between VPSNOC and Tranchulas 
During our research into VPSNOC , we identified that it is actually based in , or conducts partial operations from within , Pakistan 
The company only gives the impression of operating from Kansas City through marketing and the use of leased IP space ( Figure 4 ) 
The Whois records for vpsnoc.com revealed that the domain was registered by Digital Linx Hosting 
Digital Linx is also a Pakistan-based hosting company ( Figure 5 ) 
As seen in Figure 6 , the administrative email address is admin @ digitallinx.org 
This is the same registrant record for the digitallinx.net domain 
The domains digitillinx.org , digitallinx.net , and digitallinx.com share current and historical similarities in their WHOIS records and sitemap.xml files that imply they are all controlled by the same individual or entity 
The domain digitallinx.com is registered to Muhammad Naseer Bhatti ( Digital Linx Founder ) who uses email addresses naseer @ digitallinx.com and nbhatti @ gmail.com 
The domain is also registered to the address 638-F Johar Town , Lahore Pakistan 
The contact telephone number listed on Digital Linx ' web site is 925-665-1427 ( Figure 6 ) , and is also used in the WHOIS record for defiantmarketing.com 
The domain defiantmarketing.com is registered to Abunasar Khan 
The registration lists VPSNOC as the registrant organization , abunasar @ yahoo.com as the registration email address , and House 12 , Street 21 , F-8/1 Islamabad Federal 44000 as the registration address 
Abunasar Khan has been observed using the aliases '' agnosticon '' and '' agnostic '' 
From this we were able to locate an advertisement in the Blackhatworld forum from April 2012 posted by agnosticon promoting VPSNOC and identifying it as a subdivision of Digital Linx Hosting ( Figure 7 ) 
Though none of this information is surprising , it further suggests that both Bhatti and Abunasar Khan work or worked for Digital Linx and VPSNOC and during that time were both located in Pakistan 
Additional research into Abunasar Khan identified several registered domains and fragments of his online presence 
Based on his websites and account information , he appears to have an interest or participated in the Antisec and Anonymous movements ( Figure 8 ) 
He also used '' anony mo us '' in the registration name field of a personal account 
In addition , Abunasar Khan 's Google+ profile revealed connections to at least one Tranchulas employee , Hamza Qamar and a Digital Linx employee , Shoaib Riaz 
Hamza Qamar , the Team Lead for Penetration Testing at Tranchulas , with whom TCIRT last spoke 
Visiting Hamza Qamar 's Google+ page ( Figure 9 ) , the only directly connected person was Abunasar Khan 
At this point , it shows that a probable VPNSOC employee with ties or interests in hacking has an undefined but potentially close relationship with Hamza Qamar , the Penetration Testing employee from Tranchulas 
Qamar indicated on his public LinkedIn profile that he '' engaged in system and enterprise level network and Web application security testing for clients ranging from large federal agencies , DoD , and commercial clients '' , though it is unclear which '' DoD '' is referenced ( e.g. , whether the Pakistani Ministry of Defense or some other nation 's defense department ) 
Tranchulas identifies government ( presumably Pakistan 's government ) as an operational sector for its work 
Tranchulas ' offensive cyber initiative services are offered to '' national-level cyber security programs '' indicating commercial demand from '' national-level '' customers 
Though Tranchulas brands itself as a multi-national company , with respective addresses within the United Kingdom , the United States , and New Zealand 
We found evidence that these addresses are all associated with either virtual office spaces or address forwarding services 
For further background information on these personas , please see Appendix F : Personas 
• Tranchulas and VPNSOC were in direct communication at some point in July-August 2013 
• VPNSOC is a subsidiary of Digital Linx 
• Tranchulas , VPNSOC , Digital Linx were all physically located in Pakistan but maintained virtual presence within the U.S. • Hamza Qamar was an employee of Tranchulas 
• Muhammad Naseer Bhatti was the self-proclaimed founder of Digital Linx 
• Abunasar Khan was affiliated with AntiSec and VPNSOC 
• Digital Linx founder Muhammad Naseer Bhatti had at least a working relationship with VPNSOC employee Abunasar Khan – connected through domain registrations and a common Google+ profile for Shoaib Riaz ( another Digital Linx employee ) 
• VPNSOC employee Abunasar Khan had a direct connection to Tranchulas employee Hamza Qamar through Google+ 
Note : A walkthrough of our research is available in Appendices C , D and E. Metadata Analysis : As mentioned earlier , during the email exchanged with Zubair Khan , he sent TCIRT a Microsoft Word document ( .docx ) 
In reviewing the document metadata for '' ResponseThreatConnect.docx '' , TCIRT identified that it contained the creator properties of '' hp 
'' TCIRT compared the metadata of two benign BITTERBUG-associated decoy documents from July 2013 and found that both also had the author of '' hp '' ( Figure 10 ) 
CyberSquared Inc. partnered with FireEye for a second technical review of the malware associated with this activity 
The full malware report is included in Appendix A : Malware Details 
The earliest evidence of the malware family dates to April 2013 , based on the Portable Executable ( PE ) compile times , with more than 10 BITTERBUG variants observed to date 
The earliest samples of BITTERBUG contain the '' Tranchulas '' debug path ( below ) , as mentioned in the August 2013 TCIRT blog post 
These BITTERBUG variants were probably used in attacks around summer 2013 , using possible lures related to the then-recent death of '' Sarabjit Singh '' ( an Indian national imprisoned in Pakistan ) and an Indian Government pension memorandum 
As stated in the original blog ( and raised in the formal Tranchulas response ) , several binaries contain references to '' Cath '' in the debug path 
It is important to note that the '' Cath '' files are support components and not BITTERBUG variants , so it is probable that these were developed by another party but are a required component of the family 
Additional BITTERBUG variants were compiled in June and July 2013 that contained different identifiers in the debug paths : '' Cert-India '' ( 3 samples ) and '' umairaziz27 '' ( 1 sample ) 
The presence of '' umairaziz27 '' in a debug path from one sample makes us wonder if this represents an operational security mistake 
The debug path of '' umairaziz27 '' led us to Twitter and LinkedIn accounts ( on which a matching alias is used ) that belong to a Tranchulas employee named Umair Aziz , who identified himself as an Information Security Analyst and graduate of National University of Sciences and Technology ( NUST ) 
After publication of the TCIRT blog and our communications with Tranchulas occurred in August 2013 , no new samples of BITTERBUG or its support components ( based on compile times ) were identified until September ( various support components ) and October ( a new BITTERBUG variant ) 
Between September and December , we observed more variations of BITTERBUG and its support components in terms of packaging , host-based activities , and decoys ( or the lack of them ) compared to the samples before our blog post 
This could indicate that the threat actors were aware of the blog post and modified their malware and related components to distance them from prior indicators 
This SFXRAR contained the latest BITTERBUG variant , which had new dependencies on support components 
We provide a more detailed report on this SFX and the related variant in Appendix A : Malware Details 
Operation Arachnophobia consists of an apparent targeted exploitation campaign , dating back to early 2013 , using the BITTERBUG malware family and seemingly directed against entities involved in India-Pakistan issues 
Research later identified that a Pakistan-based VPSNOC representative had a social network affiliation with a Tranchulas employee as well as apparent affiliations with the Anonymous and AntiSec movements 
After the August 6 , 2013 blog , Tranchulas provided TCIRT and the media an official statement and explanation of BITTERBUG activity , however , this explanation contained discrepancies 
The TCIRT addressed some of these discrepancies with Tranchulas personnel , who were unresponsive , increasing our suspicion of the activity 
We later observed BITTERBUG activity following August 2013 with subtle changes that further generalized debug paths 
It was this chain of events that served as a catalyst for extra scrutiny of the activity and collaboration between the ThreatConnect and FireEye Labs teams to share information 
While we are not conclusively attributing BITTERBUG activity to Tranchulas or a specific Pakistani entity , we can confidently point to many characteristics of a Pakistan-based cyber exploitation effort that is probably directed against Indian targets or those who are involved in India-Pakistan issues 
On the surface , BITTERBUG serves as an example of how threat actors mask their operations across social , cultural and geographic boundaries 
More importantly , it demonstrates the value of threat intelligence sharing and industry collaboration 
As one organization begins to pull at a thread of evidence and share their findings with another , a larger understanding and shared perspective is revealed 
It is through this process that a shared awareness emerges into a larger , more comprehensive story that explains what we are seeing and why - ultimately it is this story that better serves us all 
The timeline below is of BITTERBUG activity from May 2013 through March 2014 
An example beacon request is shown in Figure 14 
The purpose of the first three files is unknown 
In one case , an actor appeared to manually null out the '' Cert-India '' user directory in one of the file paths ( see figures 15 and 16 below ) contained in two binaries ( support components ) 
These files shared the same import hash ( 4e96e86db5a8a025b996aefdc218ff74 ) and were virtually the same files minus modification to a few bytes in the second sample 
As these samples point to , we also observed use of the C++ Boost libraries , which introduced a new file path to monitor for operational security purposes 
We observed at least one case in which files mixed old and new file paths , as seen in the figures 17 and 18 below 
In both cases , it is possible that the actors intentionally did this in an attempt to mislead further research efforts into post-blog samples or cast suspicion on '' Cert-India '' as a more-revealing element 
For example , analysis of files deployed alongside the nulled-out '' Cert-India '' sample mentioned above revealed a lack of concern over the same string 
Alternatively , these inconsistencies could also indicate sloppy tradecraft and/or teamwork 
BITTERBUG Hashes BITTERBUG and Support Component Debug Strings ( in order of first use ) BITTERBUG Import Hashes HTTP Requests BITTERBUG Domain & IPs The Kansas-City-based hosting provider sent an introductory email message on July 24th , 2013 at 1500 CDT and would be received by TCIRT at 1400 EDT and VPSNOC on Thursday July 25th , 2013 at 1200 PKT 
Analysis of the VPSNOC email header indicated that the message was sent on Thursday 25 July at 02:28:41 +0500 GMT , which is consistent with Pakistan 's time zone 
Of note , the email message was sent with an X-Originating IP Address of 184.75.214.10 corresponding to a Private Internet Access Canadian proxy 
VPSNOC 's use of this commercial proxy service likely demonstrates the intent to mask the apparent origin of the sender 
These two examples highlight that VPSNOC 's inbound and outbound email communications consistently utilized a +0500 Pakistani timezone 
Due to the apparent Pakistani nexus within the BITTERBUG malware and the Pakistan time zone consistently observed within the VPSNOC emails , the TCIRT applied additional scrutiny and research of the content within the Tranchulas '' Response ThreatConnect.docx '' to validate their claims 
In the following section we will examine the inconsistencies observed 
Within the response we observed the following inconsistencies : Our review of the '' ResponseThreatConnect.docx '' focused in on the email screenshot ( Figure 3 ) image1.png that Khan provided revealing that the date probably had been modified to appear as though they were the first to notify VPSNOC 
Within the official response , Zubair Khan indicated that Tranchulas was '' already aware of this incident ... and contacted hosting company 
'' The official response included a screenshot depicting an email sent to VPSNOC from an unidentified ( redacted ) tranchulas.com email address that was sent on '' Tue , Jul 21 , 2013 at 11:36 PM '' with no evidence of the date in which it was received by or responded to by VPSNOC 
This message contained a notable misalignment between the date and day of the week 
July 21 , 2013 was a Sunday , not a Tuesday 
'' Tuesday '' would have pre-dated our official notification that occurred on Wednesday July 24 , 2013 , and could indicate that Tranchulas may have obtained insight into the original TCIRT notification through Pakistan- based contacts within VPSNOC 
The TCIRT subsequently responded to Mr. Khan 's official explanation with a follow-up inquiry , offering Khan an opportunity to explain the date inconsistency within the email screenshot 
Mr. Khan deferred our request to Mr. Hamza Qamar , a Penetration Testing Team Lead at Tranchulas , who later responded with a simple denial that the email message had not been altered apart from blurring the name of the original sender 
The email screenshot ( image1.png ) from within the Tranchulas response demonstrated awareness of information that we initially withheld and later released in our blog post : one malware variant that contained a debug string with '' umairaziz27 '' the same username as a Tranchulas employee 
The Tranchulas message to VPSNOC incorrectly claimed to identify malware on 199.91.173.43 that contained the '' company 's name and ... employee 's name '' 
While it is possible that Tranchulas ' analysts discovered this variant independent of the blog post , it added to the inconsistent elements of the response and further suggested that the blog post may have inspired its communications with VPSNOC 
We note that we requested additional information such as the '' detailed analysis report '' within the exchange from Tranchulas but did not receive a response 
The Tranchulas response indicates that '' Tranchulas ' research team was already aware of this incident before publication of this report 
Our team contacted hosting company of server to seek an explanation 
'' Considering there are no public references to the identified infrastructure identifying VPSNOC as the '' hosting company '' 
The only way for Tranchulas to identify VPSNOC as the hosting company was to either have previous insider knowledge of the activity , or to have been privately introduced by the Kansas-City-based service provider to their '' client '' VPSNOC , of which was never mentioned or discussed when we initially exchanged with either the Kansas-City or Pakistan-based hosting providers 
Public registration of the 199.91.173.43 reveals the Kansas-City-based hosting provider as the official registrant and owner of the infrastructure 
The only way to know that VPSNOC was subleasing the infrastructure was to obtain this information directly from them 
There was no public reference which would have revealed VPSNOC as the entity which maintained root access to the 199.91.173.43 
Had Tranchulas legitimately conducted an initial victim notification sometime in late July 2013 , they would have likely done so through the Kansas-City-based hosting provider and not VPSNOC 
On August 15 , 2013 , Hamza Qamar 's response to TCIRT 's follow up inquiry to the observed inconsistencies redirected TCIRT personnel to VPSNOC to obtain an explanation versus attempting to explain the observed day date inconsistency and document properties within the Tranchulas email 
The TCIRT 's suspicion mounted when presenting Tranchulas with the opportunity to set the record straight , that Tranchulas could not substantiate their claims , rather deferring the TCIRT inquiry to a third party ( VPSNOC ) 
Within the '' ResponseThreatConnect.docx '' the image '' image1.png '' contains an undated response from VPSNOC to the '' Tue , Jul 21 , 2013 '' Tranchulas notification 
The undated VPSNOC response that Tranchulas received is nearly identical to the response that TCIRT and the Kansas-City-based service provider obtained on July 24th 
Tranchulas does not include the date or time as to when they obtained a response from VPSNOC 
The TCIRT found it unusual that neither the Kansas-City-based service provider or VPSNOC personnel ever indicated either way that they knew about the activity or had been previously contacted by either party 
When considering all of the inconsistencies , order of events and studying , Gmail webmail layout , similarities of keywords , salutations and closings within the '' Tue , Jul 21 , 2013 '' Tranchulas notification and the respective VPSNOC response 
The TCIRT grew increasingly suspicious of the exchanges with VPSNOC and subsequent exchanges with Tranchulas personnel 
In reviewing the document metadata within the '' ResponseThreatConnect.docx '' that was sent from Mr. Zubair Khan on August 6 , 2013 , the TCIRT also identified that this document maintained the creator properties of '' hp 
'' ( Figure 10 ) While the author field of '' hp '' does n't conclusively prove a relationship , it contributes to a body of circumstantial evidence which matches the document properties of the official Tranchulas response to the document properties that were also found within decoy documents that were bundled with BITTERBUG implants 
According to the vpsnoc.com website '' In 2007 five VPS experts decided to invest in their very own private rack space in the heart of Kansas , the United States 
Their aim ? To bring service-oriented , quality managed and unmanaged VPS solutions to clients all over the world 
Just 1 year later , after beginning their enterprise on 3 servers they had filled 2 server racks with happy clients receiving quality U.S support 
Their company continued to build momentum 
'' Whois records for vpsnoc.com indicate that another individual registered the domain and listed Digital Linx Hosting as the registrant organization with a Kansas City-based address , telephone number 925-665-1427 , and administrative email address admin @ digitallinx 
org 
This is the same registrant record for the digitallinx.net domain 
The digitallinx.net/sitemap.xml and the corresponding Google cache for digitallinx.net/sitemap.xml indiciate that both digitallinx.net and digitallinx.com have shared the same sitemap.xml at the same time 
The digitallinx.net/Contact.html identified similar overlaps with data across the .org , .net , and .com domains 
The domain digitallinx.com is registered to Perasona # 1 
He uses email addresses naseer @ digitallinx.com and nbhatti @ gmail.com as the domain registrant email address , along with address 638-F Johar Town , Lahore Pakistan and telephone 966.548805579 
The DigitalLinx ( digitallinx.com ) website states that it is '' a web hosting / Web Solutions & Processing Outsourcing Company based in Pakistan '' 
Open source research of the phone number 925-665-1427 indicates that it is also used within site content as a phone number for defiantmarketing.com 
This domain is registered by Persona # 2 who uses the aliases '' agnosticon '' and '' agnostic '' 
Persona # 2 lists VPSNOC as the registrant organization , and uses the registration email address of abunasar @ yahoo.com with an address of House 12 , Street 21 , F-8/1 Islamabad Federal 44000 
The domain defiantmarketing.com domain has used ns1.abunasar.net and ns2.abunasar.net for name services 
Within a January 2009 posting to a Debian users forum , Persona # 2 sends an email from the abunasar @ yahoo.com with a reply-to as abunasar @ army.com 
Within the post , Persona # 2 responds to the question '' Who 's using Debian '' listing DigitalLinx , Kansas City MO and the link to digitallinx.com 
Also , the seemingly abandoned Twitter profile for Persona # 2 is only following the Twitter profile for @ VPSNOC 
In an April 2012 post to blackhatworld.com , a user with the alias '' agnosticon '' posted promotional codes for VPSNOC hosting services , engaging with customers , providing them feedback regarding VPS services and thanking them for positive reviews 
Within the posting the user '' agnosticon '' included an image which was an actual advertisement that was hosted at http : //vpsnoc 
com/order.png 
Within the posted image it states '' VPSNOC is a subdivision of Digital Linx Hosting 
We have been in business since 2008 '' 
The posting concludes with '' If you have any further questions/queries please contact us directly at : support @ vpsnoc.com '' Muhammad Naseer Bhatti 's LinkedIn profile indicates that he is currently the founder for Digital Linx LLC and vBilling ( vbilling.org ) as well as a consultant for a U.S. company 
Both Bhatti and Digital Linx are listed as the registrants for vbilling.org , v-billing 
com , vgriffins.com and my-server.co , which use P.O 
Box 295658 , Riyadh Saudi Arabia as the registration address 
This is also the address for two U.S. companies ' local operations 
Bhatti is also listed as the owner of the netblock 46.4.139.224/28 
Both passive DNS sources as well as Robtex highlight this overlapping infrastructure 
From September 7 - 9 , 2011 , Tranchulas in cooperation with the Pakistan National University of Sciences and Technology ( NUST ) , offered a Certified Penetration Testing Profession ( CPTP ) Workshop ( Figure 17 ) 
During the workshop , basic penetration techniques and skills were presented 
It is likely that CPTP workshops and alignment with NUST have allowed Tranchulas the opportunity to recruit student interns 
Within the CPTP event registration contact information for Muhammad Naseer was listed next to a Tranchulas office number ( 051- 2871433 ) 
It is important to note that Muhammad Naseer Bhatti has been previously known to drop the family name '' Bhatti '' within online correspondence ( Figure 18 ) 
In a June 2012 episode of Engineering and Technology Magazine podcast a Mohammed Nasser , Penetration Tester at Tranchulas was interviewed 
A Mohammed Nasser may also be directly affiliated with Tranchulas 
This links Tranchulas to a Pakistani employee or consultant also named Muhammad Naseer 
It is unknown if this is the same Muhammad Naseer that is associated with VPSNOC 's parent company Digital Linx , the Pakistan-based service provider which hosted the original BITTERBUG malware 
Abunasar Khan also maintains the aliases '' agnosticon '' and '' agnostic '' in addition to the email addresses abunasar @ yahoo 
com and abunasar @ army.com 
He has been previously associatedwith VPSNOC & Digital Linx 
An April 2012 Whois registrant record for the domain zeusadnetwork.com includes the first and last name Khan along with the same ( 925 ) 665-1427 phone number seen within the Digial Linx Hosting domains 
Khan registered a variety of domains , many of which use his abunasar.net for name services and abunasar.yahoo.com within the Start of Authority ( SOA ) records 
For example a July 2014 record ( Figure 19 ) for defiantmarketing.com and an August 2013 record ( Figure 20 ) for ns2.vpsnoc.com both maintain these references 
Abunasar Khan registered abunasar.net and previously ( May 2007 ) and maintained whitehate.org , which have both been used to demonstrate an affinity for and alignment with AntiSec and Anonymous movements 
The abunasar.net website prominently displays ascii art of the term '' antisec '' with antisec related content '' Blend in 
Get trusted 
Trust nobody 
Own everybody 
Disclose nothing 
Destroy everything 
Take back the scene 
'' This is a shared affinity that is also reflected amongst with the culture of Tranchulas employees 
The pure.whitehate.org domain has also been previously associated with Khan , examples can be found within # phrack and # darknet IRC sessions 
Ironically , in February 2011 , Khan 's Rootkit.com user profile was compromised revealing his profile 's username , password hash , email ( abunasar @ army.com ) , and the registration IP address of 202.125.143.67 ( Islamabad , Pakistan ) 
During his registration , Khan specified the name '' anony mo us '' when registering the profile 
As of 16 August 2013 , a Pastebin post contained details of a customer database compromise for nowclothing.pk , which included Khan 's name , email abunasar @ army.com , and cell phone number 03215488881 
Research of the 03215488881 cell phone number yields a user profile '' abunasark '' in an April 2009 posting 
Khan posts pictures of his blue Baleno and includes another phone number 03234764838 
In a secondary profile user '' Ak '' uses the same cell phone number 03215488881 in a 2009 sales posting for a 2004 blue Baleno 
Khan 's affinity for Suzuki Baleno cars is made obvious in a May 2009 registration for clubaleno.co.uk that was registered by Khan at VPSNOC using the name services of ns1.abunasar.net and ns2.abunasar.net with a SOA record of abunasar.yahoo.com 
Later in a June 2009 posting , Khan using the alias '' agnostic '' attempts to sell the domain clubaleno.co.uk and uses his abunasar @ army.com email address as a point of contact 
Khan is also observed using the alias '' agnosticon '' and a Toyota Racing Development avitar within posts to blackhatworld.com and again within a 2011 post where he posts a cpanel error that also includes his '' abunasar '' username within system output 
The Google+ profile for Khan reveals established social network links to a Team Lead for Penetration Testing at Tranchulas and a Digital Linx employee Shoaib Riaz who also maintains a social network association with the Digital Linx founder Muhammad Nasser Bhatti 
The Tranchulas website states that they provide a range of security services and training to include penetration and offensive cyber initiative ( OCI ) , in which they '' help national level cyber security programs on strategies for managing offensive technical threats '' 
In a September 2011 YouTube user '' tranchulascert '' posted a video titled '' Tranchulas Cyber Ranges - P @ sha ICT Awards 2011 '' , where they awarded runner up 
Within the video , the cyber ranges were referenced as being developed for '' defense forces '' that were aimed to '' help them in developing offensive and defensive warfare skills '' and '' combating anti-state hackers '' 
Although Tranchulas brands itself as a multi-national company , their respective operating addresses within United Kingdom the United States and New Zealand are all associated with either virtual office spaces or address forwarding services 
The Tranchulas website lists its Pakistan address within the 2nd floor of the Evacuee Trust Complex on Sir Agha Khan Road F-5/1 Islamabad 44000 
The Evacuee Trust Complex is also known as Software Technology Park 2 or STP2 and hosts a variety of other commercial and government offices 
The Tranchulas employee , Hamza Qamar , that handled the response to our inquiry has a public LinkedIn profile that states that he '' Engaged in system and enterprise level network and Web application security testing for clients ranging from large federal agencies , DoD , and commercial clients 
'' The profile does not specify if DoD is a reference to the U.S. Department of Defense or another country 's Ministry of Defense 
Interestingly , Qamar 's Google+ page showed one '' friend '' in his circle despite more than 40 followers , Abunasar Khan a VPSNOC employee 
It is likely that Tranchulas provides services to the Pakistani government 
The offensive cyber initiative services offered by Tranchulas is offered to '' national-level cyber security programs '' suggesting a commercial demand from '' national-level '' customers 
The stated purpose and intent of the Tranchulas '' Cyber Ranges '' P @ sha ICT 2011 awards video suggests the ranges were specifically developed in support of national interests for offensive and defensive purposes 
The domain registration by Zubair Khan using an official Pakistani government address with his zubair @ tranchulas.com email address indicates that Khan may have or currently maintains a physical address at a location where other Pakistani government officials reside 
Historic Whois registration records for the domains textcrypter.com , taggnation.com , bookadoconline.com and saadiakhan 
net lists Tranchulas CEO Zubair Khan ( zubair @ tranchulas.com ) as the registrant for the domains 
At the time of registration Khan used the address 15-B , Mehran Block of the Gulshan-e-Jinnah F-5/1 Islamabad Pakistan for the domains 
In an April 2008 Request for Proposals , the Pakistan Public Works Department issued a tender for the Constriction of Government Servant Quarters and Garages at Gulshan-e-Jinnah Complex F-5/1 Islamabad 
Later in May of 2010 within a Pakistani Senate question and answer session , the Gulshan-e-Jinnah Complex was cited under Federal Lodges / Hostels in Islamabad under the control of Pakistan Ministry for Housing and Works 
A December 2010 TheNews Pakistan ran a story that detailed the differential in rents between commoners within Islamabad and Pakistani government officers accommodated at Gulshan-e-Jinnah 
According to Google Maps it is approximately 650 meters ( 8 minute walk ) from the Gulshan-e-Jinnah Complex to the Tranchulas offices within the Evacuee Trust Complex 
Within a May 2013 interview Khan specified that he comes from a family with a strong military background 
He detailed his interest in '' the world of hacking '' grew during his teen years , referencing his father 's diplomatic assignment to the Philippines in 2003 
Khan would go on to establish Tranchulas in February 2006 after an independent audit of Pakistani Governments National Database and Registration Authority ( NADRA ) 
Digital Appendix 1 contains additional research collateral collected when conducting Operation Arachnophobia research 
Digital Appendix 2 contains raw email communications 
These .eml files include raw SMTP headers , content and attachments 
Digital Appendix 3 contains screenshots of web content used to conduct analysis 
Digital Appendix 4 contains visualization files that depict relationships and contain metadata associated with our Operation Arachnophobia research 
The exploit is sent to the targeted organizations through emails with a malicious Ichitaro document file attached , which Symantec products detect as Bloodhound.Exploit.557 
Payloads from the exploit may include Backdoor.Emdivi , Backdoor.Korplug , and Backdoor.ZXshell ; however , all payloads aim to steal confidential information from the compromised computer 
Opening the malicious attachment with Ichitaro will drop the payload and display the document 
In this campaign , variants of Backdoor.Emdivi are persistently used as a payload 
All attacks arrive on the target computers as an attachment to email messages 
Mostly the attachments are in a simple executable format with a fake icon 
This group 's primary goal is to steal confidential information from targeted organizations 
The emails include password-protected .zip files containing the malware 
This is merely to trick the recipient into believing the email is from a legitimate and trustworthy source 
The email also requests that the recipient open the attachment on a Windows computer 
The malicious payload is Backdoor.Emdivi , a threat that opens a back door on the compromised computer 
Emdivi allows the remote attacker executing the commands to send the results back to the command-and-control ( C & C ) server through HTTP 
The malware adds extra words to the version number and then , based on this , generates a hash , which it uses as an encryption key 
Type T employs techniques to protect itself from security vendors or network administrators 
Important parts of Type T , such as the C & C server address it contacts and its protection mechanisms , are encrypted 
Type T also detects the presence of automatic analysis systems or debuggers , such as the following : Type S , on the other hand , was used only twice in the attack campaign 
Type S is a .NET application based on the same source code and shared C & C infrastructure as Type T 
Once infected , Emdivi connects to hardcoded C & C servers using the HTTP protocol 
Instead , the attacker somehow penetrated the cloud service itself and turned the websites into C & C servers for Backdoor.Emdivi 
The attackers sent a Microsoft Word file containing a maliciously crafted SWF file that exploited the vulnerability 
Once successfully exploited , the file installed Backdoor.Emdivi 
Both attacks use a .doc file containing an Adobe Flash zero-day exploit that is used to install a back door 
The attacks we have documented usually involve the use of malicious links or e-mail attachments , designed to obtain information from a device 
On the one hand , we have observed attacks using a wide range of off-the-shelf spyware , as well as publicly available third-party services , like iplogger.org 
On the other hand , some at- tacks use so-called '' lawful intercept '' trojans and related equip- ment , purportedly sold exclusively to governments by compa- nies like Gamma International and Hacking Team 
Yet , the attacks are noteworthy for their careful social engineering , their links to governments , and their real-world impact 
In some cases the attackers employed expensive and '' government exclusive '' malware , while in other cases , attackers used cheap and readily available RATs 
Across these cases we find that clever social engineering often plays a central role , which is strong evidence of a well-informed ad- versary 
In general , the attacks we find are not well- detected by anti-virus programs 
The first involved malicious e-mails containing FinSpy , a '' lawful intercept '' trojan sold exclusively to governments 
The second involved specially crafted IP spy links and e-mails de- signed to reveal the IP addresses of operators of pseudonymous accounts 
We found that some of the attachments contained a PE ( .exe ) file designed to appear as an image 
Their filenames contained a Uni- code right-to-left override ( RLO ) character , causing Windows to render a filename such as gpj.1bajaR.exe instead as exe.Rajab1.jpg 
The other .rar files contained a Word document with an embedded ASCII-encoded PE file containing a custom macro set to automatically run upon document startup 
The executables used virtualized obfusca- tion , which appeared to be custom-designed 
This executable contained a similar string , except it identi- fied itself as FinSpy v3.00 , and attempted to connect to tiger.gamma-international.de , a domain registered to Gamma International GmbH 
Analysis of capabilities : We found that the spyware has a modular design , and can download additional modules from a command & control ( C & C ) server , including password cap- ture ( from over 20 applications ) and recording of screenshots , Skype chat , file transfers , and input from the computer 's micro- phone and webcam 
To exfiltrate data back to the C & C server , a module encrypts and writes it to disk in a special folder 
The spyware period- ically probes this folder for files that match a certain naming convention , then sends them to the C & C server 
It then over- writes the files , renames them several times , and deletes them , in an apparent effort to frustrate forensic analysis 
Analysis of encryption : Because the malware employed myriad known anti-debugging and anti-analysis techniques , it thwarted our attempts to attach debuggers 
We found that FinSpy encrypts data using a custom imple- mentation of AES-256-CBC 
The 32 byte AES key and 16 byte IV are generated by repeatedly reading the low-order-4-bytes of the Windows clock 
The key and IV are encrypted using an em- bedded RSA-2048 public key , and stored in the same file as the data 
Finally , FinSpy 's wire protocol for C & C commu- nication uses the same type of encryption , and thus is subject to the same brute force attack on AES keys 
C & C server : The samples communicated with 77.69.140.194 , which belongs to a subscriber of Batelco , Bahrain 's main ISP 
We then infected the VM with FinSpy and allowed it to connect to the Bahrain C & C server 
In an IP spy attack , the attacker aims to discover the IP address of a victim who is typically the opera- tor of a pseudonymous social media or e-mail account 
The at- tacker sends the pseudonymous account a link to a webpage or an e-mail containing an embedded remote image , using one of many freely-available services 
When the victim clicks on the link or opens the e-mail , their IP address is revealed to the at- tacker 
'' Red Sky had earlier targeted other users with IP spy links shortened using the al9mood bit.ly account 
'' An account linked to al9mood sent Je- had Abdulla an IP spy link on 10/2/12 in a public message 
@ YLUBH received at least three IP spy links in late 2012 , sent via public Twitter mes sages 
Use of embedded remote images : We identified several targets who received spoofed e-mails containing embedded remote images 
The attacker sent the e-mails using ReadNotify.com , which records the user 's IP address upon their mail client downloading the remote image 
Attackers often used ( 1 ) accounts of promi- nent or trusted but jailed individuals like '' Red Sky , '' ( 2 ) fake personas ( e.g. , attractive women or fake job seekers when tar- geting a labor union ) , or ( 3 ) impersonations of legitimate ac- counts 
As summarized in Table 3 , the attacks often include fake or ma- liciously packaged security tools ; intriguing , or ideological , or movement-relevant content ( e.g 
lists of wanted persons ) 
While the RATs are cheaper and less sophisticated than FinSpy and RCS , they share the same ba- sic functionality , including screen capture , keylogging , remote monitoring of webcams and microphones , remote shell , and file exfiltration 
In the most common attack sequence we observed , illus- trated with three examples in Figure 3 , the attacker seeds mal- ware via private chat messages , posts in opposition-controlled social media groups , or e-mail 
These techniques often limit the world-visibility of malicious files and links , slowing their detection by common AV products 
Typically , targets receive either ( 1 ) a PE in a .zip or .rar , ( 2 ) a file download link , or ( 3 ) a link that will trigger a drive-by download 
The messages usually include text , often in Arabic , that attempts to persuade the target to execute the file or click the link 
The first attacks in Figure 3 date to 2012 , and use bait files with a DarkComet RAT payload 
These attacks share the same C & C , 216.6.0.28 , a Syrian IP address belonging to the Syr- ian Telecommunications Establishment , and publicly reported as a C & C of Syrian malware since February 2012 
The first bait file presents to the victim as a PDF containing infor- mation about a planned uprising in Aleppo 
In fact the file is a Windows Screensaver ( .scr ) that masquerades as a PDF using Unicode RLO , rendering a name such as '' .fdp.scr '' dis- play to the victim as '' .rcs.pdf 
'' The second bait file is a dummy program containing DarkComet while masquerading as a Skype call encryption program , playing to opposition para- noia about government backdoors in common software 
The third attack in Figure 3 , observed in October 2013 , entices tar- gets with e-mails purporting to contain or link to videos about the current conflict , infecting victims with Xtreme RAT , and using the C & C tn1.linkpc.net 
For seeding , the attackers typically use compromised ac- counts ( including those of arrested individuals ) or fake iden- tities masquerading as pro-opposition 
Member C and NGO Worker D ( here , actual victims , not abstract ) , targeting was by e-mail from domains apparently belonging to opposition groups , in- dicating a potential compromise 
Opp 
Member C received a malicious file as an e-mail attachment , while NGO Worker D was sent a shortened link ( url [ 
] no/Uu5 ) to a download from a directory of Mrconstrucciones [ 
] net , a site that may have been com- promised 
Both attacks resulted in an Xtreme RAT infection 
While dis- tracted by this meaningless interaction , the victim 's machine is infected with DarkComet 3.3 [ , ] 
The first attacks we observed in the UAE involved a government-grade '' lawful interception '' trojan known as Re- mote Control System ( RCS ) , sold by the Italian company Hack- ing Team 
The exploit loaded shellcode that downloaded a second stage from ar-24.com , which in turn downloaded spyware from ar-24.com 
The C & C server also ran on ar-24.com 
The document used the same exploit and attempted to download a second stage from rcs-demo.hackingteam.it , which was unavailable at the time of testing 
One difference was in the vectors used to install the spyware 
We located additional samples ( see § 5 ) , some of which were embedded in a .jar file that installs an OS-appropriate version of RCS ( Windows or OSX ) , option- ally using an exploit 
We also saw instances of the 3-Stage Exploit Kit where the first stage contained a Flash exploit ; in some cases , we could obtain all stages and confirm that these installed RCS 
Some samples were packed with the MPress packer , and some Windows samples were obfuscated to look like the PuTTY SSH client 
For example , the RCS sample sent to Ahmed adds a Run registry key , whereas the FinSpy samples used in Bahrain overwrite the hard disk 's boot sector to modify the boot process ; the spyware is loaded be- fore the OS , and injects itself into OS processes as they start 
The RCS samples we examined also had the ability to propa- gate to other devices , including into inactive VMWare virtual machines by modifying the disk image , onto USB flash drives , and onto Windows Mobile phones 
Ahmed subsequently noted several suspicious ac- cesses to his GMail account using IMAP 
Even after he changed his password , the accesses continued 
While corresponding with Ahmed on his compromised account , an author of this pa- per discovered that the attackers had installed an application- specific password in Ahmed 's GMail account , a secondary password that they apparently used to access his account even after he changed his main password 
Two weeks after this correspondence with Ahmed , one of us ( Author in Figure 5 ) received a targeted e-mail with a link to a file hosted on Google Docs containing a commercial off-the- shelf RAT , Xtreme RAT 
The instance of Xtreme RAT sent to Author used owner.no-ip.biz for its C & C , one of the domains men- tioned in a report published by Norman about a year-long cam- paign of cyberattacks on Israeli and Palestinian targets carried out by a group that Norman was unable to identify 
Three months after Author was targeted , Ahmed received an e-mail containing an attachment with Xtreme RAT that talked to the same C & C server ( Figure 5 ) , suggesting that the attackers who infected Ahmed with RCS may have provided a list of interest- ing e-mail addresses to another group for further targeting 
( Interestingly , spyware subse- quently sent to others has used bait content about Ahmed 
) Further attacks : In October 2012 , UAE Journalist A and Human Rights activist B ( per Figure 6 ) forwarded us suspi- cious e-mails they had received that contained a Word docu- ment corresponding to the first stage of 3-Stage Exploit Kit ( Figure 5 ) 
The attachment contained an embedded Flash file that exploited a vulnerability fixed in Adobe Flash 11.4 , loading shell code to download a second stage from faddeha.com 
The SpyNet sample communicated with the C & C hamas.sytes.net 
The exploit downloaded a second stage , which in turn downloaded a sam- ple of SpyNet from maile-s.com 
This sample of SpyNet communicated with the same C & C hamas.sytes.net 
When run , the sample unpacks a compiled Visual Basic project that loads , via the RunPE method , an executable packed with UPX 
These individuals received e-mails containing a link to a web page hosted on cedarkeyrv.com impersonat- ing YouTube 
'' The page redirected to a YouTube video a few seconds later , but first loaded a Java exploit -a known vulnerability with no patch at the time that the e-mails were sent 
The attack downloaded an instance of SpyNet from isteeler.com ( which from our inspection did not appear to have any legitimate content ) , which used the C & C storge.myftp.org 
An unidentified dropper using this C & C targeted Journalist F ; a SpyNet attack on Relative of political detainee D also used this C & C 
In that latter case , the sample arrived via e-mail in a .rar attachment that contained an .scr file disguised as a Word document 
The .scr file was a self-extracting archive that decompressed and ran both the bait document and the payload 
In all , these totaled 17 distinct hashes of documents , and 10 distinct hashes of payloads ( some documents that differed in their hash downloaded the same pay- load ) 
The exploits primarily downloaded instances of SpyNet from upload.bz , which for the most part communicated with C & C at sn.all-google.com 
This domain was also used for C & C in other attacks , including that on Journalist C. Two of the other CVE-2012-0158 exploits down- loaded DarkComet from www.getmedia.us and www.technopenta.com after posting system infor- mation to random123.site11.com 
Gamma documentation advertises that an operator of FinSpy can obscure the location of the C & C server ( called the mas- ter ) by setting up a proxy known as a relay 
We located a version of FinSpy that does not use the normal FinSpy handshake , but instead uses a protocol based on HTTP POST requests for communication with the C & C server 
We also similarly obtained and analyzed sam- ples of FSBSpy , a piece of malware that can report system information , upload screenshots , and drop and execute more malware 
This address was un- reachable when we probed it ; a researcher pointed us to an FS- BSpy sample that contained an Arabic-language bait document about Omani poetry , which talked to a C & C in the UK 
We grouped servers by the SSL certificates they returned , and found that each group forwarded to only a sin- gle server , except for one case where a group forwarded to two different IPs ( both in Morocco ) 
We also found two groups that forwarded to the same address 
Two RCS and 5 FSBSpy samples from VirusTo- tal communicated with various servers in the group 
The RCS samples also communicated with domains with lapsed registra- tions , so we registered them to observe incoming traffic 
) A sample of FSBSpy apparently installed from an exploit on a Turkish server talked to one of the servers in this group 
We also found server groups containing servers in Uzbek- istan and Kazakhstan ; we found FSBSpy samples on Virus- Total uploaded from these countries that communicated with servers in these groups 
The attacks include spyware for ongoing monitoring and the use of '' IP spy '' links to deanonymize those who voice dissent 
The attacks , while sometimes incorporating effective so- cial engineering , in general lack novel technical elements 
Some of the filenames used in the attacks included : At least one of them immediately reminded us of RedOctober , which used a very similarly named spearphish : '' Diplomatic Car for Sale.doc '' 
Instead , it writes an encrypted Visual Basic Script and runs it 
This VBScript drops a pair of files on disk - a loader and an encrypted payload 
The payload is always encrypted with a unique key , making it impossible to decrypt unless the DLL is available 
We observed several different spear-phishing documents that drop uniquely named payloads 
For instance , the '' qPd0aKJu.vbs '' file MD5 : E211C2BAD9A83A6A4247EC3959E2A730 drops the following files : The VBS also adds a registry key : HKEYCURRENTUSER\Software\Microsoft\Windows\CurrentVersion\Run\ setting the key '' bookstore '' to the value '' regsvr32 % path % \ctfmonrn.dll /s '' , which ensures the malware runs every time at system boot 
Some of the DLL names we observed include : Some of the payload names include : The payload includes an encrypted configuration block which contains information about the C & C sever : The information from the config includes a WebDAV URL which is used for connections , a username and password , two folders on the WebDAV server used to store plugins/modules for the malware and where data from the victim should be uploaded 
The Cloud Atlas implants utilize a rather unusual C & C mechanism 
All the malware samples we 've seen communicate via HTTPS and WebDav with the same server '' cloudme.com '' , a cloud services provider 
Each malware set we have observed so far communicates with a different CloudMe account though 
The attackers upload data to the account , which is downloaded by the implant , decrypted and interpreted 
In turn , the malware uploads the replies back to the server via the same mechanism 
Here 's a look at one such account from CloudMe : The data from the account : The files stored in the randomly named folder were uploaded by the malware and contain various things , such as system information , running processes and current username 
The data is compressed with LZMA and encrypted with AES , however , the keys are stored in the malware body which makes it possible to decrypt the information from the C & C 
We previously observed only one other group using a similar method – ItaDuke – that connected to accounts on the cloud provider mydrive.ch 
Interestingly , some of the spear-phishing documents between Cloud Atlas and RedOctober seem to exploit the same theme and were used to target the same entity at different times 
Based on observations from KSN , some of the victims of RedOctober are also being targeted by CloudAtlas 
Most Chinese-speaking attackers simply relocate C & C servers to a different place , recompile the malware and carry on as if nothing happened 
The attackers were able to compromise the website and include code that loaded a malicious Javascript file from a remote server 
This Javascript file is a framework for reconnaissance that the attackers call '' Scanbox '' and includes some of the techniques we described in a previous blog post : The Scanbox framework first configures the remote C & C server that it will use and collects a small amount of information about the victim that is visiting the compromised website including : Resulting in something like this : Before sending the information to the C & C server , Scanbox encodes and encrypts the data with the following function : Producing the following request : If we decrypt the data it translates to : After the first request , the framework contains several plugins to extract different information from the victim 
While the user is browsing the compromised website , all keystrokes are being recorded and sent to the C & C periodically 
It will also send keystrokes when the user submits web forms that can potentially include passwords and other sensitive data 
APT3 ( also known as UPS ) , the actors responsible for Operation Clandestine Fox has quietly continued to send waves of spearphishing messages over the past few months 
CVE-2014-6332 was disclosed publicly on 2014-11-11 and is a Windows OLE Automation Array Remote Code Execution vulnerability 
CVE-2014- 4113 is a privilege escalation vulnerability that was disclosed publicly on 2014-10-14 
The webpage contained both CVE-2014-6332 exploit code and a VBScript that invoked PowerShell on the affected users ' system to download the below payload : The CVE-2014-6332 exploit code seen in this incident is derived from the code published at http : //www.exploit-db.com/exploits/35230/ , which has also been incorporated in the Metasploit project 
After the exploit or script executes , the system downloads install.exe , which has the following metadata : The file install.exe attempts to write two files ( doc.exe and test.exe ) to the hard-coded path '' C : \Users\Public '' , which fails on Windows XP because that path is not present by default 
The first dropped file , doc.exe , contains the CVE-2014-4113 exploit and then attempts to execute test.exe with the elevated privileges 
This CVE is a local kernel vulnerability that , with successful exploitation , would give any user SYSTEM access on the machine 
The malware component , test.exe , uses the Windows command '' cmd.exe '' /C whoami '' to verify it is running with the elevated privileges of '' System '' and creates persistence by creating the following scheduled task : When executed , the malware first establishes a SOCKS5 connection to 192.157.198.103 using TCP port 1913 
The malware sends the SOCKS5 connection request '' 05 01 00 '' and verifies the server response starts with '' 05 00 '' 
The malware then requests a connection to 192.184.60.229 on TCP port 81 using the command '' 05 01 00 01 c0 b8 3c e5 00 51 '' and verifies that the first two bytes from the server are '' 05 00 '' ( c0 b8 3c e5 is the IP address and 00 51 is the port in network byte order ) 
Once the connection to the server is established , the malware expects a message containing at least three bytes from the server 
The following commands are supported by the malware : On October 28 , we observed APT3 sending out spearphishing messages containing a compressed executable attachment 
The deflated exe was a variant of the same downloader described above and connected to 198.55.115.71 over port 1913 via SOCKS5 proxy 
The secondary payload in that case was detected as Backdoor.APT.CookieCutter ( aka Pirpi ) and also named newnotepad.exe ( MD5 8849538ef1c3471640230605c2623c67 ) and connected to the known APT3 domains : The 192.184.60.229 IP address seen in this current campaign also hosts securitywap [ 
This IP has hosted other domains used by APT3 in past campaigns : As we discussed in our previous blog detailing previous APT3 activity , the walterclean [ 
] com served as a Plugx/Kaba command and control server 
Although APT3 is well known for employing zero-day exploits in their attacks , recent activity has demonstrated that they will also attack targets with known exploits or social engineering 
All three samples provided remote access to the attacker , via two Command and Control ( C2 ) servers 
One sample is typical of what is commonly referred to as a 'dropper ' because its primary purpose is to write a malicious component to disk and connect it to the targeted hosts operating system 
The malicious component in this case is what is commonly referred to as a Remote Access Tool ( RAT ) , this RAT is manifested as a Dynamic Link Library ( DLL ) installed as a service 
The second sample analyzed is a dual use tool that can function both as a post exploitation tool used to infect other systems , download additional tools , remove log data , and itself be used as a backdoor 
The third sample was a sophisticated implant that in addition to having multiple communication capabilities , and the ability to act as a relay for other infected hosts , utilized a kernel mode driver that can hide aspects of the tool from user-mode tools 
This third component is likely used for long-term implantation and intelligence gathering 
The executable 14c04f88dc97aef3e9b516ef208a2bf5 is commonly referred to as a 'dropper ' , which is designed with the purpose of extracting from itself a malicious payload and to initialize and install it into a targeted system 
In this case , the malicious payload is a Dynamic-Link Library ( DLL ) , which enables an attacker to have full control of the system 
The sample first resolves several library functions provided by Microsoft using the LoadLibrary ( ) and GetProcAddress ( ) Application Programming Interfaces ( APIs ) 
The imported function names are not encrypted ; however , the function name is minutely obfuscated by a simple single character substitution : The dropper invokes the SHGetSpecialFolderPath ( ) API supplying a Constant Special Item ID List ( CSIDL ) of 'CSIDLCOMMONDOCUMENTS ' to identify the destination folder for the malicious DLL payload 
'' The dropper attempts to write the malicious payload to one of the following names , using the first available name in this set : The dropper sets the creation and last written timestamp of the newly created file to the date 2007-03-07 00:00:00 ; this allows the newly created malicious DLL to blend in with other system files 
This is meant to prevent identification during disk forensics using a common investigative technique called a forensic analysis timeline 
The malicious DLL file that is dropped is hidden in a resource of the dropper binary 
When the dropper writes the file to disk , the first byte of the file is 'Z ' which prevents the file from executing or being detected as an executable by many defensive tools 
The dropper subsequently opens the dropped file and corrects the header by writing the 'M ' over the first byte , allowing the file to be executed 
The final step the dropper performs is to load the dropped DLL into its own process space ; it then resolves the export 'OpenINFOPerformanceData ' from the DLL and invokes it with the dropped DLL 's filename as parameter 
This export then implements the actual install logic to maintain persistence and invoke the main routine 
The use of the Chrome icon may indicate a possible attempt to socially engineer the intended victim into thinking the dropper was a legitimate file associated with Google 
This sample is a 'backdoor ' which is the DLL dropped by the dropper sample file with an MD5 of 14c04f88dc97aef3e9b516ef208a2bf5 
It is instantiated when it is mapped into the process space of its dropped file , and its ' export named 'OpenINFOPerformanceData ' is called 
If the service is present , the malware replaces its previous instances or versions of this backdoor 
After attempting to disable the existing service , the malware tries to install itself as a service with that same name 
During installation , the sample attempts to use documented APIs such as OpenSCManager ( ) and CreateService ( ) to initialize itself as a persistent Windows service 
As a precaution , the sample writes settings directly to the Windows Registry to accomplish the same goal if installing the service with the documented APIs fails 
The registry change creates the following key : Following this , the subroutine will set the value of the 'ServiceDLL ' to the module handle of the DLL 
The next key to be changed is : HKEYLOCALMACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Svchost , which will have the 'msupdate ' key set to 'msupdate ' 
The export 'CollectW3PerfData ' is registered as the main function of the DLL 
If the installation of the new service is successful , the sample then starts the new service and exits 
If the installation fails , the sample spawns a new process using rundll32.exe , this executable will instantiate the DLL and can call a specific exported function 
The rundll32.exe is instantiated with a new NULL Security Identifier ( SID ) ( S-1-0-0 ) with permissions set to grant all access to the file 
This allows any user to have complete control over the machine , as rundll32.exe is frequently launched by tasks such as changing the time , wallpaper , or other system settings 
This means that after cleaning up the components dropped by the malware , the system remains vulnerable to local attacks by simply overwriting the legitimate rundll32.exe executable with a malicious version and await it 's automatic execution by the Operating System 
This may be an attempt to fool some automated dynamic analysis or anti-malware software into believing this is the legitimate ESET AV software 
After creating this window , the routine starts the main thread that eventually initiates calling out to the Command and Control ( C2 ) 
Once the proper API 's have been resolved , the sample then assigns a NULL SID to the rundll32.exe executable and sets the current process ' Window Station to '' winsta0 '' , which enables the sample to access the real user 's desktop if started as service 
The communication to the C2 is handled by a while ( ) loop , with each successive connection attempt causing the loop to invoke the Windows Sleep ( ) API for a time interval of 2 seconds , exponentially increasing in length up to 1024 seconds ( 17 minutes ) and then restarting back to 2 seconds 
Thus the sample will only attempt to connect directly using a raw socket to the C2 located at 1.9.5.38:443 
The malicious sample sends an initial beacon to the C2 that includes the following information : The beacon is encrypted using an XOR/ADD loop using the statically defined key 0x1C and sent to the C2 
The following python function can be used to decode the beacon stings : After sending the initial beacon , the routine loops receiving incoming commands and executes them in sequence 
This inbound payload is received unconditionally and regardless of command type into a fixed-size stack buffer of 408 bytes size 
The primary aim of this backdoor is remote desktop control functionality comparable to VNC or Remote Desktop over a custom protocol 
It allows the adversary to view the main desktop graphically and control the keyboard and mouse 
This remote control functionality is implemented as separate messages for mouse clicks , pressed keys , etc 
using command identifiers 0x20000002 to 0x20000019 
The command 0x22000001 initiates continuous transmission of screen captures to the C2 
The screen captures are created using a series of Microsoft Windows Graphic Device Interface ( GDI ) API calls culminating in a call to GetDIBits ( ) 
Command 0x20000001 exits the backdoor and 0x20000000 is issued to completely remove the backdoor from the system 
When command 0x23000004 is received , a temporary new user '' DomainUser '' with password '' Dom4 ! nU- serP4ss '' is created and added to the local Administrators group 
The backdoor is then started under that account and the user is deleted 
It would appear this technique is meant to obfuscate the activities of the malicious sample by masking the process creator 's user name to appear to be a generic domain user 
The backdoor functionality can be instantiated either directly from the command line or through commands issued over a network based protocol via the C2 
If no arguments are given , a connection to the C2 is initiated to the stati- cally defined IP address 
The command line options support post exploitation capabilities such as changing file timestamps , forensic mitigation , privilege escalation , launching the executable , and specifying a specific C2 
One interesting command line option allows the backdoor to filter the contents of specified files to remove content using a regular expression ( regex ) 
This command then modifies the creation , modification , and last access timestamps of the modified file to conceal the content modifications 
This activity is generally associated with log cleaning to com- plicate a forensic investigation 
There are three components to the protocol : Authentication is accomplished using a 32 byte packet , this packet consists of : An example authentication packet sent to the C2 is located in Appendix E. After sending the initial authentication packet , the sample verifies that the first four bytes of the response is equal to a statically defined value , in this sample the value is : 0x16030100 
In addition , an 8 byte key is sent to the client which is then RC4 encrypted using the random number generated in step 2 from above as the password 
The first 16 bytes of this array are then used as the KEY and the second 16 bytes are used as the IV for setting up AES encryption which is then used to encrypt and decrypt any further communications 
The beacon for this sample is formatted as XML and consists of : An example of an unencrypted beacon : Command handling loop , this is a loop structure that will process and execute commands sent by the C2 
The malware sends and receives a heartbeat/keepalive packet every 2 minutes 
Examples of implemented commands include download and upload files , installing new .NET assemblies , calling methods on those assemblies , connecting to new C2 servers and executing processes 
This sample is a sophisticated backdoor which implements several communications protocols and was developed in C++ 
This sample is a DLL which can be registered as a service and is used to drop a kernel driver and provide an interactive command line shell to the C2 
It also is able to bypass User Account Control ( UAC ) to install itself by using the 'sysprep.exe ' Microsoft Windows executable provided by the targeted system 
After it copies itself , it will modify the creation time , last access time and last modification time to the current system time when the copy was made but with the year changed to 2005 
Adds itself as a service name from the backdoor 's configuration under HKEYLOCAL MACHINE\\SYSTEM\\CurrentControlSet\\Services\\ < service > '' This defaults to '' wuauserv '' , the legitimate Windows Update service , in the given binary 's default configuration 
Adds itself to list of services started by 'netsvc ' using the service name 'helpsvc ' 
If McAfee AV is installed , creates a copy of regsvr32.exe named Update.exe and then schedules the copy to be deleted on reboot using the well documented MoveFileExA API 
The sample is capable of 'dropping ' an embedded/encrypted kernel driver 
Barring the two aforementioned conditions , the sample decrypts the kernel driver to : Following the decryption and writing of the driver to disk , it is loaded using the ZwLoadDriver ( ) API 
The driv- er is encrypted with a simple four byte XOR key value of 0x2E885Df3 ; after decryption the file has the MD5 hash of dae6b9b3b8e39b08b10a51a6457444d8 
If the current service name matches a set of pre-defined service names that legitimately exist in Windows , the backdoor then loads the original service 's DLL into the address space with LoadLibrary and invokes the ServiceMain export 
While there is code in the binary that allows downloading a list of C2 servers from an HTTP URL , the default configuration present specifies 202.86.190.3:80 as a C2 to use , this is the same Hong Kong C2 server as the one used by the post exploitation .NET tool 
The malware has three distinct C2 protocols two of which can be transmitted over HTTP proxies and one can be bundled in two different 'dual ' modes ( see 3 
The con- figuration contains the C2 protocol to be used or optionally a self-configuration mode in which the malware attempts the different C2 protocols in a pre-defined order 
Proprietary binary header ( optionally over an HTTP Proxy using CONNECT mechanism ) ; this protocol consists of 64 random bytes being sent to the C2 
This one HTTP connection will be used for bi-directional communications , sending chunks of POST payload and receiving chunks of the response , interleaved 
The GET request serves as a down-stream channel while the POST request serves as a upstream channel 
Additionally , the malware contains a custom DNS client implementation that will use the system 's configured DNS server to tunnel C2 traffic over legitimate DNS 
After establishing any of the aforementioned channels for arbitrary binary data exchange , the malware will start sending and receiving compressed binary blobs via the channel of choice 
The main backdoor thread then reads commands from the chosen C2 protocol and passes them on to any of the following registered handler classes based upon a command ID 
This handler class for command ID 8 implements generic directory and file browsing using FindFirstFileW ( ) and FindNextFileW ( ) APIs , as well as reading and writing arbitrary files via C2 commands , thus enabling upload and download of arbitrary files 
This is typically seen in RATs for searching specific files to exfiltrate 
Additionally , this class implements launching of specified executable files via the CreateProcess ( ) API 
This handler class implements a generic TCP proxy 
It supports establishing TCP connections to other hosts and also listening for incoming connections 
The incoming connection contents are forwarded to the C2 and data from the C2 is passed on to connections 
The malware is capable of gathering various pieces of information from the system , triggered by a command ID 10 
The capabilities include recovering authentication credentials from various system and client storage such as Mozilla Firefox , Internet Explorer , and Remote Access Service ( RAS ) 
This class also supports gathering intelligence on the infected system including identifying security tools by their process name , proxy accounts , and version numbers for the Operating System ( OS ) and Internet Explorer 
This handler class provides the attacker with the ability to manage system components including start / stop / delete system services , enumerate / alter registry keys , and manage running processes 
This class also provides the ability for the attacker to take a screen shot of the users desktop 
This handler class uses the command ID 5 and implements an interactive command line shell accessible from the C2 server , containing a series of built-in commands 
If the input is not in this list of built-in commands , the malware attempts to invoke cmd.exe in the background , launching a command or command line utility already present on the system 
The standard output channel of that command is provided back to the C2 
This command results in the DLL deleting itself and terminating the backdoor process 
The driver begins by opening a named event in the BaseNamedObjects object directory with the name { 8CB2ff21-0166-4cf1-BD8F-E190BC7902DC } using the Windows API ZwOpenEvent ( ) 
If the event already exists , the driver fails to load , presumably to avoid a multiple instances of itself 
If the event does not exist , the driver then creates it using the Windows API ZwCreateEvent ( ) 
The second component of the entry point performs an anti-debugging technique , calling the function KdDisableDebugger ( ) , which allows the driver to disable usage of the built-in Windows kernel debugging facility that is used by popular kernel debuggers KD and WinDbg 
The final step of the entry point is to begin hooking the system , which is done by two helper functions - one is designed to hook the system call table , while the other hooks the network stack 
The network stack hooking first queries the OS version using RtlGetVersion ( ) or PsGetVersion ( ) 
In either case , the driver obtains the device object by using IoGetDeviceObjectPointer ( ) and hooks Major Function 14 the IRPMJDEVICECONTROL , as this is the function through which all Input Output ConTroLls ( IOCTLs ) are sent , such as the IOCTL for querying active IP connections 
The purpose of the hook is to scan the list of active connections returned to the user , and hide any such connection currently bound to a local TCP port in the range between 40000 and 45000 
The hooking is performed by creating a new completion routine associated with any IRPMJDEVICECONTROL IRP that matches the IOCTL , attaching to the target process , performing several memory copies to hide the entry , and detaching 
The TCP hook works almost identically to the NSI hook , though instead hooking IOCTL 0x120003 ( IOCTL TCPQUERYINFORMATIONEX ) 
This hook also filters any connections listening on TCP ports in the range between 40000 and 45000 
The unpacked kernel driver sample hooks these functions by reading the second DWORD at each of these exported functions 
The system call hook is then performed by first allocating a Memory Descriptor List ( MDL ) using the Windows API IoAllocateMdl ( ) , and associating the MDL to a non-paged buffer using MmBuildMdlForNonPagedPool ( ) 
Instead of hooking the entry in the table directly , which is easily detectable , the driver uses the LDASM open-source disassembly engine to analyze the function that is being pointed to by the table , and applying a Detours-style hook directly in the code 
It then checks for the values of the '' ServiceDll '' and '' Security '' keys , in the latter case it applies an XOR on the data with the value 127 
The user-mode component of this malware is a service called '' msupdate '' , this driver is attempting to hide the service 
In the registry hooking code of the driver , a call is made to ObReferenceObjectByHandle ( ) 
This is particularly relevant in this case because the backdoor DLL sample with an MD5 of de7500fc1065a081180841f32f06a537 specifically avoids installing the kernel driver on a system running this tool 
While the various network hooking techniques used in the kernel driver may appear novel or well researched , upon close inspection it is actually a line-for-line copy of an existing post from the now-offline 'rootkit.com ' by a Chinese language developer 
com/showthread.php ? t=77467 perform system call hooking through MDLs 
Open source research of the 4 innocuous kernel APIs '' ZwSaveKey ZwQueryValueKey ZwEnumerateValueKey IoAllocateMdl '' , in concert leads directly to a Chinese website that has a cached rootkit performing similar hooks on the same 3 registry related APIs 
The dropped DLL ( MD5 : 47619fca20895abc83807321cbb80a3d ) itself contains functionality that is typical of a Remote Access Tool ( RAT ) which are commonly used by PRC based actors in data exfiltration attacks 
The post exploitation tool ( MD5 : 2dce7fc3f52a692d8a84a0c182519133 ) is a dual-use tool , it can be dropped and executed by a client-side exploit , or the adversary can launch it using a variety of command line options 
The sample utilizes the AES cryptographic algorithm to protect its C2 communications 
This DLL is a moderately sophisticated backdoor with several well designed communication mechanisms not typically seen in these types of implants 
This sample has multiple communication capabilities available that makes it far more versatile and stealthy 
It implements relatively well thought out protocols including HTTP and DNS 
The tool has the ability to automatically down select the most effective communication channel once it has been instantiated , which can help avoid detection from solutions like DNS blacklisting and RFC protocol enforcement 
The sample supports the ability to act as a generic proxy , this may be intended to proxy C2 traffic for other infected machines in order to minimize the number of systems communicating to the C2 , thus enhancing OPSEC 
The sample contains 'dead code ' which appears to be command and control server classes , this is likely an indicator that the C2 client which would communicate with this sample shares the same communications library which was compiled into this sample 
The kernel driver component dropped by the Backdoor DLL bears many tool marks associating it with the CCRootkit package publicly by Steven Lai ( a/k/a embedlinux ) 
This kernel mode rootkit implements several hooking techniques that are aimed at preventing a system administrator from detecting the backdoor DLL 
This driver attempts to hide a wide swath of TCP ports ( 40000-45000 ) for an unknown reason , however it is suspected that this may relate to the potential network relaying capability alluded to for the backdoor dll 
The kernel driver component dropped by the Backdoor DLL bears many tool marks associating it with the CCRootkit package publicly by Steven Lai ( a/k/a embedlinux ) 
This kernel mode rootkit implements several hooking techniques that are aimed at preventing a system administrator from detecting the backdoor DLL 
This driver attempts to hide a wide swath of TCP ports ( 40000-45000 ) for an unknown reason , however it is suspected that this may relate to the potential network relaying capability alluded to for the backdoor dll 
They steal data by configuring their implants to send data out of the network using a victim network 's mail server 
• Several of APT28 's malware samples contain counter- analysis capabilities including runtime checks to identify an analysis environment , obfuscated strings unpacked at runtime , and the inclusion of unused machine instructions to slow analysis 
APT28 uses spearphishing emails to target its victims , a common tactic in which the threat group crafts its emails to mention specific topics ( lures ) relevant to recipients 
Since 2011 , APT28 has used lures written in Georgian that are probably intended to target Georgian government agencies or citizens 
In one case , we identified an APT28 lure from mid-2013 that referenced MIA-related topics and employed malware that attempted to disguise its activity as legitimate MIA email traffic 
The lure consisted of a weaponized Excel file that presented a decoy document containing a list of Georgian driver 's license numbers 
The backdoor attempted to establish a connection to a Georgian MIA mail server and communicate via MIA email addresses ending with '' @ mia.ge.gov '' 
Once connected to the mail server , APT28 's backdoor sent an email message using a subject line related to driver's licenses ( in Georgian ) , and attached a file containing system reconnaissance information 
This tactic could allow APT28 to obtain data from the MIA 's network through a less-monitored route , limiting the MIA network security department 's abilities to detect the traffic 
In the second example of MIA targeting , an APT28 lure used an information technology-themed decoy document that included references to the Windows domain '' MIA Users\Ortachala… '' ( Figure 1 ) 
The decoy document also contains metadata listing '' MIA '' as the company name and '' Beka Nozadze '' as an author , a possible reference to a system administrator in Tbilisi 
The text of the document purports to provide domain and user group setup information for internal Windows XP and Windows 7 systems 
APT28 possibly crafted this document to appear legitimate to all MIA system users and intended to breach the MIA network specifically using the embedded malware 
APT28 used a lure document that installed a SOURFACE downloader ( further discussed in the Malware section ) and contained a listing of birthdays for members of a working group between the Georgian MOD and the U.S. defense contractor 
Another one of APT28 's lures appeared to target a specific journalist covering issues in the Caucasus region 
In late 2013 , APT28 used a lure that contained a letter addressing a journalist by his first name and claiming to originate from a '' Chief Coordinator '' in Reason Magazine's '' Caucasian Issues Department '' - a division that does not appear to exist 
In the background , the decoy document installed a SOURFACE backdoor on the victim 's system 
We have seen APT28 register at least two domains mimicking the domains of legitimate organizations in the Caucasus , as shown in the table below 
One APT28 domain imitated a key Chechen-focused news website , while the other appeared to target members of the Armenian military by hosting a fake login page 
• More recently , in August 2014 APT28 used a lure ( Figure 3 ) about hostilities surrounding a Malaysia Airlines flight downed in Ukraine in a probable attempt to compromise the Polish government 
A SOURFACE sample employed in the same Malaysia Airlines lure was referenced by a Polish computer security company in a blog post 
APT28 has registered domains similar to those of legitimate Eastern European news sites and governments , listed in Table 2 
In addition , APT28 used one domain for command and control sessions ( baltichost [ 
] org ) that was themed after the Baltic Host exercises 
Several of the domains APT28 registered imitated NATO domain names , including those of NATO Special Operations Headquarters and the NATO Future Forces Exhibition 
We identified an APT28 lure containing a decoy document with a list of British officers and U.S. and Canadian military attachés in London 
Finally , APT28 used a lure that contained an apparent non-public listing of contact information for defense attachés in the '' Ankara Military Attaché Corps ( AMAC ) , '' which appears to be a professional organization of defense attachés in Turkey 
Some of the APT28- registered domains imitated those of defense events held in Europe , such as the Farnborough Airshow 2014 , EuroNaval 2014 , EUROSATORY 2014 , and the Counter Terror Expo 
In September 2014 , APT28 registered a domain ( smigroup- online.co [ 
] uk ) that appeared to mimic that for the SMi Group , a company that plans events for the '' Defence , Security , Energy , Utilities , Finance and Pharmaceutical sectors 
Some of APT28 's more commonly used tools are the SOURFACE downloader , its second stage backdoor EVILTOSS , and a modular family of implants that we call CHOPSTICK 
However because we have observed the name '' Sofacy '' used to refer to APT28 malware generally ( to include the SOURFACE dropper , EVILTOSS , CHOPSTICK , and the credential harvester OLDBAIT ) , we are using the name SOURFACE to precisely refer to a specific downloader 
This downloader obtains a second-stage backdoor from a C2 server 
• EVILTOSS : This backdoor has been delivered through the SOURFACE downloader to gain system access for reconnaissance , monitoring , credential theft , and shellcode execution 
We have also noted that APT28 tailors implants to their target environments , configuring them to use local network resources such as email servers 
APT28 has attempted to obfuscate their code and implement counter-analysis techniques : • One of the latest samples of CORESHELL includes counter-reverse engineering tactics via unused machine instructions 
This would hinder static analysis of CORESHELL behavior by creating a large amount of unnecessary noise in the disassembly 
• A number of CORESHELL droppers also conduct runtime checks , attempting to determine if they are executing in an analysis environment , and if so , they do not trigger their payloads 
• Many samples across the SOURFACE/ CORESHELL , CHOPSTICK , and EVILTOSS malware families obfuscate strings that are decoded at runtime 
Two of the malware families ( SOURFACE/CORESHELL and EVILTOSS ) use the same decryption sequence and similar algorithms for string encoding and decoding 
These families encode their strings at compile time using a custom stream cipher 
• APT28 has employed RSA encryption to protect files and stolen information moved from the victim 's network to the controller 
We call SOURFACE ( samples are frequently named netids.dll ) a first stage downloader because its primary job is to retrieve a second stage payload from a C2 server 
Until 2013 , the SOURFACE downloader used hard-coded IP addresses for C2 communications , whereas the future CORESHELL samples use domains 
They may not share the same code structure , but they are related because one drops and installs the other 
The ecosystem surrounding the SOURFACE downloader frequently consists of a dropper , which installs SOURFACE 
The SOURFACE downloader then receives another dropper from its C2 server , and this second dropper installs a second stage backdoor , which is usually EVILTOSS 
However , it contains more capabilities , including the ability to provide access to the file system and registry , enumerate network resources , create processes , log keystrokes , access stored credentials , and execute shellcode 
The backdoor encrypts data that it uploads with an RSA public key 
EVILTOSS variants may use the Simple Mail Transfer Protocol ( SMTP ) to send stolen data in an attachment named '' detaluri 
dat '' 
The backdoor attaches this file to a preformatted email and sends it out through a victim 's mail server 
The backdoor was installed alongside the NATO-themed decoy document depicted in Figure 8 
The backdoor sent data via SMTP to natosmtp @ mail [ 
] ru and received its tasking via POP from natopop @ mail [ 
] ru 
During our research , we discovered that APT28 uses a backdoor developed using a modular framework 
Communications with a C2 server using HTTP 
Email sent through a specified mail server 
One CHOPSTICK v1 variant contained modules and functions for collecting keystroke logs , Microsoft Office documents , and PGP files 
The monitoring for new files of interest is performed by a '' Directory Observer '' module 
In one sample this information was intended to be sent via SMTP using a Georgian MIA mail server 
It used one of four embedded sender email addresses ( @ mia.gov.ge ) to send files via email to another email address on the same mail server 
One variant of CHOPSTICK focuses on apparent air gap / closed network capabilities by routing messages between local directories , the registry and USB drives 
They work together to gain access to their targets and steal data 
They may send spear phishing emails from a specific IP address or email address 
SOURFACE is a downloader that obtains a second stage backdoor from a C2 server 
CORESHELL uses two threads to communicate with its C2 server 
The first thread sends beacons that contain the process listing of the compromised host 
The second thread is responsible for downloading and executing stage two payloads 
Messages are sent using HTTP POST requests whose bodies contain encrypted and Base64 encoded data 
Commands from the controller to the CORESHELL implant are encrypted using another stream cipher but this time using an eight-byte key 
Commands are sent from the C2 server to the CORESHELL backdoor in HTTP responses to the POST requests 
If the command byte was 01 , 02 , or 03 the following bytes would be a DLL or EXE that would be written to disk and executed 
CHOPSTICK is a backdoor that uses a modularized , object-oriented framework written in C++ 
CHOPSTICK may communicate with external servers using SMTP or HTTP 
The first time CHOPSTICK is executed , it may encrypt and store configuration data in the Registry key HKU\S-1-5-19Classes\Software\Microsoft\MediaPlayer\ { E6696105-E63E-4EF1-939E- 15DDD83B669A } \chnnl 
The configuration block is encrypted using RC4 encryption 
CHOPSTICK collects detailed information from the host including the Windows version , CPU architecture , Windows Firewall state , User Account Control ( UAC ) configuration settings on Windows Vista and above and Internet Explorer settings 
It also tests for the installation of specific security products ( Table 9 ) and applications ( Table 10 ) 
After collecting host information , CHOPSTICK creates a hidden file that may be named % ALLUSERSPROFILE % \edg6EF885E2.tmp for temporary storage and creates a Windows mailslot with the name '' checkmesv5555 '' 
Its usage of a Windows mailslot would potentially allow external binaries to write data to the '' checkmesv5555 '' mailslot , possibly allowing CHOPSTICK to encrypt and store output from other malware 
It creates a thread that records user activity on the host , capturing desktop screenshots in JPEG format , tracks current window focus , collects keystrokes , and scrapes window contents ( text , context menus , etc. ) 
User activity is captured once every 500 milliseconds and logged in an HTML-like format 
The thread writes user activity log messages to the '' checkmesv5555 '' mailslot in plain text 
CHOPSTICK reads messages from the mailslot , encrypts them using RC4 , and then stores the encrypted message in an edg6EF885E2.tmp temporary file 
After approximately 60 seconds of execution time , CHOPSTICK begins communicating with one of its C2 servers over HTTP 
After sending an initial HTTP GET request it uploads the file contents of edg6EF885E2 
tmp to the C2 server using HTTP POST requests 
Once the contents of edg6EF885E2.tmp are uploaded , CHOPSTICK deletes the file 
Figure 13 below contains an example of an HTTP POST request uploading a segment from edg6EF885E2.tmp 
CHOPSTICK uses a URL-safe Base64 encoding , using an alphabet that substitutes '' + '' and '' / '' for '' - '' and ''  '' , respectively 
CHOPSTICK encrypts an 11-byte sequence in the '' ai= '' parameter 
The purpose of this parameter appears to be to uniquely identify the particular instance of the backdoor to the C2 server 
The message body of the POST request is also Base64 encoded 
After uploading edg6EF885E2.tmp , CHOPSTICK continues to query its C2 servers for commands using HTTP GET requests 
The malware contains code which allows it to load or memory-map external modules that export the following functions : SendRawPacket , GetRawPacket , InitializeExp , DestroyExp , IsActiveChannel , GetChannelInfo , SetChannelInfo , Run , GetModuleInfo , GiveMessage , and TakeMessage 
The modules that are included in an instance of CHOPSTICK may be reported to the C2 server as part of POST messages 
Once these characters are removed the decoded ( but still encrypted ) text looks like this : The first two words ( '' 72 11 '' and '' fd 22 '' ) are checksums that are used to validate the message 
OLDBAIT is a credential harvester that installs itself in % ALLUSERPROFILE % \\Application Data\ Microsoft\MediaPlayer\updatewindws.exe 
Both the internal strings and logic are obfuscated and are unpacked at startup 
Credentials for the following applications are collected : Both email and HTTP can be used to send out the collected credentials 
The primary backdoor used in the Epic attacks is also known as '' WorldCupSec '' , '' TadjMakhal '' , '' Wipbot '' or '' Tavdig '' 
Our analysis indicates that victims are infected via a sophisticated multi-stage attack , which begins with the Epic Turla 
In time , as the attackers gain confidence , this is upgraded to more sophisticated backdoors , such as the Carbon/Cobra system 
Sometimes , both backdoors are run in tandem , and used to '' rescue '' each other if communications are lost with one of the backdoors 
Once the attackers obtain the necessary credentials without the victim noticing , they deploy the rootkit and other extreme persistence mechanisms 
Contact : intelreports @ kaspersky.com The attacks in this campaign fall into several different categories depending on the vector used in the initial compromise : The attackers use both direct spearphishing and watering hole attacks to infect their victims 
Currently , the Epic attackers run a vast network of watering holes that target visitors with surgical precision 
Injected websites load a remote JavaScript into the victim 's browser : The script '' sitenavigatoin.js '' is a Pinlady-style browser and plugin detection script , which in turn , redirects to a PHP script sometimes called main.php or wreq.php 
Sometimes , the attackers register the .JPG extension with the PHP handler on the server , using '' JPG '' files to run PHP scripts : The main exploitation script '' wreq.php '' , '' main.php '' or '' main.jpg '' performs a numbers of tasks 
We have located several versions of this script which attempt various exploitation mechanisms 
One version of this script attempts to exploit Internet Explorer versions 6 , 7 and 8 : Unfortunately , the Internet Explorer exploits have not yet been retrieved 
Another more recent version attempts to exploit Oracle Sun Java and Adobe Flash Player : Although the Flash Player exploits could n't be retrieved , we did manage to obtain the Java exploits : The Java files exploit a popular vulnerability , CVE-2012-1723 , in various configurations 
The payload dropped by these Java exploits is the following : The Java exploit use a special loader that attempts to inject the final Epic backdoor payload into explorer.exe 
The backdoor extracted from the Java exploits has the following C & C hardcoded inside : This C & C is still online at the moment although it redirects to a currently suspended page at '' hxxp : //busandcoachdirectory.com [ 
Most recently , we observed them using yet another technique coupled with watering hole attacks 
This takes advantage of social engineering to trick the user into running a fake Flash Player ( MD5 : 030f5fdb78bfc1ce7b459d3cc2cf1877 ) : In at least one case , they tried to trick the user into downloading and running a fake Microsoft Security Essentials app ( MD5 : 89b0f1a3a667e5cd43f5670e12dba411 ) : The fake application is signed by a valid digital certificate from Sysprint AG : This file was distributed from the Ministry of Foreign Affairs of Tajikistan 's website , at '' hxxp : //mfa [ 
] tj/upload/security.php '' 
The file is a .NET application that contains an encrypted resource 
This drops the malicious file with the MD5 7731d42b043865559258464fe1c98513 
This is an Epic backdoor which connects to the following C & Cs , with a generic internal ID of 1156fd22- 3443-4344-c4ffff : A full list with all the C & C server URLs that we recovered from the samples can be found in the technical Appendix 
The Epic backdoors are commanded by a huge network of hacked servers that deliver command and control functionality 
The huge network commanded by the Epic Turla attackers serves multiple purposes 
For instance , the motherships function as both exploitation sites and command and control panels for the malware 
Here 's how the big picture looks like : The first level of command and control proxies generally talk to a second level of proxies , which in turn , talk to the '' mothership '' server 
The mothership server is generally a VPS , which runs the Control panel software used to interact with the victims 
The mothership also work as the exploitation servers used in the watering hole attacks , delivering Java , IE or fake applications to the victim 
It runs a control panel which is password protected : Once logged into the Control panel , the attackers can see a general overview of the system including the number of interesting potential targets : A very interesting file on the servers is task.css , where the attackers define the IP ranges they are interested in 
Depending on the '' tasks '' , they will decide whether to infect the visitors or not 
In this case , we found they targeted two ranges belonging to : It should be noted though , the fact that the attackers were targeting these ranges does n't necessarily mean they also got infected 
There are three possible values : These are the '' do n't meet the conditions '' reasons observed in the logs : For this first stage of the attack , the threat actor uses a custom backdoor 
In some cases , the backdoor is packaged together with the CVE-2013-5065 EoP exploit and heavily obfuscated 
The CVE-2013-5065 exploit allows the backdoor to achieve administrator privileges on the system and run unrestricted 
The main backdoor is about 60KB in size and implements a C & C protocol on top of normal HTTP requests 
The communication protocol uses requests in the C & C replies , which the malware decrypts and processes 
The replies are sent back to the C & C through the same channel 
The configuration can also be updated on the fly by the attackers , via the C & C 
The backdoor attempts to identify the following processes and , if found , it will terminate itself : It contains an internal unique ID , which is used to identify the victim to the C & C 
Once a victim is confirmed as '' interesting '' , the attackers upload another Epic backdoor which has a unique ID used to control this specific victim 
During the first C & C call , the backdoor sends a pack with the victim 's system information 
All further information sent to the C & C is encrypted with a public key framework , making decryption impossible 
The commands from the C & C are encrypted in a simpler manner and can be decrypted if intercepted because the secret key is hardcoded in the malware 
Through monitoring , we were able to capture a large amount of commands sent to the victims by the attackers , providing an unique view into this operation 
Here 's a look at one of the encrypted server replies : Once a victim is infected and '' checks in '' with the server , the attackers send a template of commands : Next , the attackers try to move through the victim 's network using pre-defined or collected passwords : Listing all .doc files recursively is also a common '' theme '' : In total , we have decoded several hundreds of these command packages delivered to the victims , providing an unique insight into the inner workings of the attackers 
These include searches for : In this case , the attackers were interested to find e-mails related to '' NATO '' , '' Energy Dialogue within European Unition '' and so on 
For some of the C & C servers , the attackers implemented RSA encryption for the C & C logs , which makes it impossible to decrypt them 
Once a victim is compromised , the attackers upload several tools that are used for lateral movement 
One such tool observed in the attacks and saved as '' C : \Documents and Settings\All users\Start Menu\Programs\Startup\winsvclg.exe '' is : This is a keylogger tool that creates % temp % \~DFD3O8.tmp 
For instance , another tool often uploaded by the attackers to the victim 's machine is '' winrs.exe '' : This is an UPX packed binary , which contains the genuine '' dnsquery.exe '' tool from Microsoft , unpacked MD5 : c0c03b71684eb0545ef9182f5f9928ca 
This backdoor is more sophisticated and belongs to the next level of cyber-espionage tools called the '' Carbon system '' or Cobra by the Turla attackers 
Other packages delivered to the victims include : These top level packages deploy both updated Epic backdoors and Turla Carbon system backdoors to confirmed victims , effectively linking the Epic and Turla Carbon operations together 
The Turla Carbon dropper from these packages has the following properties : This is called internally by the authors '' Carbon System '' , part of the '' Cobra '' project , as it can be seen from the debug path inside : This acts as a dropper for the following modules , both 32 and 64 bit : The Carbon system is in essence an extensible platform , very similar to other attack platforms such as the Tilded platform or the Flame platform 
The payload recovered from one of the mothership servers ( at newsforum.servehttp [ 
] com/wordpress/wp-includes/css/img/upload.php , MD5 : 4dc22c1695d1f275c3b6e503a1b171f5 , Compiled : Thu Sep 06 14:09:55 2012 ) contains two modules , a loader/injector and a backdoor 
There are other indications that the attackers are not native English language speakers : The sample e9580b6b13822090db018c320e80865f that was delivered to several Epic victims as an upgraded backdoor , has the compilation code page language set to '' LANGRUSSIAN '' 
In February 2014 we observed the Miniduke threat actor using the same backdoor on their hacked servers , although using a much stronger password 
On some of the C & C servers used in the Epic attacks , we were able to identify detailed victim statistics , which were saved for debugging purposes by the attackers 
This is used to gain a foothold and validate the high profile victim 
If the victim is interesting , they get upgraded to the Turla Carbon system 
The compromised websites contained an iframe to direct site visitors to a threat actor-controlled IP address that dropped a Poison Ivy remote access tool ( RAT ) onto victims ' systems 
The group was able to compromise these websites and insert malicious iframes 
The threat group obfuscated the iframe on two of the compromised websites 
The iframes on these websites directed visitors to Java exploits hosted at 103.27.108.45 
In turn , these exploits downloaded and decoded a payload hosted at : hxxp : //103.27.108.45/img/js.php 
It had the following properties : The backdoor also contained the below versioning info embedded in the RTVERSION of one of the PE resources : This versioning info attempted to masquerade as a Google Chrome file 
The Poison Ivy implant had the following configuration properties : The C2 domain quakegoogle.servequake [ 
] com resolved to 115.126.62.100 at the time of the SWCs 
Other domains resolving to the same IP include the following : Between August 30 , 2014 and September 16 , 2014 we also observed SOGU ( aka Kaba ) callback traffic sent to assign.ddnsking.com over port 443 
The attackers have everything they need to start looking for an entry point to the company 's network and establish one or several permanent backdoors into the environment 
The attackers mostly rely on two techniques here to infect one or several computers , usually workstations , inside the target 's network : spear phishing and drive-by downloads 
Spear phishing can be described as targeted e-mail phishing 
In a spear phishing scheme , attackers send very few e-mails to targeted people 
The trick is to target the right victim and provide it with the right content , so that they will click on a link leading to drive-by download of a malware , or open an attached file which will infect their computer 
Some groups of attackers also use '' watering hole '' techniques to successfully compromise their targets 
To build a watering hole attack , attackers do compromise the website of a third party , generally a supplier of the target , which is typically visited by a specific group of professionals and very likely by the target 
Every visitor of the compromised third party is then infected 
It just takes a few lines of code in the infecting script to only compromise visitors coming from the target IP ranges 
Attackers have gained access to one or several machines inside the target 's corporate network 
They need to install several different backdoors in order to be able to always access the network 
As soon as the attackers are sure they have enough access , they start looking for two things : intellectual property ( or anything else they want to know or steal ) in alignment with predefined mission objectives , and a means of privilege escalation to facilitate lateral movement within the compromised environment 
It generally does not take long before the attackers gain domain administrator privileges and dump all the Active Directory content 
Data exfiltration is the last step before the attackers loop to the lateral moves step , in a never-ending circle of prolonged access and information theft 
They generally create archive files containing the content they want to exfiltrate , which are then sent to the attackers by using a remote administration tool ( RAT ) or transfer protocols such as FTP and HTTP 
The attackers loop to the access strengthening/lateral moves stage and generally keep stealing more information and stay inside the network for more data gathering 
We discovered this malware sample in June 2014 , leading to a command & control ( c & c ) server still in activity 
This one is also used by the group to infect workstations , collect system information , and install more malware on the infected computer 
It acts as a first stage downloader and system data collector often used in the initial compromise of the Pitty Tiger campaigns , generally embedded in Microsoft Office documents 
Thanks to server 's misconfigurations , we managed to get information from three c & c servers used by this group of attackers , which provided us with insight from the end of 2013 to the beginning of July 2014 
Pitty Tiger , like most other APT groups , use spear phishing e-mails extensively in order to gain an initial foothold within the targeted environment 
We have been able to find a spear phishing e-mail crafted by the attackers 
This e-mail spoofed the identity of an employee of a targeted company : The attached file is a Microsoft Office Word document triggering CVE-2014-1761 to infect the computer it is sent to : While this example looks very '' amateur '' for a spear phishing attempt , we suppose the group has conducted more advanced spear phishing campaigns , based on the fact that we found infected Word documents showing content stolen from victims of the group 
These documents were infecting the system with Troj/ReRol.A malware , which we will detail later in this report 
This could mean that the Pitty Tiger group is using stolen material as spear phishing content either to target other persons in the compromised company , or to target other persons in a competitor's company , or more generally to compromise another target 
Pitty Tiger also seem to use fake Microsoft Office Excel content , yet we could only find empty content delivering once again the Troj/ReRol.A malware 
Although we have not been able to find evidences of any attack aimed at exploiting vulnerabilities on the group 's targets servers , we have been able to record several vulnerability scanning launched from one c & c server straight to the targets 
The attackers have been using different vulnerability scanners aimed at their targets 
While some targets have been scanned with '' generic '' vulnerability scanning tools like HScan or Fluxay and port scanners like Nmap , some other targets have been scanned for very specific vulnerabilities , like a ZyWALL vulnerability or a FORTINET product 
We have also been able to testify that the Pitty Tiger group has successfully collected information on some of their targets by exploiting the HeartBleed bug 
This vulnerability which exists on some old versions of OpenSSL allows attackers to collect data from chunks of memory from the targeted machine 
It allowed the Pitty Tiger group to get admin credentials from at least one target , for example 
Running automated vulnerability scanners on whole ranges of IP addresses used by the targets or on several domains is a very noisy way to collect information and find server vulnerabilities 
One of the favorite methods used by the Pitty Tiger group to infect users is to use a Microsoft Office Word document which exploits a specific vulnerability 
The payload infecting the system is malware known as '' Troj/ReRol.A '' 
We have been able to find one such document used by that group of attacker , exploiting CVE- 2012-0158 , an old critical vulnerability impacting Microsoft Office and corrected by Microsoft's MS12-027 fix in April 2012 
We also found one RTF document embedding CVE-2014-1761 , which is a more recent exploit 
We discovered several different documents spreading this malware by triggering CVE-2012-0158 vulnerability , yet we could not share them in this report , since these documents contain information about victims of the Pitty Tiger group 
When opened , it shows a single line written in Chinese language , which can be translated as '' Hello ! '' When successfully triggered , the exploit infects the host by dropping and executing a file named '' svohost.exe '' in the temporary folder of the currently logged-in user : This binary is '' Troj/ReRol.A '' according to Sophos naming convention 
It immediately triggers alarms on our sandbox : The binary drops a copy of itself in the Application Data folder of the currently logged-in user : The malware initiates a communication to time.windows.com to check for connectivity , and then communicates with the c & c server at mac.avstore.com.tw 
The variants we have seen did use that same User- Agent : The persistence mechanism used by the malware is the creation of a registry key named '' Shell '' containing the path to the malware on the infected system : The payload of this malware is used to collect information on the newly infected host , and send it back to the c & c server 
It can also download and execute binaries 
The data sent in the POST request has a 0x11 bytes header consisting of a fixed-value byte ( 0xc3 ) followed by a 0x10 bytes encryption key 
The data following the header is encrypted using RC4 with the previous key 
Here is an anonymized sample of communication showing information collected by the malware : This information is very useful for an attacker : it shows all software installed on the system , and running services 
Once this data has been transferred to the c & c server , it responds by sending additional malware to execute on the machine 
The malware , when running in our sandbox , triggers the following alarms : The binary drops two files in '' C : \Windows\System32 '' : The '' qmgrxp.exe '' binary is a simple copy of the original binary 
It drops the '' packet64.dll '' , and injects it in '' explorer.exe '' 
When executed , a mutex called '' PittyTiger '' is created 
Persistence is achieved by adding the path to the binary to the WinlogonUserInit key : The '' packet64.dll '' is the main payload of the RAT 
After being injected , it starts sending its Hello packet to its c & c server : All the requests sent to the c & c contains the string '' /FC001/ '' followed by the bot id 
The data sent is simply encoded using base64 , there is no cipher at all 
The hello packet , once decoded , looks like the following : Our sample had 3 c & c servers configured : The following commands are implemented : Regarding the controller part , we found two different versions : The interface handling both Pitty TIGER and CT connections is very interesting 
This remote administration tool is often used by the Pitty Tiger group 
Moreover , the same commands are implemented in both RATs 
Unsurprisingly , when running in our sandbox , the RAT triggers the same alarms as PittyTiger : The binary drops two files in '' C : \Program Files\Internet Explorer '' : The '' ieupdate.exe '' is a simple binary to inject the DLL into '' explorer.exe '' 
Persistence is achieved via the following registry key : After injection , the RAT sends a first login packet to its c & c : The RAT communication is performed through HTTP requests 
The data is sent encrypted with RC4 , and base64-encoded 
The Login packet contains the following string , after decoding and deciphering : It contains the computer name , the user name , the internal IP address , the OS version , the RAT internal version and the Language ID of the system 
The RAT can then receive commands from its c & c 
Usual RAT features are implemented : Regarding the configuration , our sample communicates with '' sop.avstore.com.tw '' , and contains the string '' Nov 13 2013 '' , which should be a version identifier 
This is another remote administration tool often used by the Pitty Tiger crew 
The binary we found is named 3200.exe , and triggers the following alarms in our sandbox : The '' release.tmp '' file is dropped on the system : The binary is also copied to the user 's '' Application Data '' directory , and injects the '' release.tmp '' file in '' explorer.exe '' 
Persistence is achieved by adding the path to the binary to the Winlogon Shell key : The RAT embeds its own DNS server IP addresses to make the c & c domain names resolutions 
These addresses are listed below : It starts resolving its domains after injection , and immediately sends requests 
First requests are used to check for updates ( GET request on /httpdocs/update/update.ini ) 
A Hello packet is then sent : The bot then repeatedly sends GET requests on '' /httpdocs/mm/ < botid > /ComMand.sec '' to retrieve remote commands 
The communication protocol is quite simple : GET requests are used to receive data from the c & c , and POST requests to send data 
In POST commands , the CGI name represents the command 
The following features are implemented : The following CGI files can be requested by the bot : The configuration is stored locally in a file called '' schmup.sys '' 
The file is ciphered using RC4 , using the MD5 hash of '' rEdstArs '' as the key 
Our sample uses '' mca.avstore.com.tw '' , '' star.yamn.net '' and '' bz.kimoo.com.tw '' as c & c servers 
Unlike others c & c binaries , the c & c part of this RAT does not have a graphical interface , but can be remotely requested to manage the bots 
Furthermore , no authentication is required to send commands to the c & c ( but you need to know the configured password to interact with the bots ) 
We do not currently know why this malware uses the same patterns to communicate 
This is another remote administration tool used by the Pitty Tiger group 
The binary we found was dropped by a malicious Word document 
The following alarms are triggered in the sandbox : The shellcode contained in the Word file drops the following file , and executes it : This one drops in turn the following file : This tmp file is then copied to '' C : \Windows\system32\Nwsapagentex.dll '' and registered as a service called '' Nwsapagent '' 
Up to 5 c & c servers can be configured , but our sample only had one : '' ey.avstore.com.tw:53 '' 
Moreover , the built malware we found in the same folder was configured to connect to a local IP address , probably for testing purposes 
Six malware families have been identified as communicating with subdomains of skypetm.com.tw : Avstore.com.tw and skypetm.com.tw have 4 malware families in common , communicating to subdomains of both domains : Some domains registered by the group are very old 
We suspect Pitty Tiger to use this compromise to spear phish other companies which are in commercial relation with this web development company 
We also found a lot of vulnerability scanners launched by the attackers at different targets , yet there was no sign of compromise 
According to the name of the files and the general feel of the archive , we do think it was extracted by the attackers to '' show '' someone what kind of data they could get from the compromise of that particular target 
Interestingly enough , we saw a part of these documents appear on Virus-Total , with an additional '' gift '' from the attackers , a payload dropping a malware 
There are only two options we can think of here :  Someone from the same company has been targeted with this document 
 Someone from another company has been targeted with this document 
A computer named CHMXY-PC connected to the c & c via RDP with IP address 58.61.40.5 
The IP is in an ADSL dynamic pool in the Gangzhou area ( Guangdong province ) : A few connections to the c & c were done by a computer named TIEWEISHIPC with IP address 27.16.139.143 
Some connections to the c & c originated from a computer named FLY-THINK with several IP addresses , all located in Fuqing ( Fujian province ) 
The IP addresses are in an ADSL dynamic pool : Most of the connections to the c & c server were coming from a computer named 50PZ80C- 1DFDCB8 with several IP addresses 
The two computers FLY-THINK and 50PZ80C-1DFDCB8 have used distinct IP addresses to connect to the c & c , yet some of these IP addresses come from the same IP range : We mapped these RDP connections to have a graphical view : We found that a member of this group of attackers used some tools on his own system , for testing purposes 
He launched some tests with the CT RAT we exposed earlier : Here we can see a user '' Toot '' from a machine named '' toot-2a601225a8 '' logging in the CT RAT and executing some commands 
After these tests , we could see some real connections to a victim using this RAT 
Please note that at this point , the attacker has at least the privileges of a local administrator , since he is allowed to write content in the system32 folder of a Windows XP system 
He could also gain the credentials to a sensitive e-mail account 
The c & c servers used by the attackers revealed a lot of interesting files stored in various folders : This is quite the usual arsenal for a group of APT attackers : What is rare to find is the controller part of those tools 
Not only is it one more indicator of a probable Chinese origin , but also an indicator that this server was probably used as a test base , in addition to being operational and controlling infected machines from different targets 
A script named ipc.bat uses a file named user.txt to try to brute-force a shared folder access : The user.txt file contains thousands of lines , each one being a couple of one particular username and one password attempt : This user.txt file has been anonymized , yet we wanted to give you the feel for it 
Information relating to the tools used by the attackers has been leveraged for attribution : The IP addresses used for the hosting of the c & c domains are mainly located in Taipei ( Taïwan ) and Hong Kong City ( Hong Kong Special Administrative Region , PRC ) : Most RDP connections to the c & c infrastructure come from Chinese IP ranges in Fuqing ( Fujian province , PRC ) 
Pitty Tiger is effective and mature in the use of targeted malware , the use of known exploits to infect computers with their malware and the creation of an infrastructure to efficiently conduct APT attacks 
They are quite unprofessional in their way of using their infrastructure : they do launch vulnerability scanners directly from a c & c server and also use their connection for personal activities ( downloading pornographic material for example , as we have seen a whole folder on a c & c server full of xxx torrent links ) 
The actor 's offensive activity can be tied to specific hotel and business center Wi‑Fi and physical connections , some of it is also tied to p2p/file sharing networks , and they have been known to spear-phish targets as well 
The following list presents a set of characteristics for the crew : When unsuspecting guests , including situationally aware corporate executives and high-tech entrepreneurs , travel to a variety of hotels and connect to the internet , they are infected with a rare APT Trojan posing as any one of several major software releases 
This first stage of malware helps the attackers to identify more significant victims , leading to the selective download of more advanced stealing tools 
At the hotels , these installs are selectively distributed to targeted individuals 
Addition- ally , seeding p2p networks with widely spread malware and 0-day spear-phishing attacks demonstrate that the Darkhotel APT maintains an effective toolset and a long-running operation behind the questionable hospitality it shows its guests 
The Darkhotel APT 's precise malware spread was observed in several hotels' networks , where visitors connecting to the hotel 's Wi-Fi were prompted to install software updates to popular software packages 
Of course , these packages were really installers for Darkhotel APT 's backdoors , added to legitimate installers from Adobe and Google 
Digitally signed Darkhotel backdoors were installed alongside the legitimate packages 
The most interesting thing about this delivery method is that the hotels require guests to use their last name and room number to login , yet only a few guests received the Darkhotel package 
As a part of an ongoing investigation , our research led us to embedded iframes within hotel networks that redirected individuals ' web browsers to phony install- ers 
The attackers were also very careful to immediately delete all traces of their tools as soon as an attack was carried out successfully 
The attackers set up the environment and hit their individual targets with precision 
As soon as their target 's stay was over and the attack-frame was closed , the attackers deleted their iframe placement and backdoored executables from the hotel network 
The attackers successfully de- leted traces of their work from earlier attacks in another hotel , but their offensive techniques were the same 
But the attackers also maintain truly precise targeting information over the victim 's visit , much like they would know a victim 's email address and content interests in a spearphishing attack 
This data enables the attackers to present the malicious iframe precisely to that individual target 
An example of the Darkhotel APT 's indiscriminate malware spreading is dem- onstrated by the way it seeds Japanese p2p sharing sites , where the malware is delivered as a part of a large ( approximately 900mb ) rar archive 
The archive is also spread over bittorrent , as detailed below 
Darkhotel uses this method to distribute their Karba Trojan 
This Darkhotel package was downloaded over 30,000 times in less than six months 
But what looks like the AxDecrypt.exe decryptor is bound to both the true decryptor and the dropper for the Darkhotel Catch.exe Karba Trojan 
When a user downloads the torrent and decrypts the zip files , the trojan surrepti- tiously is installed and run on the victim system 
Catch.exe , detected as Backdoor.Win32.Agent.dgrn , communicates with the fol- lowing Darkhotel command and control servers : Other examples of this Darkhotel backdoor bound within a shared torrent include adult content Japanese anime and more 
The associated Darkhotel backdoor was hosted on bittorrent , emule , etc , under a variety of comic names 
Related Darkhotel command and control server domains include : Darkhotel campaigns involving typical spear-phished Tapaoux implants publicly appeared in bits and pieces several times over the past five years 
This spear-phishing activity continues into 2014 
The attacks follow the typical spear-phishing process and in the past couple of months , exploited systems retrieved downloader executables from web servers like Over the past few years the group has emailed links that redirect targets ' brows- ers to Internet Explorer 0-day exploits 
Sometimes the attachment itself includes an Adobe 0-day exploit 
In the past few years , they deployed 0-day spear-phishing attacks targeting Adobe products and Microsoft Internet Explorer , including cve­2010­0188 
The crew spear-phished a set of target systems connected to the Internet through Chinese ISPs , and developed capabilities within the 0-day exploits to handle hardened Windows 8.1 systems 
It 's interesting that the Flash objects were embedded in Korean documents titled '' List of the latest Japanese AV wind and how to use torrents.docx '' ( loose English translation ) 
The dropped downloader ( d8137ded710d83e2339a97ee78494c34 ) delivered malcode similar to the '' Information Stealer '' component functionality summarized below , and detailed in Appendix D 
These weak encryption keys , when broken , could allow an attacker to use the certificates fraudulently to spoof content , perform phishing attacks , or perform man­in­the­middle attacks against all Web browser users including users of Internet Explorer 
One of the most interesting components that we discovered as a part of this cam- paign was the use of a digitally­signed advanced keylogger 
This keylogger is dropped by code running within svchost.exe on WinXP SP3 , which maintains an interesting debug string : It probably was developed as a part of a mid-to-late 2009 project : e : \project\2009\x\totalsource\32bit\ndiskpro\src\ioman.c This driver package is built to resemble a legitimate low-level Microsoft system device 
It is installed as a system kernel driver '' Ndiskpro '' service , described as a '' Microcode Update Device '' 
It is slightly surprising that no rootkit functionality hides this service : When loaded , the NDISKPRO.SYS driver hooks both INT 0x01 and INT 0xff , and retrieves keystroke data directly from port 0x60 , the motherboard keyboard con- troller itself 
This component then encrypts and writes the retrieved values ondisk to a randomly named .tmp , file like ffffz07131101.tmp 
This file is located in the same directory as the original dropper , which maintains persistence across reboots with a simple addition to the HKCU run key 
This keylogger module encrypts and stores gathered data in a log file , as men- tioned previously 
These tools are dropped by hotel installers spoofing legiti- mate software installers , bound within torrent bundles , or dropped by exploits or hypertext linked from spear-phishing emails 
More advanced tools , like the keylogger decribed above , are later downloaded to the victim system by one of these implants 
In a recent case , word docs embed- ded with 0-day flash swf files either dropped these backdoors or downloaded and executed backdoors from remote web servers 
These tools pull down the keylog- ger , steal information from the system , or download other tools 
The most interesting behaviors of these components include This module is quite small ( 27Kb ) and comes as a part of WinRar SFX file that drops and starts the module from % APPDATA % \Microsoft\Crypto\DES64v7\msieckc.exe 
This module is designed to update malicious components through recurring checks at the C & C server 
It is also capable of removing some older components , the names of which are hardcoded in the body of the malware 
The module adds autorun registry settings to enable an automatic start during system boot 
One of the most interesting functions of this executable is its unusual delay and persistence 
So , if some other critical malicious component was removed during this period , current module backs up and restores access to the system within 6 months 
The component gathers system information and sends it to the Darkhotel com- mand and control servers as detailed in Appendix D. This module is relatively large ( 455Kb ) and comes as a part of a WinRar SFX file that drops and starts the module from % APPDATA % \Microsoft\Display\DmaUp3 
exe 
The main purpose of the module is to collect various secrets stored on a lo- cal system and upload them to Darkhotel command and control servers : This module is designed to terminate itself on Windows with the system de- fault codepage set to Korean 
It was built as MFC framework application with a lot of extra calls that should have complicated the analysis of the sample 
It mim- ics a GUI desktop application but it does not create any visible windows or dialogs to interact with local users 
The Trojan collects data about the system and anti­ malware software installed on it , and uploads that data to Darkhotel command and control servers 
It is bound to a variety of other software packages that vary in name , but the host package is consistently detected as '' Virus.Win32 
It drops the igfxext.exe '' selective infector '' component to disk and runs it 
This component is a virus , and is used to selectively infiltrate into other comput- ers via USB or network shares 
First , the virus retrieves all available disks and starting from disk number 4 ( D : \ ) to disk number 20 ( Z : \ ) , finds executable files and infects them 
The code simply brute forces the list of mapped removable drives 
During its infection routine , the infector changes the entrypoint of executable files , creates an .rdat section , and inserts a small loader in the section , then puts its main payload in the overlay 
Every infected file has functionality described in Trojan­Dropper & Injector section , so it can collect information about the comput- er , send it to the C2 and download other Darkhotel components as commanded 
Again , further technical details are provided in Appendix D. Almost every backdoor in this set maintains an internal campaign code or id , used in initial c2 communications as described above 
Because the operators very actively build up new command and control serv- ers , it is difficult to sinkhole enough domains to get an accurate overall picture of victim system location based on this data 
Many of these c2s maintain a common directory path that serves a ddrlog 
A description of the detailed connectback URL values and their xor/base64 encoding scheme is included in the '' Interesting Malware Trojan.Win32.Karba.e '' technical notes in Appendix D. The Darkhotel c2 maintain these directory structures to store and serve ddrlog content : The following structures appear to be common across servers , but do not pro- duce ddrlog and do not maintain an /error/ directory : Two ddrlog files report entries starting January 1 , 2009 at 9:16 a.m. All of the logs maintain a significant number of entries , almost 50,000 , with a simple stamp '' B '' or '' L '' 
Typical main page : For begatrendstone.com , we have the following directory structure : The group encrypts victim data on their servers with single user/passkey combi- nations across multiple victims 
New victim systems appear to be systematically vetted 
The attackers maintain a web interface to vet these new victim systems 
The attackers first and foremost list and sort victim systems according to their latest c2 check­in 
This is becoming more and more common on the APT scene , where targeted attacks are used to compromise high profile victims and botnet style operations are used for massive surveillance or performing other tasks such as launching DDoS attacks on hostile parties or simply upgrading victims to more sophisticated espionage tools 
On February 11 , FireEye identified a zero-day exploit ( CVE-2014-0322 ) being served up from the U.S. Veterans of Foreign Wars ' website ( vfw [ 
] org ) 
Specifically , visitors to the VFW website were silently redirected through an iframe to the exploit at www. [ REDACTED ] .com/Data/img/img.html 
It aborts exploitation if the user is browsing with a different version of IE or has installed Microsoft 's Experience Mitigation Toolkit ( EMET ) 
The vulnerability allows the attacker to modify one byte of memory at an arbitrary address 
The attacker uses the vulnerability to do the following : The attacker uses the Microsoft.XMLDOM ActiveX control to load a one-line XML string containing a file path to the EMET DLL 
Because the vulnerability allows attackers to modify memory to an arbitrary address , the attacker can use it to bypass ASLR 
Once the attacker 's code has full memory access through the corrupted Flash Vector object , the code searches through loaded libraries gadgets by machine code 
The attacker then overwrites the vftable pointer of a flash.Media.Sound ( ) object in memory to point to the pivot and begin ROP 
Subsequently , the malicious Flash code downloads a file containing the dropped malware payload 
Then , when the shellcode is executed , the malware creates files '' sqlrenew.txt '' and '' stream.exe '' 
The tail of the image file is decoded , and written to these files 
'' sqlrenew.txt '' is then executed with the LoadLibraryA Windows API call 
As documented above , this exploit dropped an XOR ( 0×95 ) payload that executed a ZxShell backdoor ( MD5 : 8455bbb9a210ce603a1b646b0d951bce ) 
The ZxShell backdoor is a widely used and publicly available tool used by multiple threat actors linked to cyber espionage operations 
This particular variant called back to a command and control server located at newss [ 
] effers [ 
] com 
] org via the previous resolutions to the following IP addresses : We previously observed Gh0stRat samples with the custom packet flag '' HTTPS '' calling back to book [ 
] flnet [ 
] org and icybin [ 
] flnet [ 
] org 
We also observed another '' HTTPS '' Gh0st variant connecting to a related command and control server at me [ 
] scieron [ 
] com 
You may recall that dll [ 
] freshdns [ 
] org , ali [ 
] blankchair [ 
] com and cht [ 
] blankchair [ 
] com were all linked to both Operation DeputyDog and Operation Ephemeral Hydra 
They build ROP chains and shellcode the same way , both choose to corrupt a Flash Vector object , have some identical functions with common typos , and even share the same name 
These actors have previously targeted a number of different industries , including : The proven ability to successfully deploy a number of different private and public RATs using zero-day exploits against high-profile targets likely indicates that this actor ( s ) will continue to operate in the mid to long-term 
Aggressive ad libraries also leak the user 's private information 
By leveraging all these vulnerabilities , an attacker can conduct more targeted attacks , which we call '' Sidewinder Targeted Attacks 
'' In this paper we explain the security risks from such attacks , in which an attacker can intercept and use private information uploaded from ad libraries to precisely locate targeted areas such as a CEO 's office or specific conference rooms 
Here , we explain how attackers can invoke Android services for tasks including taking photos , calling phone numbers , sending SMS , reading from/ writing to the clipboard , etc 
Furthermore , the attackers can exploit several Android vulnerabilities to get valuable private information or to launch more advanced attacks 
The attacker can hijack the network where the targeted victim resides 
To minimize detection chances , the attacker can choose to take action on important targets only , ignoring all other devices 
In later sections , we discuss attacking ( '' warhead '' ) and targeting ( '' homing '' ) components in detail and show how a combination of these components can launch powerful and precise attacks on target devices 
Table 1 proposes different attacks that an attacker can launch remotely on target devices through vulnerable ad libraries 
The left panel enables the attacker to command the victim 's device , including uploading local files , taking pictures , recording audio/video , manipulating the clipboard , sending SMS , dialing numbers , implanting bootkit , or installing the attacker 's apps uploaded to Google Play , etc 
The right panel lists all information stolen from the victim 's device 
In this screenshot , the victim's installed app list , clipboard , a photo taken from the back camera , an audio clip , and a video clip have been uploaded , with the GPS location intercepted from the ad library 
The panel also pins down the GPS location of the victim's device onto a Google Map widget 
As noted by Google : '' Use of this method in a WebView containing untrusted content could allow an attacker to manipulate the host application in unintended ways , executing Java code with the permissions of the host application 
'' In particular , if an app running on Android API 16 or below uses the JavaScript binding method addJavascriptInterface and loads the content in the WebView over HTTP , an attacker over the network could hijack the HTTP traffic ( e.g. , through WiFi or DNS hijacking ) to inject malicious content into the WebView and to control the host application 
Listing 1 is a sample Javascript snippet to execute shell command 
If an app containing such vulnerability has sensitive Android permissions such as access to the camera , a remote attacker could exploit it to perform sensitive tasks such as taking photos or recording video , over the Internet , without consent 
However , if an ad library uses the @ JavascriptInterface annotation to expose security-sensitive interfaces , and uses HTTP to load content in the WebView , it is vulnerable to attacks where an attacker over the network could inject malicious content into the WebView to misuse the interfaces exposed through the JS binding annotation 
Given that this ad library loads ads using HTTP , if the host app has the corresponding permissions ( e.g. , CALL PHONE ) , attackers over the network can abuse these interfaces to do malicious things ( e.g. , utilizing the makeCall interface to dial phone numbers without the user 's consent ) 
If the attackers can hijack the communication channels and inject malicious DEX files , they can then control the behaviors of the victim apps 
After getting local access , the attacker can upload private and sensitive files from the victim 's device , or modify files that the host app can write to ( e.g. , the directory of the host app and SD Card with FAT file system ) 
To launch more sophisticated attacks like sending SMS or taking pictures , the attackers may use Java reflection to call other APIs from the Javascript bridge 
One direct threat posed by JBOH is to use the JBOH shell ( Listing 1 ) to download exe- cutables and use them to root the device 
Thus , as long as attackers can get the JBOH shell , they have the tools to obtain root on most Android phone models 
Even if the attackers ca n't obtain root , they can attempt ptrace to control the host app 
A simple call does the job , as shown in Listing 2 To make calls from the Javascript bridge without user consent , we can invoke the telephony service to dial numbers directly via binder , as shown in Listing 3 , where phone is the remote Android telephony service and the number 2 represents the second remote call 
As shown in Listing 5 , an attacker can load executables compiled from JNI code 
Once loaded , the code can obtain context as described in Listing 4 , or call DexClassLoaderload to inject new classes from the attackers ' DEX files to register callbacks to take pictures/ record videos 
With the Android context , an attacker can monitor or tamper with the clipboard 
Malicious apps can steal the passwords if they can read the contents on clipboard 
Any UID has the capability to manipulate clipboard via the API calls in Listing 6 : Using these APIs , the attackers can monitor changes to a clipboard and transfer the clipboard contents to some remote server 
They can also alter the clipboard content to achieve phishing goals 
For example , the user may copy a link to visit and the background malicious service can change that link to a phishing site 
For example , the attackers can manipulate Android home screen icons using two normal permissions : launcher READ SETTINGS and WRITE SETTINGS permissions 
As a proof-of-concept attack scenario , a malicious app with these two permissions can query/insert/ alter the system icon settings and modify legitimate icons of some security- sensitive apps , such as banking apps , to a phishing website 
With both the GET ACCOUNTS and the USE CREDENTIALS permissions , Android pro- cesses can get secret tokens of services ( e.g. , Google services ) from the AccountManager and use them to authenticate to these services 
We verified that Android apps with these two permissions can authenticate themselves with the user 's Google account , allowing access to Google Play and the ability send app installation requests 
Through the Javascript bridge , attackers can install apps of choice ( e.g. , an attacker 's phishing app ) to any devices registered in user 's account in the background without user consent 
Combined with the launcher modification attack introduced earlier , the attackers can redirect other app icons ( e.g. , bank or email app icons ) to the phishing app and steal the user 's login credentials 
In this section , we explain the risks of victims ' devices being tracked and targeted through ad traffic 
Though ad libraries may not have the incentive to abuse users ' private and sensitive data , this is not the case with the attackers eavesdropping or hijacking the HTTP traffic 
We successfully launched Man-in-the- Middle ( MITM ) attacks and intercepted the data uploaded to the remote server 
However , with this information , an attacker can precisely locate the victim and acquire the device 's specifications 
Unfortunately , several well-known attacks can be used to achieve large-scale monitoring , including DNS hijacking , BGP hijacking , and ARP hijacking in IDC 
In this context , DNS hijacking is done to subvert the resolution of Domain Name System ( DNS ) queries through modifying the behavior of DNS servers so that they serve fake DNS information 
Attackers successfully compromised many DNS servers , including the ones from Google and Godaddy 
By DNS hijacking , attackers can effectively access all the traffic to ad servers 
BGP hijacking takes over groups of IP addresses , corrupting Internet routing tables by breaking BGP sessions or injecting fake BGP information 
This enables attackers to monitor all traffic to specific IPs 
ARP hijacking ( or spoofing ) in IDC is done to hijack the traffic to the ad server in the IDC where the ad server locates through fake ARP packets 
Attackers may rent servers close to the target servers , and use fake ARP packets to direct all the traffic to go through the hijacking servers first for monitoring and hijacking 
ARP hijacking is a well-known approach used in network attacks 
Using the large-scale traffic intercepted from the above methods , attackers can iden- tify potential victims based on information leakage such as GPS location described in Sec- tion 4.2 
After that , they can inject exploits only into the targeted traffic to launch further attacks 
Attackers keep a low profile by allowing all other irrelevant network traffic to pass without being modified 
In the current golden age of Android ad libraries , Sidewinder Targeted Attacks can target victims using info leakage and other vulnerabilities of ad libraries to get valuable , sensitive information 
They also need to be cautious about which privileged interfaces are exposed to the ad providers , in case of malicious ads or attackers hijacking the communication channels 
This SMB Worm Tool is equipped with a Listening Implant , Lightweight Backdoor , Proxy Tool , Destructive Hard Drive Tool , and Destructive Target Cleaning Tool 
SMB Worm Tool : This worm uses a brute force authentication attack to propagate via Windows SMB shares 
It connects home every five minutes to send log data back to command and control ( C2 ) infrastructure if it has successfully spread to other Windows hosts via SMB port 445 
The tool also accepts new scan tasking when it connects to C2 
There are two main threads : the first thread calls home and sends back logs ( a list of successful SMB exploitations ) , and the second thread attempts to guess passwords for SMB connections 
If the password is correctly guessed , a file share is established and file is copied and run on the newly-infected host 
'' Additionally , this implant listens for connections on TCP port 195 ( for '' sensvc.exe '' and '' msensvc.exe '' ) and TCP port 444 ( for '' netcfg.dll '' ) 
Each message sent to and from this implant is preceded with its length , then XOR encoded with the byte 0x1F 
Upon initial connection , the victim sends the string , '' HTTP/1.1 GET /dns ? \x00 
'' The controller then responds with the string '' 200 www.yahoo.com ! \x00 '' ( for '' sensvc.exe '' and '' msensvc.exe '' ) or with the string '' RESPONSE 200 OK ! ! '' ( for '' netcfg.dll '' ) 
The controller sends the byte '' ! '' ( 0x21 ) to end the network connection 
Lightweight Backdoor : This is a backdoor listener that is designed as a service DLL 
It includes functionality such as file transfer , system survey , process manipulation , file time matching and proxy capability 
The listener can also perform arbitrary code execution and execute commands on the command line 
This tool includes functionality to open ports in a victim host 's firewall and take advantage of universal Plug and Play ( UPNP ) mechanisms to discover routers and gateway devices , and add port mappings , allowing inbound connections to victim hosts on Network Address Translated ( NAT ) private networks 
Proxy Tool : Implants in this malware family are typically loaded via a dropper installed as a service , then configured to listen on TCP port 443 
This proxy tool has basic backdoor functionality , including the ability to fingerprint the victim machine , run remote commands , perform directory listings , perform process listings , and transfer files 
Destructive Hard Drive Tool : This tool is a tailored hard-drive wiping tool that is intended to destroy data past the point of recovery and to complicate the victim machine 's recovery 
If the CNE operator has administrator-level privileges on the host , the program will over-write portions of up-to the first four physical drives attached , and over-write the master boot record ( MBR ) with a program designed to cause further damage if the hard drive is re-booted 
This further results in the victim machine being non-operational with irrecoverable data 
( There is a caveat for machines installed with the windows 7 operating system : windows 7 machines will continue to operate in a degraded state with the targeted files destroyed until after reboot , in which the infected MBR then wipes the drive 
) If the actor has user-level access , the result includes specific files being deleted and practically irrecoverable , but the victim machine would remain usable 
Destructive Target Cleaning Tool : This tool renders victim machines inoperable by overwriting the Master Boot Record 
The tool is dropped and installed by another executable and consists of three parts : an executable and a dll which contain the destructive components , and an encoded command file that contains the actual destruction commands to be executed 
Network Propagation Wiper : The malware has the ability to propagate throughout the target network via built-in Windows shares 
Based on the username/password provided in the configuration file and the hostname/IP address of target systems , the malware will access remote network shares in order to upload a copy of the wiper and begin the wiping process on these remote systems 
The malware uses several methods to access shares on the remote systems to begin wiping files 
Checking for existing shares via '' \\hostname\admin $ \system32 '' and '' \\hostname\shared $ \system32 '' or create a new share '' cmd.exe /q /c net share shared $ = % SystemRoot % /GRANT : everyone , FULL '' 
Once successful , the malware uploads a copy of the wiper file '' taskhostXX.exe '' , changes the file-time to match that of the built-in file '' calc.exe '' , and starts the remote process 
The remote process is started via the command '' cmd.exe /c wmic.exe /node : hostname /user : username /password : pass PROCESS CALL CREATE '' 
Afterwards , the remote network share is removed via '' cmd.exe /q /c net share shared $ /delete '' 
Once the wiper has been uploaded , the malware reports its status back to one of the four C2 IP addresses 
This tool contains five components – a listening implant , lightweight backdoor , proxy tool , destructive hard drive tool , and destructive target cleaning tool 
The SMB worm propagates throughout an infected network via brute-force authentication attacks , and connects to a C2 infrastructure 
This file serves as a dropper 
It drops destructive malware : '' igfxtrayex.exe '' 
When the dropper file was executed , it started a second instance of itself with '' -i '' as an argument , and then terminated 
The second instance of the dropper file installed itself as the '' WinsSchMgmt '' service with '' -k '' as a command line argument , started the service , and then terminated 
The '' WinsSchMgmt '' service executed the file with '' -k '' as an argument , which started another instance of the file using '' -s '' as an argument 
The '' -s '' instance dropped and executed '' igfxtrayex.exe '' , created '' netver.dat '' , and began generating network traffic over TCP ports 445 and 139 to victim IP addresses 
This is a log file created by the dropper , and appended to as the scans progress 
This file is destructive malware : a disk wiper with network beacon capabilities 
If '' igfxtrayex.exe '' is run with no parameters , it creates and starts a copy of itself with the '' –i '' argument 
After 10 minutes , the '' igfxtrayex.exe '' makes three copies of itself and places them in the same directory from which it was executed 
These copies are then executed , each with a different argument ( one being '' -m '' , one being '' -d '' and the other '' -w '' ) 
Network connection attempts are made to one of three hard-coded IP addresses in a random order to port 8080 or 8000 
If a connection to the IP address can not be made , it attempts to connect to another of the three IP addresses , until connections to all three IP addresses have been attempted 
A 120-minute ( 2 hour ) sleep command is issued after which the computer is shut down and rebooted 
This file , when executed , starts a listener on localhost port 80 
It has 3 files contained in the resource section ; all xor 'd with 0x63 
It is dropped from resource ID 0x81 of '' igfxtrayex.exe '' 
It is dropped from resource ID 0x83 of '' igfxtrayex.exe '' 
Furthermore , the attackers also shared a C & C domain 
The latest version of ComRAT known to us ( v3.26 ) uses a new key and does not create the installation log file , in order to complicate the analysis and to disguise the link between the two cases 
Another very interesting fact : the attackers use COM Object hijacking , the same persistence mechanism as COMpfun , which we described recently 
The first task of the malware is to install the file credprov.tlb in % APPDATA % \Microsoft\ 
The dropper executes the following command in order to install a second file : The second file is shdocw.tlp 
To be started during the boot process of the infected machine , the malware creates the following registry key : This registry key is used to associate the library shdocvw.tlp to the object 42aedc87-2188-41fd-b9a3-0c966feabec1 as previously explained in the article about COMpfun 
The purpose is to load the library into each and every process executed on the infected system 
If the version of the malware is older than 3.26 , the dropper creates an additional file called winview.ocx 
The file is xored with the following obfuscation key ( used by both , Uroburos and Agent.BTZ ) : Here is the decoded log file content : We can notice that the malware checks if an older version is installed on the system and if this is the case , the dropper removes the older version 
In contrast to this , in our Uroburos analysis , we found out that Uroburos does not install itself in case a version of Agent.BTZ was found on a system 
During the startup of the infected machine , the shdocvw.tlp library is loaded into all processes 
If the process is explorer.exe , this library will load the other library called credprov.tlb 
Its features are common for a Remote Administration Tool ( RAT ) : ComRAT 's communication to the command and control server is performed by the browser process and not by explorer.exe in order to avoid being blocked by a firewall on the system or any additional security products 
The communication between the processes is performed by named pipe 
Two log files are created during the malware execution : mskfp32.ocx and msvcrtd.tlb 
The command and control server information is stored in the registry , not in an XML , and encoded : For example , in the analyzed sample the CC is : weather-online.hopto.org 
If the malware version in lower than 3.26 , the XML log file contains the command and control server information : Let us summarize the similarities and differences between Agent.BTZ , Uroburos and ComRAT as far as we can : Some parts of the code are exactly the same ( appears to be copy & paste ) 
Command and control server domains are shared between Uroburos and ComRAT 
Agent.BTZ is a common RAT , a simple library executed on an infected machine 
The malware is loaded into each and every process of the infected machine and the main part ( payload ) of the malware is only executed in explorer.exe 
Furthermore , the C & C communication blends into the usual browser traffic and the malware communicates to the browser by named pipe 
We suspect that this date is spoofed in order to disguise that this is in fact a newer version 
The report illuminates a wide set of tools in use by the actors , including several Remote Access Tools ( RATs ) 
The RATs are used by the PUTTER PANDA actors to conduct intelligence-gathering operations with a significant focus on the space technology sector 
This toolset provides a wide degree of control over a victim system and can provide the opportunity to deploy additional tools at will 
They focus their exploits against popular productivity applications such as Adobe Reader and Microsoft Office to deploy custom malware through targeted email attacks 
➔ They focus their exploits against popular productivity applications such as Adobe Reader and Microsoft Office to deploy custom malware through targeted email attacks 
Although some of the domains used for command and control of the tools described later in this report appear to be legitimate sites that have been compromised in some way , many of them appear to have been originally registered by the operators 
These are shown in Table 3 , and may be used for command and control of PUTTER PANDA tools 
Several RATs are used by PUTTER PANDA 
Two droppers have been associated with the PUTTER PANDA toolset ; these are also briefly examined below 
The operation of this RAT is described in detail in other CrowdStrike reporting , but is useful to revisit here to highlight the characteristics of the RAT : • C2 occurs over HTTP , after connectivity has been verified by making a distinctive request ( to the URI / search ? qu= at www.google.com ) 
• A victim identifier is generated from the infected machine 's hard disk serial number , XOR'ed with the key ldd46 ! yo , and finally nibble-wise encoded as upper-case ASCII characters in the range ( A-P ) – e.g. , the byte value 0x1F becomes '' BP '' 
• A series of HTTP requests characterizes the RAT 's C2 
The initial beacon uses a request with four parameters ( h1 , h2 , h3 , and h4 ) – as shown in Figure 8 – to register the implant with the C2 server 
• Communication to and from the C2 server is obfuscated using a 1-byte XOR with the key 0xBE 
• The commands supported by the RAT enable several capabilities , including : The 3PARA RAT was described in some detail in other CrowdStrike reporting , which examined a DLL-based sample with an exported filename of ssdpsvc.dll 
On startup , the RAT attempts to create a file mapping named & *SDKJfhksdf89*DIUKJDSF & *sdfsdf78sdfsdf 
This is used to prevent multiple instances of the RAT being executed simultaneously 
The RAT will then use a byte-wise subtraction- based algorithm ( using a hard-coded modulo value ) to decode C2 server details consisting of a server hostname and port number , in this example nsc.adomhn 
com , port 80 
Several threads are used to handle different stages of the C2 protocol , such as receiving data from the server , decrypting data , and processing commands 
Once running , the RAT will load a binary representation of a date/time value from a file C : \RECYCLER\restore.dat , and it will sleep until after this date/time has passed 
Database provides a mechanism for the operators to allow the RAT to remain dormant until a fixed time , perhaps to allow a means of regaining access if other parts of their toolset are removed from a victim system 
As with the 4H RAT , the C2 protocol used by the 3PARA RAT is HTTP based , using both GET and POST requests 
An initial request is made to the C2 server ( illustrated in Figure 11 above ) , but the response value is effectively ignored ; it is likely that this request serves only as a connectivity check , as further C2 activity will only occur if this first request is successful 
In this case , the RAT will transmit some basic victim information to the C2 server along with a 256-byte hash of the hard-coded string HYF54 & % 9 & jkMCXuiS 
It is likely that this request functions as a means to authenticate the RAT to the C2 server and register a new victim machine with the controller 
If this request is also successful , the RAT will attempt to retrieve tasking from the controller using a further distinctive HTTP request shown in Figure 13 , repeating this request every two seconds until valid tasking is returned 
Output data produced by tasking instructions is encrypted in the same manner as it was decrypted and sent back to the C2 server via HTTP POST request to a URI of the form /microsoft/errorpost/ default.aspx ? ID= , where the ID value is a random number in decimal representation – as with the initial request shown in Figure 4 
The set of commands supported by the RAT is somewhat limited , indicating that perhaps the RAT is intended to be used as a second-stage tool , or as a failsafe means for the attackers to regain basic access to a compromised system ( which is consistent with its support for sleeping until a certain date/time ) 
Initially , the malware will perform a connectivity check to a hard-coded URL ( http : //www.microsoft.com ) , using a constant user agent Mozilla/4.0 ( Compatible ; MSIE 6.0 ; ) 
If this request fails , the malware will attempt to extract proxy details and credentials from Windows Protected Storage , and from the IE Credentials Store using publicly known methods15 , using the proxy credentials for subsequent requests if they enable outbound HTTP access 
An initial request is then made to the hard-coded C2 server and initial URI – forming a URL of the form ( in this sample ) http : //login.stream-media.net/files/xx11/index.asp ? 95027775 , where the numerical parameter represents a random integer 
The malware will then attempt to download content from the specified URL to the filename within the user 's temporary directory , and then execute this file via the WinExec API 
If this execution attempt succeeds , a final C2 request will be made – in this case to a URL using the same path as the initial request ( and a similarly random parameter ) , but with a filename of success.asp 
Finally , the malware will delete the content saved from the first request , and exit 
The limited functionality , and lack of persistence of this tool , implies that it is used only as a simple download- and-execute utility 
Like pngdowner , the httpclient malware is a simple tool that provides a limited range of functionality and uses HTTP for its C2 channel 
This malware also initially performs a connectivity check to www.microsoft.com using the hard-coded user agent Mozilla/4.0 ( Compatible ; MSIE 6.0 ; ) , although in this variant no attempt is made to extract proxy credentials 
The malware will then connect to its configured C2 infrastructure ( file.anyoffice.info ) and perform a HTTP request of the form shown in Figure 14 below : Content returned from the C2 server is deobfuscated by XOR'ing the content with a single byte , 0x12 
If this string is not present , the C2 request is repeated every 0.5 seconds 
Otherwise , a shell process is started ( i.e. , cmd.exe ) , with input/output redirected over the C2 channel 
If the session is ended , two other commands are supported : m2b ( upload file ) and b2m ( download file ) 
Other CrowdStrike reporting describes a dropper used by PUTTER PANDA ( abc.scr ) to install the 4H RAT 
This dropper uses RC4 to decrypt an embedded payload from data in an embedded resource before writing the payload to disk and executing it 
Another dropper has been observed , exclusively installing the pngdowner malware ( example MD5 hash 4c50457c35e2033b3a03fcbb4adac7b7 ) 
The executable and DLL are both contained within the .data section of the dropper , obfuscated with a 16-byte XOR key ( consisting of the bytes 0xA0 – 0xAF ) 
Both the document and executable are written to disk and the executed via the ShellExecute API ( using the verb '' open '' ) 
The executable is also installed into the ASEP registry key HKCU\Software\Microsoft\Windows\ CurrentVersion\Run , with a value named McUpdate 
Finally , the dropper deletes itself via a batch file 
The dropped executable ( MD5 hash 38a2a6782e1af29ca8cb691cf0d29a0d ) primarily aims to inject the specified DLL ( McUpdate.dll , MD5 hash 08c7b5501df060ccfc3aa5c8c41b452f ) into a process that would normally be accessing the network , likely in order to disguise the malicious activity 
If Internet Explorer is used , then the malware will attempt to terminate processes corresponding to two components of Sophos Anti-Virus ( SAVAdminService.exe and SavService.exe ) 
Four examples of these droppers were located , using a mixture of decoy PDF and Microsoft Word documents ( shown below in Figures 15-18 ) 
Although some of their tools are simplistic , taken as a whole their toolset provides a wide degree of control over a victim system and can provide the opportunity to deploy additional tools at will 
Among other items , staff training documents and more than 40,000 emails were stored on the machine and thought to be harvested by the attacker 
The attack appears to have been the result of the attackers having compromised the 'GOM Player ' update server and having it act as a 'watering hole ' , meaning that machines which access the site are delivered malware 
Technical analysis of the implant on the compromised machine has shown it to be a variant of a Trojan which has been in the wild for some years now and continues to be effective 
Based on open source reporting , it appears that the intrusion took place via the compromise of the GOM Player update server ( app.gomlab.com ) , where attackers may have gained entry via a PHP-based webshell , hidden within an image , present on the host since October 2011 
The observed malicious activity relates to the modification of a file that controls GOM Player updates , spanning the date range 27th December 2013 to 16th January 2014 , during which time these alterations are reported to have only manifested themselves for visitors on certain IP ranges ; evidence supporting this claim has not yet been made public 
The modified file redirected the GOM Player update process to another compromised server ( www.fudousankaitori.jp ( 203.189.101.35 ) ) , where a file containing both the legitimate update and the malware was deliver to the victim 
Deployed to the system via a compressed bundle containing the official GOM Player setup binary and a self-extracting RAR archive containing the malicious files , the malware consists of a number of individual pieces 
Upon extraction from the RAR archive , the installer component ( 0ae82fd94836815a1e8d284ccb75109d ) is automatically launched alongside the GOM Player update , distracting victims from the malicious activity taking place 
The installer component is referred to by the author as 'miansha ' which , according to an East Asia Cyber Threat Intelligence Researcher , is likely Miǎnshā ( 免杀 ) , a phrase commonly used by People 's Republic of China ( PRC ) hackers to mean 'anti Antivirus detection ' or 'Antivirus avoidance ' ; Symantec have named the detection for this code 'Backdoor.Miancha ' , where Miǎnchá ( 免查 , likely shorthand for 免杀查 ) similarly means 'Antivirus avoidance ' 
The installer is responsible for the malware persistence mechanism , adding entries to the registry in the following locations , depending on Windows Version : The installer will also determine the system architecture ( 32- or 64-bit ) and then deobfuscate the relevant loader DLL to the path 'C : \Windows\temp\install.ocx ' , ensuring the malware is launched on system start-up 
The main implant code is stored in files named instructions.pdf and instructions64.pdf ; not PDF documents but instead DLLs obfuscated with a one-byte XOR with 0x14 , similar to the malware loader DLLs 
The loader , referred to by the malware author as 壳 ( shell ) , reads and deobfuscates the main implant code which then communicates with the attacker-controlled server at testqweasd.tk ( 211.43.220.89 ) on TCP port 443 
The main implant code is referred to as 白加黑 ( 'Black on White ' ) , a term used in the PRC hacking community to denote the act of Antivirus avoidance through the loading of malicious 'black ' code via non-malicious or trusted 'white ' code 
This is a practice recently illustrated through the deployment of the PlugX trojan , utilising DLL load order hijacking alongside a signed ( trusted ) executable 
This specific variant shows similarities to that used during the VOHO campaign , where Gh0st RAT was spread via watering hole attacks utilising vulnerable websites belonging to financial services and technology companies 
In addition to delivering system-specific details back to the attacker , Gh0st RAT provides the capability to deploy additional malware , enabling the harvesting of sensitive data and enabling the further propagation throughout the infected network 
This section describes a highly targeted attack sent to an e-mail address belonging to RSS 
The attack took the form of an unsolicited e-mail containing a download link to a decoy file 
The file contained custom malware that profiled the victim 's computer and beaconed its IP address to an e-mail account under the attacker 's control 
The unsolicited message below was sent to RSS at the end of November 2014 from a Gmail email address 
However , we note that the attacker also attempts to social engineer the identity of individuals working with RSS , by requesting a personal Facebook page 
The custom malware used in this attack infects a user who views the decoy '' slideshow , '' and beacons home with the IP address of the victim 's computer and details about his or her system each time the computer restarts 
Unlike Syrian regime-linked malware , it contains no Remote Access Trojan ( RAT ) functionality , suggesting it is intended for identifying and locating a target 
Further , because the malware sends data captured by the malware to an e-mail address , it does not require that the attackers maintain a command-and-control server online 
Examples of images in the slideshow as follows : When opened , the '' slideshow.zip '' file writes and executes several files : '' AdobeR1.exe '' is malicious , while '' pictures.exe '' is the genuine slideshow displayed to the victim 
When the slideshow is closed both AdobeR1.exe and pictures.exe are deleted 
The AdobeR1 file writes a series of executable files that perform information collection and communication functions , including : The program sequence of data collection and sending is somewhat unusual , with each program performing a single task and communicating via markers left in the registry 
First , the program nvidrv adds itself to autorun : It also creates a series of registry keys that the individual programs use to communicate : Registry keys and programs using them : It then runs GooglUpd , which cleans up the program files if they exist , and runs AdbrRader 
AdbrRader ( communicating through registry key '' 2 '' ) writes the file vgadmysadm.tmp with the name of another registry key '' 2 '' with startup info 
Next , nvidrv runs GoogleUpate , which collects system information and writes it to : Then nvidrv runs nvisdvr ( registry key '' 4 '' ) that collects a list of running processes , which are written to : Finally , nvidrv runs svhosts , which tests Internet connectivity by doing a DNS query for windowsupdate.microsoft.com 
It then runs rundl132 if it has not before , by checking whether registry key name '' 6 '' is present 
It sets the key to '' 0 '' and runs it 
Next , '' rundl132.exe '' performs an HTTP GET request to myexternalip.com and collects the external IP of the infected machine : Next , rundl132 writes : Then rundl132 writes the external IP to : Finally , rundl132 runs AdobeIns , which zips the contents of the win32.tmp folder 
Program '' AdobeIns.exe '' takes the files written by the other programs and zips them in an encrypted , password- protected file : Data is transmitted by e-mail to an account presumably controlled by the attacker 
AdobeIns connects to an account at the online e-mail provider inbox.com via smtp using hardcoded credentials 
The malware then sends an e-mail to the same inbox containing the text '' Hello '' and with mxtd file attached 
SMTP traffic generated by the malware to inbox.com ( with redactions ) The malware seen in this case study is unusual as it relies on a half-dozen separate executable files , each with a single task , and each communicating via markers dropped in the Registry 
The malware is also interesting because it does not provide remote access , but only sends an e-mail containing the victim 's IP address and miscellaneous system information 
The malware resends the information each time the computer is restarted , but it does not refresh the sent information on restart ( which may be a bug ) 
This behaviour strongly suggests that the function of this malware is to serve as a beacon 
The system information could be used to identify processes to exploit in the future , however since the attacker has already triggered the execution of a file on the victim 's system , it is surprising that more was not taken , or that a RAT ( custom or widely available ) was not used 
A RAT would have provided much greater access alongside IP information By not providing remote access and other RAT functionality , the program looks less like malware , and may attract less attention from endpoint protection tools and scanners 
It registered only 6/55 detections by anti virus scanners , or a 10 % detection rate 
Transmitting the malware via e-mail also provides a degree of obscurity , and has the additional advantage of providing a layer of abstraction between the attacker and the target : there is no need to maintain a RAT command-and-control server 
The malware transmits autonomously , leaving the material in an inbox for the attacker to collect at a later time 
Nevertheless , we believe that the author of the program is aware of certain techniques to reduce the visibility of malware on a network , including transmitting data via encrypted e-mail communications 
In addition , the malware uses the old PKWARE implementation of zip encryption , which is not particularly secure 
This attack , which has little technical sophistication ( i.e. , it uses no exploits , code obfuscation , or techniques to frustrate reversing , etc 
) , nevertheless has carefully developed social engineering in the seeding materials and bait document 
Although targeted , the malware seeding often aims at classes of people ( e.g. , people interested in 'shocking ' news about a fighter , or 'leaked ' information about the Assad regime ) rather than carefully written spear phishing targeting a single individual or small group 
Use of widely available RATs ( njRAT , Xtreme Rat , ShadowTech Rat , DarkComet RAT , and Blackshades RAT , among others ) 
At least one command-and-control server located within Syrian IP space ( often from a limited range of addresses ) 
Use of '' crypters '' to obscure the binary 
Not only is it exceptionally targeted , but it is also not a commonly available RAT 
The function of the malware appears to be : identify and unmask the IP address of target ( s ) , and resend them to the attacker with each reboot 
In addition , data is sent to an Internet e-mail address , and no crypter is used to obscure the binary 
We are aware of only one previous case in Syria in which e-mail was used to transmit data , and that we believed was regime linked 
That incident , observed in 2012 , also used hardcoded e-mail to exfiltrate 
However , that malware had substantially more functionality than this case : not only did it drop a second stage from a compromised site , but was also included a mechanism for exfiltrating credentials from Facebook and hooking programs like Skype 
For example : The malware beacons location but does not provide RAT functionality 
The seeding attempts to obtain a 'private ' Facebook identity from RSS through social engineering 
The malware exfiltrates to an online e-mail account , thus not requiring the attacker to maintain a command-and- control server online 
This attack was exceptionally targeted , and clearly reflected the work of an actor familiar with the operations of the targeted organization 
Regin is an extremely complex piece of software that can be customized with a wide range of different capabilities which can be deployed depending on the target 
It is built on a framework that is designed to sustain long-term intelligence-gathering operations by remaining under the radar 
It goes to extraordinary lengths to conceal itself and its activities on compromised computers 
The main purpose of Regin is intelligence gathering and it has been implicated in data collection operations against government organizations , infrastructure operators , businesses , academics , and private individuals 
The modular design also makes analysis of the threat difficult , as all components must be available in order to fully understand it 
APTs typically seek specific information , usually intellectual property 
It is used for the collection of data and continuous monitoring of targeted organizations or individuals 
Regin has a wide range of standard capabilities , particularly around monitoring targets and stealing data 
Regin is capable of installing a large number of additional payloads , some highly customized for the targeted computer 
The threat 's standard capabilities include several remote access Trojan ( RAT ) features , such as capturing screenshots and taking control of the mouse 's point-and-click functions 
Regin is also configured to steal passwords , monitor network traffic , and gather information on processes and memory utilization 
It can also scan for deleted files on an infected computer and retrieve them 
For example , one module was designed to monitor network traffic to Microsoft Internet Information Services ( IIS ) web servers , another was designed to collect administration traffic for mobile telephony base station controllers , while another was created specifically for parsing mail from Exchange databases 
Regin goes to some lengths to hide the data it is stealing 
Valuable target data is often not written to disk 
Targets may be tricked into visiting spoofed versions of well- known websites and the threat may be installed through a web browser or by exploiting an application 
On one computer , log files show that Regin originated from Yahoo ! Instant Messenger through an unconfirmed exploit 
The initial stages involve the installation and configuration of the threat 's internal services 
All other stages are stored as encrypted data blobs , as a file or within a non-traditional file storage area such as the registry , extended attributes , or raw sectors at the end of disk 
Symantec believes that once the dropper is executed on the target 's computer , it will install and execute Stage 1 
It 's likely that Stage 0 is responsible for setting up various extended attributes and/or registry keys and values that hold encoded versions of stages 2 , 3 , and potentially stages 4 and onwards 
Stage 1 is the initial load point for the threat 
There are two known Stage 1 file names : These are kernel drivers that load and execute Stage 2 
These kernel drivers may be registered as a system service or may have an associated registry key to load the driver while the computer is starting up 
Stage 1 simply reads and executes Stage 2 from a set of NTFS extended attributes 
If no extended attributes are found , Stage 2 is executed from a set of registry keys 
Stage 2 is a kernel driver that simply extracts , installs and runs Stage 3 
Stage 2 is not stored in the traditional file system , but is encrypted within an extended attribute or a registry key blob 
Stage 2 can be found encrypted in : This stage can also hide running instances of Stage 1 
Similar to previous stages , Stage 2 finds and loads an encrypted version of Stage 3 from either NTFS extended attributes or a registry key blob 
Stage 2 can also monitor the state of the threat 
This stage drops the file msrdc64.dat , which appears to always be 512 bytes in size 
Instead , this file is encrypted within an extended attribute or registry key blob 
In addition to loading and executing Stage 4 , Stage 3 offers a framework for the higher level stages 
The files for Stage 4 , which are loaded by Stage 3 , consist of a user-mode orchestrator and multiple kernel payload modules 
When the attackers who operated Regin cleaned up compromised computers once they were finished with them , they often failed to remove Stage 4 and 5 artifacts from the system 
The files for Stage 5 are injected into services.exe by Stage 4 
Example payload functionality seen to date includes : Regin stores data files and payloads on disk in encrypted virtual file system files 
Files stored inside EVFS containers are encrypted with a variant of RC5 , using 64-bit blocks and 20 rounds 
The encryption mode is reverse cipher feedback ( CFB ) 
As explained above , the files are encrypted 
Regin 's C & C operations are extensive 
These backchannel operations are bidirectional , which means either the attackers can initiate communications with compromised computers on the border network or the compromised computers can initiate communications with the attacker 
Furthermore , compromised computers can serve as a proxy for other infections and command and control can also happen in a peer-to-peer fashion 
All communications are strongly encrypted and can happen in a two-stage fashion where the attacker may contact a compromised computer using one channel to instruct it to begin communications on a different channel 
Four transport protocols are available for C & C : • ICMP : Payload information can be encoded and embedded in lieu of legitimate ICMP/ping data 
• HTTP : Payload information can be encoded and embedded within cookie data under the names SESSID , SMSWAP , TW , WINKER , TIMESET , LASTVISIT , AST.NETSessionId , PHPSESSID , or phpAdsd 
The C & C operations are undertaken by various modules , including major groups C373h , 19h , 9 , as well as Stage 5 payloads , such as C375h and 1Bh 
Regin logs data to the ApplicationLog.dat file 
This file is not an encrypted container , but it is encrypted and compressed 
Regin can be distributed with various payload modules or receive payload modules after infection 
The IIS web server log stealing module , 27E9h , is an example of a payload module that was installed after the initial infection and was specifically deployed for a particular target 
We also recovered files from infected computers that may or may not be associated with 64-bit Regin , including several variants of svcsstat.exe , a file that aims to retrieve binary data over pipes or sockets and execute the data 
Instead , Stage 1 is a user mode DLL loaded as a Winsock helper when the computer is starting up 
Rather than loading Stage 2 from an NTFS extended attribute , Stage 1 looks for the last partition ( in terms of physical location ) on disk and searches for the payload in the raw sectors in this area of the disk 
Regin is a highly-complex threat which has been used for large-scale data collection or intelligence gathering campaigns 
Here 's an example of a targeted spear-phishing e-mail directed at Uyghur activists in March 2014 
The e-mail has two attachments , a non-malicious JPG file and a 373 KB Microsoft Word .DOC file 
If run on a vulnerable version of Microsoft Office , it drops the main module as '' net.exe '' ( detected by Kaspersky Lab products as Trojan-Dropper.Win32.Agent.lifr ) , which in turn installs a number of other files 
The main C & C module is dumped into '' % SystemRoot % \system32\Windowsupdataney.dll '' , ( detected by Kaspersky as Trojan- Spy.Win32.TravNet.qfr ) 
It is registered as a service ( named '' Windowsupdata '' ) through a Windows Batch file named '' DOT.BAT '' ( detected by Kaspersky Lab products as Trojan.BAT.Tiny.b ) : To make sure the malware is n't running multiple times , it uses the mutex '' SD2013 Is Running ! '' to mark its presence in the system 
Other known mutexes used by older and current variants include : The malware configuration file is written to the '' SYSTEM '' folder ( as opposed to SYSTEM32 ) and has a slightly new format compared to '' older '' NetTraveler samples : For the record , here 's what an older NetTraveler config file looks like : Obviously , the developers behind NetTraveler have taken steps to try to hide the malware 's configuration 
The algorithm is as follows : Once decrypted , the new config looks like this : One can easily see the command-and-control ( C & C ) server in the screenshot above , which is '' uyghurinfo [ 
] com '' 
The framework is notable for a number of reasons , including ( but not limited to ) its use of a cloud-based infrastructure for command-and-control and its use of the WebDAV protocol to send instructions and receive exfiltrated information from compromised systems 
Exploitation of vulnerabilities in this file format is leveraged to gain remote access to victim 's computers 
The framework , thus far , has been using the services of a cloud service provider based in Sweden , CloudMe.com , for its main command-and-control infrastructure 
The framework is designed in such a way that all post-infection communication ( i.e 
target surveying , configuration updates , malware updates , and data exfiltration ) can be performed via the cloud service 
Most interaction between attackers and their infrastructure is performed via a convoluted network of router proxies and rented hosts 
They turned out to belong to a highly advanced and professional targeted attack framework , which utilized a complex series of techniques to survey potential targets 
In that particular case we had the actual phishing email , so we knew the apparent recipient – the CEO of a large Russian bank 
This document was presumably obtained by the attackers and repurposed for the attack 
First of all , we have the decoy documents which indicate an interest in : We also have a set of phishing mails , which were targeted at : The shellcode used is a pretty standard variant previously used by a number of campaigns typically operating out of China , but with some minor changes 
The malicious content is stored inside the document in encoded form , and the shellcode decodes and writes this to disk 
Upon successful execution this code drops a Word document and a Visual Basic script 
The Word document is displayed to the user to avoid arousing any suspicion while the script is executed in the background 
Unusual for many exploit campaigns , the names of the dropped files vary ; for example HyHa9AJ.vbs , ewRg.vbs , 0QHdN.vbs , etc 
– clearly randomized in order to avoid detection by name 
This seems adapted from Microsoft example code , like the one found at http : //msdn.microsoft.com/en-us/library/aa387236 ( v=vs.85 ) .aspx When the VBSript is run it drops two files to disk 
This data file turns out to be encrypted using AES-256 
The files will be installed in several locations : These locations will vary some between operating system versions 
The VBScript then sets a startup key in the '' HKCU\Software\Microsoft\Windows\CurrentVersion\Run '' registry path to execute the DLLs at boot time 
Regardless of whether the registry launches the DLL or when another malware executable starts the DLL directly , the DLL is launched using regsrv32.exe with the /s ( silent ) option 
The one above drops ctfmonrc.dll 
When executed it will rebuild the original dll ( 95Num3p3gm.dll , presumably ) , load it from memory and pass over execution 
The polymorphing mechanism also generates , and inserts , unique functions all of which make calls to different floating-point operations – all done just to obfuscate the actual decoding process 
The order , size , and locations of these segments vary from build to build but somewhere near the end of the large function there will be a call to a subfunction that loads the PE image into memory , followed by a call to free the PE image allocation from memory 
This configuration information is used to load the encrypted file into memory and decrypt it 
It is designed as a survey tool 
The PE file gathers system information including OS version , computer name , user name , user group membership , the process it is running in , locale ID 's , as well as system drive and volume information 
All of this is encrypted and then sent to cloud storage via WebDAV 
Additionally , once the resource is established , the malware can transfer files to and from the command and control servers using standard file IO commands 
This allows the attackers to uniquely identify every targeted attack and track how successful each phishing campaign is 
The survey is then uploaded to the server in a specified folder with the generated name 
Files are compressed using a modified LZMA-compression and encrypted using AES cipher-block-chaining ( CBC ) before being uploaded to the cloud server 
The binary also checks a separate folder on the cloud service designated to contain new configuration information 
If such a file is present on the server , the malware downloads the new configuration file then deletes it from the server 
The malware also checks configured subfolders for updates ; and if these are found they will be downloaded , decrypted and used as appropriate 
In this account there was hidden another encrypted configuration file which the malware downloaded and decrypted 
They are lightweight and intended to pull specific survey information from their target 
Instead , when they are executed they are passed a pointer to a function to use for sending data back home 
They are executed in memory only , and once they have completed the memory is freed 
921.bin retrieves several datapoints about the infected machine : Domain info ; a list of running processes with all loaded modules in each ; the list of installed software ; and a complete hardware profile of the target machine 
922.bin compiles a dirwalk – a complete listing of every file path – of each fixed drive 
All of this information is exfiltrated back via the same WebDAV connection 
As with other plugins , these are downloaded and deleted from the share in one go 
It seems that because the plugins exist in memory only , they are injected daily to ensure persistence on victim computers 
Our theory is that this malware is a more typical datastealer , and we have observed that after this type of file is planted on the account , encrypted data uploads from compromised users increase 
Victims of this attack will connect using the Windows WebDAV redirector , and the HTTP request user-agent string will reflect this 
Common across multiple accounts , multiple IP 's , and over time , is that the probable attackers have used a HTTP user-agent of '' davfs2/1.4.6 neon/0.29.6 '' 
It is believed that the attackers were able to compromise these devices based on poor configurations or default credentials 
tail- serves as a SOCKS proxy for the attackers 
Upon execution the binary uses its hardcoded key to decrypt the configuration section and retrieve the listening port to use for incoming connections 
This means that the attackers must maintain a list of where each of these implants are installed , as well as what port and key each is configured to use 
Once received the malware would attempt to connect to the domain name on the specified port and would start tunneling all traffic received from the SOCKSS port to the destination and vise-versa 
The communication between the attacker and the SOCKSS is encoded using the RC4 key 
We identified four IP addresses that connected to the proxy malware : This host belongs to a Bulgarian VPS service and would use the router proxy to connect to webdav.cloudme.com 
This host does all scanning of webdav shares for stolen user data , and also uploads new malware components 
Traffic from this IP had a very specific purpose : It unlocked routers for proxying in connection with the sending of phishing emails 
In the wild we observed this IP connect to our router on the malware management port and specify a SOCKSS proxy port to be opened 
Immediately after , the newly opened port would be connected to by another IP and used to send phishing emails with malicious attachments 
After a router SOCKSS port was opened by Unlocker , this IP would connect to the opened port and tunnel its email traffic through the router 
Mail proxies : Through our router monitoring we identified two mail proxies used by the attackers 
After being proxied though the router , each of these would authenticate with one of the dedicated mail proxies and send out phishing attacks 
The mail proxy would then relay the spearphishing mail as seen below 
This way the attack can be mistaken to come from legitimate businesses and trusted organizations 
In some cases the organization from which the phishing email originates would appear to be a known associate to the target 
The email shown above was one of a number of messages sent to targets in the oil industry 
One of the spearphishing mails we observed coming through the router network was this one , sent to an address under the gov.py ( Government of Paraguay ) domain 
Accessing the link from an Android User-Agent initiated a download of an Android installer package named WhatsAppUpdate.apk 
The apparent main purpose of this malware is to record phone call audio 
Recordings are stored as *.mp4 files , and uploaded to the attackers periodically 
The malware is able to collect a lot of other information , not all of which is actually used : Through the encrypted C & C protocol , the attackers can issue commands and binary updates to the malware 
The HTML source code reveals that the encoded portion is encapsulated in blog-index tags : The three accounts contain different configuration blocks pointing to C & C servers apparently located in Poland , Germany and Russia , respectively 
Using an IOS User-Agent triggered the download of a Debian installer package , WhatsAppUpdate.deb , also 1.2Mb in size 
This application impersonates a Cydia installer , and can only be installed on a jailbroken phone 
Once installed , it may collect These data are encrypted and uploaded to an FTP account which is taken from an encrypted configuration file named /usr/bin/cores 
The application impersonates a settings utility 
This collects : Collected data will be uploaded to a DynDNS domain currently hosted on a US webhosting service 
The encrypted files uploaded to the WebDAV shares come with their InitVectors stored at the end of the file 
The file creation times turned out to be hours after the files themselves were uploaded to the WebDAV share 
On at least two occasions during our surveillance of the Inception framework , the malware downloaded something unexpected and wholly different from what we have discussed until now 
These files were downloaded as encrypted *.bin files from the accounts carter0648 and frogs6352 
When decrypted , these turned out to be dropper packages containing one dropper executable clearly created for the Inception framework , and one other , very different executable 
It is a downloader and remote shell program , designed to connect to a C & C server to interact with the attacker and/or download more malware 
The C & C server in this case is ict32.msname.org 
When connecting to this server , sccm.exe issues the following request : This C & C domain is used by many other malwares related to sccm.exe ; some of which share obvious connections to the Quarian malware family , a known APT intrusion tool 
Inception has the capacity to perform all steps needed for scouting out and exfiltrating data without resorting to traditional hosted command & control 
By using a well-understood APT tool and a known malicious C & C domain name , the attackers permit much clearer attribution 
Then there is the C & C domain used 
Not only is the initial DLL apparently polymorphed using some backend tool – the compile time stamps in the PE header are clearly forged , resources are removed so as not to give away any location information , and import tables are shuffled around , rendering import hashes ( aka imphashes ) useless 
The attackers utilize compromised embedded devices – typically routers- on the Internet as well as multiple dedicated hosting providers and VPN services to mask their identity from the cloud storage provider and others 
The same router botnet is used as a spreading and management platform for attacks on mobile devices as well 
It is also clear that the energy sector is not exempt from the generic attacks that every company faces , such as ransomware that locks PCs or financial Trojans that attempt to steal passwords and credit card details 
These attacks can include nonspecific data breaches where employee or customer records get stolen , as happened to the US Department of Energy in July 2013 
This allows malware to spread into such isolated networks as demonstrated many times by threats such as Stuxnet 
However , sabotage attacks that damage equipment are definitely possible , as has already been demonstrated 
There have already been proof of concept attacks that demonstrate how smart meters could be manipulated to send back false information or report incorrect billing IDs , leading to power theft 
In 2008 , Tom Donahue , a senior Central Intelligence Agency ( CIA ) official told a meeting of utility company representatives that cyberattacks had taken out power equipment in multiple cities outside the United States 
In 2003 the safety monitoring system of the Ohio nuclear power plant apparently went offline for several hours due to a Slammer worm infection 
At the beginning of 2003 a marine terminal in Venezuela was targeted by a sabotage attack 
Details of this attack are scarce and vague , but it seems that during a strike an attacking group managed to get access to the SCADA network of the oil tanker loading machinery and overwrote programmable logic controllers ( PLCs ) with an empty program module 
This halted machinery , preventing oil tankers from loading for eight hour till the unaffected backup code was reinstalled on the PLCs 
The attackers used a Trojan to gain access to the control for the gas pipelines 
As far as we know today , the Stuxnet operation began in November 2005 with the registration of the command and control ( C & C ) servers used in the attacks 
Stuxnet is the first known autonomous threat to target and sabotage industrial control systems to such an extent 
Stuxnet is a sophisticated piece of malware , which uses seven vulnerabilities to spread and infect its targets 
Spreading through infected portable media drives allowed it to also infect networks isolated by air gaps that are unreachable from the Internet 
In addition , it is able to infect Step7 project files , which are used to control Programmable Logic Controllers ( PLCs ) 
This allowed the worm to infect computers whenever the engineer exchanged the project files 
Besides this , it also spread through network shares , a printer spooler vulnerability , an old Windows RPC ( remote procedure calls ) vulnerability and a known password in the WinCC database 
Part of the malware code was signed with stolen digital certificates making it harder to detect by security tools 
To hide its activity even further , Stuxnet executed slightly different infection routines depending on the security software installed on the target 
On the USB drive itself , the malware would hide its own files and even delete itself from it after three successful propagations 
Tricks like these , to make the detection of the malware more difficult , are now frequently used in modern targeted attacks 
The sabotage payload disrupted and partially destroyed the cascaded high frequency gas centrifuges 
The early version of Stuxnet targeted the S7- 417 PLCs and modified its valve settings 
The later version of the threat focused on the S7-315 PLCs , manipulating the spinning frequency of the rotating motors 
The payload would only become active if the fingerprint in the found PLC setup matched a given configuration setup 
To avoid detection by personnel monitoring the human machine interface ( HMI ) of the plant , the threat recorded measurement readings during normal operation and played those back in a loop 
The attacks started in late 2009 and were directed at finding project details and financial information about oil and gas field exploration and bids 
The attackers started by compromising public facing Web servers through SQL injection and installing Web shells on them 
Once they had control over the server they used common hacking tools to harvest local passwords , dump password hashes , sniff authentication messages and exploit internal active directory configuration 
This allowed them to move on to other internal computers using the gathered passwords 
In addition , spear phishing messages were used to compromise additional computers 
On compromised computers a common Backdoor.Trojan was installed that communicated back to the C & C server , allowing remote access to the computer 
This allowed the attacker to find and extract valuable information 
The dropper component is responsible for creating all the required files on the system , registering a service called '' TrkSvr '' in order to start itself with Windows 
It also attempts to copy itself to accessible network shares and execute itself remotely if successfully copied 
The module then drops a legitimate and digitally signed device driver that provides low level disk access from user space 
The malware collects file names and starts overwriting them with a JPEG image or 192KB blocks of random data 
At the end Disttrack finishes the computer off by wiping the master boot record with the same data 
The reporter component is responsible for sending back a HTTP GET request to the C & C server 
It reports the domain name , IP address and number of files overwritten 
By acquiring user credentials and gaining access to the domain controller the attackers were able to push the malware on to many systems before they triggered the destructive payload 
Disttrack 's secondary goal may have been to steal valuable information from infected computers , but the main intent was to render the computers unusable by wiping the operating system and master boot record , causing disruption and downtime at the targeted company 
Although wiping is also frequently used to destroy evidence of the attack and make forensics more difficult 
Spear phishing is , along with watering hole attacks , one of the most common attack vectors used to attack companies 
This is followed by the incursion phase of breaking in and compromising computers 
After that comes the discovery phase , where the attacker gathers passwords and maps the internal network 
The final stage is capture and exfiltration , where the valuable information is copied and sent back to the attacker 
A wave of spear phishing emails were sent from two Freemailer accounts to 291 individuals at the targeted company 
All of the emails contained the same Trojan.Dropper disguised as an attachment with the filename AVP.dll 
The malware itself drops a malicious Downloader '' clbcatq.dll '' into a newly created '' wuauclt '' directory , posing as Windows update and taking advantage of the DLL search order hijack weakness in order to load the malicious code in Windows 
The back door provided full access to the compromised computers 
It is unknown if the attackers successfully retrieved the information they were seeking , if they installed other back door Trojans or gained passwords that allowed them to directly access the computers , or if they have given up on the target 
The spear phishing emails came from 234 spoofed addresses 
They were made to appear to be linked to the company in relation to the subject and attachment chosen 
The emails all contained malicious attachments 
The malware chosen was a variant of the Poison Ivy Trojan Backdoor.Darkmoon and , in some minor cases , Trojan droppers that would download additional malware 
The social engineering messages concentrated mainly around the following two themes : Once installed , the back door would create a registry run key in order to restart with Windows and connect to one of three C & C servers located in Greece 
The last C & C server has been used since 2010 in similar attacks against other companies 
The chosen names of the C & C server domains imitates legitimate services in a bid to be overlooked by the system administrators when checking their logs 
The back door provides full remote access to the compromised computers , allowing for extraction of any data 
As an example , the subject line '' Wage Data 2012 '' was used in 944 emails , sent from 26 different email addresses to targets in nine different sectors 
The attack was carried out over eight days and used the same infected Microsoft Word document in every instance 
The attacker usually compromises the network by delivering targeted malware to vulnerable systems or employees 
One is to send spear phishing emails , where a link to a malicious website or a malicious attachment is delivered using social engineering techniques 
The second method , which is gaining traction , is watering hole attacks , where the attacker infects a website that has a high likelihood of being visited by the intended victim 
By using IP address filters before infecting any visitor of such sites , the attacker can reduce the number of infected systems and bring it to a manageable quantity which can be assessed manually at another time 
Some groups carefully plan watering hole attacks 
A few days later the group resumed the watering hole attack again , this time using a different exploit 
These can be performed either at the same physical location , posing as a genuine Wi-Fi hotspot or through supply chain attacks 
This can enable the attacker to swap an update of legitimate software for a maliciously crafted version 
Once the victim installs the genuine looking update , the attacker effectively gains control over the computer 
Sometimes a regular off-the-shelf back door Trojan is used 
With more specialized teams of attackers , we can often observe that the infected system is first analyzed to ensure that it is of interest to them 
One of the obvious tasks performed by attackers is to install key loggers , dump local credentials , search local storage for saved accounts and sniff the network for passwords 
Often small scripts or even manual commands are used to comb through local files and create network mappings 
Simple system commands can help the attacker to learn about installed security tools , saved links to internal platforms and local address books 
In some instances they might even use zero-day vulnerabilities to spread further into the network 
One method which is gaining more relevance is the hijacking of local software distribution systems for further distribution 
Once the attackers have successfully managed to create and distribute their own package , they can easily infect all connected systems at once 
If the target is assumed to be in a separated network not connected to the Internet , the malware used might try and autonomously infect removable drives , like USB sticks , or project files for PLCs 
This could allow the malware to be manually introduced to the destination network , without the knowledge of the carrier , essentially jumping air gaps into isolated networks 
At the end of the discovery phase the attackers should know the internals of the infected networks and have identified systems with interesting data or with connected industrial control systems 
In this phase the interesting data is gathered and sent back to the attackers 
The simple attacks compress the files and upload them through FTP or through a HTTP POST request to a remote drop server 
More sophisticated attackers obfuscate the data by XOR-ing it , encrypting it with proper asymmetric encryption or embedding it into media files using steganography to hide the data from traffic inspection 
For example , some malware samples will send the data in smaller bursts so as not to swamp the network or generate network spikes that might attract attention 
Since most employees use laptops , the malware can use location awareness to detect if the compromised computer is outside of the corporate network and send the data once it 's directly connected to the Internet , such as from a Wi-Fi hotspot at an airport 
This might allow the traffic to bypass perimeter security and receive less scrutiny 
In such cases , a previously compromised computer in the DMZ can act as a proxy , forwarding all the collected data 
The malware deletes all files on a computer and then deletes the master boot record , rendering the computer unusable 
This report is for the world 's cyber defenders – never give up ! Since at least 2012 , Iranian actors have directly attacked , established persistence in , and extracted highly sensitive materials from the networks of government agencies and major critical infrastructure companies in the following countries : Canada , China , England , France , Germany , India , Israel , Kuwait , Mexico , Pakistan , Qatar , Saudi Arabia , South Korea , Turkey , United Arab Emirates , and the United States 
Operation Cleaver has , over the past several years , conducted a significant global surveillance and infiltration campaign 
To date it has successfully evaded detection by existing security technologies 
Famous examples of these efforts include industrial sabotage via Stuxnet ( 2009 - 2010 ) , and espionage with Duqu ( 2009 - 2011 ) as well as Flame ( 2012 ) 
Stuxnet was an eye-opening event for Iranian authorities , exposing them to the world of physical destruction via electronic means 
These attacks were debilitating and impacted the availability of online banking services 
In May 2014 , evidence emerged of a highly targeted waterhole attack that leveraged social media , dubbed Operation Newscaster , which was uncovered by iSight Partners 
• Assets ( both cyber and physical ) and logistics information were compromised at major airline operators , airports , and transportation companies 
• Confidential critical infrastructure documents were harvested from major educational institutions around the world 
• Initial compromise techniques include SQL injection , web attacks , and creative deception- based attacks – all of which have been implemented in the past by Chinese and Russian hacking teams 
• Pivoting and exploitation techniques leveraged existing public exploits for MS08-067 and Windows privilege escalations , and were coupled with automated , worm-like propagation mechanisms 
• Customized private tools with functions that include ARP poisoning , encryption , credential dumping , ASP.NET shells , web backdoors , process enumeration , WMI querying , HTTP and SMB communications , network interface sniffing , and keystroke logging 
• Private signing certificates of one victim were captured allowing the Operation Cleaver team to compromise the entirety of their organization 
The following is a breakdown by country of which industries were targeted and/or victimized : Cleaver 's level of access into each organization varied greatly , including completely compromised systems and networks , Active Directory domain controllers and credentials , compromised data repositories and stolen VPN credentials 
Compromised systems include Microsoft Windows web servers running IIS and ColdFusion , Apache with PHP , many variants of Microsoft Windows desktops and servers , and Linux servers 
Compromised network infrastructure included Cisco VPNs as well as Cisco switches and routers 
Within our investigation , we had no direct evidence of a successful compromise of specific Industrial Control Systems ( ICS ) or Supervisory Control and Data Acquisition ( SCADA ) networks , but Cleaver did exfiltrate extremely sensitive data from many critical infrastructure companies allowing them to directly affect the systems they run 
This data could enable them , or affiliated organizations , to target and potentially sabotage ICS and SCADA environments with ease 
The attackers targeted research efforts , student information , student housing , and financial aid systems 
The level of access seemed ubiquitous : Active Directory domains were fully compromised , along with entire Cisco Edge switches , routers , and internal networking infrastructure 
Fully compromised VPN credentials meant their entire remote access infrastructure and supply chain was under the control of the Cleaver team , allowing permanent persistence under compromised credentials 
They achieved complete access to airport gates and their security control systems , potentially allowing them to spoof gate credentials 
They gained access to PayPal and Go Daddy credentials allowing them to make fraudulent purchases and allowed unfettered access to the victim 's domains 
Over the course of multiple incident response engagements related to Operation Cleaver , we were able to identify a small set of IP addresses which were commonly used during the initial stages of an attack 
The IP address 78.109.194.114 served as a source for one of the primary attackers 
They were observed conducting SQL injections , controlling backdoors , as well as exfiltrating information using this address , and the address appears in multiple software configurations recovered from staging servers over a period of time 
The IP address 159.253.144.209 was a source for a secondary attacker in various compromises 
They were observed conducting SQL injection attacks 
The creator generates an ASPX web shell using user input as well as a collection of templates 
The web shell could then be installed via xpcmdshell , or any other method which would grant the attacker write access 
We originally located it on a staging server being utilized for multiple attacks as well as a tool for sharing data between members of the organization 's team 
When executed , and before any connection to an instance of the web shell is initiated , the shell client communicates with freegeoip.net in order to get the external IP address of the current user 
Net Crawler is a tool developed in C # that exhibits worm-like behavior in order to gather cached credentials from any and all accessible computers on an infected network 
Many versions were obfuscated with a legitimate tool for developers named SmartAssembly , which makes the recovery of some names implausible 
When executed , it will capture the user 's keystrokes and save them to a location which PVZ bot then exfiltrates 
This log was generated during the usage of the nbrute utility , which brute-forces network credentials and relies on NMAP to do so 
The operators of the blog IranRedLine.org , which comments on Iran 's nuclear weapons efforts , has mentioned in multiple posts having been the target of debilitating brute-force authentication attacks from IP addresses registered to the same Tarh Andishan team found in Cleaver 
The PVZ tool chain includes a variety of functionality , such as HTTP command and control communications with an ASPX server-side component , a denial of service tool they developed , and the public project named XYNTService used to run ordinary applications as services 
Nesha was seen in breaches involving SQL injection as well as other techniques 
Nesha often utilized web-based backdoors developed in ASPX , PHP as well as ColdFusion 
These tools are often support tools , either monitoring the activity of other tools or supplementing the function of other tools gathering information during the infiltration process 
SQL injection is a very common and simple attack method 
SQL injection payloads used by this organization have been double encoded 
Double encoding SQL injection payloads allows for bypassing of various anti-exploitation filters , such as those supplied by Web Application Firewalls ( WAFs ) 
The attackers would enable xpcmdshell : Then connect outbound via anonymous FTP : Using messaging methods such as email , attackers can social engineer users into downloading and executing software , which quietly installs malware alongside of the desired program 
In order to infect users , they combined the original Easy Resume Creator Pro product with malware by using a binder they developed internally named Binder1 
The resulting executable masquerades as the desired software 
The purpose is deception , to make the binder indistinguishable from the desired application 
When executed , both applications are written to a temporary directory and executed 
This way it appears that the desired application was executed , but the malware was also executed silently 
In order to take advantage of this job opportunity , the victim needed to use the fake résumé submission application supplied by the malicious recruiter 
Multiple domains were registered in order to make the download sites seem more realistic 
At this point , the résumé submission application checks the Internet connection 
If it is unable to connect to the Internet , it will display a window to input proxy information 
When this information is entered , the results are cached in a location the dropped malware can access 
After an Internet connection is ensured , the malware ( TinyZbot ) is dropped and executed 
This clever scheme makes sure the malware can connect to the command and control server , and increases the chances that domain credentials are cached on the now infected machine 
Shortly after , the main application is launched 
The first résumé submission form requests contact information 
This form , like the rest of the submission forms , only stores the submitted information while the application is running 
As the infected user is going through and filling out all this information , the malware is running in the background , logging their keystrokes , retrieving their stored passwords , etc 
When the victim hits submit , the résumé submitter does a GET request to microsoft.com in order to make it seem like it is submitting something , then claims success 
Privilege escalation is a category of techniques that describe the process of going from a less privileged user on a compromised computer to a more privileged user 
This increase in privileges allows for the attacker to gain access to privleged areas of the operating system as well as to infect other computers on the target network 
PrivEsc is a compiled exploit , which leverages the vulnerability commonly referred to as KiTrap0D ( CVE-2010-0232 ) 
The exploit allows for escalation of privileges on unpatched Windows operating systems from an unprivileged user to kernel-level privilege 
Pivoting is the process of leveraging access from one compromised computer in order to gain access to additional systems on the target network 
This can involve launching attacks from the compromised computer , or simply abusing access once it has been gained 
A very common method of pivoting on a predominantly Windows operating system based network is to extract domain credentials which have been used on the compromised computer from a credential cache 
There are a few well-known tools which are capable of doing this given sufficient privileges on the infected host 
Two similar applications were developed by Operation Cleaver in order automate the execution of Mimikatz 
When executed , they determine which version of Mimikatz to use based on whether the computer 's version of Windows is 32-bit or 64-bit 
zhMimikatz executes the correct version of Mimikatz for the current system , and parses the results for any cached credentials 
The only external difference is that MimikatzWrapper also logs these results to res.txt in the executing directory 
This can make it useful for tools like the PVZ tool chain and Csext to execute with logged results : Once an attacker has credentials extracted from the cache , whether in hash form or in plaintext form , PsExec can be used to run commands on any other computer which accepts those domain credentials 
If this technique is combined with cached credential dumping , it can be used to jump from computer to computer on a compromised network 
Net Crawler utilizes a cached credential dumping technique along with PsExec in order to worm throughout a network , collecting any and all credentials that it can extract from credential caches 
It starts by first extracting cached credentials from the infected computer 's cache 
Once this is complete , it then continues to scan a set of configured IP addresses on the local subnet to determine which IP addresses have SMB related ports open 
Then an iterative methodology is applied to brute forcing each SMB enabled target with each credential that was extracted from the cache 
When a positive result has been achieved , it will create a copy of itself with a modified configuration stored as a PE resource , then send and execute the copy utilizing PsExec 
This copy repeats the behavior of the original , but with already discovered credentials as well as newly discovered ones on the newly infected host 
MS08-067 is a vulnerability in Microsoft Windows made popular by the Conficker worm which can be exploited by a specially crafted packet to the operating system 's RPC network interface 
Jasus is an ARP cache poisoner developed by the Operation Cleaver team 
The primary positive attribute of Jasus is its poor detection ratio by the antivirus industry 
It has the ability to dump stored and cached credentials , and conduct attacks like ARP cache poisoning in order to capture credentials being transmitted on the network 
It also has a remotely installable trojan named Abel , which enables some of its functionality on a remote target 
We observed the Operation Cleaver team using Cain & Abel for extracting credentials from caches and the network when they are confident that there is little to no antivirus protection on the infected target 
Exfiltration is the process of moving information to an external site 
In this context , it is the process of stealing information without being detected 
Operation Cleaver has a strong focus on stealing confidential/privileged information , and they have utilized a few methods in order to facilitate this objective 
Cleaver Operations observed in 2013 mainly utilized FTP servers with anonymous access enabled in order to pilfer large quantities of information 
This allowed them to use existing command line utilities available on their targets in order to upload information 
These FTP servers were also observed during the infection process , as infected computers were often instructed to download additional files from these FTP servers , including backdoors and pivoting tools 
The following IP addresses hosted FTP servers that were used in the infection of targets or in the exfiltration of information 
Its main functionality allows for a client and server communication channel , allowing for information to be transported over the network simply 
NetCat has an option when being compiled to enable or disable the ability for NetCat to execute a command after the connection is established 
This feature can be abused to enable a reverse connecting shell , which can be used to remotely control a target 
The Operation Cleaver team was observed attempting to use NetCat to exfiltrate information as well as use it as a reverse connecting shell 
Its main purpose is to create a channel that is capable of transporting information over the network 
The changes made in zhCat allow for this information to be transferred with inline obfuscation and/ or encryption 
This makes it more difficult to detect that privileged information is being exfiltrated 
This makes the traffic between zhCat instances look like benign HTTP traffic 
If we observe the network communications during this transfer , we can see the following HTTP POST request 
On the server side , we can see our message has been received : If stricter egress filtering is enabled , the attackers can use zhCat to also XOR encrypt the traffic with a shared key 
The following is the key used for XOR encryption : The \n represents hex character 0x0A , which is a new line character 
An attacker could set up a server instance of zhCat with the following command in order to enable both HTTP and XOR obfuscation : The client instance could then be invoked with the following command : Once again , information can be supplied via standard input 
Upon inspecting the network traffic again , we see the following HTTP POST request 
On the server side , we can see this information being received : zhCat has a variety of other features such as port mirroring as well as traffic redirecting 
Operation Cleaver uses PLink to forward local RDP ports to remote SSH servers 
This allows them to easily connect to RDP servers inside the networks of their victims 
These RDP connections can be used to exfiltrate information visually , as well as to remotely control the computers hosting the RDP servers 
Early Cleaver operations abused SMTP in order to exfiltrate information 
The sending is performed by internally developed malware samples such as TinyZBot and Csext in order to exfiltrate information about the infected computer , as well as requested files and keystroke logging information 
Messages were sent using an open SMTP relay at BeyondSys.com with the sender email address dyanachear ( at ) beyondsys.com 
This allowed the attackers to use infrastructure that was not theirs to exfiltrate information 
The subject used is the following : The message used is the following : The files being exfiltrated are added to the email as attachments 
SOAP is a sub-protocol communicated via HTTP 
In relation to Operation Cleaver , it is used as the command and control protocol for TinyZBot , which was the preferred backdoor , and underwent long-term development 
HTTP communications are often used by botnets , but it is uncommon to use a sub-protocol such as SOAP 
It is likely that SOAP was used because it is simple to implement in C # , and has the added benefit of blending in with other benign HTTP traffic 
As part of TinyZBot 's command and control protocol , files can be exfiltrated over SOAP to the command and control server 
Persistence is the means of maintaining access to a compromised network 
There are limitless methods of persistence ; the following are techniques and tools for persistence used by Cleaver 
TinyZBot is a backdoor developed in C # 
The purpose of TinyZBot is to gather information from an infected computer as well as maintain and further access into a compromised network 
The following is a list of supported features : The command and control mechanism for TinyZBot utilizes SOAP communicating over HTTP 
SOAP traffic could easily be considered benign traffic , as it is not commonly seen in malware 
Since the first version of the SOAP-based command and control protocol was implemented , TinyZBot used what is referred to as a '' dynamic password '' 
For the command and control examples below , red text represents TCP data sent from the TinyZBot infection while blue text represents TCP data sent from the command and control server 
This is the first query done by a running TinyZBot instance , and needs to be done shortly before most other queries , in order to update the dynamic password 
Commands , updates and files to drop and execute are stored as files on the SOAP server , and access is restricted by the AppUsageID as well as the bot GUID 
This allows for commands to be sent to all bots for a campaign as well as individual control 
The TinyZBot queries the server in order to enumerate all files currently available to it 
In order to download the file and parse for commands to execute , the TinyZBot must request the file 
The file is downloaded Base64-encoded inside of the SOAP response 
The RUNCMD line requests that cmd.exe be executed , with the command ipconfig /all being redirected to a file in a directory designated for files to be uploaded 
The UPLOAD command requests that this file is then uploaded over SOAP to the command and control server 
The DELETE command then requests that the file be deleted from the infected system 
The following is a list of supported commands that TinyZBot responds to : Commands such as GETINFO are often run on newly infected systems , as they decide whether the infection has hit the correct target 
TinyZBot is commonly installed using some form of deception 
Recent versions use the resume- based methods reported in the Initial Compromise sections 
When early versions of TinyZBot were executed , they opened an image stored in the resource section of the executable and copied the malicious TinyZBot executable to the % AppData % directory 
The backdoor additionally replaced the original malicious executable with an appropriately named image file and padded the image file with null bytes in order to mirror the original file size 
It was limited to logging keystroke data , sending emails , and creating a link in the user 's startup folder for persistence 
Its method of exfiltrating the logged keystrokes relied upon a hardcoded email address stored in the binary 
The message was intended to look like common Viagra spam from China , but would be sent with the keystroke logging data as attachments , as well as system information 
The initial version did not provide any means of receiving commands and was obfuscated with SmartAssembly 
A command and control protocol was established , using HTTP and SOAP for the protocol 
The command and control server for this version was located at 173.192.144.68/ DefaultWS ( dot ) asmx 
An update mechanism was added , and could be regularly scheduled , so unassisted periodic update checks were automatically performed 
The email data exfiltration method also underwent modification to be activated at a scheduled interval 
The next day , April 25 , 2013 , a new version was compiled which allowed for self-deletion 
The AppUsageId ( at this point named AppType ) was an identifier used by this organization in order to differentiate between targets infected with TinyZBot , meaning they could effectively run multiple campaigns using the same command and control server and know which target was infected 
This also allowed for separate commands to be supplied to different targets without the need for per-bot commands 
The exfiltration email address was also changed to TerafficAnalyzer ( at ) yahoo.com 
SmartAssembly was reused again 
A method was added to detect what security related software is installed 
Avira antivirus was specifically targeted and disabled , due to its detection of the new keystroke logger module added in this version 
This keystroke logger source is publicly available and referred to as DeadkeyLogger 
The ability to extract Internet Explorer passwords was added 
Clipboard monitoring code was added , but not invoked 
The version compiled on June 23 , 2014 , added functionality which allowed screenshots of the desktop to be taken 
A bug fix is made to the keystroke logging method , and clipboard monitoring is enabled 
This was presumably done to limit antivirus detection of each individual file as well as allow for dynamic updating of specific modules 
FTP upload support was added , with hardcoded credentials of ano:1 
This FTP upload functionality points to the command and control server , and is invoked by a command in the SOAP command and control channel 
These versions have the capability to install as a service 
This indicates that TinyZBot is not only being installed while impersonating a résumé creation suite , but is also impersonating potential employers when distributed 
This dropper impersonated a tool to submit a résumé to Teledyne 
While the user enters this information , their machine is infected with TinyZBot 
These versions began to include a new method of installing as a service 
This was likely to avoid detonation-based detection engines 
This allowed supplemental tools to keep TinyZBot running by enumerating every process and checking if the process ID and mutex prefix existed 
If no mutex and process pair was located , another TinyZBot instance would be started 
Multiple backdoors were used by this organization 
These are scripts or applications that allowed for command or code execution outside of the victim network 
Many of their backdoors were web applications , added to web servers , so commands can be executed from a browser or client able to communicate with them 
This group includes the results of the Shell Creator mentioned in the Attribution section , as well as ASPX backdoors used by Nesha 
A PHP shell was also observed , which also included attribution to Nesha in its hashed password 
An ASPX backdoor named Zh0uSh311 was located on live servers as well as recovered fro a staging server 
Its functionality breaks down into three fairly standard components : SQL queries , executing commands , and uploading files 
This organization utilized backdoors which masqueraded as varying versions of Notepad 
They replace the existing Notepad.exe on the infected machine , and when run they call out to a remote server and execute any shell code returned by the remote server 
The components are as follows : XYNTService was not developed by the Cleaver team , but instead is a publicly available project which executes an executable as a service 
The purpose of PVZ-In is to communicate with a command and control server 
The known command and control server is located at http : //kundenpflege 
menrad ( dot ) de/js/jquery/default.aspx and the command and control protocol only uses HTTP 
The commands as well as infected computer information are transferred in the Content- Disposition HTTP header , making the traffic easy to pass over as benign 
When a command is received from the server , the results are stored in a central location on disk that the PVZ tools utilize 
Command functionality is limited to executing supplied commands , downloading and executing executables as well as self-updating 
PVZ-Out is the other half of the command and control channel , primarily uploading results of commands and keystroke logging data to a remote server 
The known command and control server for PVZ-Out is located at http : //www.gesunddurchsjahr ( dot ) de/tor/default.aspx 
Much like PVZ-In , this command and control channel communicates with the Content-Disposition HTTP header , but for file data , POST data is supplied 
Data uploaded is often compressed , which can make it more difficult to detect the exfiltration of sensitive information 
SYN Flooder is a simple network based denial of service tool 
It is a command line utility capable of being invoked by PVZ-In 
Logger Module observes the user 's actions and records them to a file 
The recorded actions include mouse clicks , active windows , keypresses , as well as clipboard data 
The resulting log is written out to a location where PVZ-Out can exfiltrate it to its command and control server 
The following command and control servers for Logger Module have been observed : WndTest is the evolution of the PVZ tool chain into a single executable 
The tool chain is minimized down to a command and control communications , keystroke logging , and clipboard monitoring 
The command and control still supports upgrading , downloading , and executing of applications , as well as executing batch scripts 
WndTest installs as a service and has been observed attempting to impersonate Adobe Report Service 
WndTest starts using PHP servers for its command and control server , some of which are listed as defaced sites 
We have seen wndTest communicate with the following servers : Csext is a backdoor application developed in C # which runs as a service 
A recovered configuration is as follows : This configuration executes zhCat to connect back to srv01.microsoftwindowsupdate ( dot ) net ( a deceptive domain owned by this group with falsified Whois data attributing to Microsoft Investor Relations ) with XORed communication using the HTTP protocol on TCP port 443 
This zhCat instance is running cmd.exe , effectively making it a reverse connecting shell 
This command runs at 00:29 in the morning , and is killed by taskkill at 00:35 
This gives the attackers a predictable method to regain access to a compromised network if they ever lose access 
Csext also has email functionality similar to TinyZBot 
This email functionality is used to exfiltrate the results of commands from the command file which can also include requests like gathering user information 
We have seen Csext configured to communicate with the following servers : If after reviewing the Indicators of Compromise ( IOC ) listed in Appendix A , you believe your organization to be a victim of Operation Cleaver , we recommend you consider the following course of action : 1 
Regin was found on infected internal computer systems and email servers at Belgacom , a partly state-owned Belgian phone and internet provider , following reports last year that the company was targeted in a top-secret surveillance operation carried out by British spy agency Government Communications Headquarters , industry sources told The Intercept 
The malware , which steals data from infected systems and disguises itself as legitimate Microsoft software , has also been identified on the same European Union computer systems that were targeted for surveillance by the National Security Agency 
'' In a hacking mission codenamed Operation Socialist , GCHQ gained access to Belgacom 's internal systems in 2010 by targeting engineers at the company 
The malicious LinkedIn page launched a malware attack , infecting the employees ' computers and giving the spies total control of their systems , allowing GCHQ to get deep inside Belgacom 's networks to steal data 
The implants allowed GCHQ to conduct surveillance of internal Belgacom company communications and gave British spies the ability to gather data from the company 's network and customers , which include the European Commission , the European Parliament , and the European Council 
One of the keys to Regin is its stealth : To avoid detection and frustrate analysis , malware used in such operations frequently adhere to a modular design 
The following Regin components have been identified : The first stage are drivers which act as loaders for a second stage 
When started , this stage simply loads and executes Stage 2 
The Regin loaders that are disguised as Microsoft drivers with names such as : Mimicking Microsoft drivers allows the loaders to better disguise their presence on the system and appear less suspicious to host intrusion detection systems 
When launched , it cleans traces of the initial loader , loads the next part of the toolkit and monitors its execution 
On failure , Stage 2 is able to disinfect the compromised device 
The malware zeroes out its PE ( Portable Executable , the Windows executable format ) headers in memory , replacing '' MZ '' with its own magic marker 0xfedcbafe 
It initializes the core components of the architecture and loads the next parts of the malware 
These modules can include data collectors , a self-defense engine which detects if attempts to detect the toolkit occur , functionality for encrypted communications , network capture programs , and remote controllers of different kinds 
The Intercept 's investigation revealed a sample uploaded on VirusTotal on March 14th 2012 that presents the unique 0xfedcbafe header , which is a sign that it might have been loaded by a Regin driver and it appears to provide stealth functionality for the tool kit 
In order to access information stored in the computer 's memory , programs use objects that reference specific locations in memory called pointers 
This binary file contains some of such pointers initialized , which corroborates the hypothesis that the file was dumped from memory during a forensic analysis of a compromised system 
In addition , when freeing memory using ExFreePool ( ) , the driver zeroes the content , probably to avoid leaving traces in pool memory 
The driver also contains routines to check for specific builds of the Windows kernel in use , including very old versions such as for Windows NT4 Terminal Server and Windows 2000 , and then adapts its behavior accordingly 
This Regin driver recurrently checks that the current IRQL ( Interrupt Request Level ) is set to PASSIVELEVEL using the KeGetCurrentIrql ( ) function in many parts of the code , probably in order to operate as silently as possible and to prevent possible IRQL confusion 
Upon execution of the unload routine ( located at 0xFDEFA04A ) , the driver performs a long sequence of steps to remove remaining traces and artifacts 
Downloaders , injectors , infostealers Example md5s of files detected with Kaspersky 's Virus.Win32.Pioneer.dx and Symantec 's Infostealer.Nemim ! inf : To ensure only single instance of the module is running , the module verifies if system mutex named «132DF6E» exists 
The module implements a method to resist running in virtual environment 
It gets CPU name and identifier from the registry at HKLM\HARDWARE\DESCRIPTION\ System\CentralProcessor\0 and collects IP and MAC addresses of local network adapters 
Then the module attempts to delete some other , prob- ably older , components which might be present on the system 
The list of deleted files includes the following : The next is step is to check if current directory has a file named «U» 
If «U» file is older than 180 days , the module wipes the file 
If not , it triggers a special variable that makes module dormant and dis- ables further communication with C & C server 
The module connects to autolace.twilightparadox.com ( or automachine 
servequake.com ) and issues a HTTP GET request with hardcoded User­Agent string : The server response should contain «DEXT87» string which is used to rec- ognize valid response 
If the real C & C IP address is not valid the module may try to send identical request again but using a different HTTP path : If the C & C IP address is valid , the module issues another HTTP request : The server response can be one of the following : Where < DATASIZE > is a decimal integer that represents length of < DATA > field in bytes; < DATA > is a binary data separated from < DATASIZE > field by semicolon 
Please note , that after receiving < DATA > , it is XORed with byte value 0x55 and saved to a disk in a file named «ctfmon.exe» ( current directory is used ) 
This module is relatively large ( 455Kb ) and comes as a part of WinRar SFX file that drops and starts the module from % APPDATA % \Microsoft\Display\DmaUp3 
exe 
The main purpose of the module is to collect various secrets stored on a local system 
From the very beginning this module checks if «bdagent.exe» process is running on current system 
If it is running , it uses simple AV heuristics evasion technique 
The code starts a thread that simulates keystrokes of ESC keyboard key and then shows a system modal message box 
Right after that keystroke generation thread is terminated and the module continues normal execution as if «bdagent.exe» was not running 
Next the module makes sure only one instance of current code is running by checking if system mutex object named «920111215» exists 
After that , the mod- ule collects information about current system which includes the following : If the module reveals that current System default codepage is 0412 ( Korean ) it terminates 
So far , the attackers can steal logins and pass- words but to understand where they are from they must guess the string which produced given hash 
When IntelliForms information is stolen the malware tries to check the list of known login page URLs to recover the originating webpage address 
Here is the list of URLs that are checked by the malware : The list of targeted services includes some local services specifically popular in : The module uses several simple XOR­based algorithms to encrypt embedded string data 
In addition it makes use of the following Mozilla Firefox libraries depending on Firefox version : When stealing secrets from Firefox and Chrome it uses built­in SQLite library code 
After stealing secrets from local system the malware executes some kind of embedded script 
It is logging all actions to inform the operator what exactly was executed by this variant of the malware 
The result of this execution is appended to the stolen data and uploaded to the C & C server 
The module uploads all collected information to one of the following URLs via POST request : It 's the first time we see .pn domain used in malware 
The malware uses fixed User­Agent string : The data is uploaded as a POST request binary in the following format : where < UserId > is hardcoded identifier ( i.e 
: If the server reply contains a keyword «minmei» it continues sending additional in- formation 
A quote from Wikipedia : «Born in Yokohama Chinatown , Japan ( though she is of partial Chinese descent ) as Linn Minmei , Minmay moved in with her uncle Shaochin ( 少江 ) and aunt Feic- hun ( 慧中 ) on South Ataria Island in hopes of finding the path to fulfill her dream of becoming a star.» The trojan iterates through running processes and looks for security software basing on executable filenames from the list below 
If the process is found it keeps a record of the software name using short AV Identifier string from the fol- lowing table of rules The malware uses a trick to evade running on a VMware 
First , it checks if cur- rent process is running in WOW64 environment 
Another method to detect VM en- vironment is to check local network adapter 's IP address 
If VM is detected the process instantly terminates 
Next the malware submits collected information to the C & C server using HTTP GET request and the following URL format : http : // < C2DOMAIN > /bin/readi.php ? a1= % STEPID % & a2= % HOSTID % & a3= % SYSINFO % & a4= % AVSOFTID % , where % C2DOMAIN % is one of the following C & C domains : % STEPID % is special text string indicating stage of malware operation 
Igfxext.exe can download a file and drop it to % APPDATA % \microsoft\dis- play\ctfmon.exe ( md5= e8bfb82b0dd5cef46116d61f62c25060 ) 
After execution , the downloaded file drops SMAGENT.EXE ( md5 0306f9ae- 7786570139f78e78bc940597 ) to % APPDATA % \MICROSOFT\DISPLAY and ex- ecutes it 
This component is a virus , and is used to selectively infiltrate into other computers via USB or network shares 
These files are all legitimate files that have been infected by another Darkhotel component 
All of these infected files drop a 63kb self injecting compo- nent 
The igfxext.exe component is dropped to disk and run 
It spawns an- other suspended process with its own igfxext.exe image , but decrypts a smaller 32kb executable ( cf1319d94f33380622ba000b7d8ad6e9 , Trojan­Downloader 
The running process overwrites the igfxext.exe image in the suspended process with this smaller chunk of code 
This smaller code section maintains similar functionality to the '' worm '' compo- nent : Host package files detected as '' Virus.Win32.Pioneer.dx '' are infected legitimate files , that do not have any self­propagation routines 
This sample is started by code running within svchost.exe on WinXP SP3 
It drops a keylogger 
The debug path inside : The dropper above maintains , drops and installs this kernel mode keylogger : Likely , it was developed as a part of a mid­to­late 2009 project : This driver package is built to look like a legitimate low level Microsoft system device 
It is installed as a system kernel driver '' Ndiskpro '' service , described as a '' Microcode Update Device '' 
It is somewhat surprising that there is no rootkit functionality hiding this service : When loaded , the NDISKPRO.SYS driver hooks both INT 0x01 and INT 0xff , and retrieves keystroke data directly from port 0x60 , the motherboard keyboard con- troller itself 
This component then encrypts and writes the retrieved values ondisk to a ran- domly named .tmp , file like ffffz07131101.tmp 
This file is located in the same directory as the original dropper , which maintains persistence across reboots with a simple addition to the HKCU run key 
This keylogger module encrypts and stores gathered data in a log file , as men- tioned previously 
The ThreatConnect Intelligence Research Team ( TCIRT ) recently observed a targeted cross-site scripting ( XSS ) '' drive-by '' attack that leveraged a single content delivery network resource to distribute a malicious Java applet via nearly all of the major official Government of Afghanistan websites 
This class file downloads and decodes an XOR 0xC8 encoded Windows PE executable payload from [ http : ] //mfa.gov [ 
] af/content/images/icon35.png , hosted on the official Afghan Ministry of Foreign Affairs site , which was also affected by the gop-script XSS 
This applet has the same class path , and downloads an XOR 0xFF encoded payload executable from the URL [ https : ] //amco- triton.co [ 
] jp/js/dl/in.jpg 
Additional indicators and context associated with this particular Java driveby activity can be found in the ThreatConnect Common Community Incident 20140815A : The XOR 0xC8 encoded payload downloaded from [ http : ] //mfa.gov [ 
] af/content/images/icon35.png decodes into the Windows PE executable SHA1 : This executable is a self-extracting ( SFX ) Microsoft Cabinet executable that is digitally signed with a valid certificate from '' OnAndOn Information System Co. , Ltd. '' , serial number '' 1F F7 D8 64 18 1C 55 5E 70 CF DD 3A 59 34 C4 7D '' 
This executable drops the following files : Malicious DLL that loads into the above dllhost.exe , using a similar DLL sideloading technique to that most commonly associated with the PlugX backdoor 
This backdoor connects to the faux Oracle Java themed command and control ( C2 ) domain oracle0876634.javaplug-in [ 
] com 
By exploiting and co-opting Afghan network infrastructure that is used by multiple ministerial level websites , Chinese intelligence services would be able to widely distribute malicious payloads to a variety of global targets using Afghanistan 's government websites as a topical and trusted distribution platform , exploiting a single hidden entry point 
This being a variant of a typical '' watering-hole '' attack , the attackers will most likely infect victims outside the Afghan government who happened to be browsing any one of the CDN client systems , specifically , partner states involved in the planned troop reduction 
We have since seen multiple cases where this exploit is used to deliver malware and one was particularly interesting as it contained a new variant of MiniDuke ( also known as Win32/SandyEva ) 
Some of the characteristics of MiniDuke - such as its small size ( 20 KB ) , its crafty use of assembly programming , and the use of zero-day exploits for distribution - made it an intriguing threat 
Although the backdoor is still quite similar to its previous versions , some important changes were made since last year , the most notable being the introduction of a secondary component written in JScript to contact a C & C server via Twitter 
The functionality of the shellcode which is executed by triggering the vulnerability is rather simple and straightforward 
After decrypting itself and obtaining the addresses of some functions exported by kernel32.dll , it decrypts and drops the payload in the % TEMP % directory in a file named '' a.l '' which is subsequently loaded by calling kernel32 ! LoadLibraryA 
An interesting thing about the shellcode is that before transferring control to any API function it checks the first bytes of the function in order to detect hooks and debugger breakpoints which may be set by security software and monitoring tools 
If either of those conditions is met the malware assumes it is run for the first time and it proceeds with its installation onto the system 
MiniDuke gathers information about the system and encrypts its configuration based on that information , a method also used by OSX/Flashback ( this process is called watermarking by Bitdefender ) 
The end result is that it is impossible to retrieve the configuration of an encrypted payload if analyzing it on a different computer 
The information collected on infection has not changed since the previous version and consists of the following values : Once the encrypted version of the malware is created , it is written into a file in the % ALLUSERSPROFILE % \Application Data directory 
The name of the file is randomly picked from the following values ( you can find this listing and those of the next screenshots on the VirusRadar description : The filename extension is also picked randomly from the following list : To persist on the infected system after reboots , the malware creates a hidden .LNK file in the '' Startup '' directory pointing to the modified main module 
The name of the .LNK file is randomly drawn from the following values : The .LNKfile is created using a COM object with the IShellLinkA interface and contains the following command : '' C : \Windows\system32\rundll32.exe % pathtomainmodule % , exportfunction '' Which gives something like : '' C : \Windows\system32\rundll32.exe C : \DOCUME~1\ALLUSE~1\APPLIC~1\data.cat , IlqUenn '' 
When the malware is loaded by rundll32.exe and the current directory is n't % TEMP % , the malware starts with gathering the same system information as described in the '' Installation '' section to decrypt configuration information 
If the configuration data is decrypted correctly , MiniDuke retrieves the Twitter page of @ FloydLSchwartz in search of URLs by which to reach C & C server 
As the next step , MiniDuke gathers the following information from the infected systems : This information is then sent to the C & C server along with the request to download a payload 
The final URL used to communicate with the C & C server looks like this : < urlstart > /create.php ? < rndparam > = < systeminfo > Those tokens are derived as follows : An example of such a URL is given below : The payload is downloaded in the file named '' fdbywu '' using the urlmon ! URLDownloadToFileA API : The downloaded payload is a fake GIF8 file containing encrypted executable 
The malware processes the downloaded file in the same way as previous samples of MiniDuke : it verifies the integrity of the file using RSA-2048 , then decrypts it , stores in a file and finally executes it 
The RSA-2048 public key to verify integrity of the executable inside the GIF file is the same as in the previous version of MiniDuke 
The TwitterJS module is extracted by creating a copy of the Windows DLL cryptdll.dll , injecting a block of code into it and redirecting the exported functions to this code 
This file is then stored in an Alternate Data Stream ( ADS ) in NTUSER.DAT in the % USERPROFILE % folder 
Finally this DLL is registered as the Open command when a drive is open , which has the effect of starting the bot every time the user opens a disk drive 
Below you can find the content of the init.cmd script used by MiniDuke to install TwitterJS module onto the system 
Prior to executing it , MiniDuke applies a light encoding to the script : The next images show the result of two separate obfuscations , we can see that the variables have different values 
This is probably done to thwart security systems that scan at the entry points of the JScript engine 
The purpose of this script is to use Twitter to find a C & C and retrieve JScript code to execute 
In years past , Iranian actors primarily committed politically-motivated website defacement and DDoS attacks 
More recently , however , suspected Iranian actors have destroyed data on thousands of computers with the Shamoon virus , and they have penetrated the Navy Marine Corps Intranet ( NMCI ) , which is used by the U.S. Navy worldwide 
We have seen this group leverage varied social engineering tactics as a means to lure their targets into infecting themselves with malware 
During that time period , the Chinese hacking community engaged in website defacements and denial of service attacks in conjunction with incidents such as the accidental bombing of the Chinese embassy in Belgrade in 1999 , the collision of a U.S. spy plane and a Chinese military plane in 2001 , and the Japanese Prime Minister 's controversial visit to the Yasukuni shrine in 2005 
However , the '' Shamoon '' attacks , which wiped computers in Saudi Arabia and Qatar , indicate an improvement in capabilities 
We have observed the Ajax Security Team use a variety of vectors to lure targets into installing malicious software and/or revealing login credentials 
These attack vectors include sending email , private messages via social media , fake login pages , and the propagation of anti-censorship software that has been infected with malware 
During our investigation , we discovered that these attackers sent targeted emails , as well as private messages through social media 
For example , the attackers targeted companies in the DIB using a fake conference page as a lure to trick targets into installing malicious software 
The attackers registered the domain '' aeroconf2014 [ 
] org '' in order to impersonate the IEEE Aerospace conference - the conference 's actual domain is aeroconf.org-and sent out an email with the following information : The email encouraged users to visit a fake conference website owned by the attackers : Upon visiting the website , visitors were notified that they must install '' proxy '' software in order to access it , which is actually malware 
The attackers have also used phishing attacks , in which they set up Web pages to emulate various services that require security credentials 
The attackers tailored these login pages for specific targets in the DIB and spoofed a variety of services such as Outlook Web Access and VPN login pages 
If users attempt to login through these fake Web pages , the attackers collect their login credentials 
In 2012 , researchers found that an anti-censorship tool that is primarily used by Internet users in Iran was bundled with malware and redistributed 
Our investigation found that malware-laden versions of legitimate anti-censorship software , such as Psiphon and Ultrasurf , were distributed to users Iran and Persian speaking people around the world 
They deliver this malware as a malicious executable ( dropper ) 
The executable is a CAB extractor that drops the implant IntelRS.exe 
This implant , in turn , drops various other components into C : \ Documents and Settings\ { USER } \Application Data\IntelRapidStart\ 
The following files are written to disk in this location : The IntelRS.exe is written in .NET and is aptly named '' Stealer '' , as it has various data collection modules 
It drops and launches AppTransferWiz.dll via the following command : 110 is an ordinal that corresponds to '' StartBypass '' export in AppTransferWiz.dll 
Data exfiltration is conducted over FTP by AppTransferWiz.dll , which acts as an FTP client 
There is code to exfiltrate data over HTTP POST as well , but it is unused 
We also found incomplete code that would perform SFTP and SMTP exfiltration , which could be completed in a future version 
Once the state is set , IntelRS.exe proceeds to collect data from various areas in the system as described below : IntelRS.exe loads a Delphi component called DelphiNative.DLL , which implements some additional data theft functionality for the following : The Stealer component uses common techniques to acquire credential data 
For instance , it loads vaultcli.DLL and uses various APIs shown below to acquire RDP accounts from the Windows vault 
Harvested data is encrypted and written to disk on the local host 
Analysis of the malware indicates that the data is encrypted via a Rijndael cipher implementation ; more specifically it uses AES which is a specific set of configurations of Rijndael 
Many of the malicious executables ( droppers ) that we collected were bundled with legitimate installers for VPN or proxy software 
Examples include : • 6dc7cc33a3cdcfee6c4edb6c085b869d was bundled with an installer for Ultrasurf Proxy software 
• 3d26442f06b34df3d5921f89bf680ee9 was bundled with an installer for Gerdoovpn virtual private network software 
• 3efd971db6fbae08e96535478888cff9 was bundled with an installer for the Psiphon proxy 
• 288c91d6c0197e99b92c06496921bf2f was bundled with an installer for Proxifier software 
These droppers were also designed to visually spoof the appearance of the above applications 
These droppers contained icons used in the legitimate installers for these programs 
Upon executing the 'Stealer Builder ' the user is presented with an option to load the 'Builder ' or to 'Decrypt ' logs generated from a victim and exfiltrated to a command-and-control ( CnC ) server under the groups ' control 
The Builder option enables an attacker to configure a new Stealer backdoor 
The user can configure the new backdoor to connect to a specific CnC server with a personalized username and password 
The attacker can bind the backdoor to a legitimate application of his or her choosing , or they can cloak it with an icon designed to make the backdoor appear as though it is a legitimate file 
This sample ( MD5 1823b77b9ee6296a8b997ffb64d32d21 ) was configured to exfiltrate data to ultrasms [ 
] ir 
The first cluster contains the domain used in the Aerospace Conference attack as well as the domains used in phishing attacks designed to capture user credentials : The website used in the Aerospace Conference attack was aeroconf2014 [ 
The majority of the samples we analyzed connect to intel-update [ 
] com and update-mirror [ 
] com , which were registered by james.mateo @ aim [ 
We also observed crossover with a sample that connected to both intel- update [ 
] com and ultrasms [ 
] ir , which was registered by lvlr98 @ gmail [ 
This sample is a Stealer variant that connects to the aforementioned intel-update [ 
] com as well as plugin-adobe [ 
] com 
Other domains seen resolving to IP address nearby include the following : Aside from the sample connecting to plugin- adobe [ 
] com , we have not discovered any malware connecting to these domains 
During our investigation , we were able to recover information on 77 victims from one CnC server that we discovered while analyzing malware samples that were disguised as anti-censorship tools 
As such , we believe that attackers disguised malware as anti-censorship tools in order to target the users of such tools inside Iran as well as Iranian dissidents outside the country 
This was also the email address used to register the domain aerospace2014 [ 
] org , which was used in spear phishing attacks against companies in the U.S. and is linked with malware activity directed at users of anti-censorship tools in Iran 
For example , the Ajax Security Team could just be using anti-censorship tools as a lure because they are popular in Iran , in order to engage in activities that would be considered traditional cybercrime 
In May 2013 , DarkSeoul malware was used to attack several South Korean financial institutions ; and in June , DarkSeoul DDoS attacks were launched against the South Korean government 's DNS server 
The malware used in these attacks sought out and exfiltrated data , based on keyword searches 
While the malware was clearly intended to search for and exfiltrate certain types of data , its true impact on the targets was never revealed 
The impact of the March 20 attacks included disruption of service at financial institutions and data deletion 
The malware used in the March 20 , 2013 attacks were wiper malware 
The malware attempted to disable AhnLab and Hauri AV antivirus products then proceeded to overwrite the master boot record ( MBR ) 
The attack was capable of wiping both Linux and Windows machines 
IssueMakersLab found that these actors consistently used the same 16-digit password for file compression , the same stage 1 C2 protocol , the same collection keywords and encryption keys , and the same development path 
According to South Korea 's Korea Internet and Security Agency , the North Korean IP address 175.45.178.xx was found scanning South Korean routes the month before the attacks , and the same IP was reportedly logged as accessing one of the targets 13 times 
AlienVault suspected the Chinese exploit kit GonDad was used to spread the malware , and the Korean domains serving the malware were registered using a Chinese email address 
While the method for initial compromise of the update server is not noted in detail , CrowdStrike 's report cites '' collateral information '' that suggests targeted email attacks were used to gain initial entry , and policy servers were then compromised 
The upload server vector included a time-based logic bomb that allowed the wiper to target a large number of systems , on a set time and date , with full permissions on all of the targeted systems 
According to CrowdStrike , the wiper malware was dropped on the systems as AgentBase.exe 
The wiper used the Windows utility 'taskkill ' to kill the processes pasvc.exe and clisvc.exe , which are the main processes for the Ahnlab and Hauri antivirus applications 
The wiper then performed system reconnaissance , gathering drive information and operating system version 
Depending on the OS used , the wiper recursively deleted files on the file system , deleting the Windows folder last 
It then overwrote the MBR with the strings '' HASTATI '' , '' PRINCPES '' , '' PRINCIPES '' , or '' PR ! NCPES '' 
According to CrowdStrike , a third malware component downloaded an IRC RAT from various compromised websites 
This RAT is detected by Symantec as Backdoor.Prioxer 
When executed it creates the following files in the affected user 's % Temp % directory : After determining the location of user profile directories on the affected computer , the malware searches these directories for configuration files and directories that may be associated with the connection manager clients mRemote and SecureCRT 
If an mRemote installation is located , the dropper reads the configuration file and checks if there's a NODE that is defined with '' Username=root '' , '' Protocol=SSH '' , and a password that is not blank 
If those conditions are satisfied it extracts the information 
If a SecureCRT installation is located , the dropper extracts information from sessions that have Username=root , Protocol=SSH and a saved password 
After extracting these connection and server details , the dropper uses the previously dropped alg 
exe and conime.exe to attempt to connect remote servers , upload and run the bash script ~pr1.tmp 
The bash script initially checks which UNIX it is running on ( of HP-UX , SunOS , Linux , or AIX ) and then attempts to wipe the /kernel , /usr /etc and /home directories , thus rendering the machine inoperative 
When the AgentBase.exe component is executed , it first attempts to stop the following processes , presumably in order to evade detection : It then enumerates all physical drives and overwrites the first 512 bytes with the string : '' princpes '' , effectively destroying the MBR ( master boot record ) of the affected drive 
It continues to look for removable and fixed drives , locates the root directory on these drives , and then attempts to delete all files and folders in this directory 
Finally , the affected computer is shut down and rebooted , although if the wiping mechanisms were successful then the machine will not be able to boot 
As of this blog post , visitors to at least three nonprofit institutions - two of which focus on matters of national security and public policy - were redirected to an exploit server hosting the zero-day exploit 
The group behind this campaign appears to have sufficient resources ( such as access to zero-day exploits ) and a determination to infect visitors to foreign and public policy websites 
The threat actors likely sought to infect users to these sites for follow-on data theft , including information related to defense and public policy matters 
Visitors to the Peter G. Peterson Institute for International Economics ( www.piie [ 
] com ) were redirected to an exploit server hosting this Flash zero-day through a hidden iframe 
We subsequently found that the American Research Center in Egypt ( www.arce [ 
] org ) and the Smith Richardson Foundation ( www.srf [ 
] org ) also redirected visitors the exploit server 
To bypass Windows ' Address Space Layout Randomization ( ASLR ) protections , this exploit targets computers with any of the following configurations : Users can mitigate the threat by upgrading from Windows XP and updating Java and Office 
The vulnerability permits an attacker to overwrite the vftable pointer of a Flash object to redirect code execution 
The attack uses only known ASLR bypasses 
For Windows XP , the attackers build a return-oriented programming ( ROP ) chain of MSVCRT ( Visual C runtime ) gadgets with hard-coded base addresses for English ( '' en '' ) and Chinese ( '' zh-cn '' and '' zh-tw '' ) 
On Windows 7 , the attackers use a hard-coded ROP chain for MSVCR71.dll ( Visual C++ runtime ) if the user has Java 1.6 , and a hard-coded ROP chain for HXDS.dll ( Help Data Services Module ) if the user has Microsoft Office 2007 or 2010 
The shellcode is downloaded in ActionScript as a GIF image 
Once ROP marks the shellcode as executable using Windows ' VirtualProtect function , it downloads an executable via the InternetOpenURLA and InternetReadFile functions 
Then it writes the file to disk with CreateFileA and WriteFile functions 
Finally , it runs the file using the WinExec function 
Once the exploit succeeds , a PlugX/Kaba remote access tool ( RAT ) payload with the MD5 hash 507aed81e3106da8c50efb3a045c5e2b is installed on the compromised endpoint 
This PlugX payload was configured with the following command-and-control ( CnC ) domains : Sample callback traffic was as follows : Both java.ns1 [ 
Further research uncovered a number of older malware samples connecting to the same domain wmi.ns01 [ 
] us 
The Poison Ivy variants that connected to the domain wmi.ns01 [ 
] us had the following unique configuration properties : We found a related Poison Ivy sample ( MD5 8936c87a08ffa56d19fdb87588e35952 ) with the same '' java7 '' password , which was dropped by an Adobe Flash exploit ( CVE-2012-0779 ) 
In this previous incident , visitors to the Center for Defense Information website ( www.cdi [ 
] org - also an organization involved in defense matters - were redirected to an exploit server at 159.54.62.92 
This exploit , in turn , dropped the Poison Ivy variant 
In addition to using the same password '' java7 , '' this variant was configured with the mutex with the similar pattern of '' YFds* & ^ff '' and connected to a CnC server at windows.ddns [ 
] us 
During another earlier compromise of the same www.cdi.org website , visitors were redirected to a Java exploit test.jar ( MD5 7d810e3564c4eb95bcb3d11ce191208e ) 
This jar file exploited CVE-2012-0507 and dropped a Poison Ivy payload with the hash ( MD5 52aa791a524b61b129344f10b4712f52 ) 
This Poison Ivy variant connected to a CnC server at ids.ns01 [ 
] us 
The Poison Ivy sample referenced above ( MD5 fd69793bd63c44bbb22f9c4d46873252 ) was delivered via an exploit chain that began with a redirect from the Center for European Policy Studies ( www.ceps [ 
] be ) 
In this case , visitors were redirected from www.ceps [ 
] be to a Java exploit hosted on shop.fujifilm [ 
] be 
In what is certainly not a coincidence , we also observed www.arce [ 
] org ( one of the sites redirecting to the current Flash exploit ) also redirect visitors to the Java exploit on shop.fujifilm [ 
] be in 2013 
This actor also has early access to a number of zero-day exploits , including Flash and Java , and deploys a variety of malware families on compromised systems 
Hikit consists of at least two generations of malware that provides basic RAT functionality 
The first generation of Hikit ( referred to as '' Gen 1 '' ) operates as a server and requires an externally exposed network interface in order for an attacker to access the victim machine 
The second generation of Hikit ( referred to as '' Gen 2 '' ) uses the more traditional client model and beacons out to an attacker 's C2 server 
While the communication models shifted dramatically between Gen 1 and Gen 2 , both generations of Hikit retain the same basic RAT function consisting of remote command shell , file management , network proxy and port forwarding 
Both Gen 1 and Gen 2 sub-families of Hikit consist of a main DLL ( referred to as '' the DLL '' ) that contains the RAT functionality ; a kernel driver ( referred to as '' the Driver '' ) with Gen 2 also employs an additional component : a loader executable 
The Gen 1 Driver listens to network traffic arriving at the local network interface and waits for a specific trigger string 
The Gen 2 Driver is a simpler system driver that acts as a rootkit to hide processes , registry keys and network connections associated with Gen 2 activity on the victim 's system 
In Gen 1.2 , the communication between the infected machine and the attacker is encrypted using an XOR mask 
The DLL will send a legitimate SSL certificate as a means to disrupt heuristic IDS sensors that look for encrypted traffic 
The Driver intercepts any and all network communication that traverses the Windows network stack and potentially removes the data from the network stack under very specific conditions 
The purpose of this behavior is to allow the DLL to interact with the network without utilizes the WinSock API which could potentially reveal the presence of Hikit 
The Gen 2 sub-family , beginning with Gen 2.0 Beta , employs a Windows device driver ( '' the Driver '' ) to hide aspects of the DLL 's functionality from normal system processes 
It does not attempt to obfuscate its functionality from static analysis and it hooks a minimum number of kernel API functions in order to hide different pieces of information 
The Driver expose an IOCTL interface that supports the following OIDs : The Driver is capable of hiding processes ( by PID , not name ) , system modules , services , network connections , listening ports , directories ( and by extension , files ) , as well as registry keys and values 
In order to hide these items , the Driver hooks various Windows Kernel API calls 
The following table maps the items the Driver can hide to the API function that the Driver hooks : In order to hide services , the Driver will access the memory of the services.exe process , locate the linked list of services and remove the service entry that the Driver wishes to hide 
This is a surprisingly invasive method to obfuscate a process 
Upon activation , the Driver will expose its interface by calling IoCreateDevice with the name \Device\agony ( for Gen 2.0 Beta samples ) , \Device\HTTPS ( for Gen 2.1 samples ) , \Device\advcachemgr ( for Gen 2.2 samples ) or \Device\diskdump ( for Gen 2.3 samples ) 
The Driver also creates a symbolic link to the device using the same name but under the \DosDevices\ tree 
The Hikit family has supported roughly the same set of commands since the first known samples of Gen 1.0 
The RAT supports the following commands : The shell command activates a remote shell on the victim 's computer 
The file command provides an attacker with a variety of disk access options such as listing directories , changing the current directory , and uploading and downloading files 
The proxy ( or socks5 ) command allows an attacker to utilize a Hikit-infected machine as a proxy 
Gen 2 samples rely on a configuration in order to know where the C2 server exists along with other operational aspects such as the name of its service and operational times 
The DLL operates as a service , requiring an attacker is install the DLL as a service at some point prior to activation 
Ultimately , both exports generate a new thread of the same function ( '' mainThread '' ) 
The difference between the two exports is that DllRegisterServer can take an optional command line argument of the letter '' u '' which will instruct the main thread to uninstall the Gen 1 system from a victim 's computer 
If the uninstall argument exists , mainThread will simply remove the Driver from the victim 's machine and terminate 
When the DLL activates , either by a call to DllEntryPoint or by calling DllRegisterServer without the u parameter , mainThread begins by verifying the version of the Driver installed on the victim 's machine 
it does n't match the specified version ) , the DLL installs the version of the Driver found within the DLL 's resource section ( under the BIN resource tree ) 
With the Driver version verified ( or forcibly corrected by installing the appropriate Driver ) , the DLL will instruct the Driver to use a specified string ( for Gen 1.0 and Gen 1.1 samples ) or a DWORD ( for Gen 1.2 samples ) as the acknowledgment value to send to a connecting client who requests the appropriate URL 
Following this , the DLL will then attempt to install the correct version of the Driver prior to terminating 
It is possible that the second Driver version check is a last ditch effort to ensure the correct Driver is installed 
When the Driver establishes a new channel , the DLL generates a runtime data structure before generating a new thread ( '' HikitThreadFunc '' ) which will service any request coming from the new channel 
The dwHikitVersion field allows the client and the DLL to ensure that they have a compatible communication scheme in place prior to executing commands 
The Gen 2 sub-family , like Gen 1.2 , uses a DLL for the core of its RAT functionality 
In order for the DLL to load , Gen 2 ( starting with Gen 2.1 ) uses a loader application ( referred to simply as '' the Loader '' ) 
Despite the different models , both variants of the Loader load the embedded DLL in the exact same way 
Both versions of the Loader begin by loading the embedded DLL from the Loader 's resources ( item 102 under the Group Icons resource tree ) , decrypting and decompressing the image into memory , then manually loading the DLL into memory using a custom loading routine 
LoadEmbeddedImage copies the compressed embedded DLL into a newly allocated heap buffer and then calls the function decodeBuffer ( using the EncodingKey value ) to decrypt the embedded DLL 
With the embedded DLL now decompressed into a heap buffer , LoadEmbeddedImage calls ImageLoaderData : :LoadDll to manually load the DLL into memory 
ImageLoaderData : :LoadDll interprets the PE/COFF header of the DLL image , loads the image into the appropriate memory configuration , performs the necessary relocation operations , and calls the DllMain ( DLL 's entry point ) function 
After loading the embedded DLL image into memory , the Loader will either call the DLL's StartServer or MatrixMain function depending on the type of Loader 
The standalone Loaders use the MatrixMain function while the DLL Loaders will call the StartServer function 
The Loaders , upon unloading , will call the StopServer function in order to shut down the embedded DLL 
MatrixMain and StartServer both ultimately generate a new thread ( using the POSIX API function beginthreadex instead of the more common CreateThread ) that contains the main loop of the Gen 2 RAT functionality 
The prototype for MatrixMain is as follows : where Arguments parameter can be : If the i parameter is given , the DLL will install itself as a service on the victim 's machine 
The DLL will create a new service ( e.g 
The DLL 's RAT functionality provides basic features such as network port forwarding ( proxying ) , file transfer , and remote command shell 
The RAT functionality provides an attacker with the ability to establish a phantom network within a victim 's infrastructure by having individual instances of Gen 2 DLL listen for incoming connections on local ports ( presumably , NAT 'd ports ) and accept commands from the inbound connection 
This allows an attacker to establish several Gen2 infections within a victim's infrastructure and if outbound connectivity is prohibited for any of the infected machines , the attacker can route commands to the pseudo-isolated infections through accessible infected machines providing a high level of persistence to the malware 
Each Gen 2 infection can support up to 10 listening ports 
The communication between the Gen 2 malware and the C2 ( or other Gen 2 malware , in the case of the internal routing functionality ) is encrypted using a simple DWORD XOR scheme 
In order to provide some level of stealth , the RAT will install a rootkit on 32-bit versions of Windows 
To activate the rootkit , the RAT functionality code creates a service with the driver in the % TEMP % directory as the executable for the service 
The RAT functionality code then activates the service and opens a handle to device driver 's interface ( e.g 
With the handle open to the rootkit driver , the RAT functionality code deletes the service in order to reduce the visible footprint of the new driver 
To further reduce the footprint of the driver , the RAT functionality code also uses the cloaking functionality of the rootkit to hide the DLL 's PID , any references to the GUID { 4AE26357-79A3-466D-A6D9- FC38BFB67DEA } , the DLL 's service names ( e.g 
'' NetDDESrv '' and '' Network DDE Service '' ) and the service entry as well 
Additionally , the code also attempts to hide a service named '' Hitx '' 
The console is a text based application that takes a Gen 1.0 or Gen 1.2 infection 's IP address and proceeds to connect and authenticate with the infected server 
Once connected , the operator has the basic Hikit functionalities available to them via commands such as file and shell 
From a system objects perspective , Gen 2 samples produce up to three named events 
The important strings are as follows : Together with the output of IDA Pro , we can see that this malware uses the command line tool cmd.exe for adding several registry keys to Internet Explorer 
It also tries to retrieve possible AntiVirus information by using the COM interface ( dc12a687-737f-11cf-884d-00aa004b2e24 - > IWbemLocator - > SELECT * FROM AntiVirusProduct ) 
Furthermore , it makes use of the COM to launch an instance of Internet Explorer ( d30c1661-cdaf-11d0-8a3e-00c04fc9e26e - > IWebBrowser2 ) , supposedly to contact its C & C server 
As a result , we get the following network information : Also , we see that it downloads some kind of data ( Base64 encoded ) 
Once again , it creates several registry entries with the help of the command line tool and creates an instance of the Internet Explorer ( CoCreateInstance ( ) - > d30c1661-cdaf-11d0-8a3e- 00c04fc9e26e ) for contacting the C & C server 
This time , the network information is as follows : From the code we can see , that the sample has also the ability to encode / decode data from / to Base64 
The dynamic analysis showed the malware sample contacted the C & C server , but was n't sending any URL parameters ( id1 , id2 ) 
Aumlib , which for years has been used in targeted attacks , now encodes certain HTTP communications 
And a new version of Ixeshe , which has been in service since 2009 to attack targets in East Asia , uses new network traffic patterns , possibly to evade traditional network security systems 
About four months after The New York Times publicized an attack on its network , the attackers behind the intrusion deployed updated versions of their Backdoor.APT.Aumlib and Backdoor.APT.Ixeshe malware families 
Older variants of this malware family generated the following POST request : Data sent via this POST request transmitted in clear text in the following structure : A recently observed malware sample ( hash value 832f5e01be536da71d5b3f7e41938cfb ) appears to be a modified variant of Aumlib 
) The POST body is now encoded 
The sample cb3dcde34fd9ff0e19381d99b02f9692 connected to documents [ 
] myPicture [ 
] info and www [ 
] documents [ 
] myPicture [ 
] info and as expected generated the a POST request to /bbs/info.asp 
Although the network traffic is encoded with a custom Base64 alphabet , the URI pattern has been largely consistent : We analyzed a recent sample that appears to have targeted entities in Taiwan , a target consistent with previous Ixeshe activity 
This sample ( aa873ed803ca800ce92a39d9a683c644 ) exhibited network traffic that does not match the earlier pattern and therefore may evade existing network traffic signatures designed to detect Ixeshe related infections 
The Base64-encoded data still contains information including the victim 's hostname and IP address but also a '' mark '' or '' campaign tag/code '' that the threat actors use to keep track of their various attacks 
After taking a look at recent Korplug ( PlugX ) detections , we identified two larger scale campaigns employing this well-known Remote Access Trojan 
For example , the Korplug RAT ( a.k.a .PlugX ) is a well-known toolkit associated with Chinese APT groups and used in a large number of targeted attacks since 2012 
Among these , we were able to discover several successful infections where the employed Korplug samples were connecting to the same C & C domain 
Other Korplug samples were connecting to a different domain name resolving to the same IPs as notebookhk.net : Taking these C & Cs as a starting point , we were able to locate a number of victims infected through various exploit-laden spear-phishing documents and cunningly-named archives 
A table with a selection of RTF documents and RAR self-extracting archives with a .SCR extension is shown below : Some of the above-mentioned files also contained decoy documents : In all of the cases , three binary files were dropped ( apart from decoy documents ) that led to the Korplug trojan being loading into memory 
The Korplug RAT is known to use this side-loading trick by abusing legitimate digitally signed executables and is a way to stay under the radar , since a trusted application with a valid signature among startup items is less likely to raise suspicion 
The maliciously crafted documents are RTF files that successfully exploit the CVE-2012-0158 vulnerability in Microsoft Word 
One of these 'alternative RATs ' was connecting to a domain also used by the Korplug samples 
A curious Remote Access Trojan , as research points to a Chinese connection but the commands it listens to are in Spanish ( translation in English ) : The malware can manage processes and services on the infected machine , transfer files to and from the C & C server , run shell commands , and so on 
It is written in Delphi and connects to www.dicemention.com 
This malware , written in C , and contains several functions for harvesting files off the victim 's hard drive according to criteria set in the configuration file 
Apart from doing a recursive sweep of all logical fixed and remote drives , it also continually monitors any attached removable media or network shares by listening to DBTDEVICEARRIVAL events 
In addition to collecting files , the malware attempts to gather saved passwords , history of visited URLs , account information and proxy information from the following applications : The C & C domains used by this malware are : Some samples of this file stealer detected in these campaigns also contain the signature by '' Nanning weiwu Technology co. , ltd '' – another indicator that the infections are related 
Most targeted attacks against organizations originate as spear-phish campaigns or watering hole style web driveby attacks 
Traditional malvertizing has been an effective but indiscriminate method cyber crime gangs use to compromise endpoints to perpetrate ad fraud , identity fraud , and banking credential theft 
Since these attacks were blocked by Invincea prior to compromise of the machine or network , we can not confirm the specific IP the perpetrators are after – only the Tactics , Techniques , and Protocols ( TTPs ) used which we describe herein , similar to methods used to provide backdoor access and command and control over compromised networks 
Threat actors create a corporate front , advertise on commonly visited sites , then later switch out the landing pages for their ads to pages that host exploit kits , or simply create a temporary redirection from their usual content to the malicious landing page 
In the campaign described here , Operation DeathClick , traditional malvertising has been armed with a micro-targeting system using IP address ranges , geographically narrowed down to zip codes , and interests of the user ( recorded in cookies ) to target specific companies , company types , and user interests/preferences 
And now , with the advent of real-time ad bidding , these threat actors have weaponized ad delivery networks to target victims based on : Real-time ad bidding allows advertisers , and by extension , adversaries , to micro-target ad delivery on an extremely granular basis 
Now advanced threat actors are able to target an organization directly via micro-targeted malvertising , based solely on their corporate network IP range 
Those ad windows can and are being used to deliver malware if the bidding price is right 
Recently , multiple US Defense/Aerospace contractors were targeted by a malvertising campaign 
But in a two week period , these organizations were hit with dozens of micro-targeted malvertising attacks , each of which would have provided a beachhead for the threat actors from which to compromise the network , if successful 
In each instance , the attacks were carried out by targeting these Defense contractors directly via real-time ad bidding 
As soon as the page loaded , a malicious ad delivered a backdoor Trojan via a Java-based exploit 
The malware delivered came from a compromised Polish website , and would have installed a generic backdoor Trojan 
Figure 2 shows an event tree of the exploit and malware delivered from an ad by visiting Fleaflicker.com 
The event tree in Figure 2 taken from Invincea 's Threat Management Console shows the exploited Java process dropped a file called fvJcrgR0.exe , and that it likely came from Pubmatic , an ad delivery network that allows for real time bidding to deliver ads 
In this instance , the Pubmatic server redirected to a Web server in Poland that dropped the malware 
By clicking the VirusTotal link , the analyst will see the following VirusTotal report in Figure 5 : From the VirusTotal report in Figure 5 , you will see that this malware is a Trojan backdoor that would likely be used to download additional malware or to provide remote persistent access to the attacker 
This event on September 14 ( Figure 8 ) shows that delivery.first-impression.com redirected directly to an IP address , not a domain name to deliver its malicious payload 
When they replied to an email , a new ad was loaded on a page that attempted to exploit Java 
The event tree in Figure 10 notes that this was likely a spear-phish attack 
The timeline will show that when the user replied to an email , the ads on the Earthlink page refreshed , dropping the exploit code via Java 
We observed in Operation DeathClick that real-time ad bidding networks are being used by criminal enterprise to target companies with malicious content in order to gain persistent remote access 
A small fraction is malicious content linking to landing pages that infect users 
But what if the landing pages that are supposed to be ads are actually malicious PHP pages with embedded malware ? The bidding and ad placements work the same , but instead of seeing a flashy ad banner , the highest bidder for the placement serves malware 
But it is very simple to replace the redirection code to switch from a legitimate ad banner to a drop site that hosts an exploit kit , typically based on Java , Flash , Silverlight , or all three 
As we have detailed here , they can also be mis-appropriated unwittingly by malvertisers using these same tools and techniques to target companies with malware for persistent remote access in addition to traditional click fraud , phishing , and identity theft 
So how do they get money to spend on these malicious campaigns ? Invincea recently saw a malvertiser win a bid and delivered a Java exploit 
This exploit copied a fully functional version of Chrome into the Java cache directory , and that version of Chrome launched in the background and proceeded to visit websites and click on specific ad banners 
By paying 65 cents to install a background web browser that does nothing but click fraud , the malvertiser is able to reap hundreds if not thousands of dollars in advertising referral income 
In this instance , the host was almost converted to a click-fraud bot 
But the malware delivery could have been intended for data exfiltration , banking Trojans , or any other more insidious purpose 
Invincea has witnessed a rash of exploit kits and landing pages hosted on : In most instances , the landing pages are preconfigured with the exploit kit 
Figures 17 through 21 in the following are screenshots from Invincea 's Threat Management console from various RTB-based malvertising incidents with highlighted URLs for malvertising delivered via RTB ad bidding 
In September and October of 2014 , Invincea saw a sharp spike of malvertising delivering CryptoWall ransomware attacks via Real Time Ad Bidding 
We observed Real Time Ad bidding platforms , including OpenX , GoogleAds , Yahoo , AOL , and first-impression.com , fall victim to the ransomware malvertising scheme by unwittingly delivering the CryptoWall 2.0 ransomware ads 
Ransomware is a particularly pernicious form of malware that fully encrypts the victim 's disk and data files , including remote storage , then demands payment of anywhere from $ 300 to $ 1000 in return for the decryption key 
Based on analysis of Invincea logs in would-be victims targeted by these ads , we have insight into the attacker that is delivering the malicious ads 
Legitimate ad copy is stolen , 3rd party ad networks used to distribute malware , and popular ad- supported websites displaying the malicious ads that exploit unsuspecting visitors with drive-by web exploits 
Merely visiting any ad-supported site may result in a CryptoWall ransomware infection 
Cryptowall 2.0 utilizes the TOR network to hide its communications , but it quickly encrypts all local files on the disk , and demands bitcoin payment to unlock the files 
In addition , you can see the ransom note being written to disk on an infected machine in the audit logs in Figure 24 
Items highlighted in the URL below is userid , and the winning bid price to place malvertising of Cryptowall on sports.yahoo.com , which is 60 cents 
Operation DeathClick is an active campaign to micro-target companies via malvertising in order to compromise their networks 
Unfortunately , the micro-targeting malvertising technique evades almost all network controls and traditional endpoint anti-virus solutions 
For half the price of a candy bar , attackers have the unprecedented ability to deliver malware to you through your web browser simply because of your IP address space and your industry vertical 
Most of the attacks featured here were not detected by standard Anti-Virus because the malware hashes constantly change 
Recently , research was published identifying a Tor exit node , located in Russia , that was consistently and maliciously modifying any uncompressed Windows executables downloaded through it 
By using a separate wrapper , the malicious actors are able to bypass any integrity checks the original binary might contain 
This executable is a dropper containing a PE resource that pretends to be an embedded GIF image file 
The dropper will proceed to decrypt this DLL , write it to disk and execute it 
Once executed , the DLL file ( SHA1 : b491c14d8cfb48636f6095b7b16555e9a575d57f , detected as Backdoor : W32/OnionDuke.B ) will decrypt an embedded configuration ( shown below ) and attempt to connect to hardcoded C & C URLs specified in the configuration data 
From these C & Cs the malware may receive instructions to download and execute additional malicious components 
We have , for instance , observed components dedicated to stealing login credentials from the victim machine and components dedicated to gathering further information on the compromised system like the presence of antivirus software or a firewall 
Some of these components have been observed being downloaded and executed by the original backdoor process but for other components , we have yet to identify the infection vector 
Most of these components do n't embed their own C & C information but rather communicate with their controllers through the original backdoor process 
This DLL file ( SHA1 d433f281cf56015941a1c2cb87066ca62ea1db37 , detected as Backdoor : W32/OnionDuke.A ) contains among its configuration data a different hardcoded C & C domain , overpict.com and also evidence suggesting that this component may abuse Twitter as an additional C & C channel 
This is significant because the domains leveldelta.com and grouptumbler.com have previously been identified as C & C domains used by MiniDuke 
Based on compilation timestamps and discovery dates of samples we have observed , we believe the OnionDuke operators have been infecting downloaded executables at least since the end of October 2013 
We also have evidence suggesting that , at least since February of 2014 , OnionDuke has not only been spread by modifying downloaded executables but also by infecting executables in .torrent files containing pirated software 
In recent weeks , attackers have launched a series of Distributed Denial of Service attacks ( DDoS ) against websites promoting democracy in Hong Kong 
According to the Wall Street Journal , websites belonging to Next Media 's Apple Daily publication have suffered from an ongoing DDoS attack that '' brought down its email system for hours '' 
According to other reports , Next Media 's network has suffered a '' total failure '' as a result of these attacks 
FireEye has identified a number of binaries coded to receive instructions from a set of command and control ( C2 ) servers instructing participating bots to attack Next Media-owned websites and the HKGolden forum 
Each sample we identified is signed with digital certificates that have also been used by APT actors to sign binaries in previous intrusion operations : These binaries are W32 Cabinet self-extracting files that drop a variant of an older DDoS tool known as KernelBot 
Structurally , all of these samples are similar in that they drop three files : The KernelBot implants receive targeting instructions from C2 servers hard-coded directly into the sample 
For example , c3d6450075d618b1edba17ee723eb3ca drops a KernelBot variant that connects to both www.sapporo-digital-photoclub [ 
] com and wakayamasatei [ 
] com 
The following snippet of python code can be used to decode this command : FireEye has observed two different single-byte XOR keys used to encode configuration files issued by the DDOS C2 servers in this campaign 
The encoded configuration file shown above decodes to : During the course of our research , we 've observed more than 30 different unique configuration files issued by the C2 servers listed above 
These configurations issued commands to attack the following domains and IPs : All of the above IPs host Next Media or Apple daily websites , with the exception of 58.64.139.10 and 124.217.214.149 
For approximately 14 hours between October 23rd and 24th , the attackers pushed a configuration update to four controls servers that instructed bots under their control to flood 124.217.214.149 with UDP traffic 
On Oct. 23 , 2014 , two of the active controls began instructing participating bots to cease attacks 
By Oct. 24 , 2014 , all five of the known active control servers were issuing commands to cease the attacks 
This PlugX variant connected to a Google Code project at code.google [ 
] com/p/udom/ , where it decoded a command that configured its C2 server 
This sample is detected as Backdoor.APT.Preshin and connected to luxscena [ 
] com for C2 
We detect this payload as Backdoor.APT.PISCES and it used hk.java-se [ 
] com for C2 
We also detect this payload as Backdoor.APT.PISCES and observed it connect to u.java-se [ 
] com 
Both of these certificates are valid but can be detected and blocked via the following Yara signatures : These ongoing DDoS attacks and previous APT intrusion activity both target the hkgolden [ 
] com website 
As noted above , this site has been targeted with a DDoS attack by a KernelBot network 
On Oct. 24 , 2014 , after attacking their own infrastructure , the attackers issued new instructions to their botnet that ceased all attacks 
They use highly sophisticated malware tools to maintain persistent access to their targets 
These tools can be used for covert communications in a number of different modes , some of which present significant challenges for traditional security technologies to detect 
We have identified two distinct variants , both highly flexible but with two different techniques for establishing and maintaining a presence on the target system 
It is designed to covertly install a backdoor on a compromised system , hide the presence of its components , provide a communication mechanism with its C & C servers , and enable an effective data exfiltration mechanism 
In the first model , the network communications are carried out from the userland - i.e 
In another model , the network communications are handled by a kernel mode driver - i.e 
The choice of what architecture should be used may depend on a specific target 's environment , allowing the Snake operators to choose the most suitable architecture to be deployed 
In both architectures there is a kernel mode driver installed and a usermode DLL injected by the driver into the system processes 
With this architecture , the Snake driver is mainly used to load the DLL module into the usermode processes , and then use that module for the communications 
When first executed , the driver creates device named \Device\vstor32 with a symbolic link \DosDevices\vstor32 
This device is used for userland/kernel communications 
Next , it drops a DLL into the % windows % directory - the DLL is carried in the body of the driver as a binary chunk with XOR 0xAA applied on top of it , so the driver decrypts it first 
Depending on the variant , the DLL is dropped either under a random name or a hard-coded name , such as mscpx32n.dll 
The purpose of this DLL is to be injected into the user-mode processes 
Some variants of Snake carry the DLL modules that can be installed as a service , to be run within taskhost.exe or services.exe processes 
Next , the driver sets up the hooks for the following kernel-mode APIs : After that , it calls PsSetCreateProcessNotifyRoutine ( ) in order to be notified whenever a new process is started 
The handlers of the hooks above along with the notification callback allow Snake to stay persistent on a system , being able to infect any newly created processes , and restore its driver file in case it gets deleted 
Another set of hooks it sets is designed to hide the presence of the Snake components on the system : The driver then watches for all userland processes to see if they load any web pages 
As long as the user is not using the Internet , Snake stays dormant too , as there is no process that communicates with the web servers 
However , as soon as the user goes online , the driver intercepts that event and then immediately injects the malicious DLL module into the process that initiated connection ( the browser ) 
Once injected , the module initiates polling from one of the hard-coded C & C servers 
The purpose of this behaviour is to blend Snake 's traffic with the browser traffic , bypassing the firewalls , and keeping a low profile at the same time 
Hiding a few DNS/HTTP requests among busy network traffic allows Snake rootkit to stay unnoticed 
As soon as the tool made its first GET requests , the driver immediately injected a malicious DLL module in it , and that module started producing the following traffic : ↓ The domain names of the C & C servers it relies on are hard-coded in the body of the malware 
Some examples are given below , and a full list of known domains is given in the Appendix D : As seen in the traffic dump above , the malware first resolves the domain name of its C & C 
Next , it fetches a file /D/pub.txt , and expects the server to respond with a string '' 1 '' , acknowledging it 's active : Once acknowledged , it asks the server for a command , and the server returns a new command to execute : The command it receives from C & C above ( swim.onlinewebshop.net ) is encrypted 
In order to decrypt it , the malware first applies the XOR mask to the bytes that start from offset 0x40 : An identical XOR mask was also used by Agent.BTZ 
Next , it calculates and confirms a CRC32 checksum within the command , further decrypts the data by using the Number Theory Library ( NTL ) , and makes sure the command is destined to the current host by matching the ID field in it 
Once decrypted , the malware interprets the received command , as reflected in the malware log below ( the new C & C server address is highlighted in it ) : After that , the malware connects to the new C & C , asking it for another command : The command it receives is called UpLoad , so it uploads all the collected logs to the server , and then cleans out those logs : The files it uploads are stored inside its home directory % windows % \ $ NtUninstallQ [ random ] $ , where [ random ] is a random number 
The files within that directory are used by the rootkit to store configuration and log data 
When decrypted with the same XOR key that was used by Agent.BTZ , these files expose the following contents : Analysis of the sample reveals that it supports 3 modes of fetching C & C commands 
• In the first mode , it relies on Windows Internet ( WinINet ) APIs , such as HttpOpenRequest ( ) , HttpSendRequest ( ) , InternetReadFile ( ) , etc 
• In the second mode , it uses Windows Sockets 2 ( Winsock ) APIs , such as WSAStartup ( ) , socket ( ) , connect ( ) , send ( ) , etc 
• In the third mode , it works in the 'pipe server ' mode , when it passes the web requests it is interested in ( as a client ) to the pipe server that runs within Windows Explorer ( explorer.exe ) and/or Internet Explorer ( iexplore.exe ) processes 
The diagram below demonstrates the last , 'pipe server ' mode of Snake operation : The diagram illustrates the operation steps 1-4 : 1 First , the malicious driver with the embedded DLL module injects that DLL into a system process , such as services.exe ; once loaded , the DLL will function in the 'pipe server ' mode 
2 As soon as the driver detects a usermode process that goes online ( e.g 
a browser ) , it will inject malicious DLL module into it ; depending on the operational mode , the DLL may start communicating with C & C directly 
3 In the 'pipe mode ' of operation , the injected DLL will start communicating with the pipe server by sending messages into the established inter-process communication pipes 
4 Once the task of communication with C & C is delegated to the pipe server , it will start communicating with the C & C , bypassing the host-based firewalls that keep an infected system process in a white-list 
The reason behind the pipes usage is to 'legitimise ' the outbound web requests , forcing them to originate from the host firewall- friendly system services 
In order to switch into that mode , a dedicated thread is spawned to listen for IPC messages received through the pipes 
The memory pipes used by Snake are named as : Apart from GET / POST requests , the pipe clients ( infected usermode processes ) may also ask the pipe server to perform other operations on their behalf , such as saving data into a temporary file , copy / delete files , save configuration data into the registry under the aforementioned ShellCore value 
This delegation of tasks is designed to keep infected processes under the radar of the behavioural analysis tools for as long as possible 
Another reason is to overcome account restrictions imposed on a browser process in order to be able to write into files / registry 
To delegate different types of tasks , the clients send messages to the pipe server using the following task identification headers : The usermode component of Snake communicates with its kernel-mode driver via a device called \\.\vstor32 ( created under kernel as \Device\vstor32 ) 
To write data , it opens the device with CreateFile ( '' \\.\vstor32 '' ) , then calls DeviceIoControl ( ) API on its handle with IOCTL code of 0x222038 
Configuration parameters along with the initial set of domain names are hard-coded within the body of the DLL 
Analysis of the commands performed by the malware suggests the following capabilities : Together , these commands provide complete backdoor functionality , allowing remote attacker full control over the compromised system 
The ability to update the driver and then rely on its communication capabilities means that the components of Snake are flexible , making possible the existence of the hybrid ( kernel-centric and usermode-centric ) architectures 
For example , the virtual partitions are used by kernel-centric Snake variants , where the kernel-mode driver is responsible for the communications 
If such a driver is installed via an update , the usermode component can be instructed to delegate the file upload task to the driver by copying all the necessary logs into the shared virtual partition , physically located on the compromised host and thus , accessible from kernel 
This particular architecture relies on a kernel-mode driver to carry out the network communications 
The usermode DLLs are still injected into the system processes to perform high-level tasks 
The delivery mechanism is not known : it may be distributed via a thumb-drive , a phishing email attachment , or be delivered via an exploit across the network ( e.g 
Infection starts from a dropper penetrating into the compromised system where it is allowed to run 
Once executed , the dropper installs the kernel mode driver in a pre-defined location 
On a 32-bit OS , it will install a 32-bit driver 
On a 64-bit OS , it will install a 64-bit driver 
The analysed 32-bit dropper creates a driver in the following location : However , different samples may use a different path and driver file name 
The registration is ensured with creation of the following registry entries : The driver then flags the following events with the notification purposes : The rootkit then places a number of the hooks 
The first API it hooks is IoCreateDevice ( ) 
The installed hook handler calls the original API and then checks if the name of the device is netbt or afd 
If so , it will install a TDI filter driver 
If the device name is Null , Beep , tcpip or Nsiproxy , it will activate itself by enabling its hooks designed to hide the presence of Snake on a system , set up its access control lists and the messaging system 
In order to hide its components , the driver hooks the following APIs : For example , the hook handlers of the registry-related APIs will block access to the registry entries that contain the name of the driver 
In one example , the rootkit blocks access to registry entries that contain the strings '' Ultra3 '' and '' ~ROOT '' 
The ZwReadFile ( ) hook handler will block access to the home directory where the rootkit keeps its file 
In one of the analysed kernel-centric Snake samples the home directory was hard-coded as % windows % \ $ NtUninstallQ817473 $ , so it blocked file read access from that directory 
The ZwClose ( ) hook handler is used to inject the DLL module into the userland processes 
The hook handler for ZwTerminateProcess ( ) checks if the process being shut down is svchost.exe 
If so , it considers it to be a system shutdown , so it unloads its usermode DLL and deactivates its own network drivers , just like it does when its ZwShutdownSystem ( ) hook handler gets invoked 
The ObOpenObjectByName ( ) hook is designed to hide the presence of its virtual partitions ( described later ) 
To encrypt data stored on its virtual partitions , the driver sets a hook for another API : To re-infect the usermode process svchost.exe and to re-enable its network drivers , the rootkit hooks these APIs : Snake then proceeds to the task of deep packet inspection and modification 
In order to accomplish it , it registers a callout driver for Windows Filtering Platform ( WFP ) , an architecture first introduced with Windows Vista and nowadays normally used by antivirus and/or intrusion detection systems to inspect/block malicious traffic 
Snake sets filters at the layers FWPMLAYERSTREAMV4 and FWPMLAYERALEFLOWESTABLISHEDV4 in the TCP/ IP stack , so that its callout driver is notified whenever a TCP connection is established by a browser 
When that happens , the rootkit triggers an event named \BaseNamedObjects\wininetactivate 
When the data arrives , it is intercepted with the FwpsCopyStreamDataToBuffer0 ( ) API , and then scanned for the presence of the hidden commands from C & C 
The driver inspects bidirectional network data on a per stream basis , as it 's located right on the stream data path 
An ability to manipulate data streams is provided with the packet injection logic below , allowing Snake to covertly insert traffic destined to its C & C servers : In order to qualify as a browser , the usermode process must have any of the following names : In addition to WFP , Snake also hooks the Transport Driver Interface ( TDI ) network routines by setting itself up as a TDI filter driver 
Being registered as a TDI driver on the device stack , Snake hooks TCP calls 
This way it intercepts all requests along with their parameters via IRP ( IO request package ) hooks 
By 'sniffing ' all the requests , it can now inspect the traffic , looking for and then parsing GET / POST HTTP requests and also SMTP communications , in order to distinguish commands addressed to itself 
If the rootkit detects that the OS version is pre-Vista ( e.g 
Windows XP ) or Windows Server 2008 ( e.g 
Windows Server 2003 ) , it will invoke FwpsStreamInjectAsync0 ( ) API in order to generate outbound requests 
Whenever the client establishes connections , the TDI driver will also 'pulse ' the \BaseNamedObjects\wininetactivate event , just like the WPF driver 's component of it , in order to notify the userland service about the event 
The data that the driver intercepts , along with the important notifications , is passed to the userland DLL to be processed 
If the data contains commands from C & C , the DLL module is expected to execute them and report results back to the driver to be delivered back to C & C 
For NDIS versions 5.X , Snake rootkit contains code that installs NDIS filter intermediate driver 
This driver is set up above a miniport driver ( a driver that communicates with the physical device ) and below a protocol driver ( a driver that implements a protocol , e.g 
The driver is registered with NdisIMRegisterLayeredMiniport ( ) API 
After that , the drivers hooks the following exports within ndis.sys : The rootkit contains code that installs NDIS filter driver for NDIS 6.0 and above : NDIS filter driver configuration is stored in the registry entry : The driver is registered with NdisFRegisterFilterDriver ( ) API 
After that , the drivers hooks the following exports within ndis.sys ( for NDIS 6.0 ) : Another set of exports it attempts to hook in ndis.sys ( for NDIS 6.0 ) is : With the hooks installed , whenever the network adapter driver attempts to register to NDIS , or whenever there is an attempt to install NDIS intermediate driver or NDIS filter driver , the hook handlers will register Snake 's own MiniportXxx functions with the NDIS library 
With its own miniport handler functions , it can send / receive data by using a private TCP/IP stack , bypassing all firewall hooks , and making its open ports invisible to scanners 
The Snake rootkit registers itself as Network Driver Interface Specification ( NDIS ) protocol driver 
Whenever the underlying miniport driver receives data from the network , it calls NDIS by invoking a data receive indication function NdisMIndicateReceiveNetBufferLists ( ) 
When that happens , NDIS invokes Snake 's hook function ( ProtocolReceiveNetBufferLists ) to process the received data 
To send the data back , the protocol driver defines the data in a list of NETBUFFERLIST structures , and then passes them to NDIS by calling NdisSendNetBufferLists ( ) 
NDIS , in turn , calls the miniport driver's MiniportSendNetBufferLists ( ) function to forward the data to an underlying miniport driver 
Being able to fully manipulate traffic at 3 different levels ( NDIS protocol driver , TDI Driver , and WPF callout driver ) , Snake is able to 'inject ' the traffic into existing communications to reach out to external components , and at the same time parse all incoming traffic to detect traffic addressed to itself : As the driver intercepts all connections ( e.g 
on TDIRECEIVE TDI event or ClientEventReceive ( ) event notification triggered through its TDI Filter Driver ) , it parses all incoming HTTP and SMTP traffic to see if it can be authenticated as Snake traffic 
The authentication is implemented by decrypting the data and making sure it starts with the markers 0xDEADBEAF and 0xC001BA5E ( which appear to derive from 'DEAD BEEF ' and 'COOL BASE ' ) 
Here are specific steps : By observing such behaviour , one might wonder why the driver is expecting HTTP or SMTP clients ? Why does it act like HTTP/SMTP server processing client traffic , and serving back normal responses as per the protocol ? For example , in HTTP the driver will respond with messages like '' HTTP/1.1 200 OK '' or '' HTTP/1.1 500 Server Error '' 
The reason behind such behaviour is that the driver is acting in this mode like a proxy , routing requests from other infected hosts to a remote C & C server 
: Once the incoming data is authenticated and decrypted , the driver passes it to the DLL by using memory pipes 
For example , on HTTP traffic arrival it may send traffic data into a memory pipe \Device\NamedPipe\isapihttp , and then , send a received peer-2-peer command message writepeernfo= [ IPADDRESS : PORT ] 0fragnoscrambling=Y0 into another memory pipe called \Device\NamedPipe\isapidg 
In order to log its activity , the driver writes log data into the pipe \Device\NamedPipe\isapilog , so that the DLL could log the data into the log files 
Full list of the named pipes used for communications is provided below : Messages submitted into the pipes are wrapped into the structures 
The structures appear to contain headers to allow the pipe server , that runs within an infected userland module , to identify the messages first and then unwrap the structures accordingly 
For example , the message headers could be : Once received from the pipes and unwrapped/decoded , the data is then handled by the usermode DLL as per the data intention - whether it 's a traffic sniffing task , a peer-2-peer client logic , a logging task , or a task of saving received files into the virtual volumes 
The driver creates virtual file volumes for encrypted storage of its files and configuration data : The volumes are mounted from the virtual file systems RawDisk1 and RawDisk2 
The first partition is created with the following steps : The hook installed by the rootkit on IofCallDriver ( ) API provides on-the-fly data encryption/decryption whenever that data is written to or read from the volume 
The encryption algorithm is based on CAST-128 , with the hard-coded key stored in the rootkit body 
As a result , whenever the data is saved into the volume Hd1 , it will be scrambled on-the-fly , and reflected in the persistent storage file hotfix.dat , which is physically located within the rootkit 's 'home ' directory : Analysis of the hotfix.dat file contents reveals it 's a fully encrypted file with flat entropy 
The data stored in \\.\Hd2 is encrypted the same way the first volume 's data 
Both volumes appear to be set up as FAT volumes 
An attempt to read the data from these volumes with the code below : This will produce the following results : For \\.\Hd1 : For \\.\Hd2 : The ability to keep its data on TrueCrypt-like volumes provides Snake with a powerful ability to exchange data with the usermode DLL , as these volumes are accessible both from usermode and kernel mode 
Static analysis of the code reveals that the Snake driver uses virtual volumes to store its data and additional files on it 
For example , it stores its message queue in a file called : The message queue indicates an asynchronous communication model between kernel mode driver and a usermode DLL , e.g 
Other files that may also be found on the virtual volume are : klog , conlog , dump , rknginst.exe , where rknginst.exe could be the name of the original dropper , and other log files could potentially contain executed command outputs , intercepted keystrokes , and other output logs 
The Snake dropper contains both 32-bit and 64-bit unsigned drivers , and it can successfully load its unsigned 64-bit driver on a 64-bit version of Windows XP – as driver signing is not enforced it does not have to resort to any tricks under this OS version 
In this case , in order to ensure the driver is loaded automatically at startup , the dropper can install the 64-bit driver on 64-bit Windows XP in the same way it installs a 32-bit driver on a 32-bit version of Windows XP 
On 64-bit versions of Windows Vista and above it behaves differently 
Firstly , the 64-bit unsigned driver file is created as usual : However , the driver is not registered ; what is registered instead is the dropper itself 
To do that , the dropper first copies itself as : The dropper then registers itself as a service to ensure it starts every time Windows is booted , by creating the values : Now comes the most interesting part : does the dropper manage to load its 64-bit unsigned driver under 64-bit versions of Windows Vista and later versions , such as 64-bit Windows 7/8 ? The answer : Yes , it does 
As there are no validations made for the UserBuffer an attacker can craft such input parameters that will define address within kernel memory to patch and the data to patch it with : Now that the vulnerable driver can be used as a weapon to patch kernel memory , all the malware needs to do is to patch the content of the variable nt ! gCiEnabled , a boolean variable '' Code Integrity Enabled '' that marks whether the system was booted in WinPE mode 
When running in WinPE mode there is no Code Integrity control , therefore by enabling this mode by patching only one bit , Code Integrity verification is disabled so that the unsigned 64-bit driver can be loaded 
In order to find the variable in kernel memory , the Snake dropper loads a copy of the NT core image ( ntoskrnl.exe ) , locates the import of CI.dll 's function CiInitialize ( ) , and then SepInitializeCodeIntegrity ( ) within it 
Then it parses the function 's code to locate the offset of the variable 
Once located , the content of the variable nt ! gCiEnabled is patched in kernel memory and the 64-bit unsigned driver is loaded 
This explains why Snake dropper registers itself as a service to start each time Windows starts : in order to install the vulnerable VBox driver first , then pass it a malformed structure to disable Code Integrity control with a DeviceIoControl ( ) API call , and finally , load the driver 
In order to be able to perform the steps above , the dropper must first obtain Administrator privileges 
It attempts to do this by running MS09-025 and MS10-015 exploits on the target system 
Other resources embedded within the dropper are the 32-bit and 64-bit builds of its driver , a tool for creating NTFS file systems , and the initial message queue file which is written into the virtual volume 
The message queue file contains configuration data and the libraries that will be injected into usermode processes 
The usermode DLLs injected by the kernel-mode driver into the userland system process ( e.g 
explorer.exe ) are : The rkctlWin32.dll/rkctlx64.dll module uses the following hard-coded named pipe for communications : The remote commands it receives appear to be designed to control other components of Snake : The injsnakeWin32.dll/injsnakex64.dll module exports 61 functions 
It is designed to perform the high-level tasks such as : When the DLL activates , it reads configuration parameters from the configuration queue , that the driver creates on a virtual volume 
One of the parameters defines the pipe name ( s ) that the DLL should use for its communications 
The remote commands received by this Snake DLL module are designed to set up various communication parameters : To post the data , the DLL can use the following User-Agent string '' Mozilla/4.0 ( compatible ; MSIE 6.0 ) '' 
It may rely on the following Internet Media types ( MIME types ) for data exfiltration : Request type it uses can either be POST of GET , and C & C server resource name is /default.asp 
One of the Snake components that could have been downloaded from a remote C & C server , was identified as a network reconnaissance tool 
When run as a command line tool , with its logic defined with the command line switches , this tool enumerates other network hosts and detects what Windows RPC services are enabled at the endpoints 
It carries a list of interface identifiers associated with the named pipes 
It then uses these identifiers to write a message to and read a message from the associated named pipes 
By knowing what RPC services are running , it can successfully fingerprint all network hosts by mimicking the Metasploit 's logic of OS fingerprinting via SMB 
The fingerprinting allows it to reveal the following characteristics for each host found in the network : The data it retrieves is encrypted and saved into a configuration file % system % \vtmon.bin 
This file is then further encrypted with an NTL-based ( Number Theory Library ) algorithm and is uploaded by the usermode-centric Snake rootkit to the C & C server , along with other configuration files , such as mtmon.sdb , mtmon32.sdb , gstatsnd.bin , gstat.bin , gstat32.bin , and other log files found in the % windows % \ $ NtUninstallQ [ random ] $ directory 
By using this function the remote attacker can identify any potentially exploitable hosts located in the same network as the victim 
The attacker may then craft an exploit against those hosts , possibly by using the Metasploit framework , and then deliver the generated shellcode back to the reconnaissance tool to be applied against the identified hosts by running the tool with the 'expos ' switch 
If the tool successfully delivers the payload and exploits the remote host ( s ) , it will replicate the infection across the network , taking control over new hosts , thus repeating the infection cycle all over again and spreading the infection further 
Unlike traditional worm techniques , this process is rather manual , but its danger is in the fact that the attacker can flexibly craft new attack methods , adjusting them to the hosts present within the network , thus preying on the weakest ( least updated , most vulnerable ) victims along its path 
It 's worth noting that Agent.BTZ used the same XOR key for its logs as the most recent variants : Log files created by the latest samples of Snake , compiled in 2013 and 2014 , were successfully decrypted with the same XOR key 
It is also sophisticated , using complex techniques for evading host defences and providing the attackers covert communication channels 
One approach is to delegate the network communication engine to usermode code , backed up by a usermode rootkit 
Another approach is to carry out all of the communications from the kernel-mode driver , which is a very challenging task by itself 
When most of the infected hosts are cut off from the outside world , it only needs one host to be connected online 
The traffic is then routed through that host to make external control and data exfiltration still possible 
The presence of the reconnaissance tool in the Snake operators ' framework suggests the existence of an arsenal of infiltration tools , designed to compromise a system , then find a way to replicate into other hosts , infect them , and spread the infection even further 
As demonstrated , the backdoor commands allow Snake to provide remote attackers with full remote access to the compromised system 
Its ability to hibernate , staying fully inactive for a number of days , makes its detection during that time very difficult 
The analysed code suggests that even file system and registry operations can be delegated by an infected module to another module in order to stay unnoticed by behaviour analysis engines of the antivirus products , and to overcome account restrictions of the browser processes so that the injected module could still write into files and into the sensitive registry hives 
The logs and dumps it creates on the hidden virtual volumes contributes to its stealthiness too 
A great deal of attention has also been given to keep its network communications as quiet as possible 
Its ability to generate malicious traffic whenever the user goes online and start loading the web pages allows it to 'blend in ' with the legitimate communications 
• The threat actors utilized a hosting provider that is a Pakistani-based company with subleased VPS space within the U.S. for command and control ( C2 ) 
• The customized malware ( BITTERBUG ) used by these threat actors has only been observed hosted on and communicating with two IP addresses operated by a Pakistan-based hosting provider 
To our knowledge this customized malware has only ever been observed hosted on and communicating with two command and control nodes : 199.91.173.43 and 199.91.173.45 
The following is a summary of the relationships between the hosting organizations and Tranchulas : • VPNSOC IP space was used as command and control nodes for attackers using variants of the BITTERBUG malware that contained build strings that referenced '' Tranchulas '' and a Tranchulas employee 
While the author field of '' hp '' does n't conclusively prove a relationship , it contributes to the body of circumstantial evidence which links properties of the official Tranchulas response to the properties of decoy documents that were used in conjunction with BITTERBUG targeting campaigns 
FireEye analyzed the malware , which they call BITTERBUG , and determined it to be a custom backdoor 
The backdoor relies on various support components , including the non-malicious , publically available Libcurl for installation , launch , and communications 
In some variants , BITTERBUG has the ability to automatically target and exfiltrate files with extensions such as .doc , .xls , .pdf , .ppt , .egm , and .xml 
One of these samples was probably used in attacks in late summer 2013 , using a '' leaked report '' lure which contained a decoy document related to Pakistan 's alleged inability to locate Osama Bin Laden 
Interestingly , the samples compiled following the blog publication used entirely new and generic debug paths ( Figure 11 ) as well as a compilation tactic to conceal the C2 address from static analysis 
Between December 2013 and late March 2014 , we observed several new lures used in BITTERBUG self-extracting RAR ( SFXRAR ) files 
One from December contained several BITTERBUG variants and used a decoy PDF document ( Figure 12 ) related to the December arrest of Devyani Khobragade , an Indian diplomat in the United States 
In spring 2014 , we observed a SFXRAR file with a filename lure related to the March 2014 disappearance of Malaysis Airlines Flight 370 ( cast as a Pakistan-related hijacking ) 
Interestingly , this SFXRAR 's filename was the only lure element related to the MH370 event ; it did not contain a decoy document 
BITTERBUG continued to rely on the same network behaviors to communicate with its C2s 
Connections to its C2 nodes relied on PHP and used communications that included '' .php ? compname= '' and '' .php ? srs= '' , as well as direct file/component retrieval from the C2s 
Though many of the samples that we have observed use direct IPs for HTTP communications , we have observed more limited use of a No-IP domain 
The threat actor appears to have exclusively used VPSNOC , a probable Pakistan-based VPS service provider who leased U.S. hosting services , for both the delivery and C2 phases of attack 
Many of the notable characteristics of the BITTERBUG activity suggest that this is indeed part of a Pakistan-based cyber exploitation effort that has apparently attempted to obfuscate its malware characteristics and origins ( behind U.S. infrastructure ) , before and after public disclosure in August 2013 
BITTERBUG is a backdoor executable capable of uploading and downloading files , listing running processes , generating file listings , and automatically transferring selected files to its command and control ( C2 ) server 
BITTERBUG appears to be virtual machine aware and may not execute on a VMWare or VirtualBox VM 
We have observed BITTERBUG installed by a self-extracting RAR archive disguised as a screensaver 
Upon execution , the self-extracting RAR archive may extract configuration files , dependency DLLs , and the BITTERBUG executable 
Upon execution the self-extracting RAR may install < BITTERBUG > .exe and the following DLLs : The self-extracting RAR may install the following benign configuration files : BITTERBUG first may execute the following Windows Management Instrumentation ( WMI ) command to detect the presence of a virtual machine ( VM ) : BITTERBUG then may open recovery.txt and check for the presence of strings VBox or VMware 
The backdoor then may enter an infinite sleep loop if recovery.txt contains either one of the aforementioned strings ( Example in Figure 13 ) 
Next BITTERBUG typically will beacon to the C2 server by sending the computer name and username of the compromised system 
BITTERBUG then may perform an HTTP GET request for the following URI : If the C2 server responds with a filename , the filename received is deleted from % APPDATA % \Microsoft < FILENAMEFROM C2 > 
The purpose of this command might be to delete older versions of BITTERBUG , although we have not observed this command occurring in the wild 
BITTERBUG then may attempt to download the files listed in Table 1 
The final two files are downloaded to the user 's Startup directory and executed at startup in order to maintain persistence 
Next , BITTERBUG may scan through each drive letter and search recursively for files with the following file extensions : BITTERBUG then typically creates a file list containing all documents ( excluding those whose filename contains MediaUtils ) to the following locations : BITTERBUG may also write a list of all running processes to : Finally , BITTERBUG typically uploads the running process list , document file list , and all documents to the following URI : BITTERBUG may be extracted along with the following embedded files : The malware may create the following files : • The malware typically communicates on TCP port 80 : • The malware may perform HTTP requests for the following URIs : We observed other interesting operational security-oriented challenges in the post-blog post samples 
Analysis of metadata within two benign decoy documents that were originally used within July 2013 BITTERBUG operations , Report.docx and NaxalitesFundedbyPakistan.docx , both maintained the author properties of '' hp '' 
